<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“… æ¯æ—¥å¾…åŠ</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='80'%3EğŸ“‹%3C/text%3E%3C/svg%3E">
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAUVBMVEX///8AAADHyMnP0NHX2NnJysvMzc7q6+z19fb39/j7+/z9/f7+/v/u7/Dz9PT29vfp6uv4+Pnx8vLs7e7i4+T5+frn6Onk5eb09PXw8fH8/PzY2drKyskAAACRAAAA6klEQVQ4T42T2w6CMAxGW1pAQFEUvOD7P6cttMwYJvGkycz3n7ZJm/yJiHjOWWstIuI5Z621iIjnnLXWIiKec9ZaizhnoLOzk/4f9o5DpyhUleY3Wp8Ov9EpChCaSSCT+T+GBHGJSCJ8Q3QMcYlIItJoQ4k88kPKCGxKj2hP4QG0t36pxYAFnIRSU8R3CCzgJJSaIr5DYAEH4UpbRqBpA2fhCnlChTSS7SftLoSMjnOBZTqf3v4T+Jj4cJj1NSMFZJL4aBT4QlqJm4c7iSWnCqRkSVqJ1YRfS8hJQoOSLpwJO6qR7YFo8kFZjXRYHqz+g22eBfEXqY8G2+w2FAAAAABJRU5ErkJggg==">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABXKSURBVHic7Z15fBTVvcc/5zszyWSbTDJZyEYS9gAJhLAoiCIoKiqKe61atdZa671W8fq89/re+3p9r7fW2mr7rFrr1lJrrVq1bq2CKCqLCIKsYQsECCEhZCEkk30mk5nMzP394wQSICuZzGSSPN+Pn/mQOXPO7/zOb373d8652xEREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREWkTx2gHMJKoqlpf89ddmJyxeHx+5fGy69uxY58XGC9LkmQsLi7Gbrfftl8Cz6+9+K3YpOcfeCwzPdXa9vEF/iZJyGprLU9fv/7A6NnOBMcgdMt8a+J8/PjxfLj80L3BQPCmPj7vl7fXfyLCMdKOVg6n6+P6+vqFdXX1J/5Ws+uf5eXl/o4G2xWO5s/u7u7x8+bNy03PSL00fdJ+t9Vqbc8hKnCP59ePEydO/NqNN954/yOPPKJFGsP/B5qamr7t8/l2ZGdnb33rrbe+GYhO6AAlq6KiYkxFRcXZhobGGgBVVTHo5O7YI4JhGLxZv3Xb1m3bb9VzYqJjHTAAVFdXF27cuHG6JElDJJL+/yP1wIEDlwwmyYBhaA2xTwh/EzQaDRiGAVVVDT2nK1BVFYZhGIHggKq3tbm2/D7Dw2fNTlnV/y0UURYV/QNsXPk6JO9NYD8+fHwBzK3KGJGrKooCXddJTU2lu7t7SFsrIvTQQx9/fOrYsWMrBrNNz5FjJ0Rnzpw5t6h8RlNlZWVPfWMDmfNfgl+HqvmDmJIKlrIJWJvWw5SIEtdBtY3BLj+FrfZ9rHXvYxfOwV6+FkddKY6SkyibO5AWw/KgBbPyeqKiLCrCBhNWgFLO+6sGI8og3wcdwG+/+d3MqVOmvOj3+5+/7777ek0Tx1hTaGBwO+08RqT0XEhEhB768bQqaEVRCNFIk1iN4zz/u7B5X6LGNgOAQjJYlNdpJ5VuUlFJQSMRjVS6ydKq2Gf7GlblBUye0xhDFhC5kxD86CDPOG3Q/Qfajh079OPHjz+uKMo/R0L0aOkYkqJ3OOy3j8AhOh5CaK11XHHN6hnT8xaOHlk2U5bly2fOnHn90gL21NbuDQaDgeDXnzr5xQVJfmRYLLN0w6BNF1AFNkGhWZKwA0aUH4+PCAztOqpJ6yNtZ3AcjTjG/W+6DJJwA4SbAUiIoRFNAg2JAqOJFEsFiUgjD8OyEt+2T9AoGhGPv8sTCW1KFCJXjR/z4gcf7hy2BnrpyIlvT1VV9f0333zzmxs3bnQ3Nze7AURZPPzjbZ2TmJ5P4OwbRHLOzXjyFqLpflRVHbKJQ1XHjRv3t+Li4u12u72wtLS04GJS6B7lHJqLSaEJTZK+YzNLH7ZGjZSdH+48jHWEJxJGdBKJbSU+/gCE9CL+wDkSwBcZORqKoqAoStRvvyP1IqiKw+T9H7cN61pxdHS8iqKcVBTlZGfTlC48Oq9q4LjJP7Z5fJfYbLYLKg62eTjWbC4vy7o8FPJbrVZr5BSioyn0kERPxKJvJ3S3L6qfx2d0nj9oZLOPwGabwYgIGz+UQh80NvgkjSvHo6L3KRNJ1EgkqYtOO/dK2j0Z4y4rKAh9G2hCe5lG8e4OSAI8NP9NrqGRRBpJRJGEi2aSsArNhKx5MvqOyM5wZGRkJM6ePXu5y+XKSk1NnTBcfXcpOq7NeV38xMHY3VkTUfbZW8trxjdjjqQ6cCczLkFJGEwJgqjVaLb+uSmqVXvyUqlj3lPD1meXU+gONST1SXhO7k+GqZJnb6Iv7nxM5LrL2o9tZvBa96I8sDcqeyfSEUWdNGlSfkND84zjR48NyyJKs8u8U8y8KlFzTgPGXo6uG6jDZOTY7VhsdhKSkjQZhY2N7zL9WDdM6zNPMGM8yt8b0He6t5vNdmwzHsGsKvFhpYyUuCiJoNB+A3XdYZo1Qxj5l0CK9RQWKzabn4T2VbBsNeZo4N7ZJNMKZ3lSZYDI0JGwIh3IMDT+fNnfb2hqqjJ7fV5v1XPPvRYI+K1Wm9ViNZmNRqNOr9frBFlWdCaTbDRJITmmJPGpVFy3xZ7BtWwx4FLlmqslZrBQ6vEKKhAMBhd7vd6NjdWfSocOH/ZUfn4oPTfHXVJSkpCVlZUTFZuhrzG++2BYOzTJZKnT5ZrvdDozHQ7H8xfaMv8m5g6pJO0sjpj3IfO7FJhVyqm1sLYU1Q2a6Q6YfjT8fW9qOm4/Pv9PZ+1fuf1qQNBV1Z/aKtUdZa7X6z+0Y8eOTZs3b2aqoqNgJFI7WxnbJH7/qVyBShMOLNgwE8SCnUQxjkQxDhNOFEkhIAYxhuwEgw0EQw0EAg0EQs0EQ20EQm2H7Gmdbe1I5S4YQXcn9Tk4jphD9V7VXlQeQRGjhkGkI5Whi+L0Ib9uGM0mtCIdYZh/jWGxd9rJkGBFwkqKWMdI6StuCBYWOKyL76gpOVtT8xQmHLx2t6VZO8OUuPi7+Ky4qFiEaYPNBcPvJyDcRFCpQQnVEgh1gxoEVUfQKJ3tJVofCEpWrJZxcfGLnClrHPaKm/ddPmP1K6+84V8lCRkK9HZpGgIIh7uTIKqugTEUjPNu5hGHQaJGT2fOGx2k0I41wGH/aMQTaR8K8/bWvWrjHGxzJ40YLW+1qVh6UB/aGQtL4+69J6pbwcI4AzLjbOVDmnYakmgpDYOLjceTlZGRcUdJSckdBQUFE8E2G3yDO9wdCEgGTJLo8gXM7aLQdqyY0eMRMRNRBxPdLGkTVCUKjZ+8LQHiIBgUPR4Lk+9d89YFR/oFf7Xq9LfmWlKmnPE78v6VPbGhO6mGgGFBsUmYLf2A4cKR9eXPSBe9bNtJyJBgVrTDJyLGzBCFtiGJTiQ5YCKgKB84k6PbkBhj7HMM8e2+eVx0GgihIy3xkmjmx6fev+bNHlPoj+esXr4kzbO8Mzlnwm8mprmM2mhGNwcHgsEwRLCRGELiE7DxMHfuM9zx4LN9gHNZW6sQJQpNaMhq+hBzp6/cBNMWob5eTJGWQM7fzHvdN4/rM4XeV/7BK0vzPCu68nNvfmlqmjtN6y1Ga2E9Y4Y8/Wr4q1RGMFRVBVXVhS+6jaLQNiQlJRJJ1LLObq5SkIwDZvFEp/8jha/+xb3Xe3O/L1Z/vz3vU6Mlr7aIY6mD6WQgRmGBxWHxnHg5gkGMwfQGVQ35+wJTTDNaP9zMLqZJyJG4Xk3o7mgdL0kSJlE0kjEjSV1yJzF6PJqR3nFyQ3uxvr7uVrfbvcjhcEzT8wjcQZ9vh81qu1zCRILJZVtlV5yrgJfKqBPfOdwthyqw2WzYbM5ik8l00uv19hqGaKcBwzDJEq6JQrSJOqLz7HZPCINl8XPLXzrfEUZz6tGXRJaezaOxtYOqLlOKo7n8JTFjBRjdOGuWz57x3HluMZJCO/H5n4aEiZS9FEGLnfzlbhZ9zKYbb7w7Y8aMGb8cOZj3tY1MVGV9VT0/e3FgQVr+qPaJREPg8XicubBt4z8XdKV4VjVOuPZHFpOldHgaD4/JrqZFr25fNJJCK8jGxhf5x5vfYRqNf7L22WdXXuL+KYCdAKJc7FQHVHr93eiw9o4JnYW52+fXWYKoXxVh9WKkbFRQfPRtb3E7hQ/vGrQ+sYB3YhgNt1+XGN1p3VgRvNFbCFy01l02FmhV6PkzdlzntSYts5gt3w4q4Wmd3XBPd/JZ6tLSKP1ycO6Z7Ybh+bLHhOIptK91XfLW8bJL3j55+tT8wQTWvlaPpJOkbYEo1KRXoHXHAONFi0qhF7qQIjNacruT25k8ZFhVcDrTvVkZhQvOvIqKgYJdTMTiXWyoHUVOdcdrDEZlFJqI1r6bVXNuvfRLAF1U+dBDj7zeFAx8RGxsKhYlJ/7OzHAhihTM1UVkHWCuTR+hVEYhihScWqWJgvJu0bEjI2T7/Ae0Y2CQbzQs2w1s3TbpMXS8GKbg4Lhfv7x/3AV+QEZxKVbGR60lBJP6Z4OJGkG2m8/7DF8O1h8xNMmRY7h9D4Hl5xOi/1aHIpQehmJpGM3zKLsOc3OJhJwlHFRLWTqRy1k6ccQjBmjJ7QfR5r6+9+F0u3TLLYvPbyNjjNadQKNGy9J1g3KUOHmfJMu3bNy4cW+fvUTfQnc0F6X7oVpZD8xhIIWvdHqtO2iQDqIwmnqg9fO6yNwJdMIKbhEatOSCUWCCMD4YfF8b7B6I7e9Dls1Jv/6MWzNzsq8M8lnI6LFN1LjzRhAaYFQIvxjSrEaJK9f7LJfQ3fkDIxfZrZ/6nO/s2PqHHTumJyTEjzfJyZLN5jAhGQ2ybFBxGDGYJKNJMuil5vdvmVjWPNhzBAVDMCgYAUVHfbPn3ba0aP3o04MNr/xjQEfqJeqMcCKNEgYhBp8n/33e3Xm0+fI7MKYjOcfHzrRu5IUIxSPHp+kqZV/c+bpbv2vX7gdbu90QhZbdF9eJ6pv6rFOdwVXODDnCQ6NCQ+DstSzJwsNP/YaYbhcOSzYG3Qwk92s4OsYPm6NXoM2UvOJbWW6vN6+9ZfYJX0GCtOMJDacFB5r9Vy72pQGF9TJhxcYnlNJHf7tPuzVHxMLJrCsRDQONlLJRFNnHiePHjw+mzn2p3hxvyKg5Jkm5iuT4Rp/dVXdLV2YK+7rJNS6e8xrfcUFjhQGhKNJJR+hk/4P0vLYKhRJJyzNGr5oFUINGD/esBHBT/5NpKRLisFkUaA6t1W/hUXBQNHVgHaQkVOjkTzJyJBIoBRU7tWlpvHyV0pZx9fpqNn7U8Xz3tuJZmSELhZPxrI6CyYjDbkdMJHQjohGi3E5k3cHs2zFXdGZ8WKUV9mGn8DRGOzVvdOeGrGjEWJgHXdoQ7e9vBKTWBEUggZdp7bVvq8btWCW9rLcQ6GyD7yrNvNNl5OG3iA8ckJjsWLFTVNT04mRdpHaF6TKVjrtrq7gLnFhg6b+MvFnQHHaWnAO9WGgJ5xAn08ZEHNdI+FOpLjY+VjqWZY5Zw5lBRPLBOJRjzGdtQjkVOJ9lqNyB4P0yYXE1FUf7vY9FiYJx0wRjVFdLdpKJLxnJE1TXuvELQ96Oac8ydL5rFqJrPDQRCqZxgGaJyOB3IfxPdQoIKsZZFG2FJwOTJTLiVYT7PhXs23eBtAjBuJKJp5BZmOzq4DGShPqpqdE+zFgr9YSGgihzTEeqgUFVVPQUJeR7OGlFf7VnpDAaGx+l28u4Pz6NrOjN+vAg8dkJ+c0G8dGMwoJSPnT+sPVUmcZzOEjERiUbHhL7YFiZ2JNqN4J4l3iVkOW3yEzrAE7n+9rLdePcDW7cPZ3/jJo3TdwRJzxMnqeQnRRdmj6RUIrYiYtELqd9RVFXfCMsSDjNYL2HTGKMFnCxLkvTfJqN8WcI7O6f/Vl5CYXz9ot/RuAULCvYNd19eH8nJIskJqY8Xzt5FZ81bEYZAm67pOkbjpVdRJb3vfRG4COJD9tKCHHKOjnCALFOT6h7zQlCVvzn6/FLqNM2AzaxPkpBvR7Jqf2i2mTLzchJKVWGy6O+3b53cY8Gi3xmPPPJIrKOj4y6fzxdEjmFNzJ2Lk7FmP1GQSyNOpMJ3v1yLGHH09xNnR6OHhsJ1jT/8bWoE3bE7NmJhncTnezBvJQTvJJqr8Ci9w0z1OIOJ6zW2GcvfLbztvx79PjjlKXTxnKEWDnOb6lMqiOLHWz5E9LN4mgjKfWEjKfQQpQ5w4s8zEFoD7v1Fob3hNxL7yFi0Dd4frT6ZU8fCHJKRRR08ZZHFnzKaZOX+d7Y8m3Kz94J+XhNgfXBMGKwjnQ+vELaAc5qjJEwf9Lqv4Kxo4Y7dnvKPgOAP0dO8KORgZEEr+r4A1U5sOhg73q/AATG10GdHh6sGAAAAAElFTkSuQmCC">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            /*min-height: 100vh;*/
            height: 100%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        /* ç¡®ä¿å®¹å™¨å†…çš„ç›´æ¥å­å…ƒç´ æ— é¢å¤–é—´è· */
        .container > .filter-section,
        .container > .function-section,
        .container > .settings-section {
            margin: 0;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .progress-info {
            font-size: 16px;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 6px;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        /* ç§»åŠ¨ç«¯å¤´éƒ¨ä¼˜åŒ– - å¤§å¹…å‹ç¼©é«˜åº¦ */
        @media (max-width: 768px) {
            .header {
                padding: 8px 16px; /* å¤§å¹…å‡å°‘ä¸Šä¸‹padding */
            }

            .header h1 {
                font-size: 18px; /* å¤§å¹…å‡å°å­—ä½“ */
                margin-bottom: 3px; /* å¤§å¹…å‡å°‘ä¸‹è¾¹è· */
            }

            .progress-info {
                font-size: 13px; /* å¤§å¹…å‡å°å­—ä½“ */
            }

            .progress-bar {
                height: 3px; /* å¤§å¹…å‡å°è¿›åº¦æ¡é«˜åº¦ */
                margin-top: 4px; /* å¤§å¹…å‡å°‘ä¸Šè¾¹è· */
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 6px 14px; /* å°å±å¹•æœ€å°padding */
            }

            .header h1 {
                font-size: 16px; /* å°å±å¹•æœ€å°å­—ä½“ */
                margin-bottom: 2px; /* æœ€å°ä¸‹è¾¹è· */
            }

            .progress-info {
                font-size: 12px; /* å°å±å¹•æœ€å°å­—ä½“ */
            }

            .progress-bar {
                height: 2px; /* å°å±å¹•æœ€ç»†è¿›åº¦æ¡ */
                margin-top: 2px; /* æœ€å°ä¸Šè¾¹è· */
            }
        }

        .progress-fill {
            background: #4caf50;
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .add-task {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .add-task-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-input-row {
            display: flex;
            gap: 8px;
        }

        .task-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .task-input:focus {
            border-color: #667eea;
        }

        .add-btn {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .add-btn:hover {
            background: #5a6fd8;
        }

        .task-options {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .task-select {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
        }

        .task-list {
            max-height: calc(100vh - 350px); /* åŠ¨æ€è®¡ç®—ï¼Œè€ƒè™‘å¤´éƒ¨ã€ç­›é€‰å™¨å’Œåº•éƒ¨å¯¼èˆªæ  */
            overflow-y: auto;
            padding-right: 4px; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºç©ºé—´ */
            scrollbar-width: thin; /* Firefoxæ»šåŠ¨æ¡æ ·å¼ */
            margin-bottom: 20px; /* åº•éƒ¨ç•™ç™½ */
        }

        /* ç§»åŠ¨ç«¯ä»»åŠ¡åˆ—è¡¨è‡ªé€‚åº” */
        @media (max-width: 768px) {
            .task-list {
                max-height: calc(100vh - 280px); /* ç§»åŠ¨ç«¯åŠ¨æ€è®¡ç®—é«˜åº¦ */
                max-width: 100%; /* ç§»åŠ¨ç«¯å……åˆ†åˆ©ç”¨å±å¹•å®½åº¦ */
                width: 100%; /* ç¡®ä¿å®½åº¦å……æ»¡å®¹å™¨ */
                padding-right: 2px; /* ç§»åŠ¨ç«¯å‡å°‘å³ä¾§padding */
                margin: 0 0 15px 0; /* ç§»é™¤ä¾§è¾¹è·ï¼Œä¿ç•™åº•éƒ¨é—´è· */
            }

            .task-item {
                padding: 10px 16px; /* ç§»åŠ¨ç«¯è¿›ä¸€æ­¥å‡å°‘padding */
                font-size: 15px; /* ç§»åŠ¨ç«¯è°ƒæ•´å­—ä½“å¤§å° */
                width: 100%; /* ç¡®ä¿ä»»åŠ¡é¡¹å……æ»¡å®½åº¦ */
                box-sizing: border-box; /* åŒ…å«paddingåœ¨å®½åº¦è®¡ç®—å†… */
            }

            .task-title {
                font-size: 16px; /* ç§»åŠ¨ç«¯ä»»åŠ¡æ ‡é¢˜å­—ä½“ */
                line-height: 1.4;
                flex: 1; /* æ ‡é¢˜å ç”¨æ›´å¤šå¯ç”¨ç©ºé—´ */
                /*max-width: calc(100% - 50px); !* ä¸ºæŒ‰é’®ç•™å‡ºç©ºé—´ *!*/
            }

            .task-notes {
                font-size: 13px; /* ç§»åŠ¨ç«¯å¤‡æ³¨å­—ä½“ */
                line-height: 1.3;
                width: 100%; /* å¤‡æ³¨å……æ»¡å¯ç”¨å®½åº¦ */
            }

            .task-content {
                flex: 1; /* å†…å®¹åŒºåŸŸå ç”¨æ›´å¤šç©ºé—´ */
                min-width: 0; /* å…è®¸flexæ”¶ç¼© */
            }

            .task-complete-btn {
                width: 28px; /* ç§»åŠ¨ç«¯å®ŒæˆæŒ‰é’®å°ºå¯¸ */
                height: 28px;
                min-width: 44px; /* ä¿è¯è§¦æ‘¸åŒºåŸŸ */
                min-height: 44px;
            }

            .action-btn {
                padding: 8px 12px; /* ç§»åŠ¨ç«¯æ“ä½œæŒ‰é’® */
                font-size: 12px;
                min-width: 44px;
                min-height: 44px;
            }

            .task-options {
                flex-shrink: 0; /* æ“ä½œæŒ‰é’®åŒºåŸŸä¸æ”¶ç¼© */
                min-width: 120px; /* ç§»åŠ¨ç«¯æ“ä½œåŒºåŸŸæœ€å°å®½åº¦ */
            }
        }

        @media (max-width: 480px) {
            .task-list {
                max-height: calc(100vh - 260px); /* å°å±å¹•åŠ¨æ€è®¡ç®—é«˜åº¦ */
                max-width: 100%; /* å°å±å¹•å……åˆ†åˆ©ç”¨å±å¹•å®½åº¦ */
                width: 100%; /* ç¡®ä¿å®½åº¦å……æ»¡å®¹å™¨ */
                padding-right: 0; /* å°å±å¹•å–æ¶ˆå³ä¾§padding */
                margin: 0 0 10px 0; /* ç§»é™¤ä¾§è¾¹è·ï¼Œä¿ç•™åº•éƒ¨é—´è· */
                padding-left: 0; /* å°å±å¹•ä¹Ÿç§»é™¤å·¦ä¾§padding */
            }

            .task-item {
                padding: 8px 14px; /* å°å±å¹•è¿›ä¸€æ­¥å‡å°‘padding */
                font-size: 14px;
                width: 100%; /* ç¡®ä¿ä»»åŠ¡é¡¹å……æ»¡å®½åº¦ */
                box-sizing: border-box; /* åŒ…å«paddingåœ¨å®½åº¦è®¡ç®—å†… */
            }

            .task-title {
                font-size: 15px; /* å°å±å¹•ä»»åŠ¡æ ‡é¢˜å­—ä½“ */
                flex: 1; /* æ ‡é¢˜å ç”¨æ›´å¤šå¯ç”¨ç©ºé—´ */
                /*max-width: calc(100% - 50px); !* å°å±å¹•ä¸ºæŒ‰é’®ç•™å‡ºæ›´å°‘ç©ºé—´ *!*/
            }

            .task-notes {
                font-size: 12px; /* å°å±å¹•å¤‡æ³¨å­—ä½“ */
                width: 100%; /* å¤‡æ³¨å……æ»¡å¯ç”¨å®½åº¦ */
            }

            .task-content {
                flex: 1; /* å†…å®¹åŒºåŸŸå ç”¨æ›´å¤šç©ºé—´ */
                min-width: 0; /* å…è®¸flexæ”¶ç¼© */
            }

            .task-complete-btn {
                width: 26px; /* å°å±å¹•å®ŒæˆæŒ‰é’®å°ºå¯¸ */
                height: 26px;
            }

            .action-btn {
                padding: 6px 10px; /* å°å±å¹•æ“ä½œæŒ‰é’® */
                font-size: 11px;
            }

            .task-options {
                gap: 6px; /* å°å±å¹•æ“ä½œæŒ‰é’®é—´è· */
                flex-shrink: 0; /* æ“ä½œæŒ‰é’®åŒºåŸŸä¸æ”¶ç¼© */
                min-width: 100px; /* æ“ä½œåŒºåŸŸæœ€å°å®½åº¦ */
            }
        }

        /* Webkitæµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ */
        .task-list::-webkit-scrollbar {
            width: 6px;
        }

        .task-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .task-list::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        /* ç§»åŠ¨ç«¯æ»šåŠ¨æ¡ä¼˜åŒ– */
        @media (max-width: 768px) {
            .task-list::-webkit-scrollbar {
                width: 4px; /* ç§»åŠ¨ç«¯æ›´ç»†çš„æ»šåŠ¨æ¡ */
            }
        }

        @media (max-width: 480px) {
            .task-list::-webkit-scrollbar {
                width: 3px; /* å°å±å¹•æ›´ç»†çš„æ»šåŠ¨æ¡ */
            }

            .task-list::-webkit-scrollbar-track {
                background: transparent; /* å°å±å¹•éšè—æ»šåŠ¨æ¡è½¨é“ */
            }
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .task-item:hover {
            background-color: #f8f9fa;
        }

        .task-item.completed {
            opacity: 0.6;
        }

        .task-complete-btn {
            width: 32px;
            height: 32px;
            border: 2px solid #ddd;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 12px;
            flex-shrink: 0;
            font-size: 16px;
            outline: none;
        }

        .task-complete-btn:hover {
            border-color: #667eea;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .task-complete-btn.completed {
            background: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        .task-complete-btn.completed:hover {
            background: #45a049;
            border-color: #45a049;
        }

        /* ç¦ç”¨çŠ¶æ€çš„å®ŒæˆæŒ‰é’®æ ·å¼ */
        .task-complete-btn.disabled {
            background: #f0f0f0;
            border-color: #ddd;
            color: #bbb;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .task-complete-btn.disabled:hover {
            background: #f0f0f0;
            border-color: #ddd;
            color: #bbb;
        }

        /* æ— æƒé™æ“ä½œçš„ä»»åŠ¡æ ·å¼ */
        .task-item.not-operable {
            opacity: 0.7;
        }

        .task-item.not-operable .batch-checkbox:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .task-item.not-operable .task-assignee {
            background: #ff9500;
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            position: relative;
        }

        .task-item.not-operable .task-assignee::after {
            content: " (åªè¯»)";
            font-size: 10px;
            opacity: 0.9;
        }

        .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .task-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 4px;
            transition: all 0.2s;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: #999;
        }

        .task-notes {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        .task-item.completed .task-notes {
            color: #999;
        }

        .task-time-info {
            display: flex;
            gap: 12px;
            margin-top: 6px;
            font-size: 11px;
            color: #999;
        }

        .task-created, .task-completed {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .task-created::before {
            content: 'ğŸ“…';
            font-size: 10px;
        }

        .task-completed::before {
            content: 'âœ…';
            font-size: 10px;
        }

        .task-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .task-category {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
        }

        .category-work { background: #ff6b6b; }
        .category-life { background: #4ecdc4; }
        .category-study { background: #45b7d1; }
        .category-other { background: #96ceb4; }

        .task-priority {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: bold;
        }

        .priority-high { background: #ffebee; color: #d32f2f; }
        .priority-medium { background: #fff3e0; color: #f57c00; }
        .priority-low { background: #e8f5e8; color: #388e3c; }

        .task-deadline {
            font-size: 12px;
            color: #666;
        }

        .task-deadline.overdue {
            color: #d32f2f;
            font-weight: bold;
        }

        .task-assignee {
            font-size: 12px;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 6px;
            border-radius: 12px;
            font-weight: 500;
        }

        .task-item.overdue {
            border-left: 4px solid #d32f2f;
            background-color: #fff5f5;
        }

        .overdue-badge {
            background: #d32f2f;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: 8px;
            font-weight: bold;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            margin-left: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .edit-btn {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            color: #1976d2;
            border: 2px solid rgba(25, 118, 210, 0.2);
            box-shadow:
                0 2px 8px rgba(25, 118, 210, 0.1),
                0 1px 4px rgba(25, 118, 210, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .edit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(25, 118, 210, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .edit-btn:hover {
            background: linear-gradient(135deg, #bbdefb 0%, #e1bee7 100%);
            border-color: rgba(25, 118, 210, 0.4);
            box-shadow:
                0 6px 20px rgba(25, 118, 210, 0.25),
                0 3px 10px rgba(25, 118, 210, 0.15),
                0 1px 4px rgba(25, 118, 210, 0.1),
                inset 0 2px 0 rgba(255, 255, 255, 0.6);
            transform: translateY(-1px);
        }

        .edit-btn:hover::before {
            left: 100%;
        }

        .edit-btn:active {
            transform: translateY(1px) scale(0.98);
            box-shadow:
                0 2px 8px rgba(25, 118, 210, 0.2),
                0 1px 4px rgba(25, 118, 210, 0.1),
                inset 0 2px 4px rgba(25, 118, 210, 0.1);
            background: linear-gradient(135deg, #90caf9 0%, #ce93d8 100%);
        }

        .delete-btn {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #d32f2f;
            border: 2px solid rgba(211, 47, 47, 0.2);
            box-shadow:
                0 2px 8px rgba(211, 47, 47, 0.1),
                0 1px 4px rgba(211, 47, 47, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .delete-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(211, 47, 47, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, #ffcdd2 0%, #f8bbd9 100%);
            border-color: rgba(211, 47, 47, 0.4);
            box-shadow:
                0 6px 20px rgba(211, 47, 47, 0.25),
                0 3px 10px rgba(211, 47, 47, 0.15),
                0 1px 4px rgba(211, 47, 47, 0.1),
                inset 0 2px 0 rgba(255, 255, 255, 0.6);
            transform: translateY(-1px);
        }

        .delete-btn:hover::before {
            left: 100%;
        }

        .delete-btn:active {
            transform: translateY(1px) scale(0.98);
            box-shadow:
                0 2px 8px rgba(211, 47, 47, 0.2),
                0 1px 4px rgba(211, 47, 47, 0.1),
                inset 0 2px 4px rgba(211, 47, 47, 0.1);
            background: linear-gradient(135deg, #ef9a9a 0%, #f48fb1 100%);
        }

        /* Emojiå›¾æ ‡ä¼˜åŒ–æ ·å¼ */
        .emoji-icon {
            display: inline-block;
            font-size: 18px;
            line-height: 1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-shadow:
                0 2px 4px rgba(0, 0, 0, 0.15),
                0 1px 2px rgba(0, 0, 0, 0.1);
            font-family:
                "Apple Color Emoji",
                "Segoe UI Emoji",
                "Noto Color Emoji",
                "Android Emoji",
                "EmojiOne Color",
                "Twemoji Mozilla",
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-feature-settings: "liga" off;
            filter: contrast(1.1) brightness(1.05) saturate(1.1);
            transform-origin: center;
        }

        .edit-btn:hover .emoji-icon {
            transform: scale(1.25) translateY(-2px) rotate(8deg);
            text-shadow:
                0 4px 8px rgba(25, 118, 210, 0.5),
                0 2px 4px rgba(25, 118, 210, 0.3),
                0 0 0 rgba(255, 255, 255, 0.8);
            filter:
                contrast(1.2)
                brightness(1.1)
                saturate(1.2)
                drop-shadow(0 3px 6px rgba(25, 118, 210, 0.3));
            animation: editBounce 0.6s ease-out;
        }

        @keyframes editBounce {
            0% { transform: scale(1) translateY(0) rotate(0deg); }
            30% { transform: scale(1.35) translateY(-3px) rotate(12deg); }
            60% { transform: scale(1.15) translateY(-1px) rotate(5deg); }
            100% { transform: scale(1.25) translateY(-2px) rotate(8deg); }
        }

        .delete-btn:hover .emoji-icon {
            transform: scale(1.25) translateY(-2px) rotate(-8deg);
            text-shadow:
                0 4px 8px rgba(211, 47, 47, 0.5),
                0 2px 4px rgba(211, 47, 47, 0.3),
                0 0 0 rgba(255, 255, 255, 0.8);
            filter:
                contrast(1.2)
                brightness(1.1)
                saturate(1.2)
                drop-shadow(0 3px 6px rgba(211, 47, 47, 0.3));
            animation: deleteBounce 0.6s ease-out;
        }

        @keyframes deleteBounce {
            0% { transform: scale(1) translateY(0) rotate(0deg); }
            30% { transform: scale(1.35) translateY(-3px) rotate(-12deg); }
            60% { transform: scale(1.15) translateY(-1px) rotate(-5deg); }
            100% { transform: scale(1.25) translateY(-2px) rotate(-8deg); }
        }

        .action-btn:active .emoji-icon {
            transform: scale(0.8) translateY(1px);
            text-shadow:
                0 1px 2px rgba(0, 0, 0, 0.4),
                0 0 4px rgba(0, 0, 0, 0.2);
            filter:
                contrast(1.3)
                brightness(0.95)
                saturate(1.1);
            animation: clickPulse 0.15s ease-out;
        }

        @keyframes clickPulse {
            0% { transform: scale(1.25) translateY(-2px); }
            50% { transform: scale(0.75) translateY(2px); }
            100% { transform: scale(0.8) translateY(1px); }
        }

        /* ç¦ç”¨çŠ¶æ€çš„emojiæ ·å¼ */
        .action-btn.disabled .emoji-icon {
            opacity: 0.3;
            filter: grayscale(100%) brightness(0.8);
            transform: none;
        }

        .action-btn.disabled:hover .emoji-icon {
            transform: none;
            text-shadow: none;
        }

        /* ä¸åŒå°ºå¯¸çš„emojié€‚é… */
        @media (max-width: 768px) {
            .emoji-icon {
                font-size: 25px;
            }
            .edit-btn:hover .emoji-icon,
            .delete-btn:hover .emoji-icon {
                transform: scale(1.2) translateY(-1px) rotate(6deg);
            }
        }

        @media (max-width: 480px) {
            .emoji-icon {
                font-size: 25px;
            }
            .edit-btn:hover .emoji-icon,
            .delete-btn:hover .emoji-icon {
                animation: none;
                transform: scale(1.15) translateY(-1px) rotate(4deg);
            }
            .action-btn:active .emoji-icon {
                animation: none;
                transform: scale(0.85) translateY(0.5px);
            }
        }

        /* é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ */
        @media (prefers-contrast: high) {
            .edit-btn {
                border: 2px solid #1976d2;
            }
            .delete-btn {
                border: 2px solid #d32f2f;
            }
            .emoji-icon {
                text-shadow: 0 0 3px rgba(0, 0, 0, 0.8), 0 1px 0 rgba(255, 255, 255, 0.8);
                filter: contrast(1.5) brightness(1.1);
            }
            .edit-btn:hover .emoji-icon {
                text-shadow: 0 0 5px rgba(25, 118, 210, 0.8), 0 2px 0 rgba(255, 255, 255, 0.9);
            }
            .delete-btn:hover .emoji-icon {
                text-shadow: 0 0 5px rgba(211, 47, 47, 0.8), 0 2px 0 rgba(255, 255, 255, 0.9);
            }
        }

        /* å‡å°‘åŠ¨ç”»æ¨¡å¼æ”¯æŒ */
        @media (prefers-reduced-motion: reduce) {
            .emoji-icon {
                transition: none;
            }
            .edit-btn:hover .emoji-icon,
            .delete-btn:hover .emoji-icon,
            .action-btn:active .emoji-icon {
                transform: none;
                animation: none;
            }
            .edit-btn:hover .emoji-icon {
                text-shadow: 0 2px 4px rgba(25, 118, 210, 0.4);
            }
            .delete-btn:hover .emoji-icon {
                text-shadow: 0 2px 4px rgba(211, 47, 47, 0.4);
            }

            /* å¯¼èˆªæ åŠ¨ç”»ç¦ç”¨ */
            .nav-btn.active::before,
            .nav-add-btn::before {
                animation: none;
            }
            .nav-add-btn {
                animation: none;
            }
            .nav-btn.active .nav-icon,
            .nav-btn:hover:not(.active) .nav-icon,
            .nav-add-btn:hover .nav-add-icon {
                animation: none;
            }
            .nav-add-btn:hover .nav-add-icon {
                transform: rotate(45deg) scale(1.05);
            }
        }

        /* æ·±è‰²æ¨¡å¼ä¼˜åŒ– */
        @media (prefers-color-scheme: dark) {
            .edit-btn {
                background: #1a237e;
                color: #90caf9;
                border: 1px solid rgba(144, 202, 249, 0.3);
            }
            .edit-btn:hover {
                background: #283593;
                box-shadow: 0 4px 12px rgba(144, 202, 249, 0.3);
            }
            .edit-btn:hover .emoji-icon {
                text-shadow: 0 3px 6px rgba(144, 202, 249, 0.6);
                filter: brightness(1.2) contrast(1.1);
            }
            .delete-btn {
                background: #b71c1c;
                color: #ffcdd2;
                border: 1px solid rgba(255, 205, 210, 0.3);
            }
            .delete-btn:hover {
                background: #c62828;
                box-shadow: 0 4px 12px rgba(255, 205, 210, 0.3);
            }
            .delete-btn:hover .emoji-icon {
                text-shadow: 0 3px 6px rgba(255, 205, 210, 0.6);
                filter: brightness(1.2) contrast(1.1);
            }
            .nav-btn.active {
                background: rgba(144, 202, 249, 0.15);
                border: 1px solid rgba(144, 202, 249, 0.3);
            }
            .nav-btn:hover:not(.active) {
                background: rgba(144, 202, 249, 0.1);
            }
            .emoji-icon {
                text-shadow: 0 1px 3px rgba(255, 255, 255, 0.1);
            }
        }

        /* Android 14 å…¼å®¹æ€§ä¼˜åŒ– */
        .delete-btn:active {
            background: #ff9999 !important;
            transform: scale(0.95);
        }

        /* ç¡®ä¿æŒ‰é’®å¯ç‚¹å‡» */
        .delete-btn {
            -webkit-tap-highlight-color: rgba(211, 47, 47, 0.3);
            tap-highlight-color: rgba(211, 47, 47, 0.3);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            pointer-events: auto;
        }

        .footer {
            padding: 20px;
            border-top: 1px solid #eee;
            background: #f8f9fa;
        }

        /* ç»Ÿä¸€æ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„åŸºç¡€æ ·å¼ */
        .filter-section,
        .function-section,
        .settings-section {
            background: #f8f9fa;
            border: none;
            margin: 0;
            padding: 0;
            display: block;
            position: relative;
        }

        /* ä¸ºæ¯ä¸ªæ¨¡å—æ·»åŠ åˆ†éš”çº¿ */
        .filter-section {
            border-bottom: 1px solid #e9ecef;
        }

        .function-section {
            border-bottom: 1px solid #e9ecef;
        }

        .settings-section {
            border-bottom: 1px solid #e9ecef;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        /* ç»Ÿä¸€çš„section-headeræ ·å¼ */
        .section-header {
            padding: 16px 20px;
            background: #e9ecef;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: none;
            border-bottom: 1px solid #dee2e6;
            transition: background-color 0.2s;
            margin: 0;
            position: relative;
        }

        .section-header:hover {
            background: #dee2e6;
        }

        .section-header:hover .collapse-icon {
            background: rgba(102, 126, 234, 0.25); /* headeræ‚¬åœæ—¶å›¾æ ‡èƒŒæ™¯æ›´æ˜æ˜¾ */
        }

        /* ç¡®ä¿ç¬¬ä¸€ä¸ªæ¨¡å—çš„headeræ²¡æœ‰ä¸Šè¾¹æ¡† */
        .filter-section .section-header {
            border-top: none;
        }

        .section-title {
            font-weight: 600;
            font-size: 15px; /* ç¨å¾®å¢å¤§å­—ä½“ */
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px; /* å›¾æ ‡å’Œæ–‡å­—é—´è· */
        }

        .section-header:hover .section-title {
            color: #333; /* æ‚¬åœæ—¶æ ‡é¢˜é¢œè‰²æ›´æ·± */
        }

        .collapse-icon {
            font-size: 16px; /* å¢å¤§å­—ä½“ */
            color: #667eea; /* ä½¿ç”¨ä¸»é¢˜è‰² */
            font-weight: 600; /* åŠ ç²— */
            transition: all 0.3s ease;
            padding: 4px 8px; /* å¢åŠ ç‚¹å‡»åŒºåŸŸ */
            border-radius: 4px; /* åœ†è§’ */
            background: rgba(102, 126, 234, 0.1); /* èƒŒæ™¯è‰² */
            min-width: 32px; /* æœ€å°å®½åº¦ */
            text-align: center; /* å±…ä¸­ */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .collapse-icon:hover {
            background: rgba(102, 126, 234, 0.2); /* æ‚¬åœæ•ˆæœ */
            transform: scale(1.05); /* è½»å¾®æ”¾å¤§ */
        }

        .collapse-icon.collapsed {
            transform: rotate(-90deg);
            background: rgba(102, 126, 234, 0.15); /* æŠ˜å çŠ¶æ€èƒŒæ™¯ */
        }

        .collapse-icon.collapsed:hover {
            transform: rotate(-90deg) scale(1.05); /* ä¿æŒæ—‹è½¬çš„åŒæ—¶æ”¾å¤§ */
        }

        /* ç§»åŠ¨ç«¯æŠ˜å å›¾æ ‡ä¼˜åŒ– - ç´§å‡‘åŒ– */
        @media (max-width: 768px) {
            .collapse-icon {
                font-size: 14px; /* ç§»åŠ¨ç«¯ç´§å‡‘å­—ä½“ */
                padding: 3px 6px; /* ç´§å‡‘è§¦æ‘¸åŒºåŸŸ */
                min-width: 24px; /* ç´§å‡‘æœ€å°å®½åº¦ */
                border-radius: 3px; /* æ›´å°åœ†è§’ */
            }
        }

        @media (max-width: 480px) {
            .collapse-icon {
                font-size: 12px; /* å°å±å¹•ç´§å‡‘å­—ä½“ */
                padding: 2px 4px; /* æé™è§¦æ‘¸åŒºåŸŸ */
                min-width: 20px; /* æé™æœ€å°å®½åº¦ */
                border-radius: 2px; /* æé™åœ†è§’ */
            }
        }

        /* ç§»åŠ¨ç«¯ç»Ÿè®¡ä¿¡æ¯åŒºåŸŸä¼˜åŒ– - å¤§å¹…å‹ç¼©é«˜åº¦ */
        @media (max-width: 768px) {
            .stats-row {
                padding: 3px 0; /* å¤§å¹…å‡å°‘ä¸Šä¸‹padding */
                margin-top: 2px; /* å¤§å¹…å‡å°‘ä¸Šè¾¹è· */
                border-radius: 3px; /* æ›´å°åœ†è§’ */
            }

            .stats-row .stat-number {
                font-size: 12px; /* å¤§å¹…å‡å°æ•°å­—å­—ä½“ */
                margin-bottom: 0px; /* æ— ä¸‹è¾¹è· */
            }

            .stats-row .stat-label {
                font-size: 8px; /* å¤§å¹…å‡å°æ ‡ç­¾å­—ä½“ */
            }
        }

        @media (max-width: 480px) {
            .stats-row {
                padding: 2px 0; /* å°å±å¹•æœ€å°padding */
                margin-top: 1px; /* æœ€å°ä¸Šè¾¹è· */
                border-radius: 2px; /* æœ€å°åœ†è§’ */
            }

            .stats-row .stat-number {
                font-size: 10px; /* å°å±å¹•æœ€å°æ•°å­—å­—ä½“ */
                margin-bottom: 0px; /* æ— ä¸‹è¾¹è· */
            }

            .stats-row .stat-label {
                font-size: 6px; /* å°å±å¹•æœ€å°æ ‡ç­¾å­—ä½“ */
            }
        }

        /* ç§»åŠ¨ç«¯ç­›é€‰è®¾ç½®åŒºåŸŸæ•´ä½“ä¼˜åŒ– - æé™å‹ç¼©é«˜åº¦ */
        @media (max-width: 768px) {
            .section-header {
                padding: 2px 8px; /* æé™å‡å°‘ç§»åŠ¨ç«¯section-headerçš„padding */
                min-height: 28px; /* è®¾ç½®æœ€å°é«˜åº¦ */
            }

            .section-title {
                font-size: 9px; /* ç§»åŠ¨ç«¯æé™å‡å°å­—ä½“ */
                gap: 2px; /* æé™å‡å°‘å›¾æ ‡å’Œæ–‡å­—é—´è· */
                line-height: 1.2; /* å‡å°‘è¡Œé«˜ */
            }

            .collapsible-content {
                padding: 4px; /* æé™å‡å°‘ç§»åŠ¨ç«¯å†…å®¹åŒºåŸŸçš„padding */
            }

            .collapsible-content.collapsed {
                padding: 0 4px; /* ä¿æŒå·¦å³paddingä¸€è‡´ */
            }

            /* ç­›é€‰å™¨å†…éƒ¨å…ƒç´ æé™ä¼˜åŒ– */
            .filter-row {
                gap: 2px; /* æé™å‡å°‘ç­›é€‰è¡Œé—´è· */
                margin-bottom: 2px; /* æé™å‡å°‘ä¸‹è¾¹è· */
                flex-wrap: wrap; /* å…è®¸æ¢è¡Œä»¥èŠ‚çœç©ºé—´ */
            }

            .filter-group {
                margin-bottom: 2px; /* æé™å‡å°‘ç­›é€‰ç»„ä¸‹è¾¹è· */
                min-width: 80px; /* è®¾ç½®æœ€å°å®½åº¦ */
            }

            .filter-label {
                font-size: 8px; /* æé™å‡å°æ ‡ç­¾å­—ä½“ */
                margin-bottom: 0px; /* æ— ä¸‹è¾¹è· */
                line-height: 1.1; /* å‡å°‘è¡Œé«˜ */
            }

            .filter-select {
                padding: 1px 4px; /* æé™å‡å°‘é€‰æ‹©æ¡†padding */
                font-size: 9px; /* æé™å‡å°å­—ä½“ */
                min-height: 20px; /* å‡å°æœ€å°é«˜åº¦ */
                line-height: 1.2; /* å‡å°‘è¡Œé«˜ */
            }

            /* çŠ¶æ€ç­›é€‰æŒ‰é’®ä¼˜åŒ– */
            .status-filter-buttons {
                gap: 2px; /* æé™å‡å°‘æŒ‰é’®é—´è· */
                margin: 2px 0; /* æé™å‡å°‘ä¸Šä¸‹è¾¹è· */
            }

            .status-filter-btn {
                padding: 2px 6px; /* æé™å‡å°‘æŒ‰é’®padding */
                font-size: 8px; /* æé™å‡å°å­—ä½“ */
                min-height: 18px; /* å‡å°æœ€å°é«˜åº¦ */
                line-height: 1.1; /* å‡å°‘è¡Œé«˜ */
            }
        }

        @media (max-width: 480px) {
            .section-header {
                padding: 1px 6px; /* å°å±å¹•æé™padding */
                min-height: 24px; /* æ›´å°æœ€å°é«˜åº¦ */
            }

            .section-title {
                font-size: 8px; /* å°å±å¹•æé™å­—ä½“ */
                gap: 1px; /* æé™å›¾æ ‡å’Œæ–‡å­—é—´è· */
                line-height: 1.1; /* æé™è¡Œé«˜ */
            }

            .collapsible-content {
                padding: 3px; /* å°å±å¹•æé™padding */
            }

            .collapsible-content.collapsed {
                padding: 0 3px; /* ä¿æŒå·¦å³paddingä¸€è‡´ */
            }

            /* å°å±å¹•ç­›é€‰å™¨å†…éƒ¨å…ƒç´ æé™åŒ– */
            .filter-row {
                gap: 1px; /* æé™ç­›é€‰è¡Œé—´è· */
                margin-bottom: 1px; /* æé™ä¸‹è¾¹è· */
                flex-wrap: wrap; /* å…è®¸æ¢è¡ŒèŠ‚çœç©ºé—´ */
            }

            .filter-group {
                margin-bottom: 1px; /* æé™ç­›é€‰ç»„ä¸‹è¾¹è· */
                min-width: 70px; /* æ›´å°æœ€å°å®½åº¦ */
            }

            .filter-label {
                font-size: 7px; /* æé™æ ‡ç­¾å­—ä½“ */
                margin-bottom: 0px; /* æ— ä¸‹è¾¹è· */
                line-height: 1.0; /* æé™è¡Œé«˜ */
            }

            .filter-select {
                padding: 0px 2px; /* æé™é€‰æ‹©æ¡†padding */
                font-size: 8px; /* æé™å­—ä½“ */
                min-height: 16px; /* æé™æœ€å°é«˜åº¦ */
                line-height: 1.1; /* æé™è¡Œé«˜ */
            }

            /* å°å±å¹•çŠ¶æ€ç­›é€‰æŒ‰é’®æé™ä¼˜åŒ– */
            .status-filter-buttons {
                gap: 1px; /* æé™æŒ‰é’®é—´è· */
                margin: 1px 0; /* æé™ä¸Šä¸‹è¾¹è· */
                flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */
            }

            .status-filter-btn {
                padding: 1px 4px; /* æé™æŒ‰é’®padding */
                font-size: 7px; /* æé™å­—ä½“ */
                min-height: 14px; /* æé™æœ€å°é«˜åº¦ */
                line-height: 1.0; /* æé™è¡Œé«˜ */
            }
        }

        .collapsible-content {
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            max-height: 800px;
            padding: 20px;
            margin: 0; /* ç¡®ä¿æ²¡æœ‰å¤–è¾¹è· */
        }

        .collapsible-content.collapsed {
            max-height: 0;
            padding: 0 20px;
            margin: 0; /* ç¡®ä¿æŠ˜å æ—¶æ²¡æœ‰å¤–è¾¹è· */
        }

        .footer-actions {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        .footer-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .filter-btn {
            background: #e8f4fd;
            color: #1976d2;
        }

        .filter-btn:hover, .filter-btn.active {
            background: #1976d2;
            color: white;
        }

        .export-btn {
            background: #e8f5e8;
            color: #388e3c;
        }

        .export-btn:hover {
            background: #388e3c;
            color: white;
        }

        .import-btn {
            background: #fff3e0;
            color: #f57c00;
        }

        .import-btn:hover {
            background: #f57c00;
            color: white;
        }

        .stats {
            margin-top: 16px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* ç¼–è¾‘æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 12000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* ç§»åŠ¨ç«¯è¡¨å•é€‰æ‹©æ¡†ä¼˜åŒ– */
        @media (max-width: 768px) {
            /* é˜²æ­¢iOS Safariè‡ªåŠ¨ç¼©æ”¾ */
            input, select, textarea {
                font-size: 10px !important;
            }
            .form-select {
                font-size: 16px;
                min-height: 44px;
                padding: 12px 16px;
                border-radius: 8px;
                background: white;
                border: 2px solid #e1e5e9;
                /* ä¿æŒåŸç”Ÿappearance */
            }

            .form-select:focus {
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                outline: none;
            }

            /* iOS Safariä¼˜åŒ– */
            @supports (-webkit-touch-callout: none) {
                .form-select {
                    -webkit-appearance: menulist;
                    -webkit-border-radius: 8px;
                }
            }

            /* iOSè®¾å¤‡ä¸“ç”¨æ ·å¼ */
            .ios-device .form-select,
            .ios-device .filter-select {
                -webkit-appearance: menulist;
                border-radius: 8px;
                background: white;
                cursor: pointer;
            }

            .ios-device .form-select:focus,
            .ios-device .filter-select:focus {
                -webkit-user-select: none;
                user-select: none;
            }

            /* Androidè®¾å¤‡ä¼˜åŒ– */
            .android-device .form-select,
            .android-device .filter-select {
                -webkit-appearance: menulist;
                -moz-appearance: menulist;
                appearance: auto;
                background: white;
                border: 2px solid #e1e5e9;
            }

            /* Android 12+ é€‰æ‹©æ¡†ä¼˜åŒ– - å¼ºåˆ¶ä¸‹æ‹‰åˆ—è¡¨æ¨¡å¼ */
            .android-14-compat .form-select,
            .android-14-compat .filter-select {
                background: white;
                border: 2px solid #667eea;
                border-radius: 8px;
                -webkit-appearance: menulist !important;
                -moz-appearance: menulist !important;
                appearance: menulist !important;
                background-image: none;
                padding-right: 30px;
            }

            .form-input {
                font-size: 16px;
                min-height: 44px;
                border-radius: 8px;
            }

            .form-textarea {
                font-size: 16px;
                border-radius: 8px;
            }
        }

        .form-textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .btn-cancel {
            padding: 10px 20px;
            background: #f5f5f5;
            color: #666;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-save {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        /* å®Œæˆäººæ·»åŠ æŒ‰é’®æ ·å¼ */
        .assignee-add-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btn-add-assignee {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .btn-add-assignee:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
        }

        .btn-add-assignee:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .btn-add-assignee .icon-plus {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
        }

        /* ç­›é€‰å™¨æ ·å¼å·²åœ¨ç»Ÿä¸€æ¨¡å—æ ·å¼ä¸­å®šä¹‰ */

        .filter-row {
            display: flex;
            gap: 12px;
            margin-bottom: 2px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .filter-row:last-child {
            margin-bottom: 0;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 120px;
            flex: 1;
        }

        .filter-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
        }

        .filter-select {
            padding: 3px 5px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 10px;
            outline: none;
            background: white;
            min-width: 100px;
        }

        .filter-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        /* ä¼˜åŒ–çš„ç­›é€‰å™¨æ–°æ ·å¼ */
        .filter-input {
            padding: 6px 10px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 13px;
            outline: none;
            background: white;
            width: 100%;
            min-height: 32px;
        }

        .filter-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* ä¼˜åŒ–ç­›é€‰å™¨å­—ä½“å’Œé—´è· */
        .filter-label {
            font-size: 10px !important;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
            margin-bottom: 3px;
        }

        .filter-select {
            padding: 3px 5px !important;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 9px !important;
            outline: none;
            background: white;
            min-width: 80px !important;
            max-width: 150px;
            min-height: 28px !important;
        }

        .filter-row {
            display: flex;
            gap: 8px !important;
            margin-bottom: 8px !important;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 2px !important;
            min-width: 60px;
            flex: 1;
        }

        /* å¯æŠ˜å è¡Œçš„æ ·å¼ */
        .collapsible-row {
            transition: all 0.3s ease;
            overflow: visible;
        }

        .collapsible-row.collapsed {
            display: none;
        }

        /* ç­›é€‰å†…å®¹åŒºåŸŸæ ·å¼ */
        .filter-content {
            padding: 12px 16px;
            background: #f8f9fa;
        }

        /* åŠŸèƒ½æŒ‰é’®æ ·å¼ */
        .function-btn {
            padding: 6px 12px;
            border: 2px solid #667eea;
            border-radius: 6px;
            background: white;
            color: #667eea;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-height: 32px;
        }

        .function-btn:hover {
            background: #667eea;
            color: white;
        }

        .function-btn.active {
            background: #667eea;
            color: white;
        }

        /* å¤šé€‰ä¸‹æ‹‰æ¡†ä¼˜åŒ–æ ·å¼ */
        select[multiple].filter-select {
            min-height: 32px;
            max-height: 80px;
            overflow-y: auto;
            padding: 4px 6px !important;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            position: relative;
        }

        select[multiple].filter-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }

        /* å¤šé€‰ä¸‹æ‹‰æ¡†é€‰é¡¹æ ·å¼ */
        select[multiple].filter-select option {
            padding: 3px 6px;
            border-radius: 3px;
            margin: 1px 0;
            font-size: 11px;
            line-height: 1.3;
            background: white;
            color: #333;
            cursor: pointer;
        }

        select[multiple].filter-select option:checked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 500;
        }

        select[multiple].filter-select option:hover {
            background: #f0f3ff;
        }

        select[multiple].filter-select option:checked:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        /* çŠ¶æ€ç­›é€‰ç‰¹æ®Šæ ·å¼ */
        #statusFilter option[value="all"]:checked {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        #statusFilter option[value="active"]:checked {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }

        #statusFilter option[value="completed"]:checked {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        #statusFilter option[value="overdue"]:checked {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }

        /* å®Œæˆäººç­›é€‰æ ·å¼ */
        #assigneeFilter option:checked {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
        }

        /* å¤šé€‰æ¡†å¤–è§‚æŒ‡ç¤ºå™¨ */
        select[multiple].filter-select::after {
            content: "â–¼ å¤šé€‰";
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 9px;
            color: #666;
            pointer-events: none;
            background: white;
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* ç§»åŠ¨ç«¯å¤šé€‰ä¸‹æ‹‰æ¡†ä¼˜åŒ– */
        @media (max-width: 768px) {
            select[multiple].filter-select {
                min-height: 28px;
                max-height: 70px;
                font-size: 10px;
                padding: 3px 5px !important;
            }

            select[multiple].filter-select option {
                padding: 2px 4px;
                font-size: 10px;
                line-height: 1.2;
            }

            select[multiple].filter-select::after {
                font-size: 8px;
                padding: 1px 3px;
                right: 6px;
            }
        }

        /* å°å±å¹•ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 480px) {
            select[multiple].filter-select {
                min-height: 26px;
                max-height: 60px;
                font-size: 9px;
                padding: 2px 4px !important;
            }

            select[multiple].filter-select option {
                padding: 1px 3px;
                font-size: 9px;
                line-height: 1.1;
            }

            select[multiple].filter-select::after {
                font-size: 7px;
                padding: 1px 2px;
                right: 4px;
            }
        }

        /* å¤šé€‰ä¸‹æ‹‰æ¡†çŠ¶æ€æç¤º */
        .filter-group:has(select[multiple]) .filter-label::after {
            content: " (å¯å¤šé€‰)";
            font-size: 8px;
            color: #999;
            font-weight: normal;
        }

        /* é€‰ä¸­çŠ¶æ€æ•°é‡æ˜¾ç¤º */
        .multi-select-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            line-height: 16px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .filter-group {
            position: relative;
        }

        /* å½“æœ‰å¤šä¸ªé€‰ä¸­é¡¹æ—¶æ˜¾ç¤ºæ•°é‡æ ‡è¯† */
        .filter-group:has(select[multiple]) .multi-select-count.show {
            display: block;
        }

        /* ç‰¹æ®Šæ ·å¼ï¼šå…¨é€‰çŠ¶æ€ */
        select[multiple].filter-select.all-selected {
            border-color: #28a745;
            background: linear-gradient(to right, #f8fff9, white);
        }

        /* ç‰¹æ®Šæ ·å¼ï¼šéƒ¨åˆ†é€‰ä¸­çŠ¶æ€ */
        select[multiple].filter-select.partial-selected {
            border-color: #ffc107;
            background: linear-gradient(to right, #fffbf0, white);
        }

        /* è‡ªå®šä¹‰ä¸‹æ‹‰é€‰æ‹©å™¨æ ·å¼ */
        .custom-select {
            position: relative;
            display: inline-block;
            width: 100%;
            min-width: 80px;
            max-width: 150px;
        }

        .custom-select-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px 8px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            min-height: 28px;
            font-size: 11px;
            transition: all 0.2s ease;
            user-select: none;
        }

        .custom-select-trigger:hover {
            border-color: #c1c5c9;
        }

        .custom-select-trigger.active {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .custom-select-display {
            flex: 1;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .custom-select-arrow {
            margin-left: 5px;
            font-size: 10px;
            color: #666;
            transition: transform 0.2s ease;
        }

        .custom-select-trigger.active .custom-select-arrow {
            transform: rotate(180deg);
        }

        .custom-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #667eea;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 120px;
            overflow-y: auto;
            z-index: 16000;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .custom-select-dropdown.active {
            display: block;
        }

        .custom-select-option {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            cursor: pointer;
            font-size: 11px;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
        }

        .custom-select-option:last-child {
            border-bottom: none;
        }

        .custom-select-option:hover {
            background-color: #f0f3ff;
        }

        .custom-select-option.selected {
            background-color: #667eea;
            color: white;
            font-weight: 500;
        }

        .custom-select-option.selected:hover {
            background-color: #5a6fd8;
        }

        .custom-select-checkbox {
            margin-right: 6px;
            width: 12px;
            height: 12px;
            accent-color: #667eea;
        }

        /* é€‰ä¸­çŠ¶æ€æ˜¾ç¤ºæ ‡ç­¾ */
        .selected-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-top: 2px;
        }

        .selected-tag {
            background: #667eea;
            color: white;
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 9px;
            line-height: 1.2;
        }

        /* çŠ¶æ€ç‰¹æ®Šé¢œè‰² */
        .status-tag-all { background: #28a745; }
        .status-tag-active { background: #ffc107; color: #333; }
        .status-tag-completed { background: #28a745; }
        .status-tag-overdue { background: #dc3545; }

        .assignee-tag { background: #17a2b8; }

        /* è‡ªå®šä¹‰ä¸‹æ‹‰é€‰æ‹©å™¨ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .custom-select-trigger {
                padding: 4px 6px;
                min-height: 26px;
                font-size: 10px;
            }

            .custom-select-option {
                padding: 5px 6px;
                font-size: 10px;
            }

            .custom-select-dropdown {
                max-height: 100px;
            }

            .selected-tag {
                font-size: 8px;
                padding: 1px 3px;
            }
        }

        @media (max-width: 480px) {
            .custom-select-trigger {
                padding: 3px 5px;
                min-height: 24px;
                font-size: 9px;
            }

            .custom-select-option {
                padding: 4px 5px;
                font-size: 9px;
            }

            .custom-select-dropdown {
                max-height: 80px;
            }

            .selected-tag {
                font-size: 7px;
                padding: 1px 2px;
            }
        }

        /* ç»Ÿè®¡ä¿¡æ¯è¡Œæ ·å¼ */
        .stats-row {
            display: flex;
            justify-content: space-around;
            padding: 6px 0;
            margin-top: 4px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            backdrop-filter: blur(10px);
        }

        .stats-row .stat-item {
            text-align: center;
            flex: 1;
        }

        .stats-row .stat-number {
            font-size: 16px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 2px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .stats-row .stat-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* æ·»åŠ ä»»åŠ¡æŒ‰é’®æ ·å¼ */
        .add-task-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
        }

        .add-task-btn:hover {
            background: #45a049;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.4);
        }

        /* è¡¨å•è¡Œæ ·å¼ */
        .form-row {
            display: flex;
            gap: 16px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .daily-todo-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .daily-todo-btn:hover {
            background: #5a6fd8;
        }

        .clear-filters-btn {
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .clear-filters-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .clear-filters-btn:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }

        .clear-filters-btn:hover::before {
            left: 100%;
        }

        .clear-filters-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* å¤é€‰æ¡†ç»„æ ·å¼ */
        .form-checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .form-checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .form-checkbox-group span {
            font-size: 14px;
            color: #333;
            cursor: pointer;
        }

        /* æ‰¹é‡æ“ä½œæ ·å¼ */
        .batch-controls {
            margin-top: 0;
            padding: 16px 20px;
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            border-top: 1px solid #dee2e6;
            border-radius: 0;
        }

        .batch-info {
            font-size: 14px;
            color: #667eea;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .batch-actions {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .batch-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .select-all-btn {
            background: #4caf50;
            color: white;
        }

        .select-all-btn:hover {
            background: #45a049;
        }

        .deselect-all-btn {
            background: #ff9800;
            color: white;
        }

        .deselect-all-btn:hover {
            background: #e68900;
        }

        .delete-selected-btn {
            background: #f44336;
            color: white;
        }

        .delete-selected-btn:hover {
            background: #da190b;
        }

        .complete-selected-btn {
            background: #2196f3;
            color: white;
        }

        .complete-selected-btn:hover {
            background: #0b7dda;
        }

        .cancel-batch-btn {
            background: #757575;
            color: white;
        }

        .cancel-batch-btn:hover {
            background: #616161;
        }

        .batch-mode-btn {
            background: #9c27b0;
            color: white;
        }

        .batch-mode-btn:hover {
            background: #7b1fa2;
        }

        .batch-mode-btn.active {
            background: #d32f2f;
            border: 2px solid #b71c1c;
        }

        .batch-mode-btn.active:hover {
            background: #c62828;
        }

        /* æ‰¹é‡é€‰æ‹©å¤é€‰æ¡† */
        .batch-checkbox {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            cursor: pointer;
            accent-color: #667eea;
        }

        /* æ‰¹é‡æ¨¡å¼ä¸‹çš„ä»»åŠ¡é¡¹æ ·å¼ */
        .batch-mode .task-item {
            padding-left: 12px;
        }

        /* Android è®¾å¤‡è§¦æ‘¸ä¼˜åŒ– */
        .action-btn {
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        /* Android 14 æ‰¹é‡æ“ä½œæŒ‰é’®ä¼˜åŒ– */
        .android-14-compat .batch-btn {
            min-width: 48px !important;
            min-height: 48px !important;
            font-size: 14px !important;
            padding: 8px 16px !important;
        }

        /* Android 14 å›¾ç‰‡ä¸Šä¼ ä¼˜åŒ– */
        .android-14-compat .image-upload-area {
            cursor: pointer !important;
            touch-action: manipulation !important;
            -webkit-tap-highlight-color: rgba(103, 126, 234, 0.3) !important;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
            user-select: none !important;
        }

        .android-14-compat .image-upload-area:active {
            background: rgba(103, 126, 234, 0.1) !important;
            transform: scale(0.98) !important;
        }

        .android-14-compat input[type="file"] {
            position: absolute !important;
            left: -9999px !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        .android-14-compat .delete-selected-btn {
            background: #f44336 !important;
            border: 2px solid #d32f2f !important;
        }

        .android-14-compat .delete-selected-btn:active {
            background: #c62828 !important;
            transform: scale(0.95);
        }

        /* Android 12+ çŠ¶æ€ç­›é€‰æŒ‰é’®ä¸“ç”¨ä¿®å¤ */
        .android-14-compat .status-filter-buttons {
            display: flex !important;
            flex-wrap: nowrap !important;
            gap: 2px !important;
            width: 100% !important;
            box-sizing: border-box !important;
            justify-content: space-between !important;
            align-items: stretch !important;
        }

        .android-14-compat .status-filter-btn {
            flex: 1 !important;
            min-width: 0 !important;
            max-width: none !important;
            padding: 6px 2px !important;
            font-size: 10px !important;
            border-width: 1px !important;
            border-radius: 4px !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            text-align: center !important;
            box-sizing: border-box !important;
            -webkit-box-sizing: border-box !important;
            -moz-box-sizing: border-box !important;
        }

        /* Android 12+ å¼ºåˆ¶å•è¡Œæ˜¾ç¤º */
        .android-14-compat .status-filter-btn:nth-child(1),
        .android-14-compat .status-filter-btn:nth-child(2),
        .android-14-compat .status-filter-btn:nth-child(3) {
            flex: 1 !important;
            min-width: 0 !important;
            max-width: calc(33.333% - 2px) !important;
        }

        /* æ‰€æœ‰Androidè®¾å¤‡çš„ä¿é™©æªæ–½ */
        .android-device .status-filter-buttons {
            display: flex !important;
            flex-wrap: nowrap !important;
            width: 100% !important;
        }

        .android-device .status-filter-btn {
            flex: 1 !important;
            min-width: 0 !important;
            white-space: nowrap !important;
            box-sizing: border-box !important;
        }

        /* æ‰€æœ‰Androidè®¾å¤‡é€‰æ‹©æ¡†åŸºç¡€ä¼˜åŒ– */
        .android-device select,
        .android-device .filter-select,
        .android-device .form-select {
            -webkit-appearance: menulist;
            -moz-appearance: menulist;
            appearance: menulist;
            background-image: none;
            min-height: 44px;
            font-size: 16px;
            padding-right: 24px;
        }

        /* ä»»åŠ¡å®Œæˆæ¨¡æ€æ¡†æ ·å¼ */
        .complete-task-info {
            padding: 16px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .task-title-display {
            font-size: 16px;
            font-weight: 500;
            color: #2c3e50;
            line-height: 1.4;
        }

        .completion-time {
            padding: 12px 16px;
            background: #e8f5e8;
            border-radius: 6px;
            color: #2e7d32;
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* åŒå›¾ç‰‡ä¸Šä¼ å®¹å™¨ */
        .images-upload-container {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }

        /* å›¾ç‰‡ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .image-upload-area {
            flex: 1;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* å·²ä¸Šä¼ å›¾ç‰‡åçš„ä¸Šä¼ åŒºåŸŸæ ·å¼ - é˜²æ­¢è¯¯è§¦ */
        .image-upload-area.has-image {
            cursor: default;
            pointer-events: none;
            border-color: #e0e0e0;
            background: #f5f5f5;
        }

        .image-upload-area:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }

        /* ä»»åŠ¡å®Œæˆåæ–‡ä»¶é€‰æ‹©åŒºåŸŸç¼©å°é˜²è¯¯è§¦ */
        .image-upload-area.completed {
            min-height: 60px;
            padding: 8px;
            border-color: #ccc;
            background: #f8f8f8;
            transform: scale(0.85);
            opacity: 0.7;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .image-upload-area.completed .upload-icon {
            font-size: 20px;
            color: #999;
        }

        .image-upload-area.completed .upload-text {
            font-size: 12px;
            color: #999;
        }

        /* ç§»åŠ¨ç«¯åŒå›¾ç‰‡ä¸Šä¼ ä¼˜åŒ– */
        @media (max-width: 768px) {
            .images-upload-container {
                flex-direction: column;
                gap: 10px;
            }

            .image-upload-area {
                min-height: 80px;
                padding: 8px;
            }

            .image-upload-area.completed {
                min-height: 40px;
                padding: 4px;
                transform: scale(0.75);
            }

            .image-upload-area.has-image {
                min-height: 70px;
                padding: 6px;
            }
        }

        .upload-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .upload-icon {
            font-size: 32px;
            color: #666;
        }

        .upload-text {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .upload-placeholder small {
            color: #888;
            font-size: 11px;
        }

        /* ç§»åŠ¨ç«¯è¿›ä¸€æ­¥ç¼©å°ä¸Šä¼ åŒºåŸŸæ–‡å­— */
        @media (max-width: 768px) {
            .upload-text {
                font-size: 12px;
            }

            .upload-placeholder small {
                font-size: 10px;
            }

            .upload-icon {
                font-size: 24px;
            }
        }

        .image-preview {
            position: relative;
            display: inline-block;
        }

        .image-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .remove-image-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff4757;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-image-btn:hover {
            background: #ff3838;
        }

        /* å›¾ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡†æ ·å¼ */
        .image-viewer {
            max-width: 90vw;
            max-height: 90vh;
            width: auto;
        }

        .image-view-container {
            text-align: center;
            padding: 20px;
        }

        .image-view-container img {
            max-width: 80vw;
            max-height: 60vh;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        /* æ•°æ®åŒæ­¥Loadingæ ·å¼ */
        .sync-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 15000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .sync-loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .sync-loading-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            text-align: center;
            max-width: 280px;
            width: 90%;
        }

        .sync-loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            position: relative;
        }

        .sync-loading-spinner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 4px solid #e3f2fd;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: syncSpin 1s linear infinite;
        }

        @keyframes syncSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .sync-loading-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .sync-loading-subtitle {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        /* åŒæ­¥æŒ‰é’®loadingçŠ¶æ€ */
        .fab-action.syncing {
            animation: syncButtonSpin 1s linear infinite;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        @keyframes syncButtonSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fab-action.syncing .fab-action-icon {
            opacity: 0.8;
        }

        .image-info {
            padding: 16px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 16px;
        }

        .task-info {
            font-size: 16px;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .completion-info {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        /* å›¾ç‰‡å¯¼èˆªæ ·å¼ */
        .image-navigation {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            padding: 0 20px;
            transform: translateY(-50%);
        }

        .nav-btn {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .nav-btn {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .image-navigation {
                padding: 0 15px;
            }
        }

        /* ä»»åŠ¡åˆ—è¡¨ä¸­çš„ç¼©ç•¥å›¾æ ·å¼ */
        .task-completion-media {
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .completion-thumbnail {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid #e9ecef;
            transition: all 0.2s ease;
        }

        .completion-thumbnail:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .completion-notes {
            font-size: 12px;
            color: #666;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .completion-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* å·²å®Œæˆä»»åŠ¡çš„å®Œæˆä¿¡æ¯å±•ç¤º */
        .task-item.completed .task-completion-media {
            opacity: 0.8;
        }

        /* çŠ¶æ€ç­›é€‰æŒ‰é’®æ ·å¼ */
        .status-filter-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: nowrap; /* å¼ºåˆ¶å•è¡Œæ˜¾ç¤º */
            align-items: center;
            width: 100%;
        }

        .status-filter-btn {
            flex: 1;
            padding: 8px 6px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            color: #666;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            min-width: 0;
            text-align: center;
            white-space: nowrap;
            box-sizing: border-box;
        }

        .status-filter-btn:hover {
            border-color: #667eea;
            color: #667eea;
            background: #f0f3ff;
        }

        .status-filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .status-filter-btn.active:hover {
            background: #5a6fd8;
            border-color: #5a6fd8;
        }

        /* è®¾ç½®æ¨¡å—æŒ‰é’®æ ·å¼ */
        .settings-section .footer-btn {
            font-size: 13px;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 500;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }

        /* æ¯æ—¥å¾…åŠè®¾ç½®æŒ‰é’® */
        .settings-section .daily-todo-btn:first-child {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* å¾®ä¿¡é€šçŸ¥è®¾ç½®æŒ‰é’® */
        .settings-section .daily-todo-btn:nth-child(2) {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        /* æ•°æ®åº“è®¾ç½®æŒ‰é’® */
        .settings-section .daily-todo-btn:last-child {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        /* è®¾ç½®æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .settings-section .daily-todo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .settings-section .daily-todo-btn:first-child:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .settings-section .daily-todo-btn:nth-child(2):hover {
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
        }

        .settings-section .daily-todo-btn:last-child:hover {
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
        }

        /* è®¾ç½®æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
        .settings-section .daily-todo-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* è®¾ç½®æŒ‰é’®å…‰æ³½æ•ˆæœ */
        .settings-section .daily-todo-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .settings-section .daily-todo-btn:hover::before {
            left: 100%;
        }

        /* è®¾ç½®æŒ‰é’®å›¾æ ‡åŠ¨ç”» */
        .settings-section .daily-todo-btn {
            text-decoration: none;
        }

        .settings-section .daily-todo-btn:hover {
            animation: settingButtonPulse 2s infinite;
        }

        @keyframes settingButtonPulse {
            0% { transform: translateY(-2px) scale(1); }
            50% { transform: translateY(-2px) scale(1.02); }
            100% { transform: translateY(-2px) scale(1); }
        }

        /* è®¾ç½®åŒºåŸŸå¤´éƒ¨æ ·å¼ */
        .settings-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 16px 0;
        }

        .settings-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .settings-icon {
            font-size: 24px;
            animation: settingsIconRotate 3s ease-in-out infinite;
        }

        .settings-text {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .settings-subtitle {
            font-size: 12px;
            color: #6c757d;
            font-weight: 400;
        }

        @keyframes settingsIconRotate {
            0%, 90%, 100% { transform: rotate(0deg); }
            95% { transform: rotate(360deg); }
        }

        /* è®¾ç½®ç½‘æ ¼å¸ƒå±€ */
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        /* è®¾ç½®å¡ç‰‡æ ·å¼ */
        .setting-card {
            display: flex !important;
            align-items: center;
            justify-content: flex-start !important;
            text-align: left;
            padding: 16px 20px !important;
            min-height: 80px !important;
            width: 100% !important;
            gap: 14px !important;
            box-sizing: border-box;
            white-space: normal; /* å…è®¸æ¢è¡Œ */
            overflow: visible; /* å…è®¸å†…å®¹æ˜¾ç¤º */
        }

        .setting-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }

        .setting-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 3px;
            min-width: 0; /* å…è®¸æ”¶ç¼© */
        }

        .setting-title {
            font-size: 14px;
            font-weight: 600;
            color: inherit;
            line-height: 1.4;
            margin: 0;
            word-wrap: break-word;
            word-break: keep-all;
        }

        .setting-desc {
            font-size: 11px;
            opacity: 0.9;
            color: inherit;
            line-height: 1.4;
            margin: 0;
            word-wrap: break-word;
            word-break: keep-all;
        }

        /* ä¸­ç­‰å±å¹•é€‚é… (481px-768px) */
        @media (max-width: 768px) and (min-width: 481px) {
            .footer-actions {
                gap: 8px;
            }

            .footer-actions .footer-btn {
                flex: 1 1 calc(33.333% - 6px);
                min-width: calc(33.333% - 6px);
                padding: 10px 6px;
                font-size: 13px;
            }

            .footer-actions .footer-btn:nth-child(n+7) {
                flex: 1 1 calc(50% - 4px);
                min-width: calc(50% - 4px);
            }
        }

        /* å¤§å±ç§»åŠ¨ç«¯ä¼˜åŒ– (414px+ å®½åº¦ - iPhone Plus/Maxç³»åˆ—) */
        @media (max-width: 768px) and (min-width: 415px) {
            .status-filter-buttons {
                display: flex;
                gap: 10px;
                flex-wrap: nowrap;
                justify-content: center;
            }

            .status-filter-btn {
                flex: 0 0 auto;
                padding: 12px 20px;
                font-size: 14px;
                min-width: 80px;
                border-radius: 8px;
            }
        }

        /* 375pxç²¾ç¡®ä¼˜åŒ– (iPhone 6/7/8æ ‡å‡†å°ºå¯¸) */
        @media (max-width: 375px) and (min-width: 360px) {
            .status-filter-buttons {
                gap: 3px;
            }

            .status-filter-btn {
                padding: 7px 3px;
                font-size: 11px;
                border-width: 1px;
                border-radius: 5px;
            }
        }

        /* ä¸­ç­‰ç§»åŠ¨ç«¯å±å¹•ä¼˜åŒ– (376px-414pxå®½åº¦) */
        @media (max-width: 414px) and (min-width: 376px) {
            .status-filter-btn {
                padding: 9px 6px;
                font-size: 12px;
            }
        }

        /* ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡ - å®Œå…¨æ— é—´éš™ä¼˜åŒ– */
        @media (max-width: 768px) {
            /* æŠ˜å å†…å®¹åŒºåŸŸ */
            .collapsible-content {
                transition: max-height 0.4s ease, padding 0.4s ease;
                margin: 0 !important;
                border: none !important;
            }

            .collapsible-content:not(.collapsed) {
                max-height: 1500px !important;
                overflow: visible;
                padding: 20px;
                margin: 0 !important;
            }

            .collapsible-content.collapsed {
                max-height: 0 !important;
                overflow: hidden;
                padding: 0 20px;
                margin: 0 !important;
            }

            /* æ‰€æœ‰æ¨¡å—ç»Ÿä¸€ç§»åŠ¨ç«¯æ ·å¼ */
            .filter-section,
            .function-section,
            .settings-section {
                margin: 0 !important;
                padding: 0 !important;
                border-radius: 0 !important;
                border-left: none !important;
                border-right: none !important;
                border-top: none !important;
                display: block;
            }

            /* æ¨¡å—headeråœ¨ç§»åŠ¨ç«¯çš„ç»Ÿä¸€æ ·å¼ */
            .section-header {
                padding: 14px 16px;
                margin: 0;
                border-radius: 0;
            }
        }

            .settings-header {
                padding: 12px 0;
                margin-bottom: 16px;
            }

            .settings-title .settings-text {
                font-size: 16px;
            }

            .settings-subtitle {
                font-size: 11px;
            }

            .settings-grid {
                gap: 10px;
                grid-template-columns: 1fr !important;
            }

            .setting-card {
                padding: 16px 12px !important;
                min-height: 72px !important;
                gap: 10px !important;
                flex-direction: row !important;
                align-items: flex-start !important;
            }

            .setting-icon {
                width: 36px;
                height: 36px;
                font-size: 20px;
                flex-shrink: 0;
                margin-top: 2px;
            }

            .setting-content {
                flex: 1;
                min-width: 0;
            }

            .setting-title {
                font-size: 14px !important;
                line-height: 1.3 !important;
                font-weight: 600 !important;
                margin-bottom: 4px;
                word-break: break-word;
            }

            .setting-desc {
                font-size: 11px !important;
                line-height: 1.4 !important;
                opacity: 0.9;
                word-break: break-word;
            }

            /* ç§»åŠ¨ç«¯è§¦æ‘¸ä½“éªŒä¼˜åŒ– */
            .settings-section .daily-todo-btn {
                min-height: 56px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }

            .settings-section .daily-todo-btn:hover {
                animation: none; /* ç§»åŠ¨ç«¯ä¸éœ€è¦è„‰å†²åŠ¨ç”» */
            }

            .settings-section .daily-todo-btn:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }
        }

        /* å¹³æ¿ç«¯é€‚é… */
        @media (min-width: 769px) and (max-width: 1024px) {
            .settings-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 16px;
            }

            .setting-card {
                flex-direction: column;
                text-align: center !important;
                padding: 20px !important;
                min-height: 100px !important;
                gap: 12px !important;
            }

            .setting-icon {
                margin-bottom: 4px;
            }
        }

        /* å¤§å±å¹•é€‚é… */
        @media (min-width: 1025px) {
            .settings-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 16px;
            }

            .setting-card {
                min-height: 80px !important;
            }
        }

        /* ç­›é€‰æ¨¡å—çŠ¶æ€æŒ‰é’®é—´è·è°ƒæ•´ */
        .filter-group .status-filter-buttons {
            margin-top: 8px;
        }

        /* æ¨¡å—é—´å®Œå…¨æ— ç¼è¿æ¥ - æ–°çš„ç»Ÿä¸€æ ·å¼ */
        .filter-section,
        .function-section,
        .settings-section {
            /* æ‰€æœ‰æ¨¡å—ç»Ÿä¸€ï¼šæ— è¾¹è·ã€æ— é¢å¤–è¾¹æ¡† */
            border-top: none;
            border-left: none;
            border-right: none;
            margin: 0;
            padding: 0;
        }

        /* æ¯ä¸ªæ¨¡å—ä¹‹é—´çš„åˆ†éš”é€šè¿‡åº•éƒ¨è¾¹æ¡†å®ç° */
        .filter-section {
            border-bottom: 1px solid #e9ecef;
        }

        .function-section {
            border-bottom: 1px solid #e9ecef;
        }

        .settings-section {
            border-bottom: 1px solid #e9ecef;
        }

        .settings-description {
            padding: 0 0 16px 0;
            color: #6c757d;
            font-size: 14px;
            text-align: center;
            font-style: italic;
        }

        .settings-description p {
            margin: 0;
        }

        .batch-mode .task-item.selected {
            background-color: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
        }

        /* æ‰¹é‡æ¨¡å¼ä¸‹å®Œæˆä»»åŠ¡æŒ‰é’®çš„æ ·å¼è°ƒæ•´ */
        .batch-mode .task-complete-btn {
            margin-left: 8px;
            opacity: 0.8;
        }

        .batch-mode .task-complete-btn:hover {
            opacity: 1;
        }

        /* éšè—çš„æ–‡ä»¶è¾“å…¥ */
        .hidden {
            display: none;
        }

        /* è¶…å°å±å¹•é€‚é… (360pxä»¥ä¸‹) - å®Œå…¨æ— é—´éš™ */
        @media (max-width: 360px) {
            .footer-actions .footer-btn {
                flex: 1 1 100% !important;
                min-width: 100% !important;
                margin-bottom: 6px;
            }

            .footer-actions {
                flex-direction: column;
                gap: 6px;
            }

            .collapsible-content:not(.collapsed) {
                max-height: 2000px !important;
                overflow: visible;
                padding: 15px !important;
                margin: 0 !important;
                border: none !important;
            }

            .collapsible-content.collapsed {
                max-height: 0 !important;
                overflow: hidden;
                padding: 0 15px !important;
                margin: 0 !important;
                border: none !important;
            }

            /* è¶…å°å±å¹•æ‰€æœ‰æ¨¡å—æ ·å¼å¼ºåˆ¶ç»Ÿä¸€ */
            .filter-section,
            .function-section,
            .settings-section {
                margin: 0 !important;
                padding: 0 !important;
                border-radius: 0 !important;
                border-left: none !important;
                border-right: none !important;
                border-top: none !important;
                /* åªä¿ç•™åº•éƒ¨åˆ†éš”çº¿ */
                border-bottom: 1px solid #e9ecef !important;
            }

            .section-header {
                padding: 12px 15px;
                margin: 0;
                border-radius: 0;
            }

            /* è¶…å°å±å¹•çŠ¶æ€ç­›é€‰ä¼˜åŒ– */
            .status-filter-buttons {
                display: flex;
                gap: 4px;
                flex-direction: column;
                width: 100%;
            }

            .status-filter-btn {
                flex: none;
                width: 100%;
                padding: 12px 8px;
                font-size: 14px;
                margin-bottom: 4px;
                border-radius: 6px;
                text-align: center;
            }

            .status-filter-btn:last-child {
                margin-bottom: 0;
            }
        }

            .section-title {
                font-size: 14px;
            }

            .settings-header {
                padding: 10px 0;
            }

            .settings-title .settings-text {
                font-size: 14px;
            }

            .settings-subtitle {
                font-size: 11px;
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
            }

            .task-options {
                flex-wrap: wrap;
            }

            .footer-actions {
                flex-wrap: wrap;
                gap: 8px;
            }

            .footer-actions .footer-btn {
                flex: 1 1 calc(50% - 4px);
                min-width: calc(50% - 4px);
                padding: 10px 8px;
                font-size: 13px;
                min-height: 44px;
            }

            .footer-actions .footer-btn:nth-child(n+5) {
                flex: 1 1 calc(100% - 0px);
                min-width: calc(100% - 0px);
            }

            .filter-row {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .filter-group {
                min-width: auto;
                width: 100%;
            }

            .filter-select {
                margin-bottom: 4px;
                width: 100%;
                font-size: 16px;
                min-height: 44px;
                padding: 12px 16px;
                border-radius: 8px;
                background: white;
                border: 2px solid #e1e5e9;
                /* ä¿æŒåŸç”Ÿappearanceä»¥ç¡®ä¿ä¸‹æ‹‰åˆ—è¡¨æ­£å¸¸å·¥ä½œ */
            }

            .filter-select:focus {
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                outline: none;
            }

            /* iOSç‰¹æ®Šä¼˜åŒ– */
            @supports (-webkit-touch-callout: none) {
                .filter-select {
                    -webkit-appearance: menulist;
                    -webkit-border-radius: 8px;
                }
            }

            /* Android 12+ è®¾å¤‡ç­›é€‰æ¡†ä¼˜åŒ– - å¼ºåˆ¶ä¸‹æ‹‰åˆ—è¡¨ */
            .android-14-compat .filter-select {
                background: white;
                border: 2px solid #667eea;
                border-radius: 6px;
                -webkit-appearance: menulist !important;
                -moz-appearance: menulist !important;
                appearance: menulist !important;
                background-image: none !important;
                padding: 5px 8px !important;
                padding-right: 25px !important;
                min-height: 32px !important;
                font-size: 11px !important;
                /* Android WebViewå¼ºåˆ¶ä¿®å¤ */
                -webkit-user-select: auto !important;
                user-select: auto !important;
                /* å°è¯•å¤šç§appearanceå€¼ */
                -webkit-appearance: listbox !important;
                -moz-appearance: listbox !important;
                appearance: listbox !important;
            }

            /* Android 14 è‡ªå®šä¹‰é€‰æ‹©å™¨ç»Ÿä¸€æ ·å¼ */
            .android-14-compat .custom-select-trigger {
                padding: 5px 8px !important;
                min-height: 32px !important;
                font-size: 11px !important;
                border: 2px solid #667eea !important;
                border-radius: 6px !important;
                background: white !important;
            }

            .android-14-compat .custom-select-option {
                padding: 6px 8px !important;
                font-size: 11px !important;
            }

            .android-14-compat .custom-select-display {
                font-size: 11px !important;
            }

            .android-14-compat .custom-select-arrow {
                font-size: 10px !important;
            }

            /* Android 14 ç§»åŠ¨ç«¯å“åº”å¼ä¼˜åŒ– */
            @media (max-width: 768px) {
                .android-14-compat .filter-select {
                    min-height: 28px !important;
                    font-size: 10px !important;
                    padding: 4px 6px !important;
                    padding-right: 22px !important;
                }

                .android-14-compat .custom-select-trigger {
                    min-height: 28px !important;
                    font-size: 10px !important;
                    padding: 4px 6px !important;
                }

                .android-14-compat .custom-select-option {
                    padding: 5px 6px !important;
                    font-size: 10px !important;
                }

                .android-14-compat .custom-select-display {
                    font-size: 10px !important;
                }

                .android-14-compat .custom-select-arrow {
                    font-size: 9px !important;
                }
            }

            @media (max-width: 480px) {
                .android-14-compat .filter-select {
                    min-height: 26px !important;
                    font-size: 9px !important;
                    padding: 3px 5px !important;
                    padding-right: 20px !important;
                }

                .android-14-compat .custom-select-trigger {
                    min-height: 26px !important;
                    font-size: 9px !important;
                    padding: 3px 5px !important;
                }

                .android-14-compat .custom-select-option {
                    padding: 4px 5px !important;
                    font-size: 9px !important;
                }

                .android-14-compat .custom-select-display {
                    font-size: 9px !important;
                }

                .android-14-compat .custom-select-arrow {
                    font-size: 8px !important;
                }
            }

            .filter-buttons {
                flex-direction: column;
                width: 100%;
            }

            .daily-todo-btn {
                width: 100%;
                margin-bottom: 8px;
            }

            .clear-filters-btn {
                width: 36px;
                height: 36px;
                margin-bottom: 8px;
            }
        }

        /* åº•éƒ¨å¯¼èˆªæ æ ·å¼ - ç°ä»£åŒ–æ¯›ç»ç’ƒè®¾è®¡ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 11000;
            box-shadow:
                0 -8px 32px rgba(0, 0, 0, 0.12),
                0 -2px 8px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            height: 78px;
            padding: 8px 0 12px 0;
            margin: 0 8px 8px 8px;
            border-radius: 24px 24px 0 0;
            overflow: visible;
        }

        /* ä¸ºåº•éƒ¨å¯¼èˆªæ æ·»åŠ æ¸å˜è¾¹æ¡†æ•ˆæœ */
        .bottom-nav::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #667eea, #764ba2, transparent);
            opacity: 0.6;
        }

        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 6px 4px 6px;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            color: #999;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            margin: 0 6px;
            min-height: 54px;
            justify-content: flex-end;
        }

        /* æ·»åŠ æŒ‰é’®æŒ‰ä¸‹æ³¢çº¹æ•ˆæœ */
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(102, 126, 234, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
            pointer-events: none;
            z-index: 1;
        }

        .nav-btn:active::before {
            width: 100px;
            height: 100px;
        }

        .nav-btn.active {
            color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.15));
            transform: translateY(-3px);
            box-shadow:
                0 12px 32px rgba(102, 126, 234, 0.3),
                0 6px 16px rgba(102, 126, 234, 0.2),
                0 2px 8px rgba(102, 126, 234, 0.15),
                inset 0 2px 0 rgba(255, 255, 255, 0.4),
                inset 0 -1px 0 rgba(102, 126, 234, 0.2);
            border: 2px solid rgba(102, 126, 234, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 2;
        }

        /* æ¿€æ´»çŠ¶æ€çš„å‘å…‰ç¯æ•ˆæœ */
        .nav-btn.active::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #667eea, #764ba2, #667eea, #764ba2);
            border-radius: inherit;
            z-index: -2;
            opacity: 0.6;
            animation: activeGlow 3s ease-in-out infinite;
        }

        @keyframes activeGlow {
            0%, 100% {
                opacity: 0.6;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.02);
            }
        }

        /* åº•éƒ¨æŒ‡ç¤ºå™¨ */
        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px 2px 0 0;
            box-shadow:
                0 0 12px rgba(102, 126, 234, 0.7),
                0 -2px 8px rgba(102, 126, 234, 0.4);
        }

        .nav-btn.active .nav-icon {
            transform: scale(1.2) translateY(-1px);
            filter: drop-shadow(0 3px 6px rgba(102, 126, 234, 0.4));
            animation: iconBounce 0.6s ease-out;
        }

        @keyframes iconBounce {
            0% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.3) translateY(-3px); }
            100% { transform: scale(1.2) translateY(-1px); }
        }

        .nav-btn.active .nav-label {
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }

        .nav-btn:hover:not(.active) {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.12), rgba(118, 75, 162, 0.08));
            transform: translateY(-2px);
            color: #667eea;
            box-shadow:
                0 8px 20px rgba(102, 126, 234, 0.15),
                0 4px 10px rgba(102, 126, 234, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.15);
        }

        .nav-btn:hover:not(.active) .nav-icon {
            transform: scale(1.1) translateY(-1px);
            filter: drop-shadow(0 2px 4px rgba(102, 126, 234, 0.3));
            animation: hoverBounce 0.4s ease-out;
        }

        @keyframes hoverBounce {
            0% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.15) translateY(-2px); }
            100% { transform: scale(1.1) translateY(-1px); }
        }

        .nav-btn:hover:not(.active) .nav-label {
            color: #667eea;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(102, 126, 234, 0.2);
        }

        /* æ·»åŠ ç‚¹å‡»åé¦ˆåŠ¨ç”» */
        .nav-btn:active:not(.active) {
            transform: translateY(0px) scale(0.98);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.12));
            box-shadow:
                0 4px 12px rgba(102, 126, 234, 0.2),
                inset 0 2px 4px rgba(102, 126, 234, 0.1);
        }

        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-block;
            position: relative;
            z-index: 3;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            position: relative;
            z-index: 3;
        }

        /* ä¸­é—´æ‚¬æµ®çƒæŒ‰é’®æ ·å¼ - ç°ä»£ç£æ‚¬æµ®è®¾è®¡ */
        .nav-add-btn {
            width: 68px;
            height: 68px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transform: translateY(-10px);
            box-shadow:
                0 16px 48px rgba(102, 126, 234, 0.5),
                0 8px 24px rgba(102, 126, 234, 0.4),
                0 4px 12px rgba(102, 126, 234, 0.3),
                0 0 0 5px rgba(255, 255, 255, 0.9),
                0 0 0 8px rgba(102, 126, 234, 0.1),
                inset 0 3px 0 rgba(255, 255, 255, 0.4),
                inset 0 -2px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 3;
            overflow: hidden;
            animation: addBtnFloat 4s ease-in-out infinite;
        }

        @keyframes addBtnFloat {
            0%, 100% {
                transform: translateY(-10px);
            }
            50% {
                transform: translateY(-12px);
            }
        }

        /* å¤šå±‚å‘å…‰ç¯æ•ˆæœ */
        .nav-add-btn::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #667eea);
            border-radius: 50%;
            z-index: -1;
            opacity: 0;
            transition: all 0.4s ease;
            animation: rotateGlow 6s linear infinite;
        }

        .nav-add-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120%;
            height: 120%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(102, 126, 234, 0.2) 40%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }

        @keyframes rotateGlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .nav-add-btn:hover {
            transform: translateY(-16px) scale(1.12);
            animation: addBtnHover 0.8s ease-out;
            box-shadow:
                0 24px 64px rgba(102, 126, 234, 0.6),
                0 12px 32px rgba(102, 126, 234, 0.5),
                0 6px 16px rgba(102, 126, 234, 0.4),
                0 0 0 6px rgba(255, 255, 255, 0.95),
                0 0 0 10px rgba(102, 126, 234, 0.15),
                0 0 0 14px rgba(240, 147, 251, 0.1),
                inset 0 4px 0 rgba(255, 255, 255, 0.5);
        }

        @keyframes addBtnHover {
            0% { transform: translateY(-10px) scale(1); }
            30% { transform: translateY(-18px) scale(1.15); }
            100% { transform: translateY(-16px) scale(1.12); }
        }

        .nav-add-btn:hover::before {
            opacity: 0.9;
            transform: scale(1.1);
        }

        .nav-add-btn:hover::after {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .nav-add-btn:active {
            transform: translateY(-6px) scale(0.92);
            animation: addBtnClick 0.15s ease-out;
            box-shadow:
                0 12px 32px rgba(102, 126, 234, 0.5),
                0 6px 16px rgba(102, 126, 234, 0.4),
                0 0 0 4px rgba(255, 255, 255, 0.8),
                inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        @keyframes addBtnClick {
            0% { transform: translateY(-16px) scale(1.12); }
            100% { transform: translateY(-6px) scale(0.92); }
        }

        .nav-add-icon {
            font-size: 30px;
            color: white;
            font-weight: bold;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .nav-add-btn:hover .nav-add-icon {
            transform: rotate(135deg) scale(1.15);
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
            animation: iconSpin 0.6s ease-out;
        }

        @keyframes iconSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(135deg) scale(1.15); }
        }

        .nav-add-btn:active .nav-add-icon {
            transform: rotate(90deg) scale(0.85);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        /* åº•éƒ¨å¯¼èˆªæ å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .bottom-nav {
                height: 76px;
                padding: 6px 0 10px 0;
                margin: 0 4px 4px 4px;
                border-radius: 20px 20px 0 0;
            }

            .nav-btn {
                padding: 6px 4px 2px 4px;
                margin: 0 3px;
                min-height: 52px;
            }

            .nav-btn.active {
                transform: translateY(-2px);
                box-shadow:
                    0 8px 20px rgba(102, 126, 234, 0.25),
                    0 4px 10px rgba(102, 126, 234, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }

            .nav-btn.active::after {
                width: 28px;
                height: 3px;
            }

            .nav-btn:hover:not(.active) {
                transform: translateY(-1px);
                box-shadow:
                    0 6px 16px rgba(102, 126, 234, 0.12),
                    0 3px 8px rgba(102, 126, 234, 0.08);
            }

            .nav-icon {
                font-size: 20px;
                margin-bottom: 3px;
            }

            .nav-label {
                font-size: 10px;
                letter-spacing: 0.3px;
            }

            .nav-add-btn {
                width: 60px;
                height: 60px;
                transform: translateY(-8px);
                animation: addBtnFloat 4s ease-in-out infinite;
            }

            @keyframes addBtnFloat {
                0%, 100% {
                    transform: translateY(-8px);
                }
                50% {
                    transform: translateY(-10px);
                }
            }

            .nav-add-btn:hover {
                transform: translateY(-12px) scale(1.08);
                box-shadow:
                    0 20px 48px rgba(102, 126, 234, 0.5),
                    0 10px 24px rgba(102, 126, 234, 0.4),
                    0 0 0 5px rgba(255, 255, 255, 0.9),
                    0 0 0 8px rgba(102, 126, 234, 0.12);
            }

            .nav-add-icon {
                font-size: 26px;
            }
        }

        @media (max-width: 480px) {
            .bottom-nav {
                height: 72px;
                padding: 4px 0 8px 0;
                margin: 0 2px 2px 2px;
                border-radius: 16px 16px 0 0;
            }

            .nav-btn {
                padding: 4px 2px 0px 2px;
                margin: 0 2px;
                min-height: 50px;
            }

            .nav-btn.active {
                transform: translateY(-1px);
                box-shadow:
                    0 6px 16px rgba(102, 126, 234, 0.2),
                    0 3px 8px rgba(102, 126, 234, 0.12),
                    inset 0 1px 0 rgba(255, 255, 255, 0.25);
            }

            .nav-btn.active::after {
                width: 24px;
                height: 2px;
            }

            .nav-btn:hover:not(.active) {
                transform: translateY(-0.5px);
                box-shadow:
                    0 4px 12px rgba(102, 126, 234, 0.1),
                    0 2px 6px rgba(102, 126, 234, 0.06);
            }

            /* å‡å°‘å°å±å¹•åŠ¨ç”»å¼ºåº¦ */
            .nav-btn.active .nav-icon {
                animation: none;
                transform: scale(1.1) translateY(-0.5px);
            }

            .nav-btn:hover:not(.active) .nav-icon {
                animation: none;
                transform: scale(1.05) translateY(-0.5px);
            }

            .nav-icon {
                font-size: 18px;
                margin-bottom: 2px;
            }

            .nav-label {
                font-size: 9px;
                letter-spacing: 0.2px;
            }

            .nav-add-btn {
                width: 56px;
                height: 56px;
                transform: translateY(-6px);
                animation: addBtnFloatSmall 5s ease-in-out infinite;
            }

            @keyframes addBtnFloatSmall {
                0%, 100% {
                    transform: translateY(-6px);
                }
                50% {
                    transform: translateY(-8px);
                }
            }

            .nav-add-btn:hover {
                transform: translateY(-10px) scale(1.05);
                box-shadow:
                    0 16px 32px rgba(102, 126, 234, 0.4),
                    0 8px 16px rgba(102, 126, 234, 0.3),
                    0 0 0 4px rgba(255, 255, 255, 0.85),
                    0 0 0 6px rgba(102, 126, 234, 0.1);
            }

            .nav-add-btn:hover .nav-add-icon {
                animation: none;
                transform: rotate(90deg) scale(1.05);
            }

            .nav-add-icon {
                font-size: 24px;
            }
        }

        /* å¤šé€‰ä¸‹æ‹‰æ¡†æ ·å¼ */
        .multi-select-container {
            position: relative;
            width: 100%;
        }

        .multi-select-display {
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 12px;
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 20px;
            transition: all 0.2s ease;
        }

        .multi-select-display:hover {
            border-color: #667eea;
        }

        .multi-select-display.active {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .multi-select-display .placeholder {
            color: #999;
            flex: 1;
        }

        .multi-select-display .selected-items {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            flex: 1;
        }

        .selected-item {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .selected-item .remove {
            cursor: pointer;
            font-weight: bold;
        }

        .dropdown-arrow {
            color: #999;
            font-size: 12px;
            transition: transform 0.2s ease;
        }

        .multi-select-display.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 16000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .multi-select-dropdown.active {
            display: block;
        }

        .assignee-search {
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
        }

        .search-input {
            width: 100%;
            padding: 6px;
            border: 1px solid #e1e5e9;
            border-radius: 4px;
            font-size: 14px;
        }

        .assignee-options {
            max-height: 150px;
            overflow-y: auto;
        }

        .assignee-option {
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s ease;
        }

        .assignee-option:hover {
            background: #f8f9ff;
        }

        .assignee-option.selected {
            background: #667eea;
            color: white;
        }

        .assignee-option input[type="checkbox"] {
            margin: 0;
        }

        /* æ²¡æœ‰ç»“æœæç¤º */
        .no-results {
            padding: 12px;
            text-align: center;
            color: #999;
            font-size: 14px;
        }

        /* è§†å›¾å®¹å™¨æ ·å¼ */
        .view-container {
            padding-bottom: 90px; /* ä¸ºåº•éƒ¨å¯¼èˆªæ ç•™å‡ºè¶³å¤Ÿç©ºé—´ */
            min-height: calc(100vh - 75px); /* è€ƒè™‘åº•éƒ¨å¯¼èˆªæ é«˜åº¦ */
            box-sizing: border-box;
        }

        /* å“åº”å¼è°ƒæ•´è§†å›¾å®¹å™¨åº•éƒ¨é—´è· */
        @media (max-width: 768px) {
            .view-container {
                padding-bottom: 85px; /* å¹³æ¿ç«¯è°ƒæ•´ */
                min-height: calc(100vh - 70px);
            }
        }

        @media (max-width: 480px) {
            .view-container {
                padding-bottom: 80px; /* æ‰‹æœºç«¯è°ƒæ•´ */
                min-height: calc(100vh - 65px);
            }
        }


        body {
            margin: 0;
            padding: 0;
        }

        /* ä»»åŠ¡ç•Œé¢æ ·å¼ */
        #taskView {
            width: 100%;
            position: relative;
            z-index: 1;
        }



        /* æ‚¬æµ®æ“ä½œçƒæ ·å¼ */
        .fab-container {
            position: fixed;
            bottom: 80px; /* åœ¨åº•éƒ¨å¯¼èˆªæ ä¸Šæ–¹ */
            right: 20px;
            z-index: 999;
        }

        .fab-main {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            user-select: none;
        }

        .fab-main:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
        }

        .fab-main:active {
            transform: scale(0.95);
        }

        .fab-icon {
            font-size: 24px;
            color: white;
            transition: transform 0.3s ease;
        }

        .fab-main.active .fab-icon {
            transform: rotate(135deg);
        }

        .fab-menu {
            position: absolute;
            bottom: 65px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            transform: translateY(20px) scale(0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .fab-menu.active {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        .fab-action {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            position: relative;
            transform: scale(0);
            animation: fabActionIn 0.3s ease forwards;
        }

        .fab-action:nth-child(1) { animation-delay: 0.1s; }
        .fab-action:nth-child(2) { animation-delay: 0.15s; }
        .fab-action:nth-child(3) { animation-delay: 0.2s; }
        .fab-action:nth-child(4) { animation-delay: 0.25s; }
        .fab-action:nth-child(5) { animation-delay: 0.3s; }
        .fab-action:nth-child(6) { animation-delay: 0.35s; }

        @keyframes fabActionIn {
            to {
                transform: scale(1);
            }
        }

        .fab-action:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .fab-action:active {
            transform: scale(0.95);
        }

        .fab-action-icon {
            font-size: 20px;
        }

        .fab-action::before {
            content: attr(data-tooltip);
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .fab-action:hover::before {
            opacity: 1;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .fab-container {
                bottom: 70px;
                right: 16px;
            }

            .fab-main {
                width: 50px;
                height: 50px;
            }

            .fab-icon {
                font-size: 20px;
            }

            .fab-action {
                width: 44px;
                height: 44px;
            }

            .fab-action-icon {
                font-size: 18px;
            }

            .fab-action::before {
                right: 50px;
                font-size: 11px;
                padding: 4px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="bottom-nav">
        <button class="nav-btn active" id="taskViewBtn" onclick="switchToTaskView()">
            <span class="nav-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                    <path d="m9 14 2 2 4-4"/>
                </svg>
            </span>
            <span class="nav-label">ä»»åŠ¡</span>
        </button>
        <!-- ä¸­é—´æ‚¬æµ®çƒæŒ‰é’® -->
        <button class="nav-add-btn" onclick="showAddTaskModal()">
            <span class="nav-add-icon">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="m12 8v8"/>
                    <path d="m8 12h8"/>
                </svg>
            </span>
        </button>
        <button class="nav-btn" id="settingsViewBtn" onclick="switchToSettingsView()">
            <span class="nav-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="m12 1v6m0 6v6"/>
                    <path d="m12.71 2.29 4.25 4.25m-8.48 8.48 4.25 4.25"/>
                    <path d="m2.29 12.71 4.25-4.25m8.48-8.48 4.25 4.25"/>
                </svg>
            </span>
            <span class="nav-label">è®¾ç½®</span>
        </button>
    </div>

    <!-- ä»»åŠ¡ç•Œé¢ -->
    <div class="view-container" id="taskView">
        <div class="container">
            <!-- å¤´éƒ¨ -->
            <div class="header">
                <h1>ğŸ“… æ¯æ—¥å¾…åŠ</h1>
                <div class="progress-info" id="progressInfo">0/0 å®Œæˆ</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="stats-row">
                <div class="stat-item">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">å½“å‰åˆ—è¡¨</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">å·²å®Œæˆ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="completionRate">0%</div>
                    <div class="stat-label">å®Œæˆç‡</div>
                </div>
            </div>
        </div>

        <!-- ç­›é€‰å™¨ -->
        <div class="filter-section">
            <div class="filter-content" id="filterContent">
                <!-- ç¬¬ä¸€è¡Œï¼šå…³é”®å­—æœç´¢ -->
                <div class="filter-row">
                    <div class="filter-group" style="flex: 1;">
                        <label class="filter-label">ğŸ” å…³é”®å­—æœç´¢</label>
                        <input type="text" class="filter-input" id="keywordSearch" placeholder="æœç´¢ä»»åŠ¡æ ‡é¢˜ã€å¤‡æ³¨..." oninput="applyFilters()">
                    </div>
                </div>

                <!-- ç¬¬äºŒè¡Œï¼šæ—¥æœŸç­›é€‰å’Œä¼˜å…ˆçº§ç­›é€‰ -->
                <div class="filter-row collapsible-row" id="dateRow">
                    <div class="filter-group">
                        <label class="filter-label">ğŸ“… æ—¥æœŸ</label>
                        <select class="filter-select" id="dateFilter" onchange="applyFilters()">
                            <option value="all">æ‰€æœ‰æ—¥æœŸ</option>
                            <option value="today" selected>ä»Šæ—¥</option>
                            <option value="tomorrow">æ˜æ—¥</option>
                            <option value="week">æœ¬å‘¨</option>
                            <option value="overdue">å·²é€¾æœŸ</option>
                            <option value="custom">æŒ‡å®šæ—¥æœŸ</option>
                        </select>
                    </div>
                    <div class="filter-group" id="customDateGroup" style="display: none;">
                        <label class="filter-label">ğŸ“† æŒ‡å®šæ—¥æœŸ</label>
                        <input type="date" class="filter-select" id="customDatePicker" onchange="applyFilters()">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">â­ ä¼˜å…ˆçº§</label>
                        <select class="filter-select" id="priorityFilter" onchange="applyFilters()">
                            <option value="all">æ‰€æœ‰</option>
                            <option value="high">é«˜ä¼˜å…ˆçº§</option>
                            <option value="medium">ä¸­ä¼˜å…ˆçº§</option>
                            <option value="low">ä½ä¼˜å…ˆçº§</option>
                        </select>
                    </div>
                </div>

                <!-- ç¬¬ä¸‰è¡Œï¼šåˆ†ç±»ã€çŠ¶æ€å’Œå®Œæˆäººç­›é€‰ -->
                <div class="filter-row collapsible-row" id="categoryRow">
                    <div class="filter-group">
                        <label class="filter-label">ğŸ“ åˆ†ç±»</label>
                        <select class="filter-select" id="categoryFilter" onchange="applyFilters()">
                            <option value="all">æ‰€æœ‰</option>
                            <option value="work">å·¥ä½œ</option>
                            <option value="life">ç”Ÿæ´»</option>
                            <option value="study">å­¦ä¹ </option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">âœ… çŠ¶æ€</label>
                        <div class="custom-select" id="statusFilterContainer">
                            <div class="custom-select-trigger" data-select-id="statusFilter">
                                <div class="custom-select-display" id="statusFilterDisplay">å…¨éƒ¨</div>
                                <div class="custom-select-arrow">â–¼</div>
                            </div>
                            <div class="custom-select-dropdown" id="statusFilterDropdown">
                                <div class="custom-select-option" data-value="all">
                                    <input type="checkbox" class="custom-select-checkbox" checked>
                                    <span>å…¨éƒ¨</span>
                                </div>
                                <div class="custom-select-option" data-value="active">
                                    <input type="checkbox" class="custom-select-checkbox">
                                    <span>æœªå®Œæˆ</span>
                                </div>
                                <div class="custom-select-option" data-value="completed">
                                    <input type="checkbox" class="custom-select-checkbox">
                                    <span>å·²å®Œæˆ</span>
                                </div>
                                <div class="custom-select-option" data-value="overdue">
                                    <input type="checkbox" class="custom-select-checkbox">
                                    <span>é€¾æœŸ</span>
                                </div>
                            </div>
                        </div>
                        <div class="selected-tags" id="statusFilterTags"></div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ğŸ‘¤ å®Œæˆäºº</label>
                        <div class="custom-select" id="assigneeFilterContainer">
                            <div class="custom-select-trigger" data-select-id="assigneeFilter">
                                <div class="custom-select-display" id="assigneeFilterDisplay">æ‰€æœ‰äºº</div>
                                <div class="custom-select-arrow">â–¼</div>
                            </div>
                            <div class="custom-select-dropdown" id="assigneeFilterDropdown">
                                <div class="custom-select-option" data-value="all">
                                    <input type="checkbox" class="custom-select-checkbox" checked>
                                    <span>æ‰€æœ‰äºº</span>
                                </div>
                                <!-- å…¶ä»–é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div class="selected-tags" id="assigneeFilterTags"></div>
                    </div>
                </div>

                <!-- ç¬¬å››è¡Œï¼šæ’åº -->
                <div class="filter-row collapsible-row" id="sortRow">
                    <div class="filter-group">
                        <label class="filter-label">ğŸ”½ æ’åºæ–¹å¼</label>
                        <select class="filter-select" id="sortFilter" onchange="applyFilters()">
                            <option value="deadline">ğŸ“… æˆªæ­¢æ—¶é—´</option>
                            <option value="priority">â­ ä¼˜å…ˆçº§</option>
                            <option value="created">ğŸ• åˆ›å»ºæ—¶é—´</option>
                            <option value="category">ğŸ“ åˆ†ç±»</option>
                        </select>
                    </div>
                    <div class="filter-group" style="max-width: 80px">
                        <label class="filter-label">ğŸ“¶ æ’åºé¡ºåº</label>
                        <select class="filter-select" id="sortOrderFilter" onchange="applyFilters()">
                            <option value="asc">å‡åº â†‘</option>
                            <option value="desc">é™åº â†“</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="clear-filters-btn" onclick="clearAllFilters()" title="æ¸…é™¤ç­›é€‰">
                            ğŸ”„
                        </button>
                    </div>
                </div>

                <!-- ç¬¬äº”è¡Œï¼šåŠŸèƒ½æŒ‰é’® -->
                <div class="filter-row" id="functionRow">
                    <div class="filter-group">
                        <button class="function-btn batch-toggle-btn" onclick="toggleBatchMode()" id="batchToggleBtn">
                            â˜‘ï¸ æ‰¹é‡æ¨¡å¼
                        </button>
                    </div>
                    <div class="filter-group">
                        <button class="function-btn sync-btn" onclick="manualSync()" id="syncBtn">
                            ğŸ”„ æ‰‹åŠ¨åŒæ­¥
                        </button>
                    </div>
                    <div class="filter-group">
                        <button class="function-btn collapse-toggle-btn" onclick="toggleCollapsibleRows()" id="collapseToggleBtn">
                            ğŸ“‹ å±•å¼€ç­›é€‰
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‰¹é‡æ“ä½œæ§åˆ¶åŒº -->
        <div class="batch-controls" id="batchControls" style="display: none;">
            <div class="batch-info">
                <span id="selectedCount">0</span> é¡¹å·²é€‰æ‹©
            </div>
            <div class="batch-actions">
                <button class="batch-btn select-all-btn">å…¨é€‰</button>
                <button class="batch-btn deselect-all-btn">å–æ¶ˆå…¨é€‰</button>
                <button class="batch-btn delete-selected-btn">åˆ é™¤é€‰ä¸­</button>
                <button class="batch-btn complete-selected-btn">å®Œæˆé€‰ä¸­</button>
                <button class="batch-btn cancel-batch-btn">é€€å‡ºæ‰¹é‡æ¨¡å¼</button>
            </div>
        </div>
        </div>

        <!-- ä»»åŠ¡åˆ—è¡¨ -->
        <div class="task-list" id="taskList">
            <div class="empty-state" id="emptyState">
                <div class="empty-state-icon">ğŸ“</div>
                <div>è¿˜æ²¡æœ‰ä»»åŠ¡ï¼Œæ·»åŠ ä¸€ä¸ªå¼€å§‹å§ï¼</div>
            </div>
        </div>

        <!-- æ‚¬æµ®æ“ä½œçƒ -->
        <!-- åŸæ‚¬æµ¯çƒå·²ç§»åŠ¨åˆ°åº•éƒ¨å¯¼èˆªæ ä¸­ -->
    </div>


    <!-- æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">æ·»åŠ æ–°ä»»åŠ¡</div>
                <button class="close-btn" id="closeAddTaskBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ä»»åŠ¡æ ‡é¢˜ *</label>
                    <input type="text" class="form-input" id="addTaskTitle" placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜..." maxlength="100">
                </div>
                <div class="form-group">
                    <label class="form-label">ä»»åŠ¡å¤‡æ³¨</label>
                    <textarea class="form-textarea" id="addTaskNotes" placeholder="è¯·è¾“å…¥ä»»åŠ¡å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰..." maxlength="500" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ä¼˜å…ˆçº§</label>
                        <select class="form-select" id="addTaskPriority">
                            <option value="medium">ä¸­ä¼˜å…ˆçº§</option>
                            <option value="high">é«˜ä¼˜å…ˆçº§</option>
                            <option value="low">ä½ä¼˜å…ˆçº§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">åˆ†ç±»</label>
                        <select class="form-select" id="addTaskCategory">
                            <option value="work">å·¥ä½œ</option>
                            <option value="life">ç”Ÿæ´»</option>
                            <option value="study">å­¦ä¹ </option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">æˆªæ­¢æ—¶é—´</label>
                    <input type="datetime-local" class="form-input" id="addTaskDeadline">
                </div>
                <div class="form-group">
                    <label class="form-label">å®Œæˆäºº</label>
                    <div class="multi-select-container">
                        <div class="multi-select-display" id="addTaskAssigneeDisplay" onclick="toggleAssigneeDropdown('add')">
                            <span class="placeholder">é€‰æ‹©å®Œæˆäººï¼ˆå¯é€‰ï¼‰</span>
                            <span class="dropdown-arrow">â–¼</span>
                        </div>
                        <div class="multi-select-dropdown" id="addTaskAssigneeDropdown">
                            <div class="assignee-search">
                                <input type="text" class="search-input" placeholder="æœç´¢å®Œæˆäºº..." onkeyup="filterAssignees('add', this.value)">
                            </div>
                            <div class="assignee-options" id="addTaskAssigneeOptions">
                                <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelAddTaskBtn">å–æ¶ˆ</button>
                <button class="btn-save" id="saveAddTaskBtn">æ·»åŠ ä»»åŠ¡</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ç¼–è¾‘ä»»åŠ¡</div>
                <button class="close-btn" id="closeEditBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ä»»åŠ¡æ ‡é¢˜ *</label>
                    <input type="text" class="form-input" id="editTaskTitle" placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜..." maxlength="100">
                </div>
                <div class="form-group">
                    <label class="form-label">ä»»åŠ¡å¤‡æ³¨</label>
                    <textarea class="form-textarea" id="editTaskNotes" placeholder="è¯·è¾“å…¥ä»»åŠ¡å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰..." maxlength="500" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ä¼˜å…ˆçº§</label>
                        <select class="form-select" id="editPriority">
                            <option value="high">é«˜ä¼˜å…ˆçº§</option>
                            <option value="medium">ä¸­ä¼˜å…ˆçº§</option>
                            <option value="low">ä½ä¼˜å…ˆçº§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">åˆ†ç±»</label>
                        <select class="form-select" id="editCategory">
                            <option value="work">å·¥ä½œ</option>
                            <option value="life">ç”Ÿæ´»</option>
                            <option value="study">å­¦ä¹ </option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">æˆªæ­¢æ—¶é—´</label>
                    <input type="datetime-local" class="form-input" id="editDeadline">
                </div>
                <div class="form-group">
                    <label class="form-label">å®Œæˆäºº</label>
                    <div class="multi-select-container">
                        <div class="multi-select-display" id="editTaskAssigneeDisplay" onclick="toggleAssigneeDropdown('edit')">
                            <span class="placeholder">é€‰æ‹©å®Œæˆäººï¼ˆå¯é€‰ï¼‰</span>
                            <span class="dropdown-arrow">â–¼</span>
                        </div>
                        <div class="multi-select-dropdown" id="editTaskAssigneeDropdown">
                            <div class="assignee-search">
                                <input type="text" class="search-input" placeholder="æœç´¢å®Œæˆäºº..." onkeyup="filterAssignees('edit', this.value)">
                            </div>
                            <div class="assignee-options" id="editTaskAssigneeOptions">
                                <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="form-actions">
                    <button class="btn-cancel" id="cancelEditBtn">å–æ¶ˆ</button>
                    <button class="btn-save" id="saveEditBtn">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>


    <!-- ä»»åŠ¡å®Œæˆæ¨¡æ€æ¡† -->
    <div class="modal" id="completeTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ‰ å®Œæˆä»»åŠ¡</div>
                <button class="close-btn" id="closeCompleteBtn">&times;</button>
            </div>
            <div class="complete-task-info">
                <div class="task-title-display" id="completeTaskTitle">ä»»åŠ¡æ ‡é¢˜</div>
            </div>
            <div class="form-group">
                <label class="form-label">å®Œæˆå¤‡æ³¨ (å¯é€‰)</label>
                <textarea class="form-input" id="completeNotes" placeholder="è®°å½•å®Œæˆæƒ…å†µã€å¿ƒå¾—ä½“ä¼š..." rows="3" maxlength="500"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">å®Œæˆäºº (å¯é€‰)</label>
                <div class="multi-select-container">
                    <div class="multi-select-display" id="completeTaskAssigneeDisplay" onclick="toggleAssigneeDropdown('complete')">
                        <span class="placeholder">é€‰æ‹©å®Œæˆäººï¼ˆå¯é€‰ï¼‰</span>
                        <span class="dropdown-arrow">â–¼</span>
                    </div>
                    <div class="multi-select-dropdown" id="completeTaskAssigneeDropdown">
                        <div class="assignee-search">
                            <input type="text" class="search-input" placeholder="æœç´¢å®Œæˆäºº..." onkeyup="filterAssignees('complete', this.value)">
                        </div>
                        <div class="assignee-options" id="completeTaskAssigneeOptions">
                            <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">å®Œæˆå›¾ç‰‡ (å¯é€‰ï¼Œæœ€å¤š2å¼ )</label>
                <div class="images-upload-container">
                    <!-- ç¬¬ä¸€å¼ å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
                    <div class="image-upload-area">
                        <div class="upload-placeholder" id="uploadPlaceholder1">
                            <div class="upload-icon">ğŸ“·</div>
                            <div class="upload-text" onclick="selectCompleteImage(1)" style="cursor: pointer;">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡1</div>
                            <small>JPGã€PNGã€GIF æœ€å¤§5MB</small>
                        </div>
                        <div class="image-preview" id="imagePreview1" style="display: none;">
                            <img id="previewImage1" src="" alt="é¢„è§ˆå›¾1">
                            <button type="button" class="remove-image-btn" onclick="removeCompleteImage(1)">Ã—</button>
                        </div>
                    </div>
                    <!-- ç¬¬äºŒå¼ å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
                    <div class="image-upload-area">
                        <div class="upload-placeholder" id="uploadPlaceholder2">
                            <div class="upload-icon">ğŸ“·</div>
                            <div class="upload-text" onclick="selectCompleteImage(2)" style="cursor: pointer;">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡2</div>
                            <small>JPGã€PNGã€GIF æœ€å¤§5MB</small>
                        </div>
                        <div class="image-preview" id="imagePreview2" style="display: none;">
                            <img id="previewImage2" src="" alt="é¢„è§ˆå›¾2">
                            <button type="button" class="remove-image-btn" onclick="removeCompleteImage(2)">Ã—</button>
                        </div>
                    </div>
                </div>
                <input type="file" id="completeImageInput1" accept="image/*,image/jpeg,image/png,image/gif" style="position: absolute; left: -9999px; opacity: 0; pointer-events: none;" onchange="handleCompleteImageSelect(event, 1)">
                <input type="file" id="completeImageInput2" accept="image/*,image/jpeg,image/png,image/gif" style="position: absolute; left: -9999px; opacity: 0; pointer-events: none;" onchange="handleCompleteImageSelect(event, 2)">

                <!-- Android 14ä¸“ç”¨å¯è§æ–‡ä»¶è¾“å…¥æ¡† -->
                <div id="android14FileInputs" style="display: none;">
                    <input type="file" id="android14Input1" accept="image/*" style="width: 1px; height: 1px; opacity: 0.01; position: fixed; top: 0; left: 0; z-index: -1;" onchange="handleAndroid14FileSelect(event, 1)">
                    <input type="file" id="android14Input2" accept="image/*" style="width: 1px; height: 1px; opacity: 0.01; position: fixed; top: 0; left: 0; z-index: -1;" onchange="handleAndroid14FileSelect(event, 2)">
                </div>
            </div>
            <div class="completion-time">
                <span>ğŸ• å®Œæˆæ—¶é—´ï¼š<span id="completionTime"></span></span>
            </div>
            <div class="form-actions">
                <button class="btn-cancel" id="cancelCompleteBtn">å–æ¶ˆ</button>
                <button class="btn-save" id="confirmCompleteBtn">ç¡®è®¤å®Œæˆ</button>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div class="modal" id="imageViewModal">
        <div class="modal-content image-viewer">
            <div class="modal-header">
                <div class="modal-title">ğŸ“· æŸ¥çœ‹å›¾ç‰‡</div>
                <button class="close-btn" id="closeImageViewBtn">&times;</button>
            </div>
            <div class="image-view-container">
                <img id="viewImage" src="" alt="æŸ¥çœ‹å›¾ç‰‡">
            </div>
            <div class="image-info">
                <div class="task-info" id="imageTaskInfo">ä»»åŠ¡ä¿¡æ¯</div>
                <div class="completion-info" id="imageCompletionInfo">å®Œæˆä¿¡æ¯</div>
            </div>
        </div>
    </div>
    </div>
    <div class="view-container" id="settingsView" style="display: none;">
        <!-- è®¾ç½®ç•Œé¢ -->
        <div class="container" style="background: white; overflow-y: auto;">

            <div style="padding: 20px;">
                <h1 style="color: #333; font-size: 28px; margin: 20px 0; text-align: center;">âš™ï¸ åº”ç”¨è®¾ç½®</h1>
                <p style="color: #666; margin: 10px 0; font-size: 16px; text-align: center;">ä¸ªæ€§åŒ–é…ç½®æ‚¨çš„å¾…åŠåº”ç”¨ï¼Œæå‡ä½¿ç”¨ä½“éªŒ</p>

                <!-- è®¾ç½®é€‰é¡¹ -->
                <div style="display: grid; grid-template-columns: 1fr; gap: 16px; padding: 20px 0; max-width: 400px; margin: 0 auto;">
                    <!-- æ¯æ—¥å¾…åŠè®¾ç½® -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: transform 0.2s ease;" onclick="showDailyTodoSettings()">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 28px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2); border-radius: 12px;">ğŸ“‹</div>
                            <div>
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">æ¯æ—¥å¾…åŠ</div>
                                <div style="font-size: 12px; opacity: 0.9;">è‡ªåŠ¨ä»»åŠ¡æ¨¡æ¿</div>
                            </div>
                        </div>
                    </div>

                    <!-- å¾®ä¿¡é€šçŸ¥è®¾ç½® -->
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: transform 0.2s ease;" onclick="showWechatSettings()">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 28px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2); border-radius: 12px;">ğŸ“±</div>
                            <div>
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">å¾®ä¿¡é€šçŸ¥</div>
                                <div style="font-size: 12px; opacity: 0.9;">æ¶ˆæ¯æ¨é€æé†’</div>
                            </div>
                        </div>
                    </div>

                    <!-- æ•°æ®åŒæ­¥è®¾ç½® -->
                    <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: transform 0.2s ease;" onclick="showDatabaseSettings()">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 28px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2); border-radius: 12px;">ğŸ—„ï¸</div>
                            <div>
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">æ•°æ®åŒæ­¥</div>
                                <div style="font-size: 12px; opacity: 0.9;">äº‘ç«¯å­˜å‚¨é…ç½®</div>
                            </div>
                        </div>
                    </div>

                    <!-- å®Œæˆäººç®¡ç† -->
                    <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: transform 0.2s ease;" onclick="showAssigneeSettings()">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 28px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2); border-radius: 12px;">ğŸ‘¥</div>
                            <div>
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">å®Œæˆäººç®¡ç†</div>
                                <div style="font-size: 12px; opacity: 0.9;">é…ç½®ä»»åŠ¡å®Œæˆäºº</div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸ªäººä¿¡æ¯è®¾ç½® -->
                    <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; padding: 20px; border-radius: 12px; cursor: pointer; transition: transform 0.2s ease;" onclick="showPersonalInfoModal()">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 28px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.5); border-radius: 12px;">ğŸ‘¤</div>
                            <div>
                                <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">ä¸ªäººä¿¡æ¯</div>
                                <div style="font-size: 12px; opacity: 0.8;">è®¾ç½®æˆ‘çš„èº«ä»½å’Œæƒé™</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¯æ—¥å¾…åŠè®¾ç½®æ¨¡æ€æ¡† -->
        <div class="modal" id="dailyTodoModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">æ¯æ—¥å¾…åŠè®¾ç½®</div>
                    <button class="close-btn" id="closeDailyTodoBtn">&times;</button>
                </div>
                <div class="form-group">
                    <label class="form-label">æ¯æ—¥å›ºå®šä»»åŠ¡æ¨¡æ¿</label>
                    <textarea class="form-textarea" id="dailyTasksTemplate" placeholder="æ¯è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ ¼å¼ï¼šä»»åŠ¡åç§°|ä¼˜å…ˆçº§|åˆ†ç±»|æˆªæ­¢æ—¶é—´|å®Œæˆäºº&#10;ä¾‹å¦‚ï¼š&#10;æŸ¥çœ‹é‚®ä»¶|medium|work|09:30|å¼ ä¸‰&#10;é”»ç‚¼30åˆ†é’Ÿ|high|life|18:00|æå››&#10;å­¦ä¹ æ–°çŸ¥è¯†|low|study|21:30|ç‹äº”&#10;åˆ¶å®šæ˜æ—¥è®¡åˆ’|medium|work|22:00|å¼ ä¸‰&#10;&#10;è¯´æ˜ï¼š&#10;- ä¼˜å…ˆçº§ï¼šhigh(é«˜)|medium(ä¸­)|low(ä½)&#10;- åˆ†ç±»ï¼šwork(å·¥ä½œ)|life(ç”Ÿæ´»)|study(å­¦ä¹ )|other(å…¶ä»–)&#10;- æˆªæ­¢æ—¶é—´ï¼šHH:MMæ ¼å¼ï¼Œä¸å¡«åˆ™é»˜è®¤23:59&#10;- å®Œæˆäººï¼šä»å®Œæˆäººåˆ—è¡¨ä¸­é€‰æ‹©ï¼Œä¸å¡«åˆ™ä¸ºæœªåˆ†é…&#10;- æ¯æ—¥ä¼šè‡ªåŠ¨ç”Ÿæˆæœªæ¥7å¤©çš„ä»»åŠ¡" rows="10"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">è‡ªåŠ¨æ·»åŠ æ—¶é—´</label>
                    <input type="time" class="form-input" id="autoAddTime" value="09:00">
                </div>
                <div class="form-group">
                    <label class="form-checkbox-group">
                        <input type="checkbox" id="enableDailyTodo" checked>
                        <span>å¯ç”¨æ¯æ—¥è‡ªåŠ¨æ·»åŠ ä»»åŠ¡</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-checkbox-group">
                        <input type="checkbox" id="skipHolidays" checked>
                        <span>è·³è¿‡èŠ‚å‡æ—¥ï¼ˆå‘¨æœ«å’Œæ³•å®šèŠ‚å‡æ—¥ï¼‰</span>
                    </label>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        å¼€å¯åå°†ä¸ä¼šåœ¨å‘¨æœ«å’Œæ³•å®šèŠ‚å‡æ—¥ç”Ÿæˆæ¯æ—¥ä»»åŠ¡
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn-cancel" id="cancelDailyTodoBtn">å–æ¶ˆ</button>
                    <button class="btn-save" id="saveDailyTodoBtn">ä¿å­˜</button>
                </div>
            </div>
        </div>

        <!-- æ•°æ®åº“è®¾ç½®æ¨¡æ€æ¡† -->
        <div class="modal" id="databaseModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">æ•°æ®åº“åŒæ­¥è®¾ç½®</div>
                    <button class="close-btn" id="closeDatabaseBtn">&times;</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Supabaseæ•°æ®åº“é…ç½®</label>
                    <input type="text" class="form-input" id="supabaseUrl" placeholder="è¯·è¾“å…¥Supabaseé¡¹ç›®URL" maxlength="200">
                    <small style="color: #666; font-size: 12px;">åœ¨Supabaseæ§åˆ¶å°çš„é¡¹ç›®è®¾ç½®ä¸­è·å–URL<br/>
                        <strong>é¦–æ¬¡ä½¿ç”¨éœ€è¦åˆ›å»ºæ•°æ®è¡¨ï¼š</strong><br/>
                        CREATE TABLE daily_todo (<br/>
                        &nbsp;&nbsp;id SERIAL PRIMARY KEY,<br/>
                        &nbsp;&nbsp;user_id TEXT NOT NULL,<br/>
                        &nbsp;&nbsp;tasks JSONB NOT NULL DEFAULT '[]',<br/>
                        &nbsp;&nbsp;created_at TIMESTAMPTZ DEFAULT NOW(),<br/>
                        &nbsp;&nbsp;updated_at TIMESTAMPTZ DEFAULT NOW(),<br/>
                        &nbsp;&nbsp;version TEXT DEFAULT '1.0'<br/>
                        );
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">Supabase Anon Key</label>
                    <input type="text" class="form-input" id="supabaseAnonKey" placeholder="è¯·è¾“å…¥Supabase Anon Key" maxlength="200">
                    <small style="color: #666; font-size: 12px;">
                        åœ¨Supabaseæ§åˆ¶å°çš„APIè®¾ç½®ä¸­è·å–Anon Key
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" class="form-input" id="supabaseUserId" placeholder="ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ID" maxlength="100">
                    <small style="color: #666; font-size: 12px;">
                        è‡ªå®šä¹‰ç”¨æˆ·IDå¯ä»¥ç¡®ä¿å¤šè®¾å¤‡ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®ç©ºé—´
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-checkbox-group">
                        <input type="checkbox" id="enableOnlineSync" checked>
                        <span>å¯ç”¨åœ¨çº¿æ•°æ®åŒæ­¥</span>
                    </label>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        å¼€å¯åæ•°æ®å°†è‡ªåŠ¨åŒæ­¥åˆ°äº‘ç«¯ï¼Œæ”¯æŒå¤šè®¾å¤‡è®¿é—®
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">åŒæ­¥é—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <select class="form-select" id="syncIntervalSelect">
                        <option value="1">1åˆ†é’Ÿ</option>
                        <option value="5" selected>5åˆ†é’Ÿ</option>
                        <option value="10">10åˆ†é’Ÿ</option>
                        <option value="30">30åˆ†é’Ÿ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">æ•°æ®åº“çŠ¶æ€</label>
                    <div id="databaseStatus" style="padding: 10px; border-radius: 4px; background: #f5f5f5; font-size: 14px;">
                        <span id="statusText">æ£€æŸ¥ä¸­...</span>
                        <div id="binIdInfo" style="margin-top: 8px; font-size: 12px; color: #666; word-break: break-all;"></div>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn-cancel" id="cancelDatabaseBtn">å–æ¶ˆ</button>
                    <button class="btn-save" id="saveDatabaseBtn">ä¿å­˜</button>
                    <button type="button" class="btn-save" onclick="testDatabaseConnection()" style="background: #28a745;">æµ‹è¯•è¿æ¥</button>
                </div>
            </div>
        </div>

        <!-- å¾®ä¿¡é€šçŸ¥è®¾ç½®æ¨¡æ€æ¡† -->
        <div class="modal" id="wechatModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">å¾®ä¿¡é€šçŸ¥è®¾ç½®</div>
                    <button class="close-btn" id="closeWechatBtn">&times;</button>
                </div>
                <div class="form-group">
                    <label class="form-label">å¾®ä¿¡é€šçŸ¥è®¾ç½® (Serveré…±)</label>
                    <input type="text" class="form-input" id="serverChanKey" placeholder="è¯·è¾“å…¥Serveré…±çš„SendKey" maxlength="100">
                    <small style="color: #666; font-size: 12px;">è·å–SendKeyï¼š<a href="https://sct.ftqq.com/" target="_blank">https://sct.ftqq.com/</a></small>
                </div>
                <div class="form-group">
                    <label class="form-checkbox-group">
                        <input type="checkbox" id="enableWechatNotify">
                        <span>å¯ç”¨å¾®ä¿¡é€šçŸ¥</span>
                    </label>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        å¼€å¯åå°†åœ¨æ¯æ—¥9:00å’Œ18:00å‘é€ä»Šæ—¥ä»»åŠ¡å’Œé€¾æœŸä»»åŠ¡æ±‡æ€»æé†’
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">é€šçŸ¥æ—¶é—´è®¾ç½®</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <label style="display: flex; align-items: center; gap: 4px;">
                            <span style="font-size: 14px;">æ™¨æŠ¥æ—¶é—´:</span>
                            <input type="time" class="form-input" id="morningNotifyTime" value="09:00" style="width: 120px;">
                        </label>
                        <label style="display: flex; align-items: center; gap: 4px;">
                            <span style="font-size: 14px;">æ™šæŠ¥æ—¶é—´:</span>
                            <input type="time" class="form-input" id="eveningNotifyTime" value="18:00" style="width: 120px;">
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn-cancel" id="cancelWechatBtn">å–æ¶ˆ</button>
                    <button class="btn-save" id="saveWechatBtn">ä¿å­˜</button>
                    <button type="button" class="btn-save" onclick="testWechatNotification()" style="background: #28a745;">æµ‹è¯•æ™¨æ™šæŠ¥</button>
                    <button type="button" class="btn-save" onclick="testDeadlineReminder()" style="background: #ff6b35; margin-left: 10px;">æµ‹è¯•è¶…æ—¶æé†’</button>
                </div>
            </div>
        </div>

        <!-- å®Œæˆäººç®¡ç†è®¾ç½®æ¨¡æ€æ¡† -->
        <div class="modal" id="assigneeModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">å®Œæˆäººç®¡ç†</div>
                    <button class="close-btn" id="closeAssigneeBtn">&times;</button>
                </div>
                <div class="form-group">
                    <label class="form-label">æ·»åŠ å®Œæˆäºº</label>
                    <div class="assignee-add-container">
                        <input type="text" class="form-input" id="newAssigneeName" placeholder="è¯·è¾“å…¥å®Œæˆäººå§“å" maxlength="20">
                        <button class="btn-add-assignee" onclick="addAssignee()">
                            <i class="icon-plus">+</i>
                            <span>æ·»åŠ </span>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">å½“å‰å®Œæˆäººåˆ—è¡¨</label>
                    <div id="assigneeList" style="max-height: 200px; overflow-y: auto;">
                        <!-- å®Œæˆäººåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn-cancel" id="cancelAssigneeBtn">å…³é—­</button>
                </div>
            </div>
        </div>

        <!-- ä¸ªäººä¿¡æ¯è®¾ç½®æ¨¡æ€æ¡† -->
        <div class="modal" id="personalInfoModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">ä¸ªäººä¿¡æ¯è®¾ç½®</div>
                    <button class="close-btn" id="closePersonalInfoBtn">&times;</button>
                </div>
                <div class="form-group">
                    <label class="form-label">é€‰æ‹©æˆ‘çš„èº«ä»½</label>
                    <select class="form-select" id="myAssigneeSelect">
                        <option value="">è¯·ä»å®Œæˆäººåˆ—è¡¨ä¸­é€‰æ‹©è‡ªå·±</option>
                    </select>
                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                        è®¾ç½®èº«ä»½åï¼Œé…åˆè§’è‰²é™åˆ¶ä½¿ç”¨ï¼Œæ§åˆ¶ä»»åŠ¡æ“ä½œæƒé™
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-checkbox-group">
                        <input type="checkbox" id="enableRoleRestriction">
                        <span>å¯ç”¨è§’è‰²é™åˆ¶</span>
                    </label>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        å¼€å¯åä»å¯æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡ï¼Œä½†åªèƒ½æ“ä½œè‡ªå·±çš„ä»»åŠ¡å’Œæ— æŒ‡å®šå®Œæˆäººçš„ä»»åŠ¡
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn-cancel" onclick="closePersonalInfoModal()">å–æ¶ˆ</button>
                    <button class="btn-save" onclick="savePersonalInfo()">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>


    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
    <input type="file" id="fileInput" class="hidden" accept=".json" onchange="handleFileImport(event)">

    <script>
        // å…¨å±€å˜é‡
        let tasks = [];
        let currentFilter = 'all';
        let editingTaskId = null;
        let currentDateFilter = 'today';
        let currentPriorityFilter = 'all';
        let currentCategoryFilter = 'all';
        let currentSortBy = 'deadline';
        let currentSortOrder = 'asc';
        let customDate = null;
        let isBatchMode = false;
        let selectedTasks = new Set();

        // åœ¨çº¿æ•°æ®åº“é…ç½® (Supabase)
        const DATABASE_CONFIG = {
            // Supabaseé¡¹ç›®é…ç½®
            supabaseUrl: 'https://YOUR_PROJECT_ID.supabase.co', // æ›¿æ¢ä¸ºæ‚¨çš„Supabaseé¡¹ç›®URL
            supabaseAnonKey: 'YOUR_SUPABASE_ANON_KEY', // æ›¿æ¢ä¸ºæ‚¨çš„Supabase Anon Key
            tableName: 'daily_todo', // æ•°æ®è¡¨å
            userId: null, // ç”¨æˆ·IDï¼Œå¯ä»¥è®¾ç½®å›ºå®šå€¼æˆ–åŠ¨æ€ç”Ÿæˆ
            dataPath: 'dailyTodo' // æ•°æ®å­˜å‚¨è·¯å¾„ï¼ˆç”¨äºå…¼å®¹ï¼‰
        };

        // æ•°æ®åŒæ­¥çŠ¶æ€
        let syncStatus = {
            isOnline: navigator.onLine,
            lastSyncTime: null,
            syncInProgress: false,
            pendingChanges: false,
            retryCount: 0,
            maxRetries: 3
        };

        // ========== åœ¨çº¿æ•°æ®åº“åŠŸèƒ½ ==========

        // åˆå§‹åŒ–åœ¨çº¿æ•°æ®åº“é…ç½®
        function initializeDatabase() {
            // ä»localStorageè·å–å·²ä¿å­˜çš„Firebaseé…ç½®
            const savedApiKey = localStorage.getItem('firebase_api_key');
            const savedDatabaseURL = localStorage.getItem('firebase_database_url');
            const savedUserId = localStorage.getItem('firebase_user_id');

            if (savedApiKey && !savedApiKey.includes('YOUR_FIREBASE_API_KEY')) {
                DATABASE_CONFIG.apiKey = savedApiKey;
                console.log('ä½¿ç”¨å·²ä¿å­˜çš„Firebase API Key');
            }

            if (savedDatabaseURL && !savedDatabaseURL.includes('YOUR_PROJECT_ID')) {
                DATABASE_CONFIG.databaseURL = savedDatabaseURL;
                console.log('ä½¿ç”¨å·²ä¿å­˜çš„Firebaseæ•°æ®åº“URL');
            }

            // ç”Ÿæˆæˆ–è·å–ç”¨æˆ·ID
            if (savedUserId) {
                DATABASE_CONFIG.userId = savedUserId;
            } else {
                // ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·ID
                DATABASE_CONFIG.userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('firebase_user_id', DATABASE_CONFIG.userId);
            }
            console.log('ç”¨æˆ·ID:', DATABASE_CONFIG.userId);

            // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
            window.addEventListener('online', handleOnlineStatusChange);
            window.addEventListener('offline', handleOnlineStatusChange);

            // åˆå§‹åŒ–æ—¶æ£€æŸ¥ç½‘ç»œçŠ¶æ€
            syncStatus.isOnline = navigator.onLine;
            updateSyncStatusDisplay();
        }

        // ç½‘ç»œçŠ¶æ€å˜åŒ–å¤„ç†
        function handleOnlineStatusChange() {
            const wasOnline = syncStatus.isOnline;
            syncStatus.isOnline = navigator.onLine;

            console.log('ç½‘ç»œçŠ¶æ€å˜åŒ–:', syncStatus.isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿');
            updateSyncStatusDisplay();

            if (syncStatus.isOnline && !wasOnline) {
                // ä»ç¦»çº¿æ¢å¤åˆ°åœ¨çº¿ï¼ŒåŒæ­¥å¾…å¤„ç†çš„æ›´æ”¹
                console.log('ç½‘ç»œæ¢å¤ï¼Œå¼€å§‹åŒæ­¥æ•°æ®...');
                if (syncStatus.pendingChanges) {
                    syncDataToOnline();
                } else {
                    loadTasksFromOnline();
                }
            }
        }

        // æ˜¾ç¤ºåŒæ­¥Loading
        function showSyncLoading(text = 'æ­£åœ¨åŒæ­¥æ•°æ®...', subtitle = 'è¯·ç¨å€™ï¼Œæ­£åœ¨ä¸äº‘ç«¯åŒæ­¥') {
            const overlay = document.getElementById('syncLoadingOverlay');
            const textElement = document.getElementById('syncLoadingText');
            const subtitleElement = document.getElementById('syncLoadingSubtitle');

            if (overlay && textElement && subtitleElement) {
                textElement.textContent = text;
                subtitleElement.textContent = subtitle;
                overlay.classList.add('show');
            }

            // åŒæ—¶æ›´æ–°åŒæ­¥æŒ‰é’®çŠ¶æ€
            const syncButton = document.querySelector('[onclick="manualSync()"]');
            if (syncButton) {
                syncButton.classList.add('syncing');
            }
        }

        // éšè—åŒæ­¥Loading
        function hideSyncLoading() {
            const overlay = document.getElementById('syncLoadingOverlay');
            if (overlay) {
                overlay.classList.remove('show');
            }

            // æ¢å¤åŒæ­¥æŒ‰é’®çŠ¶æ€
            const syncButton = document.querySelector('[onclick="manualSync()"]');
            if (syncButton) {
                syncButton.classList.remove('syncing');
            }
        }

        // æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
        function updateSyncStatusDisplay() {
            const statusText = syncStatus.isOnline ?
                (syncStatus.syncInProgress ? 'åŒæ­¥ä¸­...' : 'å·²è¿æ¥') :
                'ç¦»çº¿æ¨¡å¼';

            // æ›´æ–°é¡µé¢æ ‡é¢˜æ˜¾ç¤ºåŒæ­¥çŠ¶æ€
            const titleElement = document.querySelector('.header h1');
            if (titleElement) {
                const baseTitle = 'ğŸ“…æ¯æ—¥å¾…åŠ';
                const statusIcon = syncStatus.isOnline ?
                    (syncStatus.syncInProgress ? 'ğŸ”„' : 'ğŸŒ') : 'ğŸ“±';
                titleElement.textContent = `${statusIcon} ${baseTitle}`;
            }

            console.log('åŒæ­¥çŠ¶æ€:', statusText);
        }

        // æ£€æŸ¥Supabaseé…ç½®æ˜¯å¦æœ‰æ•ˆ
        function checkSupabaseConfig() {
            if (!DATABASE_CONFIG.supabaseUrl || DATABASE_CONFIG.supabaseUrl.includes('YOUR_PROJECT_ID')) {
                console.error('è¯·å…ˆé…ç½®æœ‰æ•ˆçš„Supabaseé¡¹ç›®URL');
                alert('è¯·å…ˆé…ç½®æ‚¨çš„Supabaseé¡¹ç›®ä¿¡æ¯\n1. åœ¨Supabaseæ§åˆ¶å°åˆ›å»ºé¡¹ç›®\n2. åˆ›å»ºæ•°æ®è¡¨daily_todo\n3. é…ç½®é¡¹ç›®URLå’ŒAnon Key');
                return false;
            }

            if (!DATABASE_CONFIG.supabaseAnonKey || DATABASE_CONFIG.supabaseAnonKey.includes('YOUR_SUPABASE_ANON_KEY')) {
                console.error('è¯·å…ˆé…ç½®æœ‰æ•ˆçš„Supabase Anon Key');
                alert('è¯·å…ˆé…ç½®æ‚¨çš„Supabase Anon Key\nåœ¨Supabaseæ§åˆ¶å°çš„è®¾ç½®ä¸­è·å–');
                return false;
            }

            return true;
        }

        // åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
        function initializeDatabase() {
            // ä»localStorageæ¢å¤é…ç½®
            const savedUrl = localStorage.getItem('supabase_url');
            const savedAnonKey = localStorage.getItem('supabase_anon_key');
            const savedUserId = localStorage.getItem('supabase_user_id');

            if (savedUrl && !savedUrl.includes('YOUR_PROJECT_ID')) {
                DATABASE_CONFIG.supabaseUrl = savedUrl;
                console.log('ä½¿ç”¨å·²ä¿å­˜çš„Supabase URL');
            }
            if (savedAnonKey && !savedAnonKey.includes('YOUR_SUPABASE_ANON_KEY')) {
                DATABASE_CONFIG.supabaseAnonKey = savedAnonKey;
                console.log('ä½¿ç”¨å·²ä¿å­˜çš„Supabase Anon Key');
            }

            // ç”Ÿæˆæˆ–è·å–ç”¨æˆ·ID
            if (savedUserId) {
                DATABASE_CONFIG.userId = savedUserId;
            } else {
                // ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·ID
                DATABASE_CONFIG.userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('supabase_user_id', DATABASE_CONFIG.userId);
            }

            console.log('ç”¨æˆ·ID:', DATABASE_CONFIG.userId);

            // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
            window.addEventListener('online', handleOnlineStatusChange);
            window.addEventListener('offline', handleOnlineStatusChange);

            // åˆå§‹åŒ–æ—¶æ£€æŸ¥ç½‘ç»œçŠ¶æ€
            syncStatus.isOnline = navigator.onLine;
            updateSyncStatusDisplay();
        }

        // åˆå§‹åŒ–Supabaseæ•°æ®è¡¨
        async function initializeSupabaseData() {
            if (!checkSupabaseConfig()) {
                return false;
            }

            try {
                // æ£€æŸ¥ç”¨æˆ·æ•°æ®æ˜¯å¦å­˜åœ¨
                const url = `${DATABASE_CONFIG.supabaseUrl}/rest/v1/${DATABASE_CONFIG.tableName}?user_id=eq.${DATABASE_CONFIG.userId}`;

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'apikey': DATABASE_CONFIG.supabaseAnonKey,
                        'Authorization': `Bearer ${DATABASE_CONFIG.supabaseAnonKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.length === 0) {
                        // æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ›å»ºåˆå§‹æ•°æ®
                        console.log('åˆå§‹åŒ–Supabaseæ•°æ®...');
                        const initData = {
                            user_id: DATABASE_CONFIG.userId,
                            tasks: [],
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString(),
                            version: '1.0'
                        };

                        const initResponse = await fetch(`${DATABASE_CONFIG.supabaseUrl}/rest/v1/${DATABASE_CONFIG.tableName}`, {
                            method: 'POST',
                            headers: {
                                'apikey': DATABASE_CONFIG.supabaseAnonKey,
                                'Authorization': `Bearer ${DATABASE_CONFIG.supabaseAnonKey}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(initData)
                        });

                        if (initResponse.ok) {
                            console.log('æˆåŠŸåˆå§‹åŒ–Supabaseæ•°æ®');
                            return true;
                        } else {
                            console.error('åˆå§‹åŒ–Supabaseæ•°æ®å¤±è´¥:', await initResponse.text());
                            return false;
                        }
                    } else {
                        console.log('Supabaseæ•°æ®å·²å­˜åœ¨');
                        return true;
                    }
                } else {
                    console.error('æ£€æŸ¥Supabaseæ•°æ®å¤±è´¥:', await response.text());
                    return false;
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–Supabaseæ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                return false;
            }
        }

        // ä»Firebaseæ•°æ®åº“åŠ è½½æ•°æ®
        async function loadTasksFromOnline() {
            if (!syncStatus.isOnline || syncStatus.syncInProgress) {
                console.log('ç½‘ç»œä¸å¯ç”¨æˆ–æ­£åœ¨åŒæ­¥ä¸­ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®');
                return loadTasksFromLocal();
            }

            if (!checkSupabaseConfig()) {
                return loadTasksFromLocal();
            }

            try {
                syncStatus.syncInProgress = true;
                showSyncLoading('æ­£åœ¨åŠ è½½æ•°æ®...', 'ä»äº‘ç«¯è·å–æœ€æ–°æ•°æ®');
                updateSyncStatusDisplay();

                const url = `${DATABASE_CONFIG.supabaseUrl}/rest/v1/${DATABASE_CONFIG.tableName}?user_id=eq.${DATABASE_CONFIG.userId}`;

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'apikey': DATABASE_CONFIG.supabaseAnonKey,
                        'Authorization': `Bearer ${DATABASE_CONFIG.supabaseAnonKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data && data.length > 0 && Array.isArray(data[0].tasks)) {
                        tasks = data[0].tasks;
                        syncStatus.lastSyncTime = new Date();
                        syncStatus.retryCount = 0;

                        // åŒæ—¶ä¿å­˜åˆ°æœ¬åœ°ä½œä¸ºå¤‡ä»½
                        saveTasksToLocal();

                        console.log('æˆåŠŸä»Supabaseæ•°æ®åº“åŠ è½½ä»»åŠ¡:', tasks.length, 'ä¸ª');
                        return true;
                    } else if (data.length === 0) {
                        // æ•°æ®ä¸å­˜åœ¨ï¼Œåˆå§‹åŒ–
                        console.log('Supabaseæ•°æ®ä¸å­˜åœ¨ï¼Œåˆå§‹åŒ–...');
                        const initialized = await initializeSupabaseData();
                        if (initialized) {
                            tasks = [];
                            return true;
                        }
                        return loadTasksFromLocal();
                    } else {
                        console.warn('Supabaseæ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®');
                        return loadTasksFromLocal();
                    }
                } else {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }
            } catch (error) {
                console.error('ä»Firebaseæ•°æ®åº“åŠ è½½æ•°æ®å¤±è´¥:', error);
                syncStatus.retryCount++;

                if (syncStatus.retryCount <= syncStatus.maxRetries) {
                    console.log(`å°†åœ¨5ç§’åé‡è¯• (${syncStatus.retryCount}/${syncStatus.maxRetries})`);
                    setTimeout(() => loadTasksFromOnline(), 5000);
                }

                return loadTasksFromLocal();
            } finally {
                syncStatus.syncInProgress = false;
                hideSyncLoading();
                updateSyncStatusDisplay();
            }
        }

        // ä¿å­˜æ•°æ®åˆ°Firebaseæ•°æ®åº“
        async function saveTasksToOnline() {
            if (!syncStatus.isOnline) {
                console.log('ç¦»çº¿çŠ¶æ€ï¼Œæ ‡è®°ä¸ºå¾…åŒæ­¥');
                syncStatus.pendingChanges = true;
                return saveTasksToLocal();
            }

            if (!checkSupabaseConfig()) {
                syncStatus.pendingChanges = true;
                return saveTasksToLocal();
            }

            try {
                syncStatus.syncInProgress = true;
                showSyncLoading('æ­£åœ¨ä¿å­˜æ•°æ®...', 'å°†æ•°æ®åŒæ­¥åˆ°äº‘ç«¯');
                updateSyncStatusDisplay();

                const dataToSave = {
                    user_id: DATABASE_CONFIG.userId,
                    tasks: tasks,
                    updated_at: new Date().toISOString(),
                    version: '1.0'
                };

                // æ£€æŸ¥æ•°æ®å¤§å°ï¼ˆSupabaseé€šå¸¸æœ‰æ›´å¤§çš„é™åˆ¶ï¼‰
                const dataSize = JSON.stringify(dataToSave).length;
                const dataSizeKB = Math.round(dataSize / 1024);
                console.log('å‡†å¤‡ä¿å­˜æ•°æ®å¤§å°:', dataSizeKB, 'KB');

                if (dataSizeKB > 900) {
                    console.warn('æ•°æ®å¤§å°è¾ƒå¤§ï¼Œå¯èƒ½ä¿å­˜è¾ƒæ…¢');

                    // å¦‚æœæ•°æ®å¤ªå¤§ï¼Œå°è¯•æ¸…ç†æœ€æ—§çš„å®Œæˆå›¾ç‰‡
                    if (dataSizeKB > 1000) {
                        console.log('æ•°æ®è¶…è¿‡1MBï¼Œå°è¯•æ¸…ç†æ—§å›¾ç‰‡');
                        cleanupOldImages();

                        // é‡æ–°æ„å»ºæ•°æ®
                        dataToSave.tasks = tasks;
                        dataToSave.updated_at = new Date().toISOString();
                        const newDataSize = JSON.stringify(dataToSave).length;
                        const newDataSizeKB = Math.round(newDataSize / 1024);
                        console.log('æ¸…ç†åæ•°æ®å¤§å°:', newDataSizeKB, 'KB');
                    }
                }

                // å…ˆå°è¯•æ›´æ–°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ’å…¥
                const updateUrl = `${DATABASE_CONFIG.supabaseUrl}/rest/v1/${DATABASE_CONFIG.tableName}?user_id=eq.${DATABASE_CONFIG.userId}`;

                const response = await fetch(updateUrl, {
                    method: 'PATCH',
                    headers: {
                        'apikey': DATABASE_CONFIG.supabaseAnonKey,
                        'Authorization': `Bearer ${DATABASE_CONFIG.supabaseAnonKey}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        tasks: tasks,
                        updated_at: new Date().toISOString(),
                        version: '1.0'
                    })
                });

                if (response.ok) {
                    syncStatus.lastSyncTime = new Date();
                    syncStatus.pendingChanges = false;
                    syncStatus.retryCount = 0;

                    // åŒæ—¶ä¿å­˜åˆ°æœ¬åœ°ä½œä¸ºå¤‡ä»½
                    saveTasksToLocal();

                    console.log('æˆåŠŸä¿å­˜åˆ°Supabaseæ•°æ®åº“');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }
            } catch (error) {
                console.error('ä¿å­˜åˆ°Firebaseæ•°æ®åº“å¤±è´¥:', error);
                syncStatus.pendingChanges = true;
                syncStatus.retryCount++;

                // å…ˆä¿å­˜åˆ°æœ¬åœ°
                saveTasksToLocal();

                if (syncStatus.retryCount <= syncStatus.maxRetries) {
                    console.log(`å°†åœ¨10ç§’åé‡è¯•ä¿å­˜ (${syncStatus.retryCount}/${syncStatus.maxRetries})`);
                    setTimeout(() => saveTasksToOnline(), 10000);
                }

                return false;
            } finally {
                syncStatus.syncInProgress = false;
                hideSyncLoading();
                updateSyncStatusDisplay();
            }
        }

        // åŒæ­¥æ•°æ®åˆ°åœ¨çº¿æ•°æ®åº“
        async function syncDataToOnline() {
            if (syncStatus.pendingChanges && syncStatus.isOnline) {
                console.log('æ­£åœ¨åŒæ­¥å¾…å¤„ç†çš„æ›´æ”¹...');
                await saveTasksToOnline();
            }
        }

        // æ‰‹åŠ¨è§¦å‘æ•°æ®åŒæ­¥ï¼ˆä»æ•°æ®åº“è¦†ç›–æœ¬åœ°ï¼‰
        async function manualSync() {
            if (!syncStatus.isOnline) {
                alert('å½“å‰å¤„äºç¦»çº¿çŠ¶æ€ï¼Œæ— æ³•åŒæ­¥æ•°æ®');
                return;
            }

            if (syncStatus.syncInProgress) {
                alert('æ­£åœ¨åŒæ­¥ä¸­ï¼Œè¯·ç¨å€™...');
                return;
            }

            try {
                showSyncLoading('æ‰‹åŠ¨åŒæ­¥ä¸­...', 'ä»äº‘ç«¯åŒæ­¥æœ€æ–°æ•°æ®åˆ°æœ¬åœ°');

                // ç›´æ¥ä»æ•°æ®åº“æ‹‰å–æœ€æ–°æ•°æ®ï¼Œè¦†ç›–æœ¬åœ°æ•°æ®
                await loadTasksFromOnline();

                // æ›´æ–°æ˜¾ç¤º
                renderTasks();
                updateStats();

                hideSyncLoading();

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                setTimeout(() => {
                    alert('åŒæ­¥æ•°æ®æˆåŠŸ');
                }, 300);
            } catch (error) {
                hideSyncLoading();
                console.error('æ‰‹åŠ¨åŒæ­¥å¤±è´¥:', error);
                alert('åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        // å¼ºåˆ¶ä»æ•°æ®åº“è¦†ç›–æœ¬åœ°æ•°æ®ï¼ˆå…¨å±€æµ‹è¯•å‡½æ•°ï¼‰
        window.forceLoadFromDatabase = async function() {
            console.log('å¼ºåˆ¶ä»æ•°æ®åº“åŠ è½½æ•°æ®è¦†ç›–æœ¬åœ°...');
            try {
                await checkForUpdatesFromServer();
                console.log('æ•°æ®å·²ä»æ•°æ®åº“è¦†ç›–å®Œæˆ');
            } catch (error) {
                console.error('å¼ºåˆ¶è¦†ç›–å¤±è´¥:', error);
            }
        };

        // æœ¬åœ°å­˜å‚¨å¤‡ä»½å‡½æ•°
        function saveTasksToLocal() {
            try {
                localStorage.setItem('dailyTodoTasks', JSON.stringify(tasks));
                localStorage.setItem('lastLocalSave', new Date().toISOString());
            } catch (error) {
                console.error('ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:', error);
            }
        }

        function loadTasksFromLocal() {
            try {
                const saved = localStorage.getItem('dailyTodoTasks');
                if (saved) {
                    tasks = JSON.parse(saved);
                    console.log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä»»åŠ¡:', tasks.length, 'ä¸ª');
                    return true;
                }
            } catch (error) {
                console.error('ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®å¤±è´¥:', error);
                tasks = [];
            }
            return false;
        }

        // Androidé€‰æ‹©æ¡†ä¼˜åŒ–å‡½æ•° - å¢å¼ºç‰ˆ
        function optimizeSelectElements() {
            const androidVersion = parseFloat((navigator.userAgent.match(/Android ([\d.]+)/) || [])[1]) || 0;
            console.log(`Android ${androidVersion} é€‰æ‹©æ¡†ä¼˜åŒ–å¼€å§‹`);

            // ç­‰å¾…DOMåŠ è½½å®Œæˆåå†ä¼˜åŒ–é€‰æ‹©æ¡†
            setTimeout(() => {
                const selectElements = document.querySelectorAll('select, .filter-select, .form-select');
                console.log(`ä¼˜åŒ– ${selectElements.length} ä¸ªé€‰æ‹©æ¡†å…ƒç´ `);

                selectElements.forEach(select => {
                    // å¼ºåˆ¶è®¾ç½®ä¸ºåŸç”Ÿä¸‹æ‹‰åˆ—è¡¨æ¨¡å¼
                    select.style.setProperty('-webkit-appearance', 'listbox', 'important');
                    select.style.setProperty('-moz-appearance', 'listbox', 'important');
                    select.style.setProperty('appearance', 'listbox', 'important');
                    select.style.setProperty('background-image', 'none', 'important');

                    // Android 14+ ç‰¹æ®Šå¤„ç†
                    if (androidVersion >= 14) {
                        // ç¦ç”¨WebViewçš„è‡ªå®šä¹‰é€‰æ‹©å™¨
                        select.style.setProperty('-webkit-user-select', 'auto', 'important');
                        select.style.setProperty('user-select', 'auto', 'important');

                        // å°è¯•å¤šç§appearanceå€¼
                        select.style.setProperty('-webkit-appearance', 'menulist', 'important');
                        select.style.setProperty('-moz-appearance', 'menulist', 'important');
                        select.style.setProperty('appearance', 'menulist', 'important');
                    }

                    // ç¡®ä¿è§¦æ‘¸å‹å¥½ï¼Œä¸CSSæ ·å¼ä¿æŒä¸€è‡´
                    select.style.setProperty('min-height', '32px', 'important');
                    select.style.setProperty('font-size', '11px', 'important');
                    select.style.setProperty('padding', '5px 8px', 'important');
                    select.style.setProperty('padding-right', '25px', 'important');
                    select.style.setProperty('border', '2px solid #667eea', 'important');
                    select.style.setProperty('border-radius', '8px', 'important');
                    select.style.setProperty('background-color', 'white', 'important');

                    // ç§»é™¤å¯èƒ½çš„è‡ªå®šä¹‰æ ·å¼
                    select.classList.remove('custom-select');

                    // å¼ºåˆ¶è§¦æ‘¸äº‹ä»¶å¤„ç†
                    select.addEventListener('touchstart', function(e) {
                        console.log('é€‰æ‹©æ¡†è§¦æ‘¸å¼€å§‹');
                        this.focus();
                        // å°è¯•ä¸»åŠ¨è§¦å‘clickäº‹ä»¶
                        setTimeout(() => {
                            this.click();
                        }, 50);
                    }, { passive: false });

                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç¡®ä¿æ­£å¸¸å¼¹å‡º
                    select.addEventListener('click', function(e) {
                        console.log('é€‰æ‹©æ¡†ç‚¹å‡»äº‹ä»¶');
                        // ç¡®ä¿èšç„¦
                        if (document.activeElement !== this) {
                            this.focus();
                        }
                    }, { passive: false });
                });

                console.log('Androidé€‰æ‹©æ¡†ä¼˜åŒ–å®Œæˆ');
            }, 200);
        }

        // Androidç‰ˆæœ¬æ£€æµ‹å‡½æ•°
        function getAndroidVersion() {
            const isAndroid = /Android/.test(navigator.userAgent);
            if (!isAndroid) return 0;

            const match = navigator.userAgent.match(/Android ([\d.]+)/);
            return match ? parseFloat(match[1]) : 0;
        }

        // æ£€æµ‹æ˜¯å¦ä¸ºAndroid 14åŠä»¥ä¸Šç‰ˆæœ¬
        function isAndroid14() {
            const androidVersion = getAndroidVersion();
            return androidVersion >= 14;
        }

        // Android 14 å…¼å®¹æ€§æ£€æµ‹
        function checkAndroidCompatibility() {
            const isAndroid = /Android/.test(navigator.userAgent);
            const androidVersion = getAndroidVersion();
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

            // æ·»åŠ è®¾å¤‡ç±»å‹æ ‡è¯†
            if (isAndroid) {
                document.body.classList.add('android-device');
                console.log(`æ£€æµ‹åˆ° Android ${androidVersion} è®¾å¤‡`);

                // ä¸ºæ‰€æœ‰Androidè®¾å¤‡ä¼˜åŒ–é€‰æ‹©æ¡†
                optimizeSelectElements();

                // ç›‘å¬DOMå˜åŒ–ï¼Œç¡®ä¿æ–°æ·»åŠ çš„é€‰æ‹©æ¡†ä¹Ÿè¢«ä¼˜åŒ–
                if (androidVersion >= 12) {
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            mutation.addedNodes.forEach((node) => {
                                if (node.nodeType === 1) { // å…ƒç´ èŠ‚ç‚¹
                                    const selects = node.querySelectorAll ?
                                        node.querySelectorAll('select, .filter-select, .form-select') : [];
                                    if (selects.length > 0) {
                                        console.log(`å‘ç°æ–°çš„é€‰æ‹©æ¡†å…ƒç´ : ${selects.length} ä¸ª`);
                                        setTimeout(() => optimizeSelectElements(), 100);
                                    }
                                    // å¦‚æœèŠ‚ç‚¹æœ¬èº«å°±æ˜¯selectå…ƒç´ 
                                    if (node.tagName === 'SELECT' ||
                                        node.classList.contains('filter-select') ||
                                        node.classList.contains('form-select')) {
                                        console.log('å‘ç°æ–°çš„å•ä¸ªé€‰æ‹©æ¡†å…ƒç´ ');
                                        setTimeout(() => optimizeSelectElements(), 100);
                                    }
                                }
                            });
                        });
                    });

                    // å¼€å§‹è§‚å¯Ÿ
                    observer.observe(document.body, {
                        childList: true,
                        subtree: true
                    });
                }
            }

            if (isIOS) {
                document.body.classList.add('ios-device');
            }

            // Android 12+ éƒ½éœ€è¦çŠ¶æ€ç­›é€‰æŒ‰é’®ä¿®å¤
            if (isAndroid && androidVersion >= 12) {
                console.log(`æ£€æµ‹åˆ° Android ${androidVersion}+ è®¾å¤‡ï¼Œå¯ç”¨å…¼å®¹æ€§ä¼˜åŒ–`);
                document.body.classList.add('android-14-compat'); // ä½¿ç”¨ç»Ÿä¸€çš„ç±»å

                // ä¸ºAndroid 14æ·»åŠ é¢å¤–çš„CSSå…¼å®¹æ€§
                const style = document.createElement('style');
                style.textContent = `
                    .android-14-compat .action-btn {
                        min-width: 48px !important;
                        min-height: 48px !important;
                        font-size: 16px !important;
                    }

                    .android-14-compat .emoji-icon {
                        font-size: 25px !important;
                        text-shadow:
                            0 3px 6px rgba(0, 0, 0, 0.25) !important,
                            0 1px 3px rgba(0, 0, 0, 0.15) !important;
                        filter: contrast(1.15) brightness(1.08) saturate(1.15) !important;
                    }

                    .android-14-compat .edit-btn:hover .emoji-icon {
                        transform: scale(1.15) translateY(-1px) rotate(5deg) !important;
                        animation: none !important;
                        text-shadow:
                            0 4px 8px rgba(25, 118, 210, 0.4) !important,
                            0 2px 4px rgba(25, 118, 210, 0.2) !important;
                    }

                    .android-14-compat .delete-btn:hover .emoji-icon {
                        transform: scale(1.15) translateY(-1px) rotate(-5deg) !important;
                        animation: none !important;
                        text-shadow:
                            0 4px 8px rgba(211, 47, 47, 0.4) !important,
                            0 2px 4px rgba(211, 47, 47, 0.2) !important;
                    }

                    .android-14-compat .action-btn:active .emoji-icon {
                        transform: scale(0.9) translateY(0.5px) !important;
                        animation: none !important;
                    }
                    .android-14-compat .delete-btn {
                        background: #ffebee !important;
                        border: 2px solid #d32f2f !important;
                    }
                    /* Android 14 çŠ¶æ€ç­›é€‰æŒ‰é’®å¼ºåˆ¶å•è¡Œ */
                    .android-14-compat .status-filter-buttons {
                        display: flex !important;
                        flex-direction: row !important;
                        flex-wrap: nowrap !important;
                        width: 100% !important;
                        gap: 1px !important;
                        align-items: center !important;
                    }
                    .android-14-compat .status-filter-btn {
                        flex: 1 1 33.333% !important;
                        min-width: 0 !important;
                        max-width: 33.333% !important;
                        padding: 5px 1px !important;
                        font-size: 9px !important;
                        line-height: 1.2 !important;
                        border-width: 1px !important;
                        margin: 0 !important;
                        white-space: nowrap !important;
                        overflow: hidden !important;
                        text-overflow: ellipsis !important;
                        box-sizing: border-box !important;
                    }
                    /* Android 12+ é€‰æ‹©æ¡†å¼ºåˆ¶ä¸‹æ‹‰åˆ—è¡¨æ ·å¼ */
                    .android-14-compat select,
                    .android-14-compat .filter-select,
                    .android-14-compat .form-select {
                        -webkit-appearance: menulist !important;
                        -moz-appearance: menulist !important;
                        appearance: menulist !important;
                        background-image: none !important;
                        padding: 5px 8px !important;
                        padding-right: 25px !important;
                        min-height: 32px !important;
                        font-size: 11px !important;
                        border: 2px solid #667eea !important;
                        border-radius: 8px !important;
                        background-color: white !important;
                        /* å¼ºåˆ¶ç¦ç”¨Android WebViewçš„è‡ªå®šä¹‰é€‰æ‹©å™¨ */
                        -webkit-user-select: auto !important;
                        user-select: auto !important;
                        /* å¼ºåˆ¶ä½¿ç”¨ç³»ç»ŸåŸç”Ÿæ§ä»¶ */
                        -webkit-appearance: listbox !important;
                        -moz-appearance: listbox !important;
                        appearance: listbox !important;
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('Global error caught:', e.error);
            console.error('Error message:', e.message);
            console.error('Error file:', e.filename);
            console.error('Error line:', e.lineno);
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
        });

        // æ‰“å°å½“å‰å±å¹•å°ºå¯¸ä¿¡æ¯
        function printScreenSize() {
            const screenInfo = {
                'å±å¹•åˆ†è¾¨ç‡': `${screen.width} x ${screen.height}`,
                'å¯ç”¨å±å¹•å°ºå¯¸': `${screen.availWidth} x ${screen.availHeight}`,
                'çª—å£å†…éƒ¨å°ºå¯¸': `${window.innerWidth} x ${window.innerHeight}`,
                'çª—å£å¤–éƒ¨å°ºå¯¸': `${window.outerWidth} x ${window.outerHeight}`,
                'è®¾å¤‡åƒç´ æ¯”': window.devicePixelRatio,
                'å±å¹•æ–¹å‘': screen.orientation ? screen.orientation.type : 'æœªçŸ¥',
                'è‰²å½©æ·±åº¦': `${screen.colorDepth}ä½`,
                'åƒç´ æ·±åº¦': `${screen.pixelDepth}ä½`
            };

            console.log('ğŸ–¥ï¸ å½“å‰å±å¹•å°ºå¯¸ä¿¡æ¯:');
            console.table(screenInfo);

            // åˆ¤æ–­è®¾å¤‡ç±»å‹
            const isMobile = window.innerWidth <= 768;
            const isSmallMobile = window.innerWidth <= 480;
            const isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
            const isDesktop = window.innerWidth > 1024;

            let deviceType = '';
            if (isSmallMobile) deviceType = 'å°å±æ‰‹æœº';
            else if (isMobile) deviceType = 'æ‰‹æœº';
            else if (isTablet) deviceType = 'å¹³æ¿';
            else if (isDesktop) deviceType = 'æ¡Œé¢ç«¯';

            console.log(`ğŸ“± è®¾å¤‡ç±»å‹: ${deviceType}`);
            console.log(`ğŸ“ çª—å£æ¯”ä¾‹: ${(window.innerWidth / window.innerHeight).toFixed(2)}:1`);
        }

        // çª—å£å°ºå¯¸å˜åŒ–æ—¶é‡æ–°æ‰“å°
        window.addEventListener('resize', function() {
            console.log('ğŸ”„ çª—å£å°ºå¯¸å·²æ”¹å˜:');
            printScreenSize();
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM loaded, starting initialization');

            // æ‰“å°å±å¹•å°ºå¯¸ä¿¡æ¯
            printScreenSize();

            // è°ƒè¯•æƒé™ä¿¡æ¯
            setTimeout(() => {
                console.log('ğŸ” æƒé™é…ç½®çŠ¶æ€:');
                console.table(personalInfo);
                if (personalInfo.enableRoleRestriction) {
                    console.log('âœ… è§’è‰²é™åˆ¶å·²å¯ç”¨ - å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡ï¼Œä½†åªèƒ½æ“ä½œè‡ªå·±çš„ä»»åŠ¡');
                    if (personalInfo.myAssignee) {
                        console.log(`ğŸ‘¤ å½“å‰èº«ä»½: ${personalInfo.myAssignee}`);
                    } else {
                        console.log('âš ï¸ æœªè®¾ç½®èº«ä»½ï¼Œå°†æ— æ³•æ“ä½œä»»ä½•æœ‰æŒ‡å®šå®Œæˆäººçš„ä»»åŠ¡');
                    }
                } else {
                    console.log('âŒ è§’è‰²é™åˆ¶æœªå¯ç”¨ - å¯ä»¥æ“ä½œæ‰€æœ‰ä»»åŠ¡');
                }
            }, 2000);

            // æ£€æŸ¥Androidå…¼å®¹æ€§
            checkAndroidCompatibility();

            // åˆå§‹åŒ–åœ¨çº¿æ•°æ®åº“
            initializeDatabase();

            // åŠ è½½ä»»åŠ¡æ•°æ®
            await loadTasks();
            renderTasks();
            updateStats();
            setFilter('all');

            // åŠ è½½å®Œæˆäººæ•°æ®
            loadAssignees();
            updateCompletedByOptions();

            // åŠ è½½ä¸ªäººä¿¡æ¯
            loadPersonalInfo();

            // é˜²æ­¢ä»»åŠ¡åˆ—è¡¨æ»šåŠ¨æ—¶è§¦å‘bodyæ»šåŠ¨
            const taskList = document.getElementById('taskList');
            if (taskList) {
                taskList.addEventListener('wheel', function(e) {
                    const scrollTop = this.scrollTop;
                    const scrollHeight = this.scrollHeight;
                    const height = this.clientHeight;
                    const wheelDelta = e.deltaY;

                    // å¦‚æœå‘ä¸Šæ»šåŠ¨ä¸”å·²ç»åˆ°é¡¶éƒ¨ï¼Œæˆ–å‘ä¸‹æ»šåŠ¨ä¸”å·²ç»åˆ°åº•éƒ¨ï¼Œåˆ™å…è®¸bodyæ»šåŠ¨
                    if ((wheelDelta < 0 && scrollTop === 0) ||
                        (wheelDelta > 0 && scrollTop + height >= scrollHeight)) {
                        // å…è®¸bodyæ»šåŠ¨
                        return;
                    } else {
                        // é˜»æ­¢bodyæ»šåŠ¨
                        e.stopPropagation();
                    }
                });

                // é˜²æ­¢è§¦æ‘¸æ»šåŠ¨ä¼ æ’­
                taskList.addEventListener('touchmove', function(e) {
                    e.stopPropagation();
                }, { passive: false });
            }

            // è°ƒè¯•ï¼šæ£€æŸ¥ç•Œé¢å…ƒç´ æ˜¯å¦å­˜åœ¨
            setTimeout(() => {
                const taskView = document.getElementById('taskView');
                const settingsView = document.getElementById('settingsView');
                console.log('é¡µé¢åŠ è½½å®Œæˆåçš„æ£€æŸ¥:');
                console.log('taskViewå…ƒç´ :', taskView);
                console.log('settingsViewå…ƒç´ :', settingsView);
                if (settingsView) {
                    console.log('settingsViewæ ·å¼:', settingsView.style.display);
                    console.log('settingsViewå†…å®¹:', settingsView.innerHTML.substring(0, 200));
                }
            }, 1000);

            // è®¾ç½®é»˜è®¤æˆªæ­¢æ—¶é—´ä¸ºä»Šå¤©23:59
            setDefaultDeadline();

            // åˆå§‹åŒ–ç­›é€‰å™¨
            initializeFilters();

            // åˆå§‹åŒ–å¤šé€‰UIçŠ¶æ€
            initializeMultiSelectUI();
            
            // æ¸…ç†è¿‡æœŸçš„æ¯æ—¥å¾…åŠä»»åŠ¡
            cleanupExpiredDailyTodos();
            
            // æ£€æŸ¥å¹¶æ·»åŠ æ¯æ—¥å¾…åŠä»»åŠ¡
            checkAndAddDailyTodos();

            // å¯åŠ¨å®šæ—¶é€šçŸ¥æ£€æŸ¥å™¨
            startNotificationScheduler();

            // å¯åŠ¨å®šæ—¶æ•°æ®åŒæ­¥
            startDataSyncScheduler();

            // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
            document.addEventListener('visibilitychange', handleVisibilityChange);

            // ç«‹å³æ£€æŸ¥ä¸€æ¬¡é€šçŸ¥
            checkAndSendWechatNotification();

            // æ¢å¤æŠ˜å çŠ¶æ€
            restoreCollapsedStates();

            // æ·»åŠ çª—å£å¤§å°å˜åŒ–ç›‘å¬å™¨ - ç§»åŠ¨ç«¯è‡ªé€‚åº”
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    console.log('çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´ä»»åŠ¡åˆ—è¡¨å¸ƒå±€');
                    const filterCollapsed = localStorage.getItem('filterSectionCollapsed') === 'true';
                    if (filterCollapsed) {
                        adjustTaskItemHeight('normal');
                    } else {
                        adjustTaskItemHeight('compact');
                    }
                }, 250); // é˜²æŠ–å¤„ç†
            });

            // æ·»åŠ é”®ç›˜äº‹ä»¶
            const taskTitleInput = document.getElementById('taskTitleInput');
            if (taskTitleInput) {
                taskTitleInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addTask();
                    }
                });
            }

            // æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬
            const addTaskModal = document.getElementById('addTaskModal');
            const closeAddTaskBtn = document.getElementById('closeAddTaskBtn');
            const cancelAddTaskBtn = document.getElementById('cancelAddTaskBtn');
            const saveAddTaskBtn = document.getElementById('saveAddTaskBtn');
            const addTaskTitle = document.getElementById('addTaskTitle');

            if (closeAddTaskBtn) {
                closeAddTaskBtn.addEventListener('click', closeAddTaskModal);
            }

            if (cancelAddTaskBtn) {
                cancelAddTaskBtn.addEventListener('click', closeAddTaskModal);
            }

            if (saveAddTaskBtn) {
                saveAddTaskBtn.addEventListener('click', addTaskFromModal);
            }

            // æ·»åŠ ä»»åŠ¡æ ‡é¢˜è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            if (addTaskTitle) {
                addTaskTitle.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addTaskFromModal();
                    }
                });
            }

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            if (addTaskModal) {
                addTaskModal.addEventListener('click', function(e) {
                    if (e.target === addTaskModal) {
                        closeAddTaskModal();
                    }
                });
            }
            
            // ç»‘å®šç¼–è¾‘æ¨¡æ€æ¡†æŒ‰é’®äº‹ä»¶
            const closeEditBtn = document.getElementById('closeEditBtn');
            if (closeEditBtn) {
                // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                closeEditBtn.onclick = null;
                closeEditBtn.addEventListener('click', function(e) {
                    console.log('=== å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶å¼€å§‹ ===');
                    console.log('Event:', e);
                    console.log('Target:', e.target);
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('å…³é—­æŒ‰é’®è¢«ç‚¹å‡»ï¼Œå³å°†è°ƒç”¨closeEditModal');
                    try {
                        closeEditModal();
                        console.log('closeEditModalè°ƒç”¨æˆåŠŸ');
                    } catch (error) {
                        console.error('closeEditModalè°ƒç”¨å¤±è´¥:', error);
                    }
                    console.log('=== å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç»“æŸ ===');
                });
                console.log('å…³é—­æŒ‰é’®äº‹ä»¶å·²ç»‘å®š');
            } else {
                console.error('æœªæ‰¾åˆ°closeEditBtnå…ƒç´ ');
            }

            const cancelEditBtn = document.getElementById('cancelEditBtn');
            if (cancelEditBtn) {
                // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                cancelEditBtn.onclick = null;
                cancelEditBtn.addEventListener('click', function(e) {
                    console.log('=== å–æ¶ˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶å¼€å§‹ ===');
                    console.log('Event:', e);
                    console.log('Target:', e.target);
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('å–æ¶ˆæŒ‰é’®è¢«ç‚¹å‡»ï¼Œå³å°†è°ƒç”¨closeEditModal');
                    try {
                        closeEditModal();
                        console.log('closeEditModalè°ƒç”¨æˆåŠŸ');
                    } catch (error) {
                        console.error('closeEditModalè°ƒç”¨å¤±è´¥:', error);
                    }
                    console.log('=== å–æ¶ˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶ç»“æŸ ===');
                });
                console.log('å–æ¶ˆæŒ‰é’®äº‹ä»¶å·²ç»‘å®š');
            } else {
                console.error('æœªæ‰¾åˆ°cancelEditBtnå…ƒç´ ');
            }
            
            const saveEditBtn = document.getElementById('saveEditBtn');
            if (saveEditBtn) {
                saveEditBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('ä¿å­˜æŒ‰é’®è¢«ç‚¹å‡»');
                    saveEditTask();
                });
                console.log('ä¿å­˜æŒ‰é’®äº‹ä»¶å·²ç»‘å®š');
            } else {
                console.error('æœªæ‰¾åˆ°saveEditBtnå…ƒç´ ');
            }
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            const editModal = document.getElementById('editModal');
            if (editModal) {
                editModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeEditModal();
                    }
                });
            } else {
                console.error('æœªæ‰¾åˆ°editModalå…ƒç´ ï¼Œæ— æ³•ç»‘å®šç‚¹å‡»å¤–éƒ¨å…³é—­äº‹ä»¶');
            }
            
            // ç»‘å®šæ¯æ—¥å¾…åŠè®¾ç½®æŒ‰é’®äº‹ä»¶
            bindDailyTodoEvents();

            // ç»‘å®šå¾®ä¿¡è®¾ç½®æŒ‰é’®äº‹ä»¶
            bindWechatEvents();

            // ç»‘å®šæ•°æ®åº“è®¾ç½®æŒ‰é’®äº‹ä»¶
            bindDatabaseEvents();

            // ç»‘å®šå®Œæˆäººè®¾ç½®æŒ‰é’®äº‹ä»¶
            bindAssigneeEvents();

            // ç»‘å®šä»»åŠ¡å®Œæˆæ¨¡æ€æ¡†äº‹ä»¶
            bindCompleteTaskEvents();

            // ç»‘å®šå›¾ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡†äº‹ä»¶
            bindImageViewEvents();

            // åˆå§‹åŒ–è‡ªå®šä¹‰é€‰æ‹©æ¡†ï¼ˆåœ¨æ‰€æœ‰æ¨¡æ€æ¡†äº‹ä»¶ç»‘å®šå®Œæˆåï¼‰
            initializeCustomSelects();

            // æµ‹è¯•æŒ‰é’®æ˜¯å¦å­˜åœ¨
            console.log('=== æŒ‰é’®å­˜åœ¨æ€§æ£€æŸ¥ ===');
            console.log('closeEditBtn:', document.getElementById('closeEditBtn'));
            console.log('cancelEditBtn:', document.getElementById('cancelEditBtn'));
            console.log('saveEditBtn:', document.getElementById('saveEditBtn'));
            console.log('editModal:', document.getElementById('editModal'));
        });

        // ç”Ÿæˆå”¯ä¸€ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // è®¾ç½®é»˜è®¤æˆªæ­¢æ—¶é—´ä¸ºä»Šå¤©23:59
        function setDefaultDeadline() {
            const deadlineInput = document.getElementById('deadlineInput');
            if (deadlineInput) {
                const today = new Date();
                today.setHours(23, 59, 0, 0);
                const dateString = today.toISOString().slice(0, 16);
                deadlineInput.value = dateString;
            }
        }

        // æ£€æŸ¥ä»»åŠ¡æ ‡é¢˜æ˜¯å¦é‡å¤ï¼ˆä»…æ£€æµ‹å½“æ—¥æˆªæ­¢çš„ä»»åŠ¡ï¼‰
        function checkTaskDuplication(title, excludeCompleted = false, assignee = '') {
            const today = new Date().toDateString();

            return tasks.find(task => {
                if (excludeCompleted && task.completed) return false;

                // åªæ£€æµ‹æœ‰æˆªæ­¢æ—¶é—´ä¸”æˆªæ­¢æ—¶é—´ä¸ºå½“æ—¥çš„ä»»åŠ¡
                if (!task.deadline) return false;
                const taskDate = new Date(task.deadline).toDateString();
                if (taskDate !== today) return false;

                // æ£€æŸ¥æ ‡é¢˜å’Œå®Œæˆäººæ˜¯å¦éƒ½åŒ¹é…
                const titleMatch = task.title.trim().toLowerCase() === title.trim().toLowerCase();

                // æ”¯æŒå¤šå®ŒæˆäººåŒ¹é…
                let assigneeMatch = false;
                if (task.assignees && Array.isArray(task.assignees)) {
                    assigneeMatch = task.assignees.includes(assignee) || (assignee === '' && task.assignees.length === 0);
                } else {
                    assigneeMatch = (task.assignee || '') === assignee;
                }

                return titleMatch && assigneeMatch;
            });
        }

        // æ£€æŸ¥æ¯æ—¥ä»»åŠ¡æ˜¯å¦åº”è¯¥è·³è¿‡åˆ›å»ºï¼ˆæ™ºèƒ½å»é‡ï¼‰
        function checkDailyTaskDuplication(title, targetDateString, assignee = '') {
            // 1. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ ‡é¢˜ã€å®Œæˆäººå’Œæ—¥æœŸçš„æ¯æ—¥ä»»åŠ¡ï¼ˆåŒ…æ‹¬å·²å®Œæˆï¼‰
            const existingDailyTask = tasks.find(t =>
                t.title === title &&
                (t.assignee || '') === assignee &&
                t.isDailyTodo === true &&
                t.deadline &&
                new Date(t.deadline).toDateString() === targetDateString
            );

            if (existingDailyTask) {
                const status = existingDailyTask.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ';
                console.log(`è·³è¿‡åˆ›å»ºé‡å¤çš„æ¯æ—¥ä»»åŠ¡: ${title} (${assignee || 'æœªåˆ†é…'}) (${targetDateString}) - ${status}`);
                return true; // è·³è¿‡ï¼Œå·²å­˜åœ¨ç›¸åŒçš„æ¯æ—¥ä»»åŠ¡
            }

            // 2. æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç›¸åŒæ ‡é¢˜å’Œå®Œæˆäººçš„æ‰‹åŠ¨åˆ›å»ºä»»åŠ¡ï¼ˆåŒä¸€å¤©ï¼ŒåŒ…æ‹¬å·²å®Œæˆï¼‰
            const manualTask = tasks.find(t =>
                t.title === title &&
                (t.assignee || '') === assignee &&
                !t.isDailyTodo &&
                t.deadline &&
                new Date(t.deadline).toDateString() === targetDateString
            );

            if (manualTask) {
                const status = manualTask.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ';
                console.log(`è·³è¿‡åˆ›å»ºæ¯æ—¥ä»»åŠ¡ï¼Œå› ä¸ºå­˜åœ¨æ‰‹åŠ¨åˆ›å»ºçš„åŒååŒäººä»»åŠ¡: ${title} (${assignee || 'æœªåˆ†é…'}) (${targetDateString}) - ${status}`);
                return true; // è·³è¿‡ï¼Œé¿å…ä¸æ‰‹åŠ¨ä»»åŠ¡å†²çª
            }

            // 3. æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç›¸åŒæ ‡é¢˜å’Œå®Œæˆäººçš„æœªå®Œæˆä»»åŠ¡ï¼ˆä¸é™ç±»å‹ï¼Œä¸é™æ—¥æœŸï¼‰
            const anyUncompletedTask = tasks.find(t =>
                t.title === title &&
                (t.assignee || '') === assignee &&
                !t.completed
            );

            if (anyUncompletedTask) {
                // å¦‚æœå­˜åœ¨ä½†ä¸åœ¨åŒä¸€å¤©ï¼Œåˆ™å…è®¸åˆ›å»ºï¼ˆç”¨æˆ·å¯èƒ½æƒ³åœ¨ä¸åŒå¤©é‡å¤ç›¸åŒä»»åŠ¡ï¼‰
                if (anyUncompletedTask.deadline) {
                    const existingTaskDate = new Date(anyUncompletedTask.deadline).toDateString();
                    if (existingTaskDate !== targetDateString) {
                        console.log(`å…è®¸åˆ›å»ºæ¯æ—¥ä»»åŠ¡ï¼Œå› ä¸ºç°æœ‰åŒååŒäººä»»åŠ¡åœ¨ä¸åŒæ—¥æœŸ: ${title} (${assignee || 'æœªåˆ†é…'})`);
                        return false; // ä¸è·³è¿‡ï¼Œå…è®¸åˆ›å»º
                    }
                }
            }

            return false; // ä¸è·³è¿‡ï¼Œå…è®¸åˆ›å»º
        }

        // æ˜¾ç¤ºæ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†
        function showAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            if (modal) {
                modal.style.display = 'flex';

                // æ¸…ç©ºè¡¨å•
                document.getElementById('addTaskTitle').value = '';
                document.getElementById('addTaskNotes').value = '';
                document.getElementById('addTaskPriority').value = 'medium';
                document.getElementById('addTaskCategory').value = 'work';
                document.getElementById('addTaskDeadline').value = '';
                document.getElementById('addTaskAssignee').value = '';

                // åˆå§‹åŒ–å®Œæˆäººä¸‹æ‹‰åˆ—è¡¨
                initializeAssigneeSelect();

                // è®¾ç½®é»˜è®¤æˆªæ­¢æ—¶é—´ä¸ºä»Šå¤©23:59
                setDefaultDeadlineForAdd();

                // èšç„¦åˆ°æ ‡é¢˜è¾“å…¥æ¡†
                setTimeout(() => {
                    document.getElementById('addTaskTitle').focus();
                }, 100);
            }
        }

        // å…³é—­æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†
        function closeAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            if (modal) {
                modal.style.display = 'none';
                // æ¸…ç©ºè¡¨å•
                document.getElementById('addTaskTitle').value = '';
                document.getElementById('addTaskNotes').value = '';
                document.getElementById('addTaskPriority').value = 'medium';
                document.getElementById('addTaskCategory').value = 'work';
                document.getElementById('addTaskDeadline').value = '';
                document.getElementById('addTaskAssignee').value = '';
            }
        }

        // è®¾ç½®æ·»åŠ ä»»åŠ¡çš„é»˜è®¤æˆªæ­¢æ—¶é—´
        function setDefaultDeadlineForAdd() {
            const deadlineInput = document.getElementById('addTaskDeadline');
            if (deadlineInput) {
                const today = new Date();
                today.setHours(23, 59, 0, 0);
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                const hours = String(today.getHours()).padStart(2, '0');
                const minutes = String(today.getMinutes()).padStart(2, '0');
                const dateString = `${year}-${month}-${day}T${hours}:${minutes}`;
                deadlineInput.value = dateString;
            }
        }

        // ä»æ¨¡æ€æ¡†æ·»åŠ ä»»åŠ¡
        function addTaskFromModal() {
            const titleInput = document.getElementById('addTaskTitle');
            const notesInput = document.getElementById('addTaskNotes');
            const prioritySelect = document.getElementById('addTaskPriority');
            const categorySelect = document.getElementById('addTaskCategory');
            const deadlineInput = document.getElementById('addTaskDeadline');
            const assigneeSelect = document.getElementById('addTaskAssignee');

            const title = titleInput.value.trim();
            if (!title) {
                alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜');
                titleInput.focus();
                return;
            }

            // è·å–å³å°†åˆ›å»ºä»»åŠ¡çš„æˆªæ­¢æ—¶é—´
            const newTaskDeadline = deadlineInput.value || null;

            // æ£€æŸ¥ä»»åŠ¡é‡å¤æ€§ï¼ˆåªæ£€æŸ¥æœªå®Œæˆçš„å½“æ—¥ä»»åŠ¡ï¼‰
            const selectedAssigneeList = getSelectedAssignees('add');
            const duplicateTask = checkTaskDuplication(title, true, selectedAssigneeList.join(','));
            if (duplicateTask) {
                const deadlineText = duplicateTask.deadline ?
                    `ï¼Œæˆªæ­¢æ—¶é—´ï¼š${formatDeadline(duplicateTask.deadline)}` : '';
                const categoryText = getCategoryName(duplicateTask.category);
                const priorityText = getPriorityName(duplicateTask.priority);

                const confirmMessage = `ä»Šæ—¥å·²å­˜åœ¨ç›¸åŒåç§°çš„ä»»åŠ¡"${title}"ï¼\n\nç°æœ‰ä»»åŠ¡ä¿¡æ¯ï¼š\n` +
                    `åˆ†ç±»ï¼š${categoryText}\n` +
                    `ä¼˜å…ˆçº§ï¼š${priorityText}${deadlineText}\n\n` +
                    `æ˜¯å¦ä»è¦åˆ›å»ºé‡å¤ä»»åŠ¡ï¼Ÿ`;

                if (!confirm(confirmMessage)) {
                    return; // ç”¨æˆ·é€‰æ‹©ä¸åˆ›å»ºé‡å¤ä»»åŠ¡
                }
            }

            // å¦‚æœæ–°ä»»åŠ¡æ²¡æœ‰æˆªæ­¢æ—¶é—´ï¼Œä½†å½“æ—¥æœ‰åŒåä»»åŠ¡ï¼Œä¹Ÿéœ€è¦æé†’
            if (!newTaskDeadline) {
                const today = new Date().toDateString();
                const sameTitleTask = tasks.find(task =>
                    !task.completed &&
                    task.deadline &&
                    new Date(task.deadline).toDateString() === today &&
                    task.title.trim().toLowerCase() === title.trim().toLowerCase()
                );

                if (sameTitleTask) {
                    const categoryText = getCategoryName(sameTitleTask.category);
                    const priorityText = getPriorityName(sameTitleTask.priority);
                    const deadlineText = formatDeadline(sameTitleTask.deadline);

                    const confirmMessage = `ä»Šæ—¥å·²å­˜åœ¨ç›¸åŒåç§°çš„ä»»åŠ¡"${title}"ï¼\n\nç°æœ‰ä»»åŠ¡ä¿¡æ¯ï¼š\n` +
                        `åˆ†ç±»ï¼š${categoryText}\n` +
                        `ä¼˜å…ˆçº§ï¼š${priorityText}\n` +
                        `æˆªæ­¢æ—¶é—´ï¼š${deadlineText}\n\n` +
                        `æ‚¨åˆ›å»ºçš„æ–°ä»»åŠ¡æ²¡æœ‰æˆªæ­¢æ—¶é—´ï¼Œæ˜¯å¦ä»è¦åˆ›å»ºï¼Ÿ`;

                    if (!confirm(confirmMessage)) {
                        return; // ç”¨æˆ·é€‰æ‹©ä¸åˆ›å»ºé‡å¤ä»»åŠ¡
                    }
                }
            }

            const task = {
                id: generateId(),
                title: title,
                notes: notesInput.value.trim() || '',
                completed: false,
                priority: prioritySelect.value,
                category: categorySelect.value,
                deadline: deadlineInput.value || null,
                assignees: selectedAssigneeList, // å¤šé€‰å®Œæˆäººå­—æ®µ
                assignee: selectedAssigneeList.length > 0 ? selectedAssigneeList[0] : null, // å…¼å®¹æ—§ç‰ˆæœ¬
                createdAt: new Date().toISOString(),
                completedAt: null,
                completedBy: null
            };

            tasks.unshift(task);
            saveTasks();
            renderTasks();

            // æ›´æ–°ç­›é€‰å™¨é€‰é¡¹
            updateAssigneeFilterOptions();

            // å…³é—­æ¨¡æ€æ¡†
            closeAddTaskModal();
        }

        // æ·»åŠ ä»»åŠ¡ï¼ˆä¿ç•™åŸå‡½æ•°ä»¥å…¼å®¹å…¶ä»–åœ°æ–¹çš„è°ƒç”¨ï¼‰
        function addTask() {
            const taskTitleInput = document.getElementById('taskTitleInput');
            const taskNotesInput = document.getElementById('taskNotesInput');
            const prioritySelect = document.getElementById('prioritySelect');
            const categorySelect = document.getElementById('categorySelect');
            const deadlineInput = document.getElementById('deadlineInput');

            const title = taskTitleInput.value.trim();
            if (!title) {
                alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜');
                return;
            }

            // è·å–å³å°†åˆ›å»ºä»»åŠ¡çš„æˆªæ­¢æ—¶é—´
            const newTaskDeadline = deadlineInput.value || null;

            // æ£€æŸ¥ä»»åŠ¡é‡å¤æ€§ï¼ˆåªæ£€æŸ¥æœªå®Œæˆçš„å½“æ—¥ä»»åŠ¡ï¼‰
            const duplicateTask = checkTaskDuplication(title, true, '');
            if (duplicateTask) {
                const deadlineText = duplicateTask.deadline ?
                    `ï¼Œæˆªæ­¢æ—¶é—´ï¼š${formatDeadline(duplicateTask.deadline)}` : '';
                const categoryText = getCategoryName(duplicateTask.category);
                const priorityText = getPriorityName(duplicateTask.priority);

                const confirmMessage = `ä»Šæ—¥å·²å­˜åœ¨ç›¸åŒåç§°çš„ä»»åŠ¡"${title}"ï¼\n\nç°æœ‰ä»»åŠ¡ä¿¡æ¯ï¼š\n` +
                    `åˆ†ç±»ï¼š${categoryText}\n` +
                    `ä¼˜å…ˆçº§ï¼š${priorityText}${deadlineText}\n\n` +
                    `æ˜¯å¦ä»è¦åˆ›å»ºé‡å¤ä»»åŠ¡ï¼Ÿ`;

                if (!confirm(confirmMessage)) {
                    return; // ç”¨æˆ·é€‰æ‹©ä¸åˆ›å»ºé‡å¤ä»»åŠ¡
                }
            }

            // å¦‚æœæ–°ä»»åŠ¡æ²¡æœ‰æˆªæ­¢æ—¶é—´ï¼Œä½†å½“æ—¥æœ‰åŒåä»»åŠ¡ï¼Œä¹Ÿéœ€è¦æé†’
            if (!newTaskDeadline) {
                const today = new Date().toDateString();
                const sameTitleTask = tasks.find(task =>
                    !task.completed &&
                    task.deadline &&
                    new Date(task.deadline).toDateString() === today &&
                    task.title.trim().toLowerCase() === title.trim().toLowerCase()
                );

                if (sameTitleTask) {
                    const categoryText = getCategoryName(sameTitleTask.category);
                    const priorityText = getPriorityName(sameTitleTask.priority);
                    const deadlineText = formatDeadline(sameTitleTask.deadline);

                    const confirmMessage = `ä»Šæ—¥å·²å­˜åœ¨ç›¸åŒåç§°çš„ä»»åŠ¡"${title}"ï¼\n\nç°æœ‰ä»»åŠ¡ä¿¡æ¯ï¼š\n` +
                        `åˆ†ç±»ï¼š${categoryText}\n` +
                        `ä¼˜å…ˆçº§ï¼š${priorityText}\n` +
                        `æˆªæ­¢æ—¶é—´ï¼š${deadlineText}\n\n` +
                        `æ‚¨åˆ›å»ºçš„æ–°ä»»åŠ¡æ²¡æœ‰æˆªæ­¢æ—¶é—´ï¼Œæ˜¯å¦ä»è¦åˆ›å»ºï¼Ÿ`;

                    if (!confirm(confirmMessage)) {
                        return; // ç”¨æˆ·é€‰æ‹©ä¸åˆ›å»ºé‡å¤ä»»åŠ¡
                    }
                }
            }

            const task = {
                id: generateId(),
                title: title,
                notes: taskNotesInput.value.trim() || '',
                completed: false,
                priority: prioritySelect.value,
                category: categorySelect.value,
                deadline: deadlineInput.value || null,
                createdAt: new Date().toISOString(),
                completedAt: null,
                completedBy: null
            };

            tasks.unshift(task);
            saveTasks();
            renderTasks();

            // æ¸…ç©ºè¾“å…¥
            taskTitleInput.value = '';
            taskNotesInput.value = '';
            // é‡æ–°è®¾ç½®é»˜è®¤æˆªæ­¢æ—¶é—´
            setDefaultDeadline();
        }

        // åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
        function toggleTask(id) {
            try {
                console.log('åˆ‡æ¢ä»»åŠ¡çŠ¶æ€ï¼Œid:', id);
                const task = tasks.find(t => t.id === id);
                if (task) {
                    // æƒé™æ£€æŸ¥ï¼šå¦‚æœå¯ç”¨äº†è§’è‰²é™åˆ¶ä¸”ç”¨æˆ·æœ‰èº«ä»½ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥æ“ä½œæ­¤ä»»åŠ¡
                    if (personalInfo.enableRoleRestriction && personalInfo.myAssignee) {
                        let canOperate = false;
                        if (task.assignees && Array.isArray(task.assignees)) {
                            canOperate = task.assignees.length === 0 || task.assignees.includes(personalInfo.myAssignee);
                        } else {
                            canOperate = !task.assignee || task.assignee === personalInfo.myAssignee;
                        }

                        if (!canOperate) {
                            const assignedTo = task.assignees && task.assignees.length > 0 ? task.assignees.join(', ') : task.assignee;
                            alert(`æ­¤ä»»åŠ¡åˆ†é…ç»™äº†"${assignedTo}"ï¼Œæ‚¨æ— æ³•æ“ä½œæ­¤ä»»åŠ¡ã€‚`);
                            return;
                        }
                    }

                    if (task.completed) {
                        // å¦‚æœå·²å®Œæˆï¼Œç›´æ¥åˆ‡æ¢ä¸ºæœªå®Œæˆ
                        task.completed = false;
                        task.completedAt = null;
                        task.completionNotes = null;
                        task.completionImage = null;
                        task.completedBy = null;
                        saveTasks();
                        renderTasks();
                        console.log('ä»»åŠ¡å·²æ ‡è®°ä¸ºæœªå®Œæˆ:', task.title);
                    } else {
                        // å¦‚æœæœªå®Œæˆï¼Œæ˜¾ç¤ºå®Œæˆç¡®è®¤æ¨¡æ€æ¡†
                        showCompleteTaskModal(task);
                    }
                } else {
                    console.error('æœªæ‰¾åˆ°ä»»åŠ¡ï¼Œid:', id);
                }
            } catch (error) {
                console.error('åˆ‡æ¢ä»»åŠ¡çŠ¶æ€æ—¶å‡ºé”™:', error);
            }
        }

        // æ˜¾ç¤ºä»»åŠ¡å®Œæˆæ¨¡æ€æ¡†
        function showCompleteTaskModal(task) {
            const modal = document.getElementById('completeTaskModal');
            const taskTitle = document.getElementById('completeTaskTitle');
            const completionTime = document.getElementById('completionTime');

            if (modal && taskTitle && completionTime) {
                taskTitle.textContent = task.title;
                completionTime.textContent = new Date().toLocaleString('zh-CN');

                // é‡ç½®è¡¨å•ï¼ˆåŒ…æ‹¬ä¸¤å¼ å›¾ç‰‡çš„åŒºåŸŸï¼‰
                resetCompleteForm();

                // åˆå§‹åŒ–å®Œæˆäººå¤šé€‰åŠŸèƒ½
                initializeAssigneeDropdown('complete');

                // è®¾ç½®å½“å‰ä»»åŠ¡çš„å®Œæˆäºº
                selectedAssignees.complete = [];
                if (task.assignees && Array.isArray(task.assignees)) {
                    selectedAssignees.complete = [...task.assignees];
                } else if (task.assignee) {
                    selectedAssignees.complete = [task.assignee];
                }
                updateAssigneeDisplay('complete');

                // å­˜å‚¨å½“å‰ä»»åŠ¡IDåˆ°æ¨¡æ€æ¡†
                modal.dataset.taskId = task.id;

                modal.style.display = 'flex';

                // Android 14 ç‰¹æ®Šå¤„ç†
                if (isAndroid14()) {
                    console.log('Android 14è®¾å¤‡ï¼šæ˜¾ç¤ºå®Œæˆä»»åŠ¡æ¨¡æ€æ¡†');

                    // ç«‹å³åº”ç”¨Android 14ä¼˜åŒ–
                    setTimeout(() => {
                        applyAndroid14UploadFix();
                    }, 300);

                }
            }
        }

        // åº”ç”¨Android 14ä¸Šä¼ ä¿®å¤
        function applyAndroid14UploadFix() {
            console.log('åº”ç”¨Android 14ä¸Šä¼ ä¿®å¤ - åˆ›å»ºå¯è§æ–‡ä»¶è¾“å…¥æ¡†');

            for (let i = 1; i <= 2; i++) {
                const uploadArea = document.querySelector(`.image-upload-area:nth-child(${i})`);

                if (uploadArea) {
                    console.log(`å®Œå…¨æ›¿æ¢ä¸Šä¼ åŒºåŸŸ${i}ä¸ºåŸç”Ÿæ–‡ä»¶è¾“å…¥`);

                    // ä¿å­˜åŸå§‹å†…å®¹ä½œä¸ºå¤‡ç”¨
                    const originalContent = uploadArea.innerHTML;

                    // æ¸…ç©ºåŸæœ‰å†…å®¹
                    uploadArea.innerHTML = '';

                    // æ¸…é™¤åŸæœ‰äº‹ä»¶ï¼ˆç°åœ¨onclickåœ¨æ–‡å­—å…ƒç´ ä¸Šï¼‰

                    // åˆ›å»ºä¸€ä¸ªå®¹å™¨
                    const container = document.createElement('div');
                    container.style.cssText = `
                        position: relative;
                        width: 100%;
                        height: 100%;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        background: linear-gradient(45deg, #f0f8ff, #e6f3ff);
                        border: 2px dashed #4a90e2;
                        border-radius: 8px;
                        padding: 20px;
                        min-height: 120px;
                    `;

                    // åˆ›å»ºè¯´æ˜æ–‡å­—
                    const label = document.createElement('div');
                    label.textContent = `ğŸ“± Android 14 å…¼å®¹æ¨¡å¼`;
                    label.style.cssText = `
                        color: #4a90e2;
                        font-weight: bold;
                        margin-bottom: 10px;
                        font-size: 14px;
                        text-align: center;
                    `;

                    // åˆ›å»ºåŸç”Ÿæ–‡ä»¶è¾“å…¥æ¡†
                    const nativeInput = document.createElement('input');
                    nativeInput.type = 'file';
                    nativeInput.accept = 'image/*,image/jpeg,image/png,image/gif';
                    nativeInput.id = `visibleInput${i}`;
                    nativeInput.style.cssText = `
                        width: 100%;
                        height: 40px;
                        padding: 8px;
                        border: 1px solid #4a90e2;
                        border-radius: 4px;
                        background: white;
                        font-size: 14px;
                        cursor: pointer;
                        color: #333;
                        text-align: center;
                    `;

                    // æ·»åŠ æ–‡ä»¶é€‰æ‹©äº‹ä»¶
                    nativeInput.addEventListener('change', function(e) {
                        console.log(`Android 14å¯è§è¾“å…¥æ¡†${i}æ–‡ä»¶é€‰æ‹©:`, e.target.files);
                        if (e.target.files && e.target.files.length > 0) {
                            handleCompleteImageSelect(e, i);

                            // æ˜¾ç¤ºæˆåŠŸæç¤º
                            label.textContent = `âœ… å·²é€‰æ‹©: ${e.target.files[0].name}`;
                            label.style.color = '#28a745';
                        }
                    });

                    // æ·»åŠ æç¤ºæ–‡å­—
                    const hint = document.createElement('div');
                    hint.textContent = `ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®é€‰æ‹©å›¾ç‰‡${i}`;
                    hint.style.cssText = `
                        color: #666;
                        font-size: 12px;
                        margin-top: 8px;
                        text-align: center;
                    `;

                    // ç»„è£…å…ƒç´ 
                    container.appendChild(label);
                    container.appendChild(nativeInput);
                    container.appendChild(hint);

                    uploadArea.appendChild(container);

                    // æ·»åŠ å¤‡ç”¨æ¢å¤æŒ‰é’®ï¼ˆè°ƒè¯•ç”¨ï¼‰
                    const restoreBtn = document.createElement('button');
                    restoreBtn.textContent = 'æ¢å¤åŸæ ·';
                    restoreBtn.style.cssText = `
                        position: absolute;
                        top: 5px;
                        right: 5px;
                        padding: 2px 6px;
                        font-size: 10px;
                        background: #ff6b6b;
                        color: white;
                        border: none;
                        border-radius: 3px;
                        cursor: pointer;
                        opacity: 0.7;
                    `;

                    restoreBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        uploadArea.innerHTML = originalContent;
                        // ä¸å†ç»™æ•´ä¸ªä¸Šä¼ åŒºåŸŸæ·»åŠ onclickï¼Œå› ä¸ºç°åœ¨åªæœ‰æ–‡å­—éƒ¨åˆ†éœ€è¦ç‚¹å‡»
                        console.log(`å·²æ¢å¤ä¸Šä¼ åŒºåŸŸ${i}çš„åŸå§‹çŠ¶æ€`);
                    });

                    container.appendChild(restoreBtn);

                    console.log(`Android 14ä¸Šä¼ åŒºåŸŸ${i}å·²å®Œå…¨æ›¿æ¢ä¸ºå¯è§æ–‡ä»¶è¾“å…¥`);
                }
            }

        }

        // å…³é—­ä»»åŠ¡å®Œæˆæ¨¡æ€æ¡†
        function closeCompleteTaskModal() {
            const modal = document.getElementById('completeTaskModal');
            if (modal) {
                modal.style.display = 'none';
                // æ¸…ç†ä¸´æ—¶æ•°æ®
                delete modal.dataset.taskId;
                resetCompleteForm();
            }
        }

        // é‡ç½®å®Œæˆè¡¨å•
        function resetCompleteForm() {
            const completeNotes = document.getElementById('completeNotes');

            if (completeNotes) completeNotes.value = '';

            // é‡ç½®ä¸¤å¼ å›¾ç‰‡çš„ä¸Šä¼ åŒºåŸŸ
            for (let i = 1; i <= 2; i++) {
                const uploadPlaceholder = document.getElementById(`uploadPlaceholder${i}`);
                const imagePreview = document.getElementById(`imagePreview${i}`);
                const completeImageInput = document.getElementById(`completeImageInput${i}`);
                const previewImage = document.getElementById(`previewImage${i}`);

                if (uploadPlaceholder) uploadPlaceholder.style.display = 'flex';
                if (imagePreview) imagePreview.style.display = 'none';
                if (completeImageInput) completeImageInput.value = '';
                if (previewImage) previewImage.src = '';
            }

            // ç§»é™¤æ–‡ä»¶é€‰æ‹©åŒºåŸŸçš„completedå’Œhas-imageç±»ï¼Œæ¢å¤æ­£å¸¸çŠ¶æ€
            const uploadAreas = document.querySelectorAll('.image-upload-area');
            uploadAreas.forEach(area => {
                area.classList.remove('completed', 'has-image');
            });
        }

        // é€‰æ‹©å®Œæˆå›¾ç‰‡
        function selectCompleteImage(imageIndex = 1) {
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰å›¾ç‰‡ï¼Œå¦‚æœæœ‰åˆ™ä¸æ‰§è¡Œ
            const imagePreview = document.getElementById(`imagePreview${imageIndex}`);
            const previewImage = document.getElementById(`previewImage${imageIndex}`);

            if (imagePreview && imagePreview.style.display === 'block' &&
                previewImage && previewImage.src) {
                console.log(`å›¾ç‰‡${imageIndex}å·²å­˜åœ¨ï¼Œæ— æ³•é‡å¤ä¸Šä¼ ã€‚è¯·å…ˆåˆ é™¤ç°æœ‰å›¾ç‰‡ã€‚`);
                return;
            }

            const input = document.getElementById(`completeImageInput${imageIndex}`);
            if (input) {
                input.click();
            }
        }

        // å¤„ç†å®Œæˆå›¾ç‰‡é€‰æ‹©
        function handleCompleteImageSelect(event, imageIndex = 1) {
            const file = event.target.files[0];
            if (file) {
                // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ5MBé™åˆ¶ï¼‰
                if (file.size > 5 * 1024 * 1024) {
                    alert('å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB');
                    return;
                }

                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                if (!file.type.startsWith('image/')) {
                    alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                    return;
                }

                // å‹ç¼©å›¾ç‰‡ä»¥ç¬¦åˆæ•°æ®åº“å¤§å°é™åˆ¶
                compressImage(file, (compressedDataUrl) => {
                    const uploadPlaceholder = document.getElementById(`uploadPlaceholder${imageIndex}`);
                    const imagePreview = document.getElementById(`imagePreview${imageIndex}`);
                    const previewImage = document.getElementById(`previewImage${imageIndex}`);

                    if (uploadPlaceholder && imagePreview && previewImage) {
                        uploadPlaceholder.style.display = 'none';
                        imagePreview.style.display = 'block';
                        previewImage.src = compressedDataUrl;

                        // ç»™ä¸Šä¼ åŒºåŸŸæ·»åŠ has-imageç±»ï¼Œé˜²æ­¢é‡å¤ä¸Šä¼ 
                        const uploadArea = document.querySelector(`.image-upload-area:nth-child(${imageIndex})`);
                        if (uploadArea) {
                            uploadArea.classList.add('has-image');
                        }

                        const sizeKB = Math.round(compressedDataUrl.length / 1024);
                        console.log(`å›¾ç‰‡${imageIndex}å‹ç¼©å®Œæˆï¼Œå¤§å°:`, sizeKB, 'KB');

                        if (sizeKB > 50) {
                            console.warn(`å›¾ç‰‡${imageIndex}å‹ç¼©åä»ç„¶è¾ƒå¤§ï¼Œå¯èƒ½å½±å“æ•°æ®åº“å­˜å‚¨`);
                        }
                    }
                });
            }
        }

        // æ¸…ç†æ—§çš„å®Œæˆå›¾ç‰‡ä»¥å‡å°‘æ•°æ®å¤§å°
        function cleanupOldImages() {
            const completedTasksWithImages = tasks.filter(task =>
                task.completed && task.completionImage && task.completedAt
            );

            if (completedTasksWithImages.length === 0) {
                console.log('æ²¡æœ‰æ‰¾åˆ°å¯æ¸…ç†çš„å®Œæˆå›¾ç‰‡');
                return;
            }

            // æŒ‰å®Œæˆæ—¶é—´æ’åºï¼Œä¿ç•™æœ€æ–°çš„5å¼ å›¾ç‰‡
            completedTasksWithImages.sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));

            let cleanedCount = 0;
            const keepCount = 5; // ä¿ç•™æœ€æ–°çš„5å¼ å›¾ç‰‡

            for (let i = keepCount; i < completedTasksWithImages.length; i++) {
                const task = completedTasksWithImages[i];
                if (task.completionImage) {
                    task.completionImage = null;
                    cleanedCount++;
                }
            }

            console.log(`å·²æ¸…ç†${cleanedCount}å¼ æ—§çš„å®Œæˆå›¾ç‰‡ï¼Œä¿ç•™æœ€æ–°çš„${Math.min(keepCount, completedTasksWithImages.length)}å¼ `);
        }

        // å›¾ç‰‡å‹ç¼©å‡½æ•°
        function compressImage(file, callback, maxWidth = 800, quality = 0.7) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = function() {
                // è®¡ç®—å‹ç¼©åçš„å°ºå¯¸
                let { width, height } = img;

                if (width > maxWidth) {
                    height = (height * maxWidth) / width;
                    width = maxWidth;
                }

                canvas.width = width;
                canvas.height = height;

                // ç»˜åˆ¶å‹ç¼©åçš„å›¾ç‰‡
                ctx.drawImage(img, 0, 0, width, height);

                // è½¬æ¢ä¸ºbase64ï¼Œä½¿ç”¨æŒ‡å®šè´¨é‡
                const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);

                // æ£€æŸ¥å‹ç¼©åå¤§å°ï¼Œå¦‚æœè¿˜æ˜¯å¤ªå¤§å°±è¿›ä¸€æ­¥å‹ç¼©
                const sizeKB = Math.round(compressedDataUrl.length / 1024);

                if (sizeKB > 60 && quality > 0.3) {
                    // å¦‚æœè¿˜æ˜¯å¤ªå¤§ä¸”è´¨é‡è¿˜èƒ½é™ä½ï¼Œé€’å½’å‹ç¼©
                    compressImage(file, callback, Math.max(600, maxWidth * 0.8), quality * 0.8);
                } else {
                    callback(compressedDataUrl);
                }
            };

            img.src = URL.createObjectURL(file);
        }

        // ç§»é™¤å®Œæˆå›¾ç‰‡
        function removeCompleteImage(imageIndex = 1) {
            const uploadPlaceholder = document.getElementById(`uploadPlaceholder${imageIndex}`);
            const imagePreview = document.getElementById(`imagePreview${imageIndex}`);
            const completeImageInput = document.getElementById(`completeImageInput${imageIndex}`);

            if (uploadPlaceholder && imagePreview && completeImageInput) {
                uploadPlaceholder.style.display = 'flex';
                imagePreview.style.display = 'none';
                completeImageInput.value = '';

                // æ¸…ç©ºå›¾ç‰‡src
                const previewImage = document.getElementById(`previewImage${imageIndex}`);
                if (previewImage) {
                    previewImage.src = '';
                }

                // ç§»é™¤has-imageç±»ï¼Œé‡æ–°å¯ç”¨ä¸Šä¼ åŠŸèƒ½
                const uploadArea = document.querySelector(`.image-upload-area:nth-child(${imageIndex})`);
                if (uploadArea) {
                    uploadArea.classList.remove('has-image');
                }
            }
        }

        // ç¡®è®¤å®Œæˆä»»åŠ¡
        function confirmCompleteTask() {
            const modal = document.getElementById('completeTaskModal');
            const taskId = modal ? modal.dataset.taskId : null;

            if (!taskId) {
                console.error('æœªæ‰¾åˆ°ä»»åŠ¡ID');
                return;
            }

            const task = tasks.find(t => t.id === taskId);
            if (!task) {
                console.error('æœªæ‰¾åˆ°ä»»åŠ¡');
                return;
            }

            const completeNotes = document.getElementById('completeNotes');
            const previewImage1 = document.getElementById('previewImage1');
            const previewImage2 = document.getElementById('previewImage2');

            console.log('å®Œæˆä»»åŠ¡è°ƒè¯•ä¿¡æ¯:');
            console.log('previewImage1å­˜åœ¨:', !!previewImage1);
            console.log('previewImage2å­˜åœ¨:', !!previewImage2);
            console.log('å›¾ç‰‡1ç±»å‹æ£€æŸ¥:', previewImage1 && previewImage1.src ? previewImage1.src.startsWith('data:image/') : false);
            console.log('å›¾ç‰‡2ç±»å‹æ£€æŸ¥:', previewImage2 && previewImage2.src ? previewImage2.src.startsWith('data:image/') : false);

            // æ ‡è®°ä»»åŠ¡ä¸ºå®Œæˆ
            task.completed = true;
            task.completedAt = new Date().toISOString();


            // æ·»åŠ å®Œæˆå¤‡æ³¨
            if (completeNotes && completeNotes.value.trim()) {
                task.completionNotes = completeNotes.value.trim();
            }

            // æ›´æ–°å®Œæˆäººä¿¡æ¯
            const selectedCompleteAssignees = getSelectedAssignees('complete');
            if (selectedCompleteAssignees.length > 0) {
                task.assignees = selectedCompleteAssignees;
                task.assignee = selectedCompleteAssignees[0]; // ä¿æŒå‘åå…¼å®¹
            }

            // æ·»åŠ å®Œæˆå›¾ç‰‡ï¼ˆæ”¯æŒä¸¤å¼ å›¾ç‰‡ï¼‰
            const completionImages = [];

            if (previewImage1 && previewImage1.src && previewImage1.src.startsWith('data:image/')) {
                completionImages.push(previewImage1.src);
                console.log('ä¿å­˜å®Œæˆå›¾ç‰‡1ï¼Œå¤§å°:', Math.round(previewImage1.src.length / 1024), 'KB');
            }

            if (previewImage2 && previewImage2.src && previewImage2.src.startsWith('data:image/')) {
                completionImages.push(previewImage2.src);
                console.log('ä¿å­˜å®Œæˆå›¾ç‰‡2ï¼Œå¤§å°:', Math.round(previewImage2.src.length / 1024), 'KB');
            }

            if (completionImages.length > 0) {
                task.completionImages = completionImages;
                // ä¸ºäº†å‘åå…¼å®¹ï¼Œå¦‚æœåªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œä¹Ÿä¿å­˜åˆ°åŸæ¥çš„å­—æ®µ
                if (completionImages.length === 1) {
                    task.completionImage = completionImages[0];
                }
                console.log(`ä¿å­˜äº† ${completionImages.length} å¼ å®Œæˆå›¾ç‰‡`);
            } else {
                console.log('æ²¡æœ‰å›¾ç‰‡éœ€è¦ä¿å­˜');
            }

            saveTasks();
            renderTasks();

            // ç»™æ–‡ä»¶é€‰æ‹©åŒºåŸŸæ·»åŠ completedç±»ï¼Œé˜²æ­¢è¯¯è§¦
            const uploadAreas = document.querySelectorAll('.image-upload-area');
            uploadAreas.forEach(area => {
                area.classList.add('completed');
            });

            closeCompleteTaskModal();

            console.log('ä»»åŠ¡å·²å®Œæˆ:', task.title);
            console.log('å®Œæˆå›¾ç‰‡å·²ä¿å­˜:', !!task.completionImage);
            console.log('å®Œæˆå¤‡æ³¨å·²ä¿å­˜:', !!task.completionNotes);

            // æ˜¾ç¤ºå®Œæˆæç¤º
            showSyncNotification(`ğŸ‰ ä»»åŠ¡"${task.title}"å·²å®Œæˆï¼`);
        }

        // æŸ¥çœ‹å®Œæˆå›¾ç‰‡
        function viewCompletionImage(taskId, imageIndex = 0) {
            const task = tasks.find(t => t.id === taskId);

            // æ”¯æŒæ–°æ—§æ ¼å¼çš„å›¾ç‰‡æ•°æ®
            let images = [];
            if (task.completionImages && Array.isArray(task.completionImages)) {
                images = task.completionImages;
            } else if (task.completionImage) {
                images = [task.completionImage];
            }

            if (!task || images.length === 0) {
                console.error('æœªæ‰¾åˆ°ä»»åŠ¡æˆ–å®Œæˆå›¾ç‰‡');
                return;
            }

            // ç¡®ä¿ç´¢å¼•æœ‰æ•ˆ
            imageIndex = Math.max(0, Math.min(imageIndex, images.length - 1));

            const modal = document.getElementById('imageViewModal');
            const viewImage = document.getElementById('viewImage');
            const imageTaskInfo = document.getElementById('imageTaskInfo');
            const imageCompletionInfo = document.getElementById('imageCompletionInfo');

            if (modal && viewImage && imageTaskInfo && imageCompletionInfo) {
                // è®¾ç½®å›¾ç‰‡
                viewImage.src = images[imageIndex];

                // è®¾ç½®ä»»åŠ¡ä¿¡æ¯ï¼ˆåŒ…å«å›¾ç‰‡ç´¢å¼•ä¿¡æ¯ï¼‰
                const imageInfo = images.length > 1 ? ` (${imageIndex + 1}/${images.length})` : '';
                imageTaskInfo.textContent = `ä»»åŠ¡ï¼š${task.title}${imageInfo}`;

                // è®¾ç½®å®Œæˆä¿¡æ¯
                let completionInfo = '';
                if (task.completedAt) {
                    completionInfo += `å®Œæˆæ—¶é—´ï¼š${new Date(task.completedAt).toLocaleString('zh-CN')}`;
                }
                if (task.completionNotes) {
                    completionInfo += `\nå®Œæˆå¤‡æ³¨ï¼š${task.completionNotes}`;
                }
                imageCompletionInfo.textContent = completionInfo;

                // ä¿å­˜å½“å‰æŸ¥çœ‹çŠ¶æ€ä»¥ä¾¿å¯¼èˆª
                modal.dataset.taskId = taskId;
                modal.dataset.currentIndex = imageIndex;
                modal.dataset.totalImages = images.length;

                // æ·»åŠ å¯¼èˆªæ§åˆ¶
                addImageNavigation(modal, images.length > 1);

                modal.style.display = 'flex';
            }
        }

        // æ·»åŠ å›¾ç‰‡å¯¼èˆªåŠŸèƒ½
        function addImageNavigation(modal, showNavigation) {
            // ç§»é™¤ç°æœ‰çš„å¯¼èˆªæŒ‰é’®
            const existingNav = modal.querySelector('.image-navigation');
            if (existingNav) {
                existingNav.remove();
            }

            if (!showNavigation) return;

            // åˆ›å»ºå¯¼èˆªæ§åˆ¶
            const navigation = document.createElement('div');
            navigation.className = 'image-navigation';
            navigation.innerHTML = `
                <button class="nav-btn prev-btn" onclick="navigateImage(-1)">â€¹</button>
                <button class="nav-btn next-btn" onclick="navigateImage(1)">â€º</button>
            `;

            modal.appendChild(navigation);
        }

        // å›¾ç‰‡å¯¼èˆªå‡½æ•°
        function navigateImage(direction) {
            const modal = document.getElementById('imageViewModal');
            const taskId = modal.dataset.taskId;
            const currentIndex = parseInt(modal.dataset.currentIndex);
            const totalImages = parseInt(modal.dataset.totalImages);

            let newIndex = currentIndex + direction;

            // å¾ªç¯å¯¼èˆª
            if (newIndex < 0) {
                newIndex = totalImages - 1;
            } else if (newIndex >= totalImages) {
                newIndex = 0;
            }

            viewCompletionImage(taskId, newIndex);
        }

        // å…³é—­å›¾ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡†
        function closeImageViewModal() {
            const modal = document.getElementById('imageViewModal');
            if (modal) {
                modal.style.display = 'none';

                // æ¸…ç†å¯¼èˆªæŒ‰é’®
                const navigation = modal.querySelector('.image-navigation');
                if (navigation) {
                    navigation.remove();
                }

                // æ¸…ç†æ•°æ®å±æ€§
                delete modal.dataset.taskId;
                delete modal.dataset.currentIndex;
                delete modal.dataset.totalImages;
            }
        }

        // è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†ï¼ˆAndroid 14å¤‡ç”¨æ–¹æ¡ˆï¼‰
        function customConfirm(message, callback) {
            // é˜²æ­¢é‡å¤åˆ›å»ºå¯¹è¯æ¡†
            if (document.querySelector('.custom-confirm-overlay')) {
                return;
            }

            // åˆ›å»ºè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
            const overlay = document.createElement('div');
            overlay.className = 'custom-confirm-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 12000;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                animation: fadeIn 0.2s ease-out;
            `;

            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 24px;
                max-width: 320px;
                width: 90%;
                text-align: center;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                transform: scale(0.9);
                animation: scaleIn 0.2s ease-out forwards;
            `;

            dialog.innerHTML = `
                <div style="margin-bottom: 24px; font-size: 16px; color: #333; line-height: 1.5;">${message}</div>
                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button id="confirmCancel" style="
                        padding: 12px 24px;
                        border: 2px solid #ddd;
                        border-radius: 8px;
                        background: #f8f9fa;
                        color: #666;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        min-width: 80px;
                        min-height: 44px;
                        transition: all 0.2s;
                        -webkit-tap-highlight-color: transparent;
                        touch-action: manipulation;
                    ">å–æ¶ˆ</button>
                    <button id="confirmOk" style="
                        padding: 12px 24px;
                        border: none;
                        border-radius: 8px;
                        background: #d32f2f;
                        color: white;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        min-width: 80px;
                        min-height: 44px;
                        transition: all 0.2s;
                        -webkit-tap-highlight-color: transparent;
                        touch-action: manipulation;
                    ">ç¡®å®š</button>
                </div>
            `;

            // æ·»åŠ åŠ¨ç”»æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes scaleIn {
                    from { transform: scale(0.9); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }
                .custom-confirm-overlay button:hover {
                    transform: translateY(-1px);
                }
                .custom-confirm-overlay button:active {
                    transform: translateY(0) scale(0.98);
                }
                .custom-confirm-overlay #confirmCancel:hover {
                    background: #e9ecef;
                    border-color: #adb5bd;
                }
                .custom-confirm-overlay #confirmOk:hover {
                    background: #c62828;
                }
            `;
            document.head.appendChild(style);

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            const okBtn = dialog.querySelector('#confirmOk');
            const cancelBtn = dialog.querySelector('#confirmCancel');
            let dialogHandled = false;

            function cleanup() {
                if (document.body.contains(overlay)) {
                    document.body.removeChild(overlay);
                }
                if (document.head.contains(style)) {
                    document.head.removeChild(style);
                }
            }

            function handleResult(result) {
                if (dialogHandled) return;
                dialogHandled = true;
                cleanup();
                setTimeout(() => callback(result), 10);
            }

            // ä¼˜åŒ–æŒ‰é’®äº‹ä»¶å¤„ç†ï¼Œé˜²æ­¢Androidè®¾å¤‡ä¸Šçš„æ„å¤–è§¦å‘
            okBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                handleResult(true);
            }, { passive: false });

            cancelBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                handleResult(false);
            }, { passive: false });

            // Androidè®¾å¤‡è§¦æ‘¸ä¼˜åŒ–
            const isAndroid = /Android/i.test(navigator.userAgent);
            if (isAndroid) {
                okBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (!dialogHandled) {
                        handleResult(true);
                    }
                }, { passive: false });

                cancelBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (!dialogHandled) {
                        handleResult(false);
                    }
                }, { passive: false });
            }

            // ç‚¹å‡»é®ç½©å…³é—­ï¼ˆæ·»åŠ å»¶è¿Ÿé˜²æ­¢æ„å¤–è§¦å‘ï¼‰
            setTimeout(() => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay && !dialogHandled) {
                        handleResult(false);
                    }
                });
            }, 300);

            // é”®ç›˜æ”¯æŒ
            document.addEventListener('keydown', function escapeHandler(e) {
                if (e.key === 'Escape' && !dialogHandled) {
                    document.removeEventListener('keydown', escapeHandler);
                    handleResult(false);
                }
            });

            // èšç„¦åˆ°å–æ¶ˆæŒ‰é’®ï¼Œé¿å…æ„å¤–ç¡®è®¤
            setTimeout(() => {
                if (!dialogHandled) {
                    cancelBtn.focus();
                }
            }, 100);
        }

        // åˆ é™¤ä»»åŠ¡
        function deleteTask(id) {
            console.log('å¼€å§‹åˆ é™¤ä»»åŠ¡ï¼ŒID:', id);

            function handleConfirmResult(shouldDelete) {
                if (shouldDelete) {
                    console.log('ç”¨æˆ·ç¡®è®¤åˆ é™¤ä»»åŠ¡ID:', id);
                    const originalLength = tasks.length;
                    tasks = tasks.filter(t => t.id !== id);

                    if (tasks.length < originalLength) {
                        console.log('ä»»åŠ¡åˆ é™¤æˆåŠŸï¼ŒåŸé•¿åº¦:', originalLength, 'æ–°é•¿åº¦:', tasks.length);
                        saveTasks();
                        renderTasks();
                    } else {
                        console.error('ä»»åŠ¡åˆ é™¤å¤±è´¥ï¼Œæœªæ‰¾åˆ°IDä¸º', id, 'çš„ä»»åŠ¡');
                    }
                } else {
                    console.log('ç”¨æˆ·å–æ¶ˆåˆ é™¤æ“ä½œ');
                }
            }

            // æ£€æµ‹Androidè®¾å¤‡å’Œç‰ˆæœ¬
            const isAndroid = /Android/i.test(navigator.userAgent);
            const androidVersion = isAndroid ? parseFloat((navigator.userAgent.match(/Android ([\d.]+)/) || [])[1]) : 0;
            const forceCustomDialog = isAndroid && androidVersion >= 14;

            if (forceCustomDialog) {
                // Android 14+ å¼ºåˆ¶ä½¿ç”¨è‡ªå®šä¹‰å¯¹è¯æ¡†
                console.log('æ£€æµ‹åˆ°Android 14+ï¼Œä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†');
                customConfirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ', handleConfirmResult);
                return;
            }

            // å…¶ä»–è®¾å¤‡å°è¯•ä½¿ç”¨åŸç”Ÿconfirm
            try {
                if (typeof confirm === 'function') {
                    console.log('ä½¿ç”¨åŸç”Ÿç¡®è®¤å¯¹è¯æ¡†');
                    const result = confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ');
                    handleConfirmResult(result);
                    return;
                }
            } catch (error) {
                console.error('åŸç”Ÿconfirmå¯¹è¯æ¡†å‡ºé”™:', error);
            }

            // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨è‡ªå®šä¹‰å¯¹è¯æ¡†
            console.log('ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ');
            customConfirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ', handleConfirmResult);
        }

        // æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
        function editTask(id) {
            try {
                console.log('ç¼–è¾‘ä»»åŠ¡ï¼Œid:', id);
                const task = tasks.find(t => t.id === id);
                if (!task) {
                    console.error('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„ä»»åŠ¡ï¼Œid:', id);
                    alert('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„ä»»åŠ¡');
                    return;
                }
                
                editingTaskId = id;
                console.log('è®¾ç½®editingTaskId:', editingTaskId);
                
                // å¡«å……è¡¨å•
                const editTaskTitle = document.getElementById('editTaskTitle');
                const editTaskNotes = document.getElementById('editTaskNotes');
                const editPriority = document.getElementById('editPriority');
                const editCategory = document.getElementById('editCategory');
                const editDeadline = document.getElementById('editDeadline');
                // åˆå§‹åŒ–ç¼–è¾‘æ¡†ä¸­çš„å¤šé€‰å®ŒæˆäººåŠŸèƒ½
                initializeAssigneeDropdown('edit');

                if (editTaskTitle && editTaskNotes && editPriority && editCategory && editDeadline) {
                    editTaskTitle.value = task.title || task.text || ''; // å…¼å®¹æ—§æ•°æ®
                    editTaskNotes.value = task.notes || '';
                    editPriority.value = task.priority;
                    editCategory.value = task.category;

                    // è®¾ç½®å®Œæˆäººï¼ˆæ”¯æŒå¤šé€‰ï¼‰
                    selectedAssignees.edit = [];
                    if (task.assignees && Array.isArray(task.assignees)) {
                        selectedAssignees.edit = [...task.assignees];
                    } else if (task.assignee) {
                        selectedAssignees.edit = [task.assignee];
                    }
                    updateAssigneeDisplay('edit');
                    
                    // å¤„ç†æˆªæ­¢æ—¥æœŸæ ¼å¼
                    if (task.deadline) {
                        const date = new Date(task.deadline);
                        if (!isNaN(date.getTime())) {
                            // è½¬æ¢ä¸º datetime-local éœ€è¦çš„æ ¼å¼ (YYYY-MM-DDTHH:MM)
                            // ä¿®å¤æ—¶åŒºé—®é¢˜ï¼šä½¿ç”¨æœ¬åœ°æ—¶é—´è€Œä¸æ˜¯UTCæ—¶é—´
                            const year = date.getFullYear();
                            const month = String(date.getMonth() + 1).padStart(2, '0');
                            const day = String(date.getDate()).padStart(2, '0');
                            const hours = String(date.getHours()).padStart(2, '0');
                            const minutes = String(date.getMinutes()).padStart(2, '0');
                            const dateString = `${year}-${month}-${day}T${hours}:${minutes}`;
                            editDeadline.value = dateString;
                        } else {
                            editDeadline.value = '';
                        }
                    } else {
                        editDeadline.value = '';
                    }
                } else {
                    console.error('ç¼–è¾‘è¡¨å•å…ƒç´ æœªæ‰¾åˆ°');
                    alert('ç¼–è¾‘è¡¨å•å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                const editModal = document.getElementById('editModal');
                if (editModal) {
                    editModal.style.display = 'flex';
                    console.log('ç¼–è¾‘æ¨¡æ€æ¡†å·²æ‰“å¼€');
                } else {
                    console.error('æœªæ‰¾åˆ°editModalå…ƒç´ ');
                    alert('æœªæ‰¾åˆ°ç¼–è¾‘çª—å£å…ƒç´ ');
                }
            } catch (error) {
                console.error('æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†æ—¶å‡ºé”™:', error);
                alert('æ‰“å¼€ç¼–è¾‘çª—å£å¤±è´¥ï¼š' + error.message);
            }
        }

        // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
        function closeEditModal() {
            console.log('closeEditModalå‡½æ•°è¢«è°ƒç”¨');
            const editModal = document.getElementById('editModal');
            if (editModal) {
                editModal.style.display = 'none';
                console.log('ç¼–è¾‘æ¨¡æ€æ¡†å·²å…³é—­');
            } else {
                console.error('æœªæ‰¾åˆ°editModalå…ƒç´ ï¼Œæ— æ³•å…³é—­');
            }
            editingTaskId = null;
            console.log('editingTaskIdå·²é‡ç½®ä¸ºnull');
        }

        // ä¿å­˜ç¼–è¾‘çš„ä»»åŠ¡
        function saveEditTask() {
            try {
                console.log('saveEditTaskå‡½æ•°è¢«è°ƒç”¨');
                console.log('ä¿å­˜ä»»åŠ¡ï¼ŒeditingTaskId:', editingTaskId);
                
                if (!editingTaskId) {
                    alert('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„ä»»åŠ¡ID');
                    return;
                }
                
                const task = tasks.find(t => t.id === editingTaskId);
                if (!task) {
                    alert('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„ä»»åŠ¡');
                    return;
                }
                
                const editTaskTitle = document.getElementById('editTaskTitle');
                const editTaskNotes = document.getElementById('editTaskNotes');
                const editPriority = document.getElementById('editPriority');
                const editCategory = document.getElementById('editCategory');
                const editDeadline = document.getElementById('editDeadline');
                if (!editTaskTitle || !editTaskNotes || !editPriority || !editCategory || !editDeadline) {
                    alert('ç¼–è¾‘è¡¨å•å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                
                const title = editTaskTitle.value.trim();
                if (!title) {
                    alert('ä»»åŠ¡æ ‡é¢˜ä¸èƒ½ä¸ºç©º');
                    return;
                }

                // æ£€æŸ¥ç¼–è¾‘åçš„æ ‡é¢˜æ˜¯å¦ä¸å…¶ä»–å½“æ—¥ä»»åŠ¡é‡å¤ï¼ˆæ’é™¤å½“å‰ç¼–è¾‘çš„ä»»åŠ¡å’Œå·²å®Œæˆçš„ä»»åŠ¡ï¼‰
                const today = new Date().toDateString();
                const duplicateTask = tasks.find(t => {
                    if (t.id === editingTaskId || t.completed) return false;

                    // åªæ£€æµ‹æœ‰æˆªæ­¢æ—¶é—´ä¸”æˆªæ­¢æ—¶é—´ä¸ºå½“æ—¥çš„ä»»åŠ¡
                    if (!t.deadline) return false;
                    const taskDate = new Date(t.deadline).toDateString();
                    if (taskDate !== today) return false;

                    return t.title.trim().toLowerCase() === title.trim().toLowerCase();
                });

                if (duplicateTask) {
                    const deadlineText = duplicateTask.deadline ?
                        `ï¼Œæˆªæ­¢æ—¶é—´ï¼š${formatDeadline(duplicateTask.deadline)}` : '';
                    const categoryText = getCategoryName(duplicateTask.category);
                    const priorityText = getPriorityName(duplicateTask.priority);

                    const confirmMessage = `ä¿®æ”¹åçš„ä»»åŠ¡æ ‡é¢˜"${title}"ä¸ä»Šæ—¥ç°æœ‰ä»»åŠ¡é‡å¤ï¼\n\né‡å¤ä»»åŠ¡ä¿¡æ¯ï¼š\n` +
                        `åˆ†ç±»ï¼š${categoryText}\n` +
                        `ä¼˜å…ˆçº§ï¼š${priorityText}${deadlineText}\n\n` +
                        `æ˜¯å¦ä»è¦ä¿å­˜æ­¤ä¿®æ”¹ï¼Ÿ`;

                    if (!confirm(confirmMessage)) {
                        return; // ç”¨æˆ·é€‰æ‹©ä¸ä¿å­˜é‡å¤æ ‡é¢˜
                    }
                }

                // æ›´æ–°ä»»åŠ¡
                task.title = title;
                task.notes = editTaskNotes.value.trim();
                task.priority = editPriority.value;
                task.category = editCategory.value;
                task.deadline = editDeadline.value || null;

                // ä½¿ç”¨å¤šé€‰å®ŒæˆäººåŠŸèƒ½
                const selectedEditAssignees = getSelectedAssignees('edit');
                task.assignees = selectedEditAssignees;
                task.assignee = selectedEditAssignees.length > 0 ? selectedEditAssignees[0] : null; // ä¿æŒå‘åå…¼å®¹

                task.updatedAt = new Date().toISOString();
                
                console.log('æ›´æ–°åçš„ä»»åŠ¡:', task);
                
                console.log('å¼€å§‹ä¿å­˜å’Œåˆ·æ–°...');
                saveTasks();
                console.log('æ•°æ®å·²ä¿å­˜åˆ°localStorage');
                
                // å¼ºåˆ¶åˆ·æ–°åˆ—è¡¨
                setTimeout(() => {
                    renderTasks();
                    console.log('åˆ—è¡¨å·²é‡æ–°æ¸²æŸ“');
                }, 100);
                
                closeEditModal();
                console.log('æ¨¡æ€æ¡†å·²å…³é—­');
                
                console.log('ä»»åŠ¡ä¿å­˜æˆåŠŸ');
            } catch (error) {
                console.error('ä¿å­˜ä»»åŠ¡æ—¶å‡ºé”™:', error);
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆå§‹åŒ–ç­›é€‰å™¨
        function initializeFilters() {
            const dateFilter = document.getElementById('dateFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const categoryFilter = document.getElementById('categoryFilter');
            const sortFilter = document.getElementById('sortFilter');
            const sortOrderFilter = document.getElementById('sortOrderFilter');
            const customDatePicker = document.getElementById('customDatePicker');

            if (dateFilter) {
                dateFilter.addEventListener('change', function() {
                    currentDateFilter = this.value;
                    const customDateGroup = document.getElementById('customDateGroup');
                    if (this.value === 'custom') {
                        customDateGroup.style.display = 'flex';
                    } else {
                        customDateGroup.style.display = 'none';
                        customDate = null;
                    }
                    renderTasks(true); // ä¿æŒæ»šåŠ¨ä½ç½®
                });
                dateFilter.value = 'today';
            }

            if (priorityFilter) {
                priorityFilter.addEventListener('change', function() {
                    currentPriorityFilter = this.value;
                    renderTasks(true); // ä¿æŒæ»šåŠ¨ä½ç½®
                });
            }

            if (categoryFilter) {
                categoryFilter.addEventListener('change', function() {
                    currentCategoryFilter = this.value;
                    renderTasks(true); // ä¿æŒæ»šåŠ¨ä½ç½®
                });
            }


            if (sortFilter) {
                sortFilter.addEventListener('change', function() {
                    currentSortBy = this.value;
                    renderTasks(true); // ä¿æŒæ»šåŠ¨ä½ç½®
                });
                sortFilter.value = 'deadline';
            }

            if (sortOrderFilter) {
                sortOrderFilter.addEventListener('change', function() {
                    currentSortOrder = this.value;
                    renderTasks(true); // ä¿æŒæ»šåŠ¨ä½ç½®
                });
                sortOrderFilter.value = 'asc';
            }

            if (customDatePicker) {
                customDatePicker.addEventListener('change', function(e) {
                    e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º
                    customDate = this.value;
                    renderTasks(true); // ä¿æŒæ»šåŠ¨ä½ç½®
                });
            }
        }

        // æ¸…é™¤æ‰€æœ‰ç­›é€‰
        function clearAllFilters() {
            currentDateFilter = 'all';
            currentPriorityFilter = 'all';
            currentCategoryFilter = 'all';
            currentFilter = 'all';
            currentSortBy = 'deadline';
            currentSortOrder = 'asc';
            customDate = null;

            const dateFilter = document.getElementById('dateFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const categoryFilter = document.getElementById('categoryFilter');
            const sortFilter = document.getElementById('sortFilter');
            const sortOrderFilter = document.getElementById('sortOrderFilter');
            const customDatePicker = document.getElementById('customDatePicker');
            const customDateGroup = document.getElementById('customDateGroup');

            if (dateFilter) dateFilter.value = 'all';
            if (priorityFilter) priorityFilter.value = 'all';
            if (categoryFilter) categoryFilter.value = 'all';
            if (sortFilter) sortFilter.value = 'deadline';
            if (sortOrderFilter) sortOrderFilter.value = 'asc';
            if (customDatePicker) {
                customDatePicker.value = '';
            }
            if (customDateGroup) {
                customDateGroup.style.display = 'none';
            }

            // æ›´æ–°çŠ¶æ€æŒ‰é’®
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const filterAllBtn = document.getElementById('filterAll');
            if (filterAllBtn) filterAllBtn.classList.add('active');

            renderTasks();
        }

        // è®¾ç½®è¿‡æ»¤å™¨
        function setFilter(filter) {
            currentFilter = filter;

            // æ›´æ–°çŠ¶æ€ç­›é€‰æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.status-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            const activeBtn = document.querySelector(`.status-filter-btn[data-filter="${filter}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            renderTasks();
        }

        // æ¸…ç©ºå·²å®Œæˆä»»åŠ¡
        function clearCompleted() {
            const completedCount = tasks.filter(t => t.completed).length;
            if (completedCount === 0) {
                alert('æ²¡æœ‰å·²å®Œæˆçš„ä»»åŠ¡');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦æ¸…ç©º ${completedCount} ä¸ªå·²å®Œæˆçš„ä»»åŠ¡å—ï¼Ÿ`)) {
                tasks = tasks.filter(t => !t.completed);
                saveTasks();
                renderTasks();
                updateStats();
            }
        }

        // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
        function renderTasks(preserveScrollPosition = false) {
            console.log('renderTaskså‡½æ•°è¢«è°ƒç”¨');
            console.log('tasksæ•°ç»„:', tasks);
            console.log('å½“å‰ä»»åŠ¡æ•°é‡:', tasks ? tasks.length : 'tasksæœªå®šä¹‰');
            console.log('å½“å‰è¿‡æ»¤å™¨:', currentFilter);

            // æ£€æŸ¥æ˜¯å¦æœ‰ç­›é€‰å™¨è¾“å…¥æ¡†å­˜åœ¨ï¼Œå¦‚æœæœ‰åˆ™ä½¿ç”¨ç»Ÿä¸€çš„ç­›é€‰é€»è¾‘
            const keywordSearch = document.getElementById('keywordSearch');
            const dateFilter = document.getElementById('dateFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const categoryFilter = document.getElementById('categoryFilter');
            const statusFilter = document.getElementById('statusFilterContainer');
            const assigneeFilter = document.getElementById('assigneeFilterContainer');

            // å¦‚æœæ–°çš„ç­›é€‰å™¨å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨applyFiltersç»Ÿä¸€å¤„ç†
            if (keywordSearch || dateFilter || priorityFilter || categoryFilter || statusFilter || assigneeFilter) {
                console.log('æ£€æµ‹åˆ°æ–°ç­›é€‰å™¨å­˜åœ¨ï¼Œä½¿ç”¨ç»Ÿä¸€ç­›é€‰é€»è¾‘');
                applyFilters();
                return;
            }

            // ä¿å­˜å½“å‰æ»šåŠ¨ä½ç½®ï¼ˆåªåœ¨éœ€è¦æ—¶ï¼‰
            const scrollTop = preserveScrollPosition ? (window.pageYOffset || document.documentElement.scrollTop) : 0;

            if (!tasks) {
                console.error('tasksæ•°ç»„æœªå®šä¹‰');
                return;
            }

            const taskList = document.getElementById('taskList');

            if (!taskList) {
                console.error('æœªæ‰¾åˆ°taskListå…ƒç´ ');
                return;
            }

            // è¿‡æ»¤ä»»åŠ¡ - ä»…ç”¨äºå‘åå…¼å®¹
            let filteredTasks = [...tasks]; // åˆ›å»ºå‰¯æœ¬é¿å…ä¿®æ”¹åŸæ•°ç»„
            console.log('è¿‡æ»¤å‰ä»»åŠ¡æ•°é‡:', filteredTasks.length);
            
            try {
                // æŒ‰çŠ¶æ€è¿‡æ»¤
                if (currentFilter === 'active') {
                    filteredTasks = filteredTasks.filter(t => !t.completed);
                } else if (currentFilter === 'completed') {
                    filteredTasks = filteredTasks.filter(t => t.completed);
                }
                
                // æŒ‰æ—¥æœŸè¿‡æ»¤
                if (currentDateFilter !== 'all') {
                    filteredTasks = filteredTasks.filter(task => {
                        if (!task.deadline) return currentDateFilter === 'all';
                        
                        const taskDate = new Date(task.deadline);
                        const today = new Date();
                        const tomorrow = new Date(today);
                        tomorrow.setDate(today.getDate() + 1);
                        
                        switch (currentDateFilter) {
                            case 'today':
                                return taskDate.toDateString() === today.toDateString();
                            case 'tomorrow':
                                return taskDate.toDateString() === tomorrow.toDateString();
                            case 'week':
                                const weekFromNow = new Date(today);
                                weekFromNow.setDate(today.getDate() + 7);
                                return taskDate >= today && taskDate <= weekFromNow;
                            case 'overdue':
                                return taskDate < today && !task.completed;
                            case 'custom':
                                if (customDate) {
                                    const selectedDate = new Date(customDate);
                                    return taskDate.toDateString() === selectedDate.toDateString();
                                }
                                return true;
                            default:
                                return true;
                        }
                    });
                }
                
                // æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤
                if (currentPriorityFilter !== 'all') {
                    filteredTasks = filteredTasks.filter(t => t.priority === currentPriorityFilter);
                }
                
                // æŒ‰åˆ†ç±»è¿‡æ»¤
                if (currentCategoryFilter !== 'all') {
                    filteredTasks = filteredTasks.filter(t => t.category === currentCategoryFilter);
                }


                // è§’è‰²æƒé™ï¼šæ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡ï¼Œä½†åœ¨UIä¸ŠåŒºåˆ†æ“ä½œæƒé™
                // ä¸å†è¿‡æ»¤ä»»åŠ¡ï¼Œè®©ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
                // æ“ä½œæƒé™åœ¨æŒ‰é’®æ¸²æŸ“æ—¶æ§åˆ¶

                console.log('è¿‡æ»¤åä»»åŠ¡æ•°é‡:', filteredTasks.length);
            } catch (error) {
                console.error('è¿‡æ»¤ä»»åŠ¡æ—¶å‡ºé”™:', error);
                filteredTasks = tasks;
            }

            // æ’åºä»»åŠ¡
            try {
                filteredTasks.sort((a, b) => {
                    let result = 0;

                    switch (currentSortBy) {
                        case 'deadline':
                            // æˆªæ­¢æ—¶é—´æ’åº - ä¼˜å…ˆæ˜¾ç¤ºæœ‰æˆªæ­¢æ—¶é—´çš„ä»»åŠ¡
                            if (!a.deadline && !b.deadline) result = 0;
                            else if (!a.deadline) result = 1;
                            else if (!b.deadline) result = -1;
                            else result = new Date(a.deadline) - new Date(b.deadline);
                            break;

                        case 'priority':
                            // ä¼˜å…ˆçº§æ’åº - é«˜ä¼˜å…ˆçº§åœ¨å‰
                            const priorityOrder = { high: 3, medium: 2, low: 1 };
                            result = (priorityOrder[b.priority] || 0) - (priorityOrder[a.priority] || 0);
                            break;

                        case 'created':
                            // åˆ›å»ºæ—¶é—´æ’åº - æ–°åˆ›å»ºçš„åœ¨å‰
                            result = new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
                            break;

                        case 'category':
                            // åˆ†ç±»æ’åº - æŒ‰å­—æ¯é¡ºåº
                            result = (a.category || '').localeCompare(b.category || '');
                            break;

                        default:
                            result = 0;
                    }

                    // åº”ç”¨æ’åºé¡ºåº
                    return currentSortOrder === 'desc' ? -result : result;
                });
                console.log('æ’åºå®Œæˆï¼Œæ’åºæ–¹å¼:', currentSortBy);
            } catch (error) {
                console.error('æ’åºä»»åŠ¡æ—¶å‡ºé”™:', error);
            }
            
            if (filteredTasks.length === 0) {
                // æ˜¾ç¤ºç©ºçŠ¶æ€
                taskList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><div>è¿˜æ²¡æœ‰ä»»åŠ¡ï¼Œæ·»åŠ ä¸€ä¸ªå¼€å§‹å§ï¼</div></div>';
                return;
            }
            
            // ç©ºçŠ¶æ€å·²é€šè¿‡innerHTMLå¤„ç†ï¼Œæ— éœ€å•ç‹¬éšè—
            
            const taskListElement = document.getElementById('taskList');
            if (isBatchMode) {
                taskListElement.classList.add('batch-mode');
            } else {
                taskListElement.classList.remove('batch-mode');
            }
            
            taskList.innerHTML = filteredTasks.map(task => {
                const isOverdue = task.deadline && new Date(task.deadline) < new Date() && !task.completed;
                const isSelected = selectedTasks.has(task.id);

                // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ“ä½œæ­¤ä»»åŠ¡ï¼ˆæƒé™æ§åˆ¶ï¼‰
                let canOperate = true;
                if (personalInfo.enableRoleRestriction && personalInfo.myAssignee) {
                    if (task.assignees && Array.isArray(task.assignees)) {
                        canOperate = task.assignees.length === 0 || task.assignees.includes(personalInfo.myAssignee);
                    } else {
                        canOperate = !task.assignee || task.assignee === personalInfo.myAssignee;
                    }
                }

                // è°ƒè¯•æƒé™æ£€æŸ¥
                if (personalInfo.enableRoleRestriction && task.assignee && personalInfo.myAssignee) {
                    console.log(`ä»»åŠ¡æ“ä½œæƒé™æ£€æŸ¥: ${task.title}`, {
                        taskAssignee: task.assignee,
                        myAssignee: personalInfo.myAssignee,
                        canOperate: canOperate,
                        message: canOperate ? 'âœ… å¯ä»¥æ“ä½œ' : 'âŒ åªèƒ½æŸ¥çœ‹ï¼Œä¸èƒ½æ“ä½œ'
                    });
                }

                const buttonDisabled = !canOperate;
                const buttonTitle = buttonDisabled ?
                    `æ­¤ä»»åŠ¡åˆ†é…ç»™"${task.assignee}"ï¼Œæ‚¨æ— æ³•æ“ä½œ` :
                    (task.completed ? 'æ ‡è®°ä¸ºæœªå®Œæˆ' : 'æ ‡è®°ä¸ºå®Œæˆ');

                return `
                    <div class="task-item ${task.completed ? 'completed' : ''} ${isOverdue ? 'overdue' : ''} ${isSelected ? 'selected' : ''} ${buttonDisabled ? 'not-operable' : ''}" data-id="${task.id}">
                        ${isBatchMode ? `<input type="checkbox" class="batch-checkbox" data-task-id="${task.id}" ${isSelected ? 'checked' : ''} ${buttonDisabled ? 'disabled title="æ— æƒé™æ“ä½œæ­¤ä»»åŠ¡"' : ''}>` : ''}
                        <button class="task-complete-btn ${task.completed ? 'completed' : ''} ${buttonDisabled ? 'disabled' : ''}"
                                data-task-id="${task.id}"
                                title="${buttonTitle}"
                                ${buttonDisabled ? 'disabled' : ''}>
                            ${task.completed ? 'âœ…' : 'â­•'}
                        </button>
                        <div class="task-content">
                            <div class="task-title">
                                ${isOverdue ? '<span class="overdue-badge">è¶…æ—¶</span>' : ''}
                                ${escapeHtml(task.title || task.text || 'æ— æ ‡é¢˜')}
                            </div>
                            ${task.notes ? `<div class="task-notes">${escapeHtml(task.notes)}</div>` : ''}
                            <div class="task-meta">
                                <span class="task-category category-${task.category}">${getCategoryName(task.category)}</span>
                                <span class="task-priority priority-${task.priority}">${getPriorityName(task.priority)}</span>
                                ${task.deadline ? `<span class="task-deadline ${isOverdue ? 'overdue' : ''}">${formatDeadline(task.deadline)}</span>` : ''}
                                ${task.assignees && task.assignees.length > 0 ? `<span class="task-assignee">ğŸ‘¤ ${task.assignees.join(', ')}</span>` : task.assignee ? `<span class="task-assignee">ğŸ‘¤ ${task.assignee}</span>` : ''}
                            </div>
                            <div class="task-time-info">
                                <span class="task-created">åˆ›å»ºäº ${formatRelativeTime(task.createdAt)}</span>
                                ${task.completed && task.completedAt ? `<span class="task-completed">å®Œæˆäº ${formatRelativeTime(task.completedAt)}</span>` : ''}
                            </div>
                            ${task.completed && (task.completionImages || task.completionImage || task.completionNotes) ? `
                                <div class="task-completion-media">
                                    ${(() => {
                                        // æ”¯æŒå¤šå¼ å›¾ç‰‡æ˜¾ç¤º
                                        const images = task.completionImages || (task.completionImage ? [task.completionImage] : []);
                                        return images.map((img, index) =>
                                            `<img class="completion-thumbnail" src="${img}" alt="å®Œæˆå›¾ç‰‡${index + 1}" onclick="viewCompletionImage('${task.id}', ${index})">`
                                        ).join('');
                                    })()}
                                    ${task.completionNotes ? `<div class="completion-notes" title="${escapeHtml(task.completionNotes)}">${escapeHtml(task.completionNotes)}</div>` : ''}
                                </div>
                            ` : ''}
                        </div>
                        <div class="task-actions">
                            <button class="action-btn edit-btn" data-task-id="${task.id}" title="ç¼–è¾‘" ${isBatchMode ? 'style="display:none;"' : ''}>
                                <span class="emoji-icon">âœï¸</span>
                            </button>
                            <button class="action-btn delete-btn" data-task-id="${task.id}" title="åˆ é™¤" ${isBatchMode ? 'style="display:none;"' : ''}>
                                <span class="emoji-icon">ğŸ—‘ï¸</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // é‡æ–°ç»‘å®šäº‹ä»¶å¤„ç†å™¨
            bindTaskEvents();

            // æ¢å¤æ»šåŠ¨ä½ç½®ï¼ˆåªåœ¨éœ€è¦æ—¶ï¼‰
            if (preserveScrollPosition && scrollTop > 0) {
                requestAnimationFrame(() => {
                    // åªæœ‰åœ¨æ»šåŠ¨ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶æ‰æ¢å¤
                    const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    if (Math.abs(currentScrollTop - scrollTop) > 10) { // å…è®¸10pxçš„è¯¯å·®
                        window.scrollTo(0, scrollTop);
                    }
                });
            }

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œä¼ é€’å½“å‰æ˜¾ç¤ºçš„ä»»åŠ¡åˆ—è¡¨
            updateStats(filteredTasks);
        }

        // ç»‘å®šä»»åŠ¡äº‹ä»¶
        function bindTaskEvents() {
            console.log('å¼€å§‹ç»‘å®šä»»åŠ¡äº‹ä»¶');
            
            // ç»‘å®šå®Œæˆä»»åŠ¡æŒ‰é’®äº‹ä»¶
            const completeButtons = document.querySelectorAll('.task-complete-btn');
            console.log('æ‰¾åˆ°', completeButtons.length, 'ä¸ªå®Œæˆä»»åŠ¡æŒ‰é’®');
            completeButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    // æ£€æŸ¥æŒ‰é’®æ˜¯å¦è¢«ç¦ç”¨
                    if (this.disabled || this.classList.contains('disabled')) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('æŒ‰é’®è¢«ç¦ç”¨ï¼Œæ— æ³•æ“ä½œ');
                        return;
                    }

                    const taskId = this.getAttribute('data-task-id');
                    console.log('å®Œæˆä»»åŠ¡æŒ‰é’®ç‚¹å‡»ï¼ŒtaskId:', taskId);
                    if (taskId) {
                        toggleTask(taskId);
                    } else {
                        console.error('å®Œæˆä»»åŠ¡æŒ‰é’®æ²¡æœ‰data-task-idå±æ€§');
                    }
                });
            });
            
            // ç»‘å®šç¼–è¾‘æŒ‰é’®äº‹ä»¶
            const editBtns = document.querySelectorAll('.edit-btn');
            console.log('æ‰¾åˆ°', editBtns.length, 'ä¸ªç¼–è¾‘æŒ‰é’®');
            editBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const taskId = this.getAttribute('data-task-id');
                    console.log('ç¼–è¾‘æŒ‰é’®ç‚¹å‡»ï¼ŒtaskId:', taskId);
                    if (taskId) {
                        editTask(taskId);
                    } else {
                        console.error('ç¼–è¾‘æŒ‰é’®æ²¡æœ‰data-task-idå±æ€§');
                    }
                });
            });
            
            // ç»‘å®šåˆ é™¤æŒ‰é’®äº‹ä»¶
            const deleteBtns = document.querySelectorAll('.delete-btn');
            console.log('æ‰¾åˆ°', deleteBtns.length, 'ä¸ªåˆ é™¤æŒ‰é’®');
            deleteBtns.forEach(btn => {
                // ç§»é™¤ç°æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
                btn.removeEventListener('click', btn._deleteHandler);
                btn.removeEventListener('touchend', btn._touchHandler);

                // é˜²æ­¢é‡å¤è§¦å‘çš„æ ‡è®°
                btn._deleteInProgress = false;

                // åˆ›å»ºæ–°çš„äº‹ä»¶å¤„ç†å™¨
                btn._deleteHandler = function(e) {
                    // é˜²æ­¢é‡å¤æ‰§è¡Œ
                    if (this._deleteInProgress) {
                        console.log('åˆ é™¤æ“ä½œæ­£åœ¨è¿›è¡Œä¸­ï¼Œå¿½ç•¥é‡å¤è§¦å‘');
                        return;
                    }

                    console.log('åˆ é™¤æŒ‰é’®è¢«ç‚¹å‡»');
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();

                    const taskId = this.getAttribute('data-task-id');
                    console.log('åˆ é™¤æŒ‰é’®ç‚¹å‡»ï¼ŒtaskId:', taskId);

                    if (taskId) {
                        // è®¾ç½®æ“ä½œæ ‡è®°
                        this._deleteInProgress = true;

                        // æ·»åŠ è§†è§‰åé¦ˆ
                        this.style.backgroundColor = '#ff9999';
                        this.style.transform = 'scale(0.95)';

                        // å»¶è¿Ÿæ‰§è¡Œåˆ é™¤ï¼Œç»™ç”¨æˆ·åé¦ˆæ—¶é—´
                        setTimeout(() => {
                            deleteTask(taskId);
                            // é‡ç½®çŠ¶æ€
                            this.style.backgroundColor = '';
                            this.style.transform = '';
                            this._deleteInProgress = false;
                        }, 150);
                    } else {
                        console.error('åˆ é™¤æŒ‰é’®æ²¡æœ‰data-task-idå±æ€§');
                        alert('åˆ é™¤å¤±è´¥ï¼šä»»åŠ¡IDä¸¢å¤±');
                        this._deleteInProgress = false;
                    }
                };

                // Android 14ç‰¹æ®Šå¤„ç†çš„è§¦æ‘¸äº‹ä»¶
                btn._touchHandler = function(e) {
                    // é˜²æ­¢é‡å¤æ‰§è¡Œ
                    if (this._deleteInProgress) {
                        return;
                    }

                    console.log('åˆ é™¤æŒ‰é’®touchendäº‹ä»¶');
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();

                    // é¿å…åŒæ—¶è§¦å‘clickå’Œtouchend
                    setTimeout(() => {
                        if (!this._deleteInProgress) {
                            btn._deleteHandler.call(this, e);
                        }
                    }, 50);
                };

                // ç»‘å®šäº‹ä»¶å¤„ç†å™¨
                btn.addEventListener('click', btn._deleteHandler, { passive: false });

                // æ£€æµ‹Androidè®¾å¤‡å¹¶æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
                const isAndroid = /Android/i.test(navigator.userAgent);
                const androidVersion = isAndroid ? parseFloat((navigator.userAgent.match(/Android ([\d.]+)/) || [])[1]) : 0;

                if (isAndroid && androidVersion >= 14) {
                    // Android 14+ ç‰¹æ®Šå¤„ç†ï¼šåªä½¿ç”¨touchendäº‹ä»¶
                    btn.removeEventListener('click', btn._deleteHandler);
                    btn.addEventListener('touchend', btn._touchHandler, { passive: false });

                    // å®Œå…¨ç¦ç”¨clickäº‹ä»¶é˜²æ­¢å†²çª
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        return false;
                    }, { passive: false, capture: true });
                } else if (isAndroid) {
                    // å…¶ä»–Androidç‰ˆæœ¬ï¼šåŒæ—¶æ”¯æŒclickå’Œtouchend
                    btn.addEventListener('touchend', btn._touchHandler, { passive: false });
                }
            });
            
            // ç»‘å®šæ‰¹é‡é€‰æ‹©å¤é€‰æ¡†äº‹ä»¶
            const batchCheckboxes = document.querySelectorAll('.batch-checkbox');
            console.log('æ‰¾åˆ°', batchCheckboxes.length, 'ä¸ªæ‰¹é‡é€‰æ‹©å¤é€‰æ¡†');
            batchCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const taskId = this.getAttribute('data-task-id');
                    console.log('æ‰¹é‡é€‰æ‹©å¤é€‰æ¡†å˜åŒ–ï¼ŒtaskId:', taskId, 'checked:', this.checked);
                    if (this.checked) {
                        selectedTasks.add(taskId);
                    } else {
                        selectedTasks.delete(taskId);
                    }
                    updateSelectedCount();
                    updateTaskSelection(taskId, this.checked);
                });
            });

            console.log('äº‹ä»¶ç»‘å®šå®Œæˆ');

            // æ ¹æ®ç­›é€‰å™¨æŠ˜å çŠ¶æ€è°ƒæ•´task-itemé«˜åº¦
            const filterCollapsed = localStorage.getItem('filterSectionCollapsed') === 'true';
            if (filterCollapsed) {
                adjustTaskItemHeight('normal');
            } else {
                adjustTaskItemHeight('compact');
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(currentTasks = null) {
            // å¦‚æœæ²¡æœ‰ä¼ å…¥å½“å‰ä»»åŠ¡åˆ—è¡¨ï¼Œåˆ™ä½¿ç”¨å…¨éƒ¨ä»»åŠ¡
            const tasksToCount = currentTasks || tasks;
            const total = tasksToCount.length;
            const completed = tasksToCount.filter(t => t.completed).length;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

            // æ›´æ–°è¿›åº¦æ¡ï¼ˆä»ä½¿ç”¨å…¨éƒ¨ä»»åŠ¡ï¼‰
            const allTotal = tasks.length;
            const allCompleted = tasks.filter(t => t.completed).length;
            const allRate = allTotal > 0 ? Math.round((allCompleted / allTotal) * 100) : 0;

            document.getElementById('progressInfo').textContent = `${allCompleted}/${allTotal} å®Œæˆ`;
            document.getElementById('progressFill').style.width = `${allRate}%`;

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆä½¿ç”¨å½“å‰åˆ—è¡¨çš„æ•°æ®ï¼‰
            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('completionRate').textContent = `${rate}%`;
        }

        // ä¿å­˜ä»»åŠ¡ - ç»Ÿä¸€å…¥å£
        function saveTasks() {
            if (syncStatus.isOnline) {
                saveTasksToOnline();
            } else {
                saveTasksToLocal();
                syncStatus.pendingChanges = true;
            }
        }

        // åŠ è½½ä»»åŠ¡ - ç»Ÿä¸€å…¥å£
        async function loadTasks() {
            if (syncStatus.isOnline) {
                await loadTasksFromOnline();
            } else {
                loadTasksFromLocal();
            }

            // åŠ è½½ä»»åŠ¡åæ›´æ–°ç­›é€‰å™¨é€‰é¡¹
            updateAssigneeFilterOptions();
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(tasks, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `daily-todo-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // å¯¼å…¥æ•°æ®
        function importData() {
            document.getElementById('fileInput').click();
        }

        // å¤„ç†æ–‡ä»¶å¯¼å…¥
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedTasks = JSON.parse(e.target.result);
                    if (Array.isArray(importedTasks)) {
                        if (confirm(`ç¡®å®šè¦å¯¼å…¥ ${importedTasks.length} ä¸ªä»»åŠ¡å—ï¼Ÿè¿™å°†è¦†ç›–ç°æœ‰æ•°æ®ã€‚`)) {
                            tasks = importedTasks;
                            saveTasks();
                            renderTasks();
                            updateStats();
                            alert('å¯¼å…¥æˆåŠŸï¼');
                        }
                    } else {
                        alert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                    }
                } catch (error) {
                    alert('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                }
            };
            reader.readAsText(file);
            
            // æ¸…ç©ºinputå€¼ï¼Œå…è®¸é‡å¤å¯¼å…¥åŒä¸€æ–‡ä»¶
            event.target.value = '';
        }

        // å·¥å…·å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getCategoryName(category) {
            const names = {
                work: 'å·¥ä½œ',
                life: 'ç”Ÿæ´»',
                study: 'å­¦ä¹ ',
                other: 'å…¶ä»–'
            };
            return names[category] || 'å…¶ä»–';
        }

        function getPriorityName(priority) {
            const names = {
                high: 'é«˜',
                medium: 'ä¸­',
                low: 'ä½'
            };
            return names[priority] || 'ä¸­';
        }

        function formatDeadline(deadline) {
            const date = new Date(deadline);
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const taskDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            
            if (taskDate.getTime() === today.getTime()) {
                return `ä»Šå¤© ${date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}`;
            } else if (taskDate.getTime() === today.getTime() + 24 * 60 * 60 * 1000) {
                return `æ˜å¤© ${date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}`;
            } else {
                return date.toLocaleString('zh-CN', {
                    month: 'numeric',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function formatDateTime(dateTime) {
            if (!dateTime) return '';
            const date = new Date(dateTime);
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const taskDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            
            const timeDiff = now.getTime() - date.getTime();
            const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            
            if (daysDiff === 0) {
                return `ä»Šå¤© ${date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}`;
            } else if (daysDiff === 1) {
                return `æ˜¨å¤© ${date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}`;
            } else if (daysDiff < 7) {
                return `${daysDiff}å¤©å‰`;
            } else {
                return date.toLocaleString('zh-CN', {
                    month: 'numeric',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function formatRelativeTime(dateTime) {
            if (!dateTime) return '';
            const date = new Date(dateTime);
            const now = new Date();
            const timeDiff = now.getTime() - date.getTime();
            
            const minutes = Math.floor(timeDiff / (1000 * 60));
            const hours = Math.floor(timeDiff / (1000 * 60 * 60));
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            
            if (minutes < 1) {
                return 'åˆšåˆš';
            } else if (minutes < 60) {
                return `${minutes}åˆ†é’Ÿå‰`;
            } else if (hours < 24) {
                return `${hours}å°æ—¶å‰`;
            } else if (days < 30) {
                return `${days}å¤©å‰`;
            } else {
                return date.toLocaleDateString('zh-CN');
            }
        }

        // æ¯æ—¥å¾…åŠç›¸å…³åŠŸèƒ½
        function showDailyTodoSettings() {
            const modal = document.getElementById('dailyTodoModal');
            if (modal) {
                // åŠ è½½å½“å‰è®¾ç½®
                loadDailyTodoSettings();
                modal.style.display = 'flex';
            }
        }

        // å¾®ä¿¡é€šçŸ¥è®¾ç½®åŠŸèƒ½
        function showWechatSettings() {
            const modal = document.getElementById('wechatModal');
            if (modal) {
                // åŠ è½½å½“å‰è®¾ç½®
                loadWechatSettings();
                modal.style.display = 'flex';
            }
        }

        function closeWechatModal() {
            const modal = document.getElementById('wechatModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // æ•°æ®åº“è®¾ç½®åŠŸèƒ½
        function showDatabaseSettings() {
            const modal = document.getElementById('databaseModal');
            if (modal) {
                // åŠ è½½å½“å‰è®¾ç½®
                loadDatabaseSettings();
                modal.style.display = 'flex';
            }
        }

        function closeDatabaseModal() {
            const modal = document.getElementById('databaseModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function closeDailyTodoModal() {
            const modal = document.getElementById('dailyTodoModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function loadDailyTodoSettings() {
            const settings = getDailyTodoSettings();
            const templateTextarea = document.getElementById('dailyTasksTemplate');
            const autoAddTimeInput = document.getElementById('autoAddTime');
            const enableCheckbox = document.getElementById('enableDailyTodo');
            const skipHolidaysCheckbox = document.getElementById('skipHolidays');

            if (templateTextarea && settings.template) {
                templateTextarea.value = settings.template;
            }
            if (autoAddTimeInput && settings.autoAddTime) {
                autoAddTimeInput.value = settings.autoAddTime;
            }
            if (enableCheckbox) {
                enableCheckbox.checked = settings.enabled;
            }
            if (skipHolidaysCheckbox) {
                skipHolidaysCheckbox.checked = settings.skipHolidays !== false; // é»˜è®¤ä¸ºtrue
            }
        }

        // å¾®ä¿¡è®¾ç½®åŠ è½½å‡½æ•°
        function loadWechatSettings() {
            const settings = getDailyTodoSettings();
            const serverChanKeyInput = document.getElementById('serverChanKey');
            const enableWechatNotifyCheckbox = document.getElementById('enableWechatNotify');
            const morningNotifyTimeInput = document.getElementById('morningNotifyTime');
            const eveningNotifyTimeInput = document.getElementById('eveningNotifyTime');

            if (serverChanKeyInput && settings.serverChanKey) {
                serverChanKeyInput.value = settings.serverChanKey;
            }
            if (enableWechatNotifyCheckbox) {
                enableWechatNotifyCheckbox.checked = settings.enableWechatNotify || false;
            }
            if (morningNotifyTimeInput && settings.morningNotifyTime) {
                morningNotifyTimeInput.value = settings.morningNotifyTime;
            }
            if (eveningNotifyTimeInput && settings.eveningNotifyTime) {
                eveningNotifyTimeInput.value = settings.eveningNotifyTime;
            }
        }

        // æ•°æ®åº“è®¾ç½®åŠ è½½å‡½æ•°
        function loadDatabaseSettings() {
            const settings = getDailyTodoSettings();
            const supabaseUrlInput = document.getElementById('supabaseUrl');
            const supabaseAnonKeyInput = document.getElementById('supabaseAnonKey');
            const supabaseUserIdInput = document.getElementById('supabaseUserId');
            const enableOnlineSyncCheckbox = document.getElementById('enableOnlineSync');
            const syncIntervalSelect = document.getElementById('syncIntervalSelect');
            const statusText = document.getElementById('statusText');

            // Supabase URLé…ç½®
            if (supabaseUrlInput) {
                supabaseUrlInput.value = DATABASE_CONFIG.supabaseUrl && !DATABASE_CONFIG.supabaseUrl.includes('YOUR_PROJECT_ID') ? DATABASE_CONFIG.supabaseUrl : '';
            }

            // Supabase Anon Keyé…ç½®
            if (supabaseAnonKeyInput) {
                supabaseAnonKeyInput.value = DATABASE_CONFIG.supabaseAnonKey && !DATABASE_CONFIG.supabaseAnonKey.includes('YOUR_SUPABASE_ANON_KEY') ? DATABASE_CONFIG.supabaseAnonKey : '';
            }

            // Supabaseç”¨æˆ·IDé…ç½®
            if (supabaseUserIdInput) {
                supabaseUserIdInput.value = DATABASE_CONFIG.userId || '';
            }

            if (enableOnlineSyncCheckbox) {
                enableOnlineSyncCheckbox.checked = settings.enableOnlineSync !== false;
            }
            if (syncIntervalSelect) {
                syncIntervalSelect.value = String(syncInterval / (60 * 1000));
            }

            // æ›´æ–°æ•°æ®åº“çŠ¶æ€æ˜¾ç¤º
            updateDatabaseStatusDisplay();
        }

        // æ›´æ–°æ•°æ®åº“çŠ¶æ€æ˜¾ç¤º
        function updateDatabaseStatusDisplay() {
            const statusText = document.getElementById('statusText');
            const databaseStatus = document.getElementById('databaseStatus');
            const binIdInfo = document.getElementById('binIdInfo');

            if (!statusText || !databaseStatus) return;

            if (!DATABASE_CONFIG.apiKey || DATABASE_CONFIG.apiKey.includes('YOUR_API_KEY')) {
                statusText.textContent = 'âŒ æœªé…ç½®API Key';
                databaseStatus.style.background = '#ffebee';
                databaseStatus.style.color = '#d32f2f';
            } else if (!syncStatus.isOnline) {
                statusText.textContent = 'ğŸ“± ç¦»çº¿æ¨¡å¼';
                databaseStatus.style.background = '#fff3e0';
                databaseStatus.style.color = '#f57c00';
            } else if (syncStatus.syncInProgress) {
                statusText.textContent = 'ğŸ”„ åŒæ­¥ä¸­...';
                databaseStatus.style.background = '#e3f2fd';
                databaseStatus.style.color = '#1976d2';
            } else if (DATABASE_CONFIG.binId) {
                // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†å›ºå®šçš„Bin ID
                const settings = getDailyTodoSettings();
                const isFixed = settings.fixedBinId && settings.fixedBinId === DATABASE_CONFIG.binId;
                const modeText = isFixed ? ' (å›ºå®šæ¨¡å¼)' : ' (è‡ªåŠ¨åˆ›å»º)';
                statusText.textContent = 'âœ… å·²è¿æ¥å¹¶åŒæ­¥' + modeText;
                databaseStatus.style.background = '#e8f5e8';
                databaseStatus.style.color = '#388e3c';
            } else {
                statusText.textContent = 'âš ï¸ éœ€è¦æµ‹è¯•è¿æ¥';
                databaseStatus.style.background = '#fff3e0';
                databaseStatus.style.color = '#f57c00';
            }

            // æ›´æ–°Bin IDä¿¡æ¯æ˜¾ç¤º
            if (binIdInfo) {
                if (DATABASE_CONFIG.binId) {
                    const settings = getDailyTodoSettings();
                    const isFixed = settings.fixedBinId && settings.fixedBinId === DATABASE_CONFIG.binId;
                    binIdInfo.textContent = `Bin ID: ${DATABASE_CONFIG.binId} ${isFixed ? '(ç”¨æˆ·è®¾ç½®)' : '(è‡ªåŠ¨ç”Ÿæˆ)'}`;
                } else {
                    binIdInfo.textContent = 'æš‚æ— Bin ID';
                }
            }
        }

        function saveDailyTodoSettings() {
            const templateTextarea = document.getElementById('dailyTasksTemplate');
            const autoAddTimeInput = document.getElementById('autoAddTime');
            const enableCheckbox = document.getElementById('enableDailyTodo');
            const skipHolidaysCheckbox = document.getElementById('skipHolidays');

            const oldSettings = getDailyTodoSettings();
            const newSettings = {
                ...oldSettings, // ä¿ç•™å…¶ä»–è®¾ç½®
                template: templateTextarea ? templateTextarea.value.trim() : '',
                autoAddTime: autoAddTimeInput ? autoAddTimeInput.value : '09:00',
                enabled: enableCheckbox ? enableCheckbox.checked : true,
                skipHolidays: skipHolidaysCheckbox ? skipHolidaysCheckbox.checked : true,
                lastAddedDate: null, // é‡ç½®æ·»åŠ æ—¥æœŸï¼Œå¼ºåˆ¶é‡æ–°ç”Ÿæˆä»»åŠ¡
            };
            
            // æ£€æŸ¥æ¨¡æ¿æ˜¯å¦å‘ç”Ÿå˜åŒ–
            const templateChanged = oldSettings.template !== newSettings.template;
            const enabledChanged = oldSettings.enabled !== newSettings.enabled;
            const skipHolidaysChanged = oldSettings.skipHolidays !== newSettings.skipHolidays;

            if (templateChanged || enabledChanged || skipHolidaysChanged) {
                // åˆ é™¤æ‰€æœ‰æœªå®Œæˆçš„æ¯æ—¥å¾…åŠä»»åŠ¡
                const today = new Date();
                const oneWeekLater = new Date(today);
                oneWeekLater.setDate(today.getDate() + 7);
                
                tasks = tasks.filter(task => {
                    // ä¿ç•™éæ¯æ—¥å¾…åŠä»»åŠ¡ï¼Œæˆ–å·²å®Œæˆçš„æ¯æ—¥å¾…åŠä»»åŠ¡
                    if (!task.isDailyTodo || task.completed) {
                        return true;
                    }
                    
                    // åˆ é™¤æœªæ¥ä¸€å‘¨å†…çš„æœªå®Œæˆæ¯æ—¥å¾…åŠä»»åŠ¡
                    if (task.deadline) {
                        const taskDate = new Date(task.deadline);
                        return taskDate < today || taskDate > oneWeekLater;
                    }
                    
                    return false;
                });
                
                // å¦‚æœå¯ç”¨äº†æ¯æ—¥å¾…åŠï¼Œæ·»åŠ æ–°çš„ä¸€å‘¨ä»»åŠ¡
                if (newSettings.enabled && newSettings.template) {
                    addWeeklyTodos(newSettings, today);
                }
                
                saveTasks();
                renderTasks();
                updateStats();
            }
            
            localStorage.setItem('dailyTodoSettings', JSON.stringify(newSettings));
            closeDailyTodoModal();
            alert('æ¯æ—¥å¾…åŠè®¾ç½®å·²ä¿å­˜' + (templateChanged || enabledChanged ? 'ï¼Œä»»åŠ¡å·²æ›´æ–°' : ''));
        }

        // å¾®ä¿¡è®¾ç½®ä¿å­˜å‡½æ•°
        function saveWechatSettings() {
            const serverChanKeyInput = document.getElementById('serverChanKey');
            const enableWechatNotifyCheckbox = document.getElementById('enableWechatNotify');
            const morningNotifyTimeInput = document.getElementById('morningNotifyTime');
            const eveningNotifyTimeInput = document.getElementById('eveningNotifyTime');

            const oldSettings = getDailyTodoSettings();
            const newSettings = {
                ...oldSettings, // ä¿ç•™å…¶ä»–è®¾ç½®
                serverChanKey: serverChanKeyInput ? serverChanKeyInput.value.trim() : '',
                enableWechatNotify: enableWechatNotifyCheckbox ? enableWechatNotifyCheckbox.checked : false,
                morningNotifyTime: morningNotifyTimeInput ? morningNotifyTimeInput.value : '09:00',
                eveningNotifyTime: eveningNotifyTimeInput ? eveningNotifyTimeInput.value : '18:00'
            };

            localStorage.setItem('dailyTodoSettings', JSON.stringify(newSettings));
            closeWechatModal();
            alert('å¾®ä¿¡é€šçŸ¥è®¾ç½®å·²ä¿å­˜');
        }

        // æ•°æ®åº“è®¾ç½®ä¿å­˜å‡½æ•°
        function saveDatabaseSettings() {
            const supabaseUrlInput = document.getElementById('supabaseUrl');
            const supabaseAnonKeyInput = document.getElementById('supabaseAnonKey');
            const supabaseUserIdInput = document.getElementById('supabaseUserId');
            const enableOnlineSyncCheckbox = document.getElementById('enableOnlineSync');
            const syncIntervalSelect = document.getElementById('syncIntervalSelect');

            const oldSettings = getDailyTodoSettings();
            const newSettings = {
                ...oldSettings, // ä¿ç•™å…¶ä»–è®¾ç½®
                enableOnlineSync: enableOnlineSyncCheckbox ? enableOnlineSyncCheckbox.checked : true
            };

            // æ›´æ–°Supabase URLé…ç½®
            if (supabaseUrlInput && supabaseUrlInput.value.trim()) {
                DATABASE_CONFIG.supabaseUrl = supabaseUrlInput.value.trim();
                localStorage.setItem('supabase_url', DATABASE_CONFIG.supabaseUrl);
            }

            // æ›´æ–°Supabase Anon Keyé…ç½®
            if (supabaseAnonKeyInput && supabaseAnonKeyInput.value.trim()) {
                const anonKey = supabaseAnonKeyInput.value.trim();
                // éªŒè¯Anon Keyæ ¼å¼
                if (anonKey.length > 0) {
                    DATABASE_CONFIG.supabaseAnonKey = anonKey;
                    localStorage.setItem('supabase_anon_key', DATABASE_CONFIG.supabaseAnonKey);
                    console.log('Supabase Anon Keyå·²è®¾ç½®');
                } else {
                    alert('Anon Keyæ ¼å¼ä¸æ­£ç¡®ï¼è¯·è¾“å…¥å®Œæ•´çš„Supabase Anon Key');
                    return;
                }
            }

            // æ›´æ–°Supabaseç”¨æˆ·IDé…ç½®
            if (supabaseUserIdInput) {
                const userId = supabaseUserIdInput.value.trim();
                if (userId) {
                    // éªŒè¯ç”¨æˆ·IDæ ¼å¼ï¼ˆå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ä¸­åˆ’çº¿ï¼‰
                    if (/^[a-zA-Z0-9_-]+$/.test(userId)) {
                        DATABASE_CONFIG.userId = userId;
                        localStorage.setItem('supabase_user_id', userId);
                        console.log('Supabaseç”¨æˆ·IDå·²è®¾ç½®:', userId);
                    } else {
                        alert('ç”¨æˆ·IDæ ¼å¼ä¸æ­£ç¡®ï¼åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œä¸­åˆ’çº¿');
                        return;
                    }
                } else {
                    // ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ç”¨æˆ·ID
                    if (!DATABASE_CONFIG.userId) {
                        DATABASE_CONFIG.userId = 'user_' + Math.random().toString(36).substr(2, 9);
                        localStorage.setItem('supabase_user_id', DATABASE_CONFIG.userId);
                    }
                    console.log('ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ç”¨æˆ·ID:', DATABASE_CONFIG.userId);
                }
            }

            // æ›´æ–°åŒæ­¥é—´éš”
            if (syncIntervalSelect) {
                const newInterval = parseInt(syncIntervalSelect.value);
                if (newInterval && newInterval > 0) {
                    setSyncInterval(newInterval);
                }
            }

            localStorage.setItem('dailyTodoSettings', JSON.stringify(newSettings));
            closeDatabaseModal();

            // æä¾›æ›´è¯¦ç»†çš„ä¿å­˜ç¡®è®¤ä¿¡æ¯
            const userIdText = DATABASE_CONFIG.userId ? `\nç”¨æˆ·ID: ${DATABASE_CONFIG.userId}` : '';
            alert('Supabaseæ•°æ®åº“è®¾ç½®å·²ä¿å­˜' + userIdText);
        }

        // æµ‹è¯•Supabaseæ•°æ®åº“è¿æ¥
        async function testDatabaseConnection() {
            const supabaseUrlInput = document.getElementById('supabaseUrl');
            const supabaseAnonKeyInput = document.getElementById('supabaseAnonKey');
            const supabaseUrlValue = supabaseUrlInput ? supabaseUrlInput.value.trim() : '';
            const anonKey = supabaseAnonKeyInput ? supabaseAnonKeyInput.value.trim() : '';

            if (!supabaseUrlValue || !anonKey) {
                alert('è¯·å…ˆè¾“å…¥Supabaseé¡¹ç›®URLå’ŒAnon Key');
                return;
            }

            try {
                // æµ‹è¯•Supabaseè¿æ¥
                const url = `${supabaseUrlValue}/rest/v1/${DATABASE_CONFIG.tableName}?user_id=eq.test_connection`;

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'apikey': anonKey,
                        'Authorization': `Bearer ${anonKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    // è¿æ¥æˆåŠŸ
                    alert('âœ… Supabaseæ•°æ®åº“è¿æ¥æµ‹è¯•æˆåŠŸï¼\\nå¯ä»¥æ­£å¸¸è®¿é—®æ•°æ®è¡¨ã€‚');
                } else {
                    const errorText = await response.text();
                    let errorMessage = 'è¯·æ£€æŸ¥Supabaseé¡¹ç›®URLå’ŒAnon Keyæ˜¯å¦æ­£ç¡®';

                    if (response.status === 401) {
                        errorMessage = 'Anon Keyæ— æ•ˆæˆ–æƒé™ä¸è¶³';
                    } else if (response.status === 404) {
                        errorMessage = 'æ•°æ®è¡¨ä¸å­˜åœ¨æˆ–é¡¹ç›®URLé”™è¯¯';
                    }

                    alert(`âŒ Supabaseè¿æ¥å¤±è´¥ï¼š${errorMessage}`);
                    console.error('Supabaseè¿æ¥é”™è¯¯:', errorText);
                }

            } catch (error) {
                alert(`âŒ è¿æ¥æµ‹è¯•å¤±è´¥ï¼š${error.message}`);
                console.error('Firebaseè¿æ¥æµ‹è¯•å¤±è´¥:', error);
            }

            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateDatabaseStatusDisplay();
        }

        // å®Œæˆäººç®¡ç†åŠŸèƒ½
        let assignees = [];

        // ä¸ªäººä¿¡æ¯è®¾ç½®
        let personalInfo = {
            myAssignee: null, // æˆ‘çš„èº«ä»½ï¼ˆå®Œæˆäººåç§°ï¼‰
            enableRoleRestriction: false // æ˜¯å¦å¯ç”¨è§’è‰²é™åˆ¶
        };

        // åˆå§‹åŒ–å®Œæˆäººä¸‹æ‹‰åˆ—è¡¨
        function initializeAssigneeSelect() {
            const assigneeSelect = document.getElementById('addTaskAssignee');
            if (!assigneeSelect) {
                console.error('addTaskAssignee element not found');
                return;
            }

            console.log('Initializing assignee select, assignees:', assignees);

            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            assigneeSelect.innerHTML = '<option value="">é€‰æ‹©å®Œæˆäººï¼ˆå¯é€‰ï¼‰</option>';

            // æ·»åŠ å®Œæˆäººé€‰é¡¹
            assignees.forEach(assignee => {
                const option = document.createElement('option');
                // å¤„ç†å­—ç¬¦ä¸²æˆ–å¯¹è±¡æ ¼å¼
                const assigneeName = typeof assignee === 'string' ? assignee : assignee.name;
                option.value = assigneeName;
                option.textContent = assigneeName;
                assigneeSelect.appendChild(option);
                console.log('Added assignee option:', assigneeName);
            });

            // å¦‚æœæ²¡æœ‰å®Œæˆäººï¼Œæ·»åŠ ä¸€ä¸ªæç¤º
            if (assignees.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'è¯·å…ˆåœ¨è®¾ç½®ä¸­æ·»åŠ å®Œæˆäºº';
                option.disabled = true;
                assigneeSelect.appendChild(option);
                console.log('No assignees found, added help text');
            }
        }

        function showAssigneeSettings() {
            const modal = document.getElementById('assigneeModal');
            if (modal) {
                loadAssignees();
                renderAssigneeList();
                modal.style.display = 'flex';
            }
        }

        function closeAssigneeModal() {
            const modal = document.getElementById('assigneeModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function loadAssignees() {
            const saved = localStorage.getItem('assignees');
            if (saved) {
                try {
                    assignees = JSON.parse(saved);
                    // è§„èŒƒåŒ–æ•°æ®æ ¼å¼ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡
                    assignees = assignees.map(assignee => {
                        if (typeof assignee === 'string') {
                            return {
                                id: generateId(),
                                name: assignee,
                                createdAt: new Date().toISOString()
                            };
                        }
                        return assignee;
                    });
                    // ä¿å­˜è§„èŒƒåŒ–åçš„æ•°æ®
                    saveAssignees();
                } catch (error) {
                    console.error('åŠ è½½å®Œæˆäººåˆ—è¡¨å¤±è´¥:', error);
                    assignees = [];
                }
            } else {
                assignees = [];
            }
        }

        function saveAssignees() {
            try {
                localStorage.setItem('assignees', JSON.stringify(assignees));
            } catch (error) {
                console.error('ä¿å­˜å®Œæˆäººåˆ—è¡¨å¤±è´¥:', error);
            }
        }

        function addAssignee() {
            const input = document.getElementById('newAssigneeName');
            const name = input.value.trim();

            if (!name) {
                alert('è¯·è¾“å…¥å®Œæˆäººå§“å');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (assignees.find(assignee => assignee.name === name)) {
                alert('è¯¥å®Œæˆäººå·²å­˜åœ¨');
                return;
            }

            // æ·»åŠ å®Œæˆäººå¯¹è±¡
            const newAssignee = {
                id: generateId(),
                name: name,
                createdAt: new Date().toISOString()
            };

            assignees.push(newAssignee);
            saveAssignees();
            renderAssigneeList();
            updateCompletedByOptions();
            // åˆ·æ–°æ¨¡æ€æ¡†ä¸­çš„å®Œæˆäººé€‰é¡¹ï¼ˆå¦‚æœæ¨¡æ€æ¡†å¤„äºæ‰“å¼€çŠ¶æ€ï¼‰
            refreshAssigneeOptions();
            updateAssigneeFilterOptions(); // åˆ·æ–°ç­›é€‰å™¨çš„å®Œæˆäººé€‰é¡¹
            input.value = '';
        }

        function removeAssignee(name) {
            if (confirm(`ç¡®è®¤åˆ é™¤å®Œæˆäºº"${name}"å—ï¼Ÿ`)) {
                assignees = assignees.filter(assignee => assignee.name !== name);
                saveAssignees();
                renderAssigneeList();
                updateCompletedByOptions();
                // åˆ·æ–°æ¨¡æ€æ¡†ä¸­çš„å®Œæˆäººé€‰é¡¹ï¼ˆå¦‚æœæ¨¡æ€æ¡†å¤„äºæ‰“å¼€çŠ¶æ€ï¼‰
                refreshAssigneeOptions();
                updateAssigneeFilterOptions(); // åˆ·æ–°ç­›é€‰å™¨çš„å®Œæˆäººé€‰é¡¹
            }
        }

        function renderAssigneeList() {
            const listContainer = document.getElementById('assigneeList');
            if (!listContainer) return;

            if (assignees.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">æš‚æ— å®Œæˆäºº</div>';
                return;
            }

            listContainer.innerHTML = assignees.map(assignee => {
                const assigneeName = typeof assignee === 'string' ? assignee : assignee.name;
                return `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: #f5f5f5; border-radius: 6px; margin-bottom: 8px;">
                    <span>${assigneeName}</span>
                    <button onclick="removeAssignee('${assigneeName}')" style="background: #ff4757; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">åˆ é™¤</button>
                </div>
                `;
            }).join('');
        }

        function updateCompletedByOptions() {
            const select = document.getElementById('completedBySelect');
            if (select) {
                // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼Œä¿ç•™é»˜è®¤é€‰é¡¹
                select.innerHTML = '<option value="">è¯·é€‰æ‹©å®Œæˆäºº</option>';

                // æ·»åŠ å®Œæˆäººé€‰é¡¹
                assignees.forEach(assignee => {
                    const option = document.createElement('option');
                    const assigneeName = typeof assignee === 'string' ? assignee : assignee.name;
                    option.value = assigneeName;
                    option.textContent = assigneeName;
                    select.appendChild(option);
                });
            }

        }

        // ========== ç•Œé¢åˆ‡æ¢åŠŸèƒ½ ==========

        // åˆ‡æ¢åˆ°ä»»åŠ¡ç•Œé¢
        function switchToTaskView() {
            console.log('åˆ‡æ¢åˆ°ä»»åŠ¡ç•Œé¢');

            const taskView = document.getElementById('taskView');
            const settingsView = document.getElementById('settingsView');
            const taskViewBtn = document.getElementById('taskViewBtn');
            const settingsViewBtn = document.getElementById('settingsViewBtn');

            if (taskView) taskView.style.display = 'block';
            if (settingsView) settingsView.style.display = 'none';

            if (taskViewBtn) taskViewBtn.classList.add('active');
            if (settingsViewBtn) settingsViewBtn.classList.remove('active');

            console.log('ä»»åŠ¡ç•Œé¢åˆ‡æ¢å®Œæˆ');
        }

        // åˆ‡æ¢åˆ°è®¾ç½®ç•Œé¢
        function switchToSettingsView() {
            console.log('=== å¼€å§‹åˆ‡æ¢åˆ°è®¾ç½®ç•Œé¢ ===');

            const taskView = document.getElementById('taskView');
            const settingsView = document.getElementById('settingsView');
            const taskViewBtn = document.getElementById('taskViewBtn');
            const settingsViewBtn = document.getElementById('settingsViewBtn');

            console.log('æ‰¾åˆ°çš„å…ƒç´ :');
            console.log('- taskView:', taskView);
            console.log('- settingsView:', settingsView);
            console.log('- taskViewBtn:', taskViewBtn);
            console.log('- settingsViewBtn:', settingsViewBtn);

            // å¼ºåˆ¶æ˜¾ç¤ºè®¾ç½®ç•Œé¢
            if (settingsView) {
                settingsView.style.display = 'block';
                settingsView.style.visibility = 'visible';
                settingsView.style.opacity = '1';
                console.log('âœ… è®¾ç½®ç•Œé¢æ ·å¼å·²è®¾ç½®ä¸ºæ˜¾ç¤º');
                console.log('è®¾ç½®ç•Œé¢å½“å‰æ ·å¼:', settingsView.style.cssText);
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°è®¾ç½®ç•Œé¢å…ƒç´ ');
                return;
            }

            // éšè—ä»»åŠ¡ç•Œé¢
            if (taskView) {
                taskView.style.display = 'none';
                console.log('âœ… ä»»åŠ¡ç•Œé¢å·²éšè—');
            }

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            if (taskViewBtn) taskViewBtn.classList.remove('active');
            if (settingsViewBtn) settingsViewBtn.classList.add('active');

            console.log('=== è®¾ç½®ç•Œé¢åˆ‡æ¢å®Œæˆ ===');
        }

        // è°ƒè¯•å‡½æ•°ï¼šå¼ºåˆ¶æ˜¾ç¤ºè®¾ç½®ç•Œé¢
        function forceShowSettings() {
            console.log('å¼ºåˆ¶æ˜¾ç¤ºè®¾ç½®ç•Œé¢');
            const settingsView = document.getElementById('settingsView');
            if (settingsView) {
                settingsView.style.display = 'block';
                settingsView.style.visibility = 'visible';
                settingsView.style.opacity = '1';
                console.log('è®¾ç½®ç•Œé¢åº”è¯¥ç°åœ¨å¯è§äº†');
            } else {
                console.error('æ‰¾ä¸åˆ°è®¾ç½®ç•Œé¢å…ƒç´ ');
            }
        }

        // æ·»åŠ åˆ°å…¨å±€ä½œç”¨åŸŸä»¥ä¾¿è°ƒè¯•
        window.forceShowSettings = forceShowSettings;

        // ========== æ‚¬æµ®çƒåŠŸèƒ½ ==========

        let fabOpen = false;

        // åˆ‡æ¢æ‚¬æµ®çƒèœå•
        function toggleFab() {
            const fabMain = document.getElementById('fabMain');
            const fabMenu = document.getElementById('fabMenu');

            fabOpen = !fabOpen;

            if (fabOpen) {
                fabMain.classList.add('active');
                fabMenu.classList.add('active');
            } else {
                fabMain.classList.remove('active');
                fabMenu.classList.remove('active');
            }
        }

        // ç‚¹å‡»ç©ºç™½å¤„å…³é—­æ‚¬æµ®çƒèœå•
        document.addEventListener('click', function(event) {
            const fabContainer = document.querySelector('.fab-container');
            if (fabOpen && !fabContainer.contains(event.target)) {
                toggleFab();
            }
        });

        // ========== å¤šé€‰å®ŒæˆäººåŠŸèƒ½ ==========

        // å­˜å‚¨é€‰ä¸­çš„å®Œæˆäºº
        let selectedAssignees = {
            add: [],
            edit: [],
            complete: []
        };

        // åˆ‡æ¢ä¸‹æ‹‰æ¡†æ˜¾ç¤ºçŠ¶æ€
        function toggleAssigneeDropdown(type) {
            const display = document.getElementById(`${type}TaskAssigneeDisplay`);
            const dropdown = document.getElementById(`${type}TaskAssigneeDropdown`);

            if (!display || !dropdown) return;

            const isActive = dropdown.classList.contains('active');

            // å…³é—­æ‰€æœ‰ä¸‹æ‹‰æ¡†
            document.querySelectorAll('.multi-select-dropdown').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.multi-select-display').forEach(d => d.classList.remove('active'));

            if (!isActive) {
                dropdown.classList.add('active');
                display.classList.add('active');
                // åˆå§‹åŒ–ä¸‹æ‹‰æ¡†å†…å®¹
                initializeAssigneeOptions(type);
            }
        }

        // åˆ·æ–°æ‰€æœ‰æ‰“å¼€çš„æ¨¡æ€æ¡†ä¸­çš„å®Œæˆäººé€‰é¡¹
        function refreshAssigneeOptions() {
            // æ£€æŸ¥æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡†æ˜¯å¦æ‰“å¼€
            const addModal = document.getElementById('addModal');
            if (addModal && addModal.style.display !== 'none') {
                const addDropdown = document.querySelector('#addTaskAssigneeDropdown.active');
                if (addDropdown) {
                    initializeAssigneeOptions('add');
                }
            }

            // æ£€æŸ¥ç¼–è¾‘ä»»åŠ¡æ¨¡æ€æ¡†æ˜¯å¦æ‰“å¼€
            const editModal = document.getElementById('editModal');
            if (editModal && editModal.style.display !== 'none') {
                const editDropdown = document.querySelector('#editTaskAssigneeDropdown.active');
                if (editDropdown) {
                    initializeAssigneeOptions('edit');
                }
            }
        }

        // åˆå§‹åŒ–å®Œæˆäººé€‰é¡¹
        function initializeAssigneeOptions(type) {
            const optionsContainer = document.getElementById(`${type}TaskAssigneeOptions`);
            if (!optionsContainer) return;

            // ä½¿ç”¨é…ç½®çš„å®Œæˆäººåˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰é…ç½®åˆ™ä½¿ç”¨é»˜è®¤åˆ—è¡¨
            const configuredAssignees = assignees && assignees.length > 0 ? assignees : [
                'å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'å­™ä¸ƒ',
                'å‘¨å…«', 'å´ä¹', 'éƒ‘å', 'é™ˆä¸€', 'åˆ˜äºŒ'
            ];

            optionsContainer.innerHTML = '';

            configuredAssignees.forEach(assignee => {
                // å¤„ç†å­—ç¬¦ä¸²æˆ–å¯¹è±¡æ ¼å¼
                const assigneeName = typeof assignee === 'string' ? assignee : assignee.name;
                const option = document.createElement('div');
                option.className = 'assignee-option';
                option.innerHTML = `
                    <input type="checkbox" id="${type}_${assigneeName}" onchange="toggleAssigneeSelection('${type}', '${assigneeName}')">
                    <label for="${type}_${assigneeName}">${assigneeName}</label>
                `;

                // æ£€æŸ¥æ˜¯å¦å·²é€‰ä¸­
                if (selectedAssignees[type].includes(assigneeName)) {
                    option.querySelector('input').checked = true;
                    option.classList.add('selected');
                }

                optionsContainer.appendChild(option);
            });
        }

        // åˆ‡æ¢å®Œæˆäººé€‰ä¸­çŠ¶æ€
        function toggleAssigneeSelection(type, assignee) {
            const checkbox = document.getElementById(`${type}_${assignee}`);
            const option = checkbox.closest('.assignee-option');

            if (checkbox.checked) {
                if (!selectedAssignees[type].includes(assignee)) {
                    selectedAssignees[type].push(assignee);
                }
                option.classList.add('selected');
            } else {
                selectedAssignees[type] = selectedAssignees[type].filter(a => a !== assignee);
                option.classList.remove('selected');
            }

            updateAssigneeDisplay(type);
        }

        // æ›´æ–°æ˜¾ç¤ºåŒºåŸŸ
        function updateAssigneeDisplay(type) {
            const display = document.getElementById(`${type}TaskAssigneeDisplay`);
            if (!display) return;

            const placeholder = display.querySelector('.placeholder');
            let selectedItemsContainer = display.querySelector('.selected-items');

            // åˆ é™¤ç°æœ‰çš„é€‰ä¸­é¡¹å®¹å™¨
            if (selectedItemsContainer) {
                selectedItemsContainer.remove();
            }

            if (selectedAssignees[type].length === 0) {
                placeholder.style.display = 'block';
            } else {
                placeholder.style.display = 'none';

                // åˆ›å»ºæ–°çš„é€‰ä¸­é¡¹å®¹å™¨
                selectedItemsContainer = document.createElement('div');
                selectedItemsContainer.className = 'selected-items';

                selectedAssignees[type].forEach(assignee => {
                    const item = document.createElement('span');
                    item.className = 'selected-item';
                    item.innerHTML = `
                        ${assignee}
                        <span class="remove" onclick="removeAssignee('${type}', '${assignee}')">Ã—</span>
                    `;
                    selectedItemsContainer.appendChild(item);
                });

                display.insertBefore(selectedItemsContainer, display.querySelector('.dropdown-arrow'));
            }
        }

        // ç§»é™¤å®Œæˆäºº
        function removeAssignee(type, assignee) {
            selectedAssignees[type] = selectedAssignees[type].filter(a => a !== assignee);
            updateAssigneeDisplay(type);

            // æ›´æ–°å¤é€‰æ¡†çŠ¶æ€
            const checkbox = document.getElementById(`${type}_${assignee}`);
            if (checkbox) {
                checkbox.checked = false;
                checkbox.closest('.assignee-option').classList.remove('selected');
            }
        }

        // ç­›é€‰å®Œæˆäºº
        function filterAssignees(type, searchText) {
            const options = document.querySelectorAll(`#${type}TaskAssigneeOptions .assignee-option`);
            const lowerSearchText = searchText.toLowerCase();

            let hasResults = false;
            options.forEach(option => {
                const label = option.querySelector('label').textContent.toLowerCase();
                if (label.includes(lowerSearchText)) {
                    option.style.display = 'flex';
                    hasResults = true;
                } else {
                    option.style.display = 'none';
                }
            });

            // æ˜¾ç¤º/éšè—æ— ç»“æœæç¤º
            const container = document.getElementById(`${type}TaskAssigneeOptions`);
            let noResults = container.querySelector('.no-results');

            if (!hasResults && searchText.trim()) {
                if (!noResults) {
                    noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.textContent = 'æœªæ‰¾åˆ°ç›¸å…³å®Œæˆäºº';
                    container.appendChild(noResults);
                }
            } else if (noResults) {
                noResults.remove();
            }
        }

        // è®¾ç½®é€‰ä¸­çš„å®Œæˆäººï¼ˆç”¨äºç¼–è¾‘ä»»åŠ¡æ—¶åˆå§‹åŒ–ï¼‰
        function setSelectedAssignees(type, assignees) {
            selectedAssignees[type] = Array.isArray(assignees) ? [...assignees] : [];
            updateAssigneeDisplay(type);
        }

        // è·å–é€‰ä¸­çš„å®Œæˆäºº
        function getSelectedAssignees(type) {
            return [...selectedAssignees[type]];
        }

        // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰æ¡†
        document.addEventListener('click', function(e) {
            // å¦‚æœç‚¹å‡»çš„æ˜¯æ¨¡æ€æ¡†ç›¸å…³å…ƒç´ ï¼Œä¸å¤„ç†ä¸‹æ‹‰æ¡†å…³é—­
            if (e.target.closest('.modal') ||
                e.target.closest('.close-btn') ||
                e.target.classList.contains('close-btn') ||
                e.target.closest('[id*="cancel"]') ||
                e.target.closest('[id*="close"]') ||
                e.target.closest('[id*="Modal"]') ||
                e.target.closest('.modal-content') ||
                e.target.closest('.modal-header') ||
                e.target.closest('.modal-footer') ||
                e.target.id.includes('cancel') ||
                e.target.id.includes('close') ||
                e.target.id.includes('Cancel') ||
                e.target.id.includes('Close')) {
                return;
            }

            if (!e.target.closest('.multi-select-container')) {
                document.querySelectorAll('.multi-select-dropdown').forEach(d => d.classList.remove('active'));
                document.querySelectorAll('.multi-select-display').forEach(d => d.classList.remove('active'));
            }
        });

        // ========== ä¸ªäººä¿¡æ¯è®¾ç½®åŠŸèƒ½ ==========

        // æ˜¾ç¤ºä¸ªäººä¿¡æ¯è®¾ç½®æ¨¡æ€æ¡†
        function showPersonalInfoModal() {
            const modal = document.getElementById('personalInfoModal');
            if (modal) {
                modal.style.display = 'flex';
                initializeMyAssigneeSelect();
                loadPersonalInfo(); // åœ¨åˆå§‹åŒ–é€‰é¡¹åå†åŠ è½½è®¾ç½®
            }
        }

        // å…³é—­ä¸ªäººä¿¡æ¯è®¾ç½®æ¨¡æ€æ¡†
        function closePersonalInfoModal() {
            const modal = document.getElementById('personalInfoModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // åˆå§‹åŒ–æˆ‘çš„èº«ä»½ä¸‹æ‹‰åˆ—è¡¨
        function initializeMyAssigneeSelect() {
            const myAssigneeSelect = document.getElementById('myAssigneeSelect');
            if (!myAssigneeSelect) return;

            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            myAssigneeSelect.innerHTML = '<option value="">è¯·ä»å®Œæˆäººåˆ—è¡¨ä¸­é€‰æ‹©è‡ªå·±</option>';

            // æ·»åŠ å®Œæˆäººé€‰é¡¹
            assignees.forEach(assignee => {
                const option = document.createElement('option');
                const assigneeName = typeof assignee === 'string' ? assignee : assignee.name;
                option.value = assigneeName;
                option.textContent = assigneeName;
                myAssigneeSelect.appendChild(option);
            });
        }

        // åŠ è½½ä¸ªäººä¿¡æ¯
        function loadPersonalInfo() {
            const saved = localStorage.getItem('personalInfo');
            if (saved) {
                personalInfo = JSON.parse(saved);
                console.log('Loaded personal info:', personalInfo);
            }

            const myAssigneeSelect = document.getElementById('myAssigneeSelect');
            const enableRoleRestrictionCheckbox = document.getElementById('enableRoleRestriction');

            if (myAssigneeSelect) {
                myAssigneeSelect.value = personalInfo.myAssignee || '';
                console.log('Set myAssignee to:', personalInfo.myAssignee);
            }

            if (enableRoleRestrictionCheckbox) {
                enableRoleRestrictionCheckbox.checked = personalInfo.enableRoleRestriction || false;
                console.log('Set enableRoleRestriction to:', personalInfo.enableRoleRestriction);
            }
        }

        // ä¿å­˜ä¸ªäººä¿¡æ¯
        function savePersonalInfo() {
            console.log('savePersonalInfo called');
            const myAssigneeSelect = document.getElementById('myAssigneeSelect');
            const enableRoleRestrictionCheckbox = document.getElementById('enableRoleRestriction');

            if (!myAssigneeSelect || !enableRoleRestrictionCheckbox) {
                console.error('Personal info form elements not found');
                alert('ä¿å­˜å¤±è´¥ï¼šè¡¨å•å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            personalInfo.myAssignee = myAssigneeSelect.value || null;
            personalInfo.enableRoleRestriction = enableRoleRestrictionCheckbox.checked;

            console.log('Saving personal info:', personalInfo);
            localStorage.setItem('personalInfo', JSON.stringify(personalInfo));

            closePersonalInfoModal();

            // é‡æ–°æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨ä»¥åº”ç”¨æƒé™è¿‡æ»¤
            renderTasks();

            alert('ä¸ªäººä¿¡æ¯å·²ä¿å­˜');
        }

        function getDailyTodoSettings() {
            const saved = localStorage.getItem('dailyTodoSettings');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                template: 'ä¸Šç­æ‰“å¡|high|work|09:50\nä¸‹ç­æ‰“å¡|high|work|19:00',
                autoAddTime: '09:00',
                enabled: true,
                skipHolidays: true, // é»˜è®¤è·³è¿‡èŠ‚å‡æ—¥
                lastAddedDate: null,
                serverChanKey: '',
                enableWechatNotify: false,
                morningNotifyTime: '09:00',
                eveningNotifyTime: '18:00',
                lastNotifyDate: null,
                lastNotifyInfo: {}
            };
        }

        function checkAndAddDailyTodos() {
            const settings = getDailyTodoSettings();
            if (!settings.enabled || !settings.template) return;
            
            const today = new Date();
            const todayString = today.toDateString();
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ ä¸€å‘¨çš„ä»»åŠ¡
            if (!settings.lastAddedDate || settings.lastAddedDate !== todayString) {
                addWeeklyTodos(settings, today);
                
                // æ›´æ–°æœ€åæ·»åŠ æ—¥æœŸ
                settings.lastAddedDate = todayString;
                localStorage.setItem('dailyTodoSettings', JSON.stringify(settings));
                
                saveTasks();
                renderTasks();
                updateStats();
            }
        }

        // æ£€æŸ¥æ˜¯å¦ä¸ºèŠ‚å‡æ—¥
        function isHoliday(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1; // JavaScriptæœˆä»½ä»0å¼€å§‹
            const day = date.getDate();
            const dayOfWeek = date.getDay(); // 0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­

            // å‘¨æœ«æ£€æŸ¥
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                return true;
            }

            // ä¸­å›½æ³•å®šèŠ‚å‡æ—¥ï¼ˆéœ€è¦æ¯å¹´æ›´æ–°ï¼‰
            // æ³¨æ„ï¼šèŠ‚å‡æ—¥æ•°æ®åŸºäºå›½åŠ¡é™¢åŠå…¬å…å‘å¸ƒçš„æ”¾å‡å®‰æ’ï¼ŒåŒ…å«è°ƒä¼‘åçš„å®é™…æ”¾å‡æ—¥æœŸ
            const holidays = {
                2024: [
                    // å…ƒæ—¦ï¼š1æœˆ1æ—¥
                    '1-1',
                    // æ˜¥èŠ‚ï¼š2æœˆ10æ—¥-17æ—¥ï¼ˆè°ƒä¼‘åçš„å®é™…æ”¾å‡æ—¥æœŸï¼‰
                    '2-10', '2-11', '2-12', '2-13', '2-14', '2-15', '2-16', '2-17',
                    // æ¸…æ˜èŠ‚ï¼š4æœˆ4æ—¥-6æ—¥
                    '4-4', '4-5', '4-6',
                    // åŠ³åŠ¨èŠ‚ï¼š5æœˆ1æ—¥-5æ—¥
                    '5-1', '5-2', '5-3', '5-4', '5-5',
                    // ç«¯åˆèŠ‚ï¼š6æœˆ10æ—¥
                    '6-10',
                    // ä¸­ç§‹èŠ‚ï¼š9æœˆ15æ—¥-17æ—¥
                    '9-15', '9-16', '9-17',
                    // å›½åº†èŠ‚ï¼š10æœˆ1æ—¥-7æ—¥
                    '10-1', '10-2', '10-3', '10-4', '10-5', '10-6', '10-7'
                ],
                2025: [
                    // å…ƒæ—¦ï¼š1æœˆ1æ—¥
                    '1-1',
                    // æ˜¥èŠ‚ï¼š1æœˆ28æ—¥-2æœˆ3æ—¥ï¼ˆé¢„è®¡ï¼‰
                    '1-28', '1-29', '1-30', '1-31', '2-1', '2-2', '2-3',
                    // æ¸…æ˜èŠ‚ï¼š4æœˆ5æ—¥-7æ—¥ï¼ˆé¢„è®¡ï¼‰
                    '4-5', '4-6', '4-7',
                    // åŠ³åŠ¨èŠ‚ï¼š5æœˆ1æ—¥-5æ—¥ï¼ˆé¢„è®¡ï¼‰
                    '5-1', '5-2', '5-3', '5-4', '5-5',
                    // ç«¯åˆèŠ‚ï¼š5æœˆ31æ—¥-6æœˆ2æ—¥ï¼ˆé¢„è®¡ï¼‰
                    '5-31', '6-1', '6-2',
                    // ä¸­ç§‹èŠ‚ï¼š10æœˆ6æ—¥-8æ—¥ï¼ˆé¢„è®¡ï¼‰
                    '10-6', '10-7', '10-8',
                    // å›½åº†èŠ‚ï¼š10æœˆ1æ—¥-7æ—¥
                    '10-1', '10-2', '10-3', '10-4', '10-5', '10-6', '10-7'
                ]
            };

            const yearHolidays = holidays[year];
            if (yearHolidays) {
                const dateStr = `${month}-${day}`;
                return yearHolidays.includes(dateStr);
            }

            return false;
        }

        function addWeeklyTodos(settings, startDate = new Date()) {
            const lines = settings.template.split('\n').filter(line => line.trim());

            // ä¸ºæ¥ä¸‹æ¥çš„7å¤©æ·»åŠ ä»»åŠ¡
            for (let dayOffset = 0; dayOffset < 7; dayOffset++) {
                const targetDate = new Date(startDate);
                targetDate.setDate(startDate.getDate() + dayOffset);
                const targetDateString = targetDate.toDateString();

                // æ£€æŸ¥æ˜¯å¦ä¸ºèŠ‚å‡æ—¥ï¼Œå¦‚æœå¼€å¯äº†è·³è¿‡èŠ‚å‡æ—¥è®¾ç½®ä¸”æ˜¯èŠ‚å‡æ—¥ï¼Œåˆ™è·³è¿‡
                if (settings.skipHolidays && isHoliday(targetDate)) {
                    console.log(`è·³è¿‡èŠ‚å‡æ—¥ä»»åŠ¡ç”Ÿæˆ: ${targetDateString}`);
                    continue;
                }
                
                lines.forEach(line => {
                    const parts = line.split('|');
                    if (parts.length >= 1) {
                        const title = parts[0].trim();
                        const priority = parts[1] ? parts[1].trim() : 'medium';
                        const category = parts[2] ? parts[2].trim() : 'other';
                        const timeStr = parts[3] ? parts[3].trim() : '23:59';
                        const assignee = parts[4] ? parts[4].trim() : '';

                        // æ™ºèƒ½é‡å¤æ£€æµ‹é€»è¾‘ï¼ˆåŒ…å«å®Œæˆäººæ£€æµ‹ï¼‰
                        const shouldSkipTask = checkDailyTaskDuplication(title, targetDateString, assignee);

                        if (!shouldSkipTask) {
                            // è§£ææˆªæ­¢æ—¶é—´
                            const deadline = new Date(targetDate);
                            if (timeStr && timeStr.includes(':')) {
                                const [hours, minutes] = timeStr.split(':').map(n => parseInt(n));
                                if (!isNaN(hours) && !isNaN(minutes) && hours >= 0 && hours <= 23 && minutes >= 0 && minutes <= 59) {
                                    deadline.setHours(hours, minutes, 0, 0);
                                } else {
                                    deadline.setHours(23, 59, 0, 0); // é»˜è®¤23:59
                                }
                            } else {
                                deadline.setHours(23, 59, 0, 0); // é»˜è®¤23:59
                            }
                            
                            const task = {
                                id: generateId(),
                                title: title,
                                notes: '',
                                completed: false,
                                priority: ['high', 'medium', 'low'].includes(priority) ? priority : 'medium',
                                category: ['work', 'life', 'study', 'other'].includes(category) ? category : 'other',
                                deadline: deadline.toISOString(),
                                createdAt: new Date().toISOString(),
                                completedAt: null,
                                assignee: assignee,
                                isDailyTodo: true // æ ‡è®°ä¸ºæ¯æ—¥å¾…åŠä»»åŠ¡
                            };
                            tasks.unshift(task);
                        }
                    }
                });
            }
        }

        function cleanupExpiredDailyTodos() {
            const today = new Date();
            today.setHours(0, 0, 0, 0); // è®¾ç½®ä¸ºä»Šå¤©å¼€å§‹
            
            // åˆ é™¤æ˜¨å¤©åŠæ›´æ—©çš„æœªå®Œæˆæ¯æ—¥å¾…åŠä»»åŠ¡
            const originalLength = tasks.length;
            tasks = tasks.filter(task => {
                // ä¿ç•™éæ¯æ—¥å¾…åŠä»»åŠ¡
                if (!task.isDailyTodo) return true;
                
                // ä¿ç•™å·²å®Œæˆçš„æ¯æ—¥å¾…åŠä»»åŠ¡
                if (task.completed) return true;
                
                // æ£€æŸ¥æˆªæ­¢æ—¥æœŸ
                if (task.deadline) {
                    const taskDate = new Date(task.deadline);
                    taskDate.setHours(0, 0, 0, 0);
                    
                    // ä¿ç•™ä»Šå¤©åŠä»¥åçš„ä»»åŠ¡
                    return taskDate >= today;
                }
                
                return true;
            });
            
            // å¦‚æœåˆ é™¤äº†ä»»åŠ¡ï¼Œä¿å­˜æ›´æ–°
            if (tasks.length !== originalLength) {
                saveTasks();
                console.log(`æ¸…ç†äº† ${originalLength - tasks.length} ä¸ªè¿‡æœŸçš„æ¯æ—¥å¾…åŠä»»åŠ¡`);
            }
        }

        function bindDailyTodoEvents() {
            const closeDailyTodoBtn = document.getElementById('closeDailyTodoBtn');
            const cancelDailyTodoBtn = document.getElementById('cancelDailyTodoBtn');
            const saveDailyTodoBtn = document.getElementById('saveDailyTodoBtn');
            const dailyTodoModal = document.getElementById('dailyTodoModal');

            if (closeDailyTodoBtn) {
                closeDailyTodoBtn.addEventListener('click', closeDailyTodoModal);
            }

            if (cancelDailyTodoBtn) {
                cancelDailyTodoBtn.addEventListener('click', closeDailyTodoModal);
            }

            if (saveDailyTodoBtn) {
                saveDailyTodoBtn.addEventListener('click', saveDailyTodoSettings);
            }

            if (dailyTodoModal) {
                dailyTodoModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeDailyTodoModal();
                    }
                });
            }
        }

        function bindWechatEvents() {
            const closeWechatBtn = document.getElementById('closeWechatBtn');
            const cancelWechatBtn = document.getElementById('cancelWechatBtn');
            const saveWechatBtn = document.getElementById('saveWechatBtn');
            const wechatModal = document.getElementById('wechatModal');

            if (closeWechatBtn) {
                closeWechatBtn.addEventListener('click', closeWechatModal);
            }

            if (cancelWechatBtn) {
                cancelWechatBtn.addEventListener('click', closeWechatModal);
            }

            if (saveWechatBtn) {
                saveWechatBtn.addEventListener('click', saveWechatSettings);
            }

            if (wechatModal) {
                wechatModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeWechatModal();
                    }
                });
            }
        }

        function bindAssigneeEvents() {
            const closeAssigneeBtn = document.getElementById('closeAssigneeBtn');
            const cancelAssigneeBtn = document.getElementById('cancelAssigneeBtn');
            const assigneeModal = document.getElementById('assigneeModal');
            const newAssigneeNameInput = document.getElementById('newAssigneeName');

            if (closeAssigneeBtn) {
                closeAssigneeBtn.addEventListener('click', closeAssigneeModal);
            }

            if (cancelAssigneeBtn) {
                cancelAssigneeBtn.addEventListener('click', closeAssigneeModal);
            }

            if (assigneeModal) {
                assigneeModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeAssigneeModal();
                    }
                });
            }

            // æ·»åŠ å›è½¦é”®æ”¯æŒ
            if (newAssigneeNameInput) {
                newAssigneeNameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addAssignee();
                    }
                });
            }
        }

        function bindDatabaseEvents() {
            const closeDatabaseBtn = document.getElementById('closeDatabaseBtn');
            const cancelDatabaseBtn = document.getElementById('cancelDatabaseBtn');
            const saveDatabaseBtn = document.getElementById('saveDatabaseBtn');
            const databaseModal = document.getElementById('databaseModal');

            if (closeDatabaseBtn) {
                closeDatabaseBtn.addEventListener('click', closeDatabaseModal);
            }

            if (cancelDatabaseBtn) {
                cancelDatabaseBtn.addEventListener('click', closeDatabaseModal);
            }

            if (saveDatabaseBtn) {
                saveDatabaseBtn.addEventListener('click', saveDatabaseSettings);
            }

            if (databaseModal) {
                databaseModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeDatabaseModal();
                    }
                });
            }
        }

        function bindCompleteTaskEvents() {
            const closeCompleteBtn = document.getElementById('closeCompleteBtn');
            const cancelCompleteBtn = document.getElementById('cancelCompleteBtn');
            const confirmCompleteBtn = document.getElementById('confirmCompleteBtn');
            const completeTaskModal = document.getElementById('completeTaskModal');

            if (closeCompleteBtn) {
                closeCompleteBtn.addEventListener('click', closeCompleteTaskModal);
            }

            if (cancelCompleteBtn) {
                cancelCompleteBtn.addEventListener('click', closeCompleteTaskModal);
            }

            if (confirmCompleteBtn) {
                confirmCompleteBtn.addEventListener('click', confirmCompleteTask);
            }

            if (completeTaskModal) {
                completeTaskModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeCompleteTaskModal();
                    }
                });
            }

            // ä¸ªäººä¿¡æ¯è®¾ç½®æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬
            const closePersonalInfoBtn = document.getElementById('closePersonalInfoBtn');
            const personalInfoModal = document.getElementById('personalInfoModal');

            if (closePersonalInfoBtn) {
                closePersonalInfoBtn.addEventListener('click', closePersonalInfoModal);
            }

            if (personalInfoModal) {
                personalInfoModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closePersonalInfoModal();
                    }
                });
            }

            // Android 14 ä¸“é—¨çš„å›¾ç‰‡ä¸Šä¼ äº‹ä»¶ç»‘å®š
            if (isAndroid14()) {
                bindAndroid14ImageUploadEvents();
            }
        }

        // Android 14 å›¾ç‰‡ä¸Šä¼ äº‹ä»¶ç»‘å®š
        function bindAndroid14ImageUploadEvents() {
            console.log('ç»‘å®šAndroid 14å›¾ç‰‡ä¸Šä¼ äº‹ä»¶');

            // ä¸ºä¸¤ä¸ªä¸Šä¼ åŒºåŸŸç»‘å®šäº‹ä»¶
            for (let i = 1; i <= 2; i++) {
                // ä½¿ç”¨ç±»é€‰æ‹©å™¨æŸ¥æ‰¾ä¸Šä¼ åŒºåŸŸ
                const uploadArea = document.querySelector(`.image-upload-area:nth-child(${i})`);
                const fileInput = document.getElementById(`completeImageInput${i}`);

                if (uploadArea && fileInput) {
                    console.log(`æ‰¾åˆ°ä¸Šä¼ åŒºåŸŸ${i}:`, uploadArea);
                    console.log(`æ‰¾åˆ°æ–‡ä»¶è¾“å…¥${i}:`, fileInput);

                    // ä¸éœ€è¦ç§»é™¤onclickï¼Œå› ä¸ºç°åœ¨åœ¨æ–‡å­—å…ƒç´ ä¸Š

                    // åˆ›å»ºä¸€ä¸ªæ›´ç›´æ¥çš„äº‹ä»¶å¤„ç†å™¨
                    const handleUploadClick = function(e) {
                        console.log(`Android 14: ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ${i}`);
                        e.preventDefault();
                        e.stopPropagation();

                        // ç«‹å³è§¦å‘æ–‡ä»¶é€‰æ‹©ï¼Œä¸ä½¿ç”¨å»¶è¿Ÿ
                        directTriggerFileSelect(i);
                    };

                    // æ·»åŠ å¤šç§äº‹ä»¶ç›‘å¬å™¨ç¡®ä¿å…¼å®¹æ€§
                    uploadArea.addEventListener('click', handleUploadClick, { passive: false });
                    uploadArea.addEventListener('touchend', handleUploadClick, { passive: false });

                    // ä¸ºæ•´ä¸ªä¸Šä¼ åŒºåŸŸæ·»åŠ å¯è®¿é—®æ€§å±æ€§
                    uploadArea.setAttribute('role', 'button');
                    uploadArea.setAttribute('tabindex', '0');
                    uploadArea.setAttribute('aria-label', `é€‰æ‹©å›¾ç‰‡${i}`);

                    // ä¸ºæ–‡ä»¶è¾“å…¥æ¡†æ·»åŠ ä¸“é—¨çš„äº‹ä»¶å¤„ç†
                    fileInput.addEventListener('change', function(e) {
                        console.log(`Android 14: æ–‡ä»¶é€‰æ‹©å˜åŒ–${i}`, e.target.files);
                        handleCompleteImageSelect(e, i);
                    });

                    console.log(`å·²ç»‘å®šç¬¬${i}ä¸ªä¸Šä¼ åŒºåŸŸçš„Android 14äº‹ä»¶`);
                } else {
                    console.warn(`æœªæ‰¾åˆ°ä¸Šä¼ åŒºåŸŸæˆ–æ–‡ä»¶è¾“å…¥${i}`);
                }
            }
        }

        // Android 14ä¸“ç”¨æ–‡ä»¶é€‰æ‹©å¤„ç†
        function handleAndroid14FileSelect(event, imageIndex) {
            console.log(`Android 14æ–‡ä»¶é€‰æ‹©å¤„ç†${imageIndex}:`, event.target.files);
            handleCompleteImageSelect(event, imageIndex);
        }

        // æ›´ç›´æ¥çš„æ–‡ä»¶é€‰æ‹©è§¦å‘æ–¹æ³•
        function directTriggerFileSelect(imageIndex) {
            console.log(`è§¦å‘æ–‡ä»¶é€‰æ‹©${imageIndex}`);

            // ä¼˜å…ˆä½¿ç”¨åŸå§‹input
            const input = document.getElementById(`completeImageInput${imageIndex}`);
            if (input) {
                input.click();
                return;
            }

            // å¦‚æœåŸå§‹inputä¸å­˜åœ¨ï¼Œå°è¯•Android 14ä¸“ç”¨input
            const android14Input = document.getElementById(`android14Input${imageIndex}`);
            if (android14Input) {
                android14Input.click();
            }
        }

        // åˆ›å»ºå¯è§çš„æ–‡ä»¶è¾“å…¥æ¡†ï¼ˆAndroid 14ä¸“ç”¨æ–¹æ¡ˆï¼‰
        function createVisibleFileInput(imageIndex) {
            console.log(`åˆ›å»ºå¯è§æ–‡ä»¶è¾“å…¥æ¡†${imageIndex}`);

            // åˆ›å»ºæ¨¡æ€è¦†ç›–å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 12000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            // åˆ›å»ºæ–‡ä»¶é€‰æ‹©å®¹å™¨
            const container = document.createElement('div');
            container.style.cssText = `
                background: white;
                padding: 20px;
                border-radius: 8px;
                text-align: center;
                max-width: 300px;
                width: 90%;
            `;

            // æ·»åŠ æ ‡é¢˜
            const title = document.createElement('div');
            title.textContent = `é€‰æ‹©å›¾ç‰‡${imageIndex}`;
            title.style.cssText = `
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 15px;
                color: #333;
            `;

            // åˆ›å»ºå¯è§çš„æ–‡ä»¶è¾“å…¥æ¡†
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*,image/jpeg,image/png,image/gif';
            fileInput.style.cssText = `
                width: 100%;
                padding: 10px;
                border: 2px solid #667eea;
                border-radius: 4px;
                margin-bottom: 15px;
                font-size: 16px;
                background: white;
            `;

            // æ·»åŠ æŒ‰é’®å®¹å™¨
            const buttonContainer = document.createElement('div');
            buttonContainer.style.cssText = `
                display: flex;
                gap: 10px;
                justify-content: center;
            `;

            // å–æ¶ˆæŒ‰é’®
            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'å–æ¶ˆ';
            cancelButton.style.cssText = `
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                background: #ccc;
                color: #333;
                font-size: 16px;
                cursor: pointer;
            `;

            // ç¡®è®¤æŒ‰é’®
            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'ç¡®è®¤é€‰æ‹©';
            confirmButton.style.cssText = `
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                background: #667eea;
                color: white;
                font-size: 16px;
                cursor: pointer;
            `;

            // äº‹ä»¶å¤„ç†
            let selectedFile = null;

            fileInput.addEventListener('change', function(e) {
                selectedFile = e.target.files[0];
                console.log('é€‰æ‹©äº†æ–‡ä»¶:', selectedFile);
                if (selectedFile) {
                    confirmButton.style.background = '#4CAF50';
                    confirmButton.textContent = `å·²é€‰æ‹©: ${selectedFile.name.substring(0, 20)}...`;
                }
            });

            cancelButton.addEventListener('click', function() {
                console.log('å–æ¶ˆæ–‡ä»¶é€‰æ‹©');
                document.body.removeChild(overlay);
            });

            confirmButton.addEventListener('click', function() {
                console.log('ç¡®è®¤æ–‡ä»¶é€‰æ‹©:', selectedFile);
                if (selectedFile) {
                    // åˆ›å»ºæ¨¡æ‹Ÿçš„changeäº‹ä»¶å¯¹è±¡
                    const mockEvent = {
                        target: {
                            files: [selectedFile]
                        }
                    };

                    // è°ƒç”¨å¤„ç†å‡½æ•°
                    handleCompleteImageSelect(mockEvent, imageIndex);
                }
                document.body.removeChild(overlay);
            });

            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });

            // ç»„è£…å…ƒç´ 
            buttonContainer.appendChild(cancelButton);
            buttonContainer.appendChild(confirmButton);

            container.appendChild(title);
            container.appendChild(fileInput);
            container.appendChild(buttonContainer);

            overlay.appendChild(container);
            document.body.appendChild(overlay);

            // è‡ªåŠ¨èšç„¦åˆ°æ–‡ä»¶è¾“å…¥æ¡†
            setTimeout(() => {
                fileInput.focus();
                fileInput.click();
            }, 100);
        }

        // Android 14 æ–‡ä»¶é€‰æ‹©è§¦å‘å‡½æ•°
        function triggerAndroid14FileSelect(imageIndex) {
            const input = document.getElementById(`completeImageInput${imageIndex}`);

            if (input) {
                console.log(`è§¦å‘Android 14æ–‡ä»¶é€‰æ‹©ï¼Œå›¾ç‰‡ç´¢å¼•: ${imageIndex}`);
                input.click();
            }
        }

        // æ£€æŸ¥Android 14æ–‡ä»¶è®¿é—®æƒé™
        function checkAndroid14FileAccess() {
            try {
                // æ£€æŸ¥åŸºæœ¬çš„æ–‡ä»¶APIå¯ç”¨æ€§
                if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {
                    console.warn('æ–‡ä»¶APIä¸å®Œæ•´');
                    return false;
                }

                // æ£€æŸ¥æ˜¯å¦åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­
                if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                    console.warn('éå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå¯èƒ½å½±å“æ–‡ä»¶è®¿é—®');
                }

                // æ£€æŸ¥ç”¨æˆ·æ¿€æ´»çŠ¶æ€ï¼ˆAndroid 14ä¸¥æ ¼è¦æ±‚ï¼‰
                if (window.navigator && window.navigator.userActivation && !window.navigator.userActivation.isActive) {
                    console.warn('ç”¨æˆ·æ¿€æ´»çŠ¶æ€æ— æ•ˆ');
                    return false;
                }

                return true;
            } catch (error) {
                console.error('æ–‡ä»¶è®¿é—®æ£€æŸ¥å¤±è´¥:', error);
                return false;
            }
        }

        // Android 14 è°ƒè¯•å‡½æ•°ï¼ˆå…¨å±€å¯ç”¨ï¼‰
        window.debugAndroid14Upload = function() {
            console.log('=== Android 14 ä¸Šä¼ è°ƒè¯•ä¿¡æ¯ ===');
            console.log('å½“å‰UserAgent:', navigator.userAgent);

            try {
                console.log('æ£€æµ‹åˆ°çš„Androidç‰ˆæœ¬:', getAndroidVersion());
                console.log('æ˜¯å¦ä¸ºAndroid 14:', isAndroid14());
            } catch (e) {
                console.error('Androidç‰ˆæœ¬æ£€æµ‹å‡½æ•°é”™è¯¯:', e);
            }

            console.log('bodyæ˜¯å¦æœ‰android-14-compatç±»:', document.body.classList.contains('android-14-compat'));

            // æ£€æŸ¥ä¸Šä¼ åŒºåŸŸ
            for (let i = 1; i <= 2; i++) {
                const uploadArea = document.querySelector(`.image-upload-area:nth-child(${i})`);
                const fileInput = document.getElementById(`completeImageInput${i}`);
                console.log(`ä¸Šä¼ åŒºåŸŸ${i}:`, uploadArea);
                console.log(`æ–‡ä»¶è¾“å…¥${i}:`, fileInput);

                if (uploadArea) {
                    console.log(`ä¸Šä¼ åŒºåŸŸ${i}äº‹ä»¶ç›‘å¬å™¨:`, getEventListeners ? getEventListeners(uploadArea) : 'æ— æ³•è·å–');
                }
            }

            // æ£€æŸ¥æ–‡ä»¶API
            console.log('File APIæ”¯æŒ:', {
                File: !!window.File,
                FileReader: !!window.FileReader,
                FileList: !!window.FileList,
                Blob: !!window.Blob,
                DataTransfer: !!window.DataTransfer
            });

            // æ£€æŸ¥ç”¨æˆ·æ¿€æ´»
            if (window.navigator && window.navigator.userActivation) {
                console.log('ç”¨æˆ·æ¿€æ´»çŠ¶æ€:', {
                    isActive: window.navigator.userActivation.isActive,
                    hasBeenActive: window.navigator.userActivation.hasBeenActive
                });
            }

            console.log('=== è°ƒè¯•ä¿¡æ¯ç»“æŸ ===');
        };

        // æ‰‹åŠ¨è§¦å‘ä¸Šä¼ ï¼ˆè°ƒè¯•ç”¨ï¼‰
        window.manualTriggerUpload = function(imageIndex) {
            console.log(`æ‰‹åŠ¨è§¦å‘ä¸Šä¼ ${imageIndex}`);
            try {
                if (isAndroid14()) {
                    console.log('ä½¿ç”¨Android 14ä¸“ç”¨ä¸Šä¼ æ–¹æ³•');
                    directTriggerFileSelect(imageIndex);
                } else {
                    console.log('ä½¿ç”¨æ ‡å‡†ä¸Šä¼ æ–¹æ³•');
                    selectCompleteImage(imageIndex);
                }
            } catch (e) {
                console.error('æ‰‹åŠ¨è§¦å‘ä¸Šä¼ å¤±è´¥:', e);
                // å¤‡ç”¨æ–¹æ³•
                try {
                    selectCompleteImage(imageIndex);
                } catch (e2) {
                    console.error('å¤‡ç”¨æ–¹æ³•ä¹Ÿå¤±è´¥:', e2);
                }
            }
        };

        // æµ‹è¯•Androidç‰ˆæœ¬æ£€æµ‹ï¼ˆå…¨å±€å¯ç”¨ï¼‰
        window.testAndroidDetection = function() {
            console.log('=== Androidç‰ˆæœ¬æ£€æµ‹æµ‹è¯• ===');
            console.log('UserAgent:', navigator.userAgent);

            try {
                const version = getAndroidVersion();
                const isA14 = isAndroid14();

                console.log('Androidç‰ˆæœ¬:', version);
                console.log('æ˜¯å¦ä¸ºAndroid 14+:', isA14);
                console.log('æ£€æµ‹ç»“æœ:', version >= 14 ? 'âœ… Android 14+' : 'âŒ éAndroid 14+');

                // æµ‹è¯•ç›¸å…³åŠŸèƒ½
                if (typeof directTriggerFileSelect === 'function') {
                    console.log('âœ… directTriggerFileSelect å‡½æ•°å­˜åœ¨');
                } else {
                    console.log('âŒ directTriggerFileSelect å‡½æ•°ä¸å­˜åœ¨');
                }

                if (typeof bindAndroid14ImageUploadEvents === 'function') {
                    console.log('âœ… bindAndroid14ImageUploadEvents å‡½æ•°å­˜åœ¨');
                } else {
                    console.log('âŒ bindAndroid14ImageUploadEvents å‡½æ•°ä¸å­˜åœ¨');
                }

            } catch (e) {
                console.error('Androidç‰ˆæœ¬æ£€æµ‹æµ‹è¯•å¤±è´¥:', e);
            }

            console.log('=== æµ‹è¯•ç»“æŸ ===');
        };

        // å¼ºåˆ¶å¯ç”¨Android 14åŸç”Ÿæ–‡ä»¶è¾“å…¥æ¨¡å¼ï¼ˆè°ƒè¯•ç”¨ï¼‰
        window.forceAndroid14NativeMode = function() {
            console.log('å¼ºåˆ¶å¯ç”¨Android 14åŸç”Ÿæ–‡ä»¶è¾“å…¥æ¨¡å¼');
            applyAndroid14UploadFix();
        };

        // æ‰‹åŠ¨åº”ç”¨ä¿®å¤ï¼ˆå…¨å±€å¯ç”¨ï¼‰
        window.fixAndroid14Upload = function() {
            console.log('æ‰‹åŠ¨åº”ç”¨Android 14ä¸Šä¼ ä¿®å¤');
            applyAndroid14UploadFix();
        };

        function bindImageViewEvents() {
            const closeImageViewBtn = document.getElementById('closeImageViewBtn');
            const imageViewModal = document.getElementById('imageViewModal');

            if (closeImageViewBtn) {
                closeImageViewBtn.addEventListener('click', closeImageViewModal);
            }

            if (imageViewModal) {
                imageViewModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeImageViewModal();
                    }
                });
            }
        }

        // æ‰¹é‡æ“ä½œç›¸å…³å‡½æ•°
        function toggleBatchMode() {
            if (isBatchMode) {
                exitBatchMode();
            } else {
                enterBatchMode();
            }
        }

        function enterBatchMode() {
            isBatchMode = true;
            selectedTasks.clear();

            // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®æ–‡å­—å’Œæ ·å¼
            const batchModeBtn = document.querySelector('.batch-mode-btn');
            if (batchModeBtn) {
                batchModeBtn.innerHTML = 'âŒ é€€å‡ºæ‰¹é‡';
                batchModeBtn.classList.add('active');
            }

            // åŒæ—¶æ›´æ–°æ–°çš„æ‰¹é‡æ¨¡å¼æŒ‰é’®
            updateBatchModeButton();

            // æ˜¾ç¤ºæ‰¹é‡æ“ä½œæ§åˆ¶åŒº
            const batchControls = document.getElementById('batchControls');
            if (batchControls) {
                batchControls.style.display = 'block';
            }

            // é‡æ–°æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨ä»¥æ˜¾ç¤ºå¤é€‰æ¡†
            renderTasks();
            updateSelectedCount();

            // ä¸ºæ‰¹é‡æ“ä½œæŒ‰é’®ç»‘å®šå¢å¼ºçš„äº‹ä»¶å¤„ç†å™¨
            bindBatchModeEvents();

            console.log('è¿›å…¥æ‰¹é‡æ“ä½œæ¨¡å¼');
        }

        function exitBatchMode() {
            isBatchMode = false;
            selectedTasks.clear();

            // æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®æ–‡å­—å’Œæ ·å¼
            const batchModeBtn = document.querySelector('.batch-mode-btn');
            if (batchModeBtn) {
                batchModeBtn.innerHTML = 'â˜‘ï¸ æ‰¹é‡æ“ä½œ';
                batchModeBtn.classList.remove('active');
            }

            // åŒæ—¶æ›´æ–°æ–°çš„æ‰¹é‡æ¨¡å¼æŒ‰é’®
            updateBatchModeButton();

            // éšè—æ‰¹é‡æ“ä½œæ§åˆ¶åŒº
            const batchControls = document.getElementById('batchControls');
            if (batchControls) {
                batchControls.style.display = 'none';
            }

            // é‡æ–°æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨éšè—å¤é€‰æ¡†
            renderTasks();

            console.log('é€€å‡ºæ‰¹é‡æ“ä½œæ¨¡å¼');
        }

        function updateSelectedCount() {
            const selectedCountElement = document.getElementById('selectedCount');
            if (selectedCountElement) {
                selectedCountElement.textContent = selectedTasks.size;
            }
        }

        function updateTaskSelection(taskId, selected) {
            const taskItem = document.querySelector(`[data-id="${taskId}"]`);
            if (taskItem) {
                if (selected) {
                    taskItem.classList.add('selected');
                } else {
                    taskItem.classList.remove('selected');
                }
            }
        }

        function selectAllTasks() {
            // è·å–å½“å‰æ˜¾ç¤ºçš„æ‰€æœ‰ä»»åŠ¡
            const visibleTasks = document.querySelectorAll('.task-item[data-id]');
            
            visibleTasks.forEach(taskItem => {
                const taskId = taskItem.getAttribute('data-id');
                selectedTasks.add(taskId);
                
                // æ›´æ–°å¤é€‰æ¡†çŠ¶æ€
                const checkbox = taskItem.querySelector('.batch-checkbox');
                if (checkbox) {
                    checkbox.checked = true;
                }
                
                // æ›´æ–°ä»»åŠ¡é¡¹æ ·å¼
                taskItem.classList.add('selected');
            });
            
            updateSelectedCount();
            console.log('å·²å…¨é€‰', selectedTasks.size, 'ä¸ªä»»åŠ¡');
        }

        function deselectAllTasks() {
            selectedTasks.clear();
            
            // æ›´æ–°æ‰€æœ‰å¤é€‰æ¡†çŠ¶æ€
            const checkboxes = document.querySelectorAll('.batch-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // ç§»é™¤æ‰€æœ‰é€‰ä¸­æ ·å¼
            const taskItems = document.querySelectorAll('.task-item');
            taskItems.forEach(item => {
                item.classList.remove('selected');
            });
            
            updateSelectedCount();
            console.log('å·²å–æ¶ˆå…¨é€‰');
        }

        function deleteSelectedTasks() {
            if (selectedTasks.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„ä»»åŠ¡');
                return;
            }

            const count = selectedTasks.size;

            function handleBatchDeleteConfirm(shouldDelete) {
                if (shouldDelete) {
                    console.log('ç”¨æˆ·ç¡®è®¤æ‰¹é‡åˆ é™¤ä»»åŠ¡ï¼Œæ•°é‡:', count);

                    // åˆ é™¤é€‰ä¸­çš„ä»»åŠ¡
                    const originalLength = tasks.length;
                    tasks = tasks.filter(task => !selectedTasks.has(task.id));

                    if (tasks.length < originalLength) {
                        console.log('æ‰¹é‡åˆ é™¤æˆåŠŸï¼ŒåŸé•¿åº¦:', originalLength, 'æ–°é•¿åº¦:', tasks.length);

                        // æ¸…ç©ºé€‰æ‹©
                        selectedTasks.clear();

                        // ä¿å­˜å¹¶æ›´æ–°æ˜¾ç¤º
                        saveTasks();
                        renderTasks();
                        updateStats();
                        updateSelectedCount();

                        alert(`å·²åˆ é™¤ ${count} ä¸ªä»»åŠ¡`);
                        console.log('æ‰¹é‡åˆ é™¤äº†', count, 'ä¸ªä»»åŠ¡');
                    } else {
                        console.error('æ‰¹é‡åˆ é™¤å¤±è´¥ï¼Œä»»åŠ¡æ•°é‡æœªå˜åŒ–');
                        alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                } else {
                    console.log('ç”¨æˆ·å–æ¶ˆæ‰¹é‡åˆ é™¤æ“ä½œ');
                }
            }

            // æ£€æµ‹Androidè®¾å¤‡å’Œç‰ˆæœ¬ï¼Œä½¿ç”¨é€‚å½“çš„ç¡®è®¤å¯¹è¯æ¡†
            const isAndroid = /Android/i.test(navigator.userAgent);
            const androidVersion = isAndroid ? parseFloat((navigator.userAgent.match(/Android ([\d.]+)/) || [])[1]) : 0;
            const forceCustomDialog = isAndroid && androidVersion >= 14;

            if (forceCustomDialog) {
                // Android 14+ å¼ºåˆ¶ä½¿ç”¨è‡ªå®šä¹‰å¯¹è¯æ¡†
                console.log('æ£€æµ‹åˆ°Android 14+ï¼Œæ‰¹é‡åˆ é™¤ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†');
                customConfirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${count} ä¸ªä»»åŠ¡å—ï¼Ÿ`, handleBatchDeleteConfirm);
                return;
            }

            // å…¶ä»–è®¾å¤‡å°è¯•ä½¿ç”¨åŸç”Ÿconfirm
            try {
                if (typeof confirm === 'function') {
                    console.log('ä½¿ç”¨åŸç”Ÿç¡®è®¤å¯¹è¯æ¡†è¿›è¡Œæ‰¹é‡åˆ é™¤');
                    const result = confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${count} ä¸ªä»»åŠ¡å—ï¼Ÿ`);
                    handleBatchDeleteConfirm(result);
                    return;
                }
            } catch (error) {
                console.error('åŸç”Ÿconfirmå¯¹è¯æ¡†å‡ºé”™:', error);
            }

            // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨è‡ªå®šä¹‰å¯¹è¯æ¡†
            console.log('ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†ä½œä¸ºæ‰¹é‡åˆ é™¤å¤‡ç”¨æ–¹æ¡ˆ');
            customConfirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${count} ä¸ªä»»åŠ¡å—ï¼Ÿ`, handleBatchDeleteConfirm);
        }

        function completeSelectedTasks() {
            if (selectedTasks.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦å®Œæˆçš„ä»»åŠ¡');
                return;
            }
            
            let completedCount = 0;
            const now = new Date().toISOString();
            
            // æ ‡è®°é€‰ä¸­çš„ä»»åŠ¡ä¸ºå·²å®Œæˆï¼ˆæ£€æŸ¥æƒé™ï¼‰
            tasks.forEach(task => {
                if (selectedTasks.has(task.id) && !task.completed) {
                    // æ£€æŸ¥æ˜¯å¦æœ‰æƒé™æ“ä½œæ­¤ä»»åŠ¡
                    let canOperate = true;
                    if (personalInfo.enableRoleRestriction && personalInfo.myAssignee) {
                        if (task.assignees && Array.isArray(task.assignees)) {
                            canOperate = task.assignees.length === 0 || task.assignees.includes(personalInfo.myAssignee);
                        } else {
                            canOperate = !task.assignee || task.assignee === personalInfo.myAssignee;
                        }
                    }

                    if (canOperate) {
                        task.completed = true;
                        task.completedAt = now;
                        completedCount++;
                    } else {
                        const assignedTo = task.assignees && task.assignees.length > 0 ? task.assignees.join(', ') : task.assignee;
                        console.log(`è·³è¿‡ä»»åŠ¡ "${task.title}"ï¼Œåˆ†é…ç»™äº† "${assignedTo}"`);
                    }
                }
            });
            
            if (completedCount > 0) {
                // æ¸…ç©ºé€‰æ‹©
                selectedTasks.clear();
                
                // ä¿å­˜å¹¶æ›´æ–°æ˜¾ç¤º
                saveTasks();
                renderTasks();
                updateStats();
                updateSelectedCount();
                
                alert(`å·²å®Œæˆ ${completedCount} ä¸ªä»»åŠ¡`);
                console.log('æ‰¹é‡å®Œæˆäº†', completedCount, 'ä¸ªä»»åŠ¡');
            } else {
                alert('æ‰€é€‰ä»»åŠ¡éƒ½å·²å®Œæˆ');
            }
        }

        // ========== å¾®ä¿¡é€šçŸ¥åŠŸèƒ½ ==========

        // å‘é€Serveré…±å¾®ä¿¡é€šçŸ¥
        async function sendWechatNotification(title, content) {
            const settings = getDailyTodoSettings();

            if (!settings.enableWechatNotify || !settings.serverChanKey) {
                console.log('å¾®ä¿¡é€šçŸ¥æœªå¯ç”¨æˆ–æœªé…ç½®SendKey');
                return false;
            }

            try {
                const url = `https://sctapi.ftqq.com/${settings.serverChanKey}.send`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        desp: content
                    })
                });

                const result = await response.json();
                console.log('å¾®ä¿¡é€šçŸ¥å‘é€ç»“æœ:', result);

                if (result.code === 0) {
                    console.log('å¾®ä¿¡é€šçŸ¥å‘é€æˆåŠŸ');
                    return true;
                } else {
                    console.error('å¾®ä¿¡é€šçŸ¥å‘é€å¤±è´¥:', result.message);
                    return false;
                }
            } catch (error) {
                console.error('å‘é€å¾®ä¿¡é€šçŸ¥æ—¶å‡ºé”™:', error);
                return false;
            }
        }

        // æ£€æŸ¥å¹¶å‘é€å®šæ—¶å¾®ä¿¡é€šçŸ¥
        function checkAndSendWechatNotification() {
            const settings = getDailyTodoSettings();
            if (!settings.enableWechatNotify || !settings.serverChanKey) return;

            const now = new Date();
            const currentTime = now.toTimeString().slice(0, 5); // HH:MMæ ¼å¼
            const today = now.toDateString();

            // æ£€æŸ¥æ˜¯å¦å·²ç»å‘é€è¿‡ä»Šå¤©çš„é€šçŸ¥
            const lastNotifyInfo = settings.lastNotifyInfo || {};
            const todayNotifyInfo = lastNotifyInfo[today] || { morning: false, evening: false };

            // æ£€æŸ¥æ˜¯å¦åˆ°äº†æ™¨æŠ¥æ—¶é—´
            const shouldSendMorning = currentTime >= settings.morningNotifyTime &&
                                    currentTime < addMinutesToTime(settings.morningNotifyTime, 5) &&
                                    !todayNotifyInfo.morning;

            // æ£€æŸ¥æ˜¯å¦åˆ°äº†æ™šæŠ¥æ—¶é—´
            const shouldSendEvening = currentTime >= settings.eveningNotifyTime &&
                                    currentTime < addMinutesToTime(settings.eveningNotifyTime, 5) &&
                                    !todayNotifyInfo.evening;

            if (shouldSendMorning) {
                const { title, content } = generateNotificationContent('morning');
                sendWechatNotification(title, content);

                // æ›´æ–°é€šçŸ¥è®°å½•
                todayNotifyInfo.morning = true;
                lastNotifyInfo[today] = todayNotifyInfo;
                settings.lastNotifyInfo = lastNotifyInfo;
                localStorage.setItem('dailyTodoSettings', JSON.stringify(settings));
            }

            if (shouldSendEvening) {
                const { title, content } = generateNotificationContent('evening');
                sendWechatNotification(title, content);

                // æ›´æ–°é€šçŸ¥è®°å½•
                todayNotifyInfo.evening = true;
                lastNotifyInfo[today] = todayNotifyInfo;
                settings.lastNotifyInfo = lastNotifyInfo;
                localStorage.setItem('dailyTodoSettings', JSON.stringify(settings));
            }

            // æ£€æŸ¥ä»»åŠ¡è¶…æ—¶æé†’ï¼ˆæˆªæ­¢æ—¶é—´å‰5åˆ†é’Ÿï¼‰
            checkTaskDeadlineReminders(settings);
        }

        // æ£€æŸ¥ä»»åŠ¡æˆªæ­¢æ—¶é—´æé†’
        function checkTaskDeadlineReminders(settings) {
            const now = new Date();
            const fiveMinutesLater = new Date(now.getTime() + 5 * 60 * 1000);

            // è·å–å³å°†åˆ°æœŸçš„ä»»åŠ¡ï¼ˆæœªå®Œæˆä¸”åœ¨5åˆ†é’Ÿå†…åˆ°æœŸï¼‰
            const upcomingDeadlineTasks = tasks.filter(task => {
                if (task.completed || !task.deadline) return false;

                const taskDeadline = new Date(task.deadline);
                // æ£€æŸ¥ä»»åŠ¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´åˆ°5åˆ†é’Ÿåä¹‹é—´åˆ°æœŸ
                return taskDeadline >= now && taskDeadline <= fiveMinutesLater;
            });

            if (upcomingDeadlineTasks.length === 0) return;

            // æ£€æŸ¥æ˜¯å¦å·²ç»ä¸ºè¿™äº›ä»»åŠ¡å‘é€è¿‡æé†’
            const reminderKey = 'taskDeadlineReminders';
            const sentReminders = JSON.parse(localStorage.getItem(reminderKey) || '{}');
            const today = now.toDateString();

            const newReminders = upcomingDeadlineTasks.filter(task => {
                const taskReminderKey = `${task.id}_${today}`;
                return !sentReminders[taskReminderKey];
            });

            if (newReminders.length === 0) return;

            // ç”Ÿæˆè¶…æ—¶æé†’é€šçŸ¥å†…å®¹
            const { title, content } = generateDeadlineReminderContent(newReminders);
            sendWechatNotification(title, content);

            // è®°å½•å·²å‘é€çš„æé†’
            newReminders.forEach(task => {
                const taskReminderKey = `${task.id}_${today}`;
                sentReminders[taskReminderKey] = true;
            });
            localStorage.setItem(reminderKey, JSON.stringify(sentReminders));

            console.log(`å‘é€äº† ${newReminders.length} ä¸ªä»»åŠ¡çš„æˆªæ­¢æ—¶é—´æé†’`);
        }

        // ç”Ÿæˆæˆªæ­¢æ—¶é—´æé†’é€šçŸ¥å†…å®¹
        function generateDeadlineReminderContent(tasks) {
            const title = `â° ä»»åŠ¡å³å°†åˆ°æœŸæé†’`;
            let content = `ğŸš¨ ä»¥ä¸‹ä»»åŠ¡å³å°†åœ¨5åˆ†é’Ÿå†…åˆ°æœŸï¼Œè¯·æŠ“ç´§æ—¶é—´å®Œæˆï¼\n\n`;

            tasks.forEach((task, index) => {
                const priority = task.priority === 'high' ? 'ğŸ”´' : task.priority === 'medium' ? 'ğŸŸ¡' : 'ğŸŸ¢';
                const category = getCategoryName(task.category);
                const deadline = task.deadline ? formatDeadline(task.deadline) : '';
                const assignee = task.assignees && task.assignees.length > 0 ? `ğŸ‘¤ ${task.assignees.join(', ')}` : task.assignee ? `ğŸ‘¤ ${task.assignee}` : 'ğŸ‘¤ æœªåˆ†é…';
                const timeLeft = getTimeUntilDeadline(task.deadline);

                content += `${index + 1}. ${priority} **${task.title}**\n`;
                content += `   - åˆ†ç±»ï¼š${category}\n`;
                content += `   - å®Œæˆäººï¼š${assignee}\n`;
                content += `   - æˆªæ­¢æ—¶é—´ï¼š${deadline}\n`;
                content += `   - å‰©ä½™æ—¶é—´ï¼š${timeLeft}\n`;
                if (task.notes) content += `   - å¤‡æ³¨ï¼š${task.notes}\n`;
                content += '\n';
            });

            content += `---\nâš¡ æ—¶é—´ç´§è¿«ï¼Œè¯·ç«‹å³å¤„ç†ï¼\n\nğŸ’¡ æ¥è‡ªæ‚¨çš„æ¯æ—¥å¾…åŠåŠ©æ‰‹`;

            return { title, content };
        }

        // è®¡ç®—è·ç¦»æˆªæ­¢æ—¶é—´è¿˜æœ‰å¤šé•¿æ—¶é—´
        function getTimeUntilDeadline(deadline) {
            if (!deadline) return '';

            const now = new Date();
            const deadlineDate = new Date(deadline);
            const timeDiff = deadlineDate - now;

            if (timeDiff <= 0) return 'å·²è¿‡æœŸ';

            const minutes = Math.ceil(timeDiff / (1000 * 60));
            if (minutes < 60) {
                return `${minutes}åˆ†é’Ÿ`;
            } else {
                const hours = Math.floor(minutes / 60);
                const remainingMinutes = minutes % 60;
                return remainingMinutes > 0 ? `${hours}å°æ—¶${remainingMinutes}åˆ†é’Ÿ` : `${hours}å°æ—¶`;
            }
        }

        // æ—¶é—´åŠ åˆ†é’Ÿè¾…åŠ©å‡½æ•°
        function addMinutesToTime(timeStr, minutes) {
            const [hours, mins] = timeStr.split(':').map(Number);
            const totalMins = hours * 60 + mins + minutes;
            const newHours = Math.floor(totalMins / 60) % 24;
            const newMins = totalMins % 60;
            return `${String(newHours).padStart(2, '0')}:${String(newMins).padStart(2, '0')}`;
        }

        // ç”Ÿæˆé€šçŸ¥å†…å®¹
        function generateNotificationContent(notifyType) {
            const now = new Date();
            const today = now.toDateString();

            // è·å–ä»Šæ—¥ä»»åŠ¡
            const todayTasks = tasks.filter(task => {
                if (!task.deadline || task.completed) return false;
                const taskDate = new Date(task.deadline).toDateString();
                return taskDate === today;
            });

            // è·å–ä»Šæ—¥å·²å®Œæˆä»»åŠ¡
            const todayCompletedTasks = tasks.filter(task => {
                if (!task.completed || !task.completedAt) return false;
                const completedDate = new Date(task.completedAt).toDateString();
                return completedDate === today;
            });

            // è·å–é€¾æœŸä»»åŠ¡
            const overdueTasks = tasks.filter(task => {
                if (!task.deadline || task.completed) return false;
                const taskDate = new Date(task.deadline);
                return taskDate < now;
            });

            const timeLabel = notifyType === 'morning' ? 'æ™¨æŠ¥' : 'æ™šæŠ¥';
            const greeting = notifyType === 'morning' ? 'æ—©ä¸Šå¥½ï¼' : 'æ™šä¸Šå¥½ï¼';
            const timeEmoji = notifyType === 'morning' ? 'ğŸŒ…' : 'ğŸŒ™';

            let title = `${timeEmoji} æ¯æ—¥å¾…åŠ${timeLabel}`;
            let content = `${greeting}ä»¥ä¸‹æ˜¯æ‚¨çš„ä»»åŠ¡æé†’ï¼š\n\n`;

            // ä»Šæ—¥ä»»åŠ¡éƒ¨åˆ†
            if (todayTasks.length > 0) {
                content += `## ğŸ“… ä»Šæ—¥ä»»åŠ¡ (${todayTasks.length}é¡¹)\n\n`;
                todayTasks.forEach((task, index) => {
                    const priority = task.priority === 'high' ? 'ğŸ”´' : task.priority === 'medium' ? 'ğŸŸ¡' : 'ğŸŸ¢';
                    const category = getCategoryName(task.category);
                    const deadline = task.deadline ? formatDeadline(task.deadline) : '';
                    const assignee = task.assignees && task.assignees.length > 0 ? `ğŸ‘¤ ${task.assignees.join(', ')}` : task.assignee ? `ğŸ‘¤ ${task.assignee}` : 'ğŸ‘¤ æœªåˆ†é…';
                    content += `${index + 1}. ${priority} **${task.title}**\n`;
                    content += `   - åˆ†ç±»ï¼š${category}\n`;
                    content += `   - å®Œæˆäººï¼š${assignee}\n`;
                    if (deadline) content += `   - æˆªæ­¢ï¼š${deadline}\n`;
                    if (task.notes) content += `   - å¤‡æ³¨ï¼š${task.notes}\n`;
                    content += '\n';
                });
            } else {
                content += `## ğŸ“… ä»Šæ—¥ä»»åŠ¡\n\nâœ¨ ä»Šæ—¥æ— å¾…åŠä»»åŠ¡ï¼Œäº«å—è½»æ¾æ—¶å…‰ï¼\n\n`;
            }

            // é€¾æœŸä»»åŠ¡éƒ¨åˆ†
            if (overdueTasks.length > 0) {
                content += `## âš ï¸ é€¾æœŸä»»åŠ¡ (${overdueTasks.length}é¡¹)\n\n`;
                overdueTasks.forEach((task, index) => {
                    const priority = task.priority === 'high' ? 'ğŸ”´' : task.priority === 'medium' ? 'ğŸŸ¡' : 'ğŸŸ¢';
                    const category = getCategoryName(task.category);
                    const deadline = task.deadline ? formatDeadline(task.deadline) : '';
                    const assignee = task.assignees && task.assignees.length > 0 ? `ğŸ‘¤ ${task.assignees.join(', ')}` : task.assignee ? `ğŸ‘¤ ${task.assignee}` : 'ğŸ‘¤ æœªåˆ†é…';
                    content += `${index + 1}. ${priority} **${task.title}**\n`;
                    content += `   - åˆ†ç±»ï¼š${category}\n`;
                    content += `   - å®Œæˆäººï¼š${assignee}\n`;
                    if (deadline) content += `   - æˆªæ­¢ï¼š${deadline}\n`;
                    if (task.notes) content += `   - å¤‡æ³¨ï¼š${task.notes}\n`;
                    content += '\n';
                });
            } else {
                content += `## âš ï¸ é€¾æœŸä»»åŠ¡\n\nâœ… æ— é€¾æœŸä»»åŠ¡ï¼\n\n`;
            }

            // ä»Šæ—¥å®Œæˆä»»åŠ¡éƒ¨åˆ†
            if (todayCompletedTasks.length > 0) {
                content += `## âœ… ä»Šæ—¥å®Œæˆä»»åŠ¡ (${todayCompletedTasks.length}é¡¹)\n\n`;
                todayCompletedTasks.forEach((task, index) => {
                    const priority = task.priority === 'high' ? 'ğŸ”´' : task.priority === 'medium' ? 'ğŸŸ¡' : 'ğŸŸ¢';
                    const category = getCategoryName(task.category);
                    const assignee = task.assignees && task.assignees.length > 0 ? `ğŸ‘¤ ${task.assignees.join(', ')}` : task.assignee ? `ğŸ‘¤ ${task.assignee}` : 'ğŸ‘¤ æœªåˆ†é…';
                    const completedTime = task.completedAt ? formatRelativeTime(task.completedAt) : '';
                    content += `${index + 1}. ${priority} **${task.title}**\n`;
                    content += `   - åˆ†ç±»ï¼š${category}\n`;
                    content += `   - å®Œæˆäººï¼š${assignee}\n`;
                    if (completedTime) content += `   - å®Œæˆæ—¶é—´ï¼š${completedTime}\n`;
                    content += '\n';
                });
            } else {
                content += `## âœ… ä»Šæ—¥å®Œæˆä»»åŠ¡\n\nğŸ˜´ ä»Šæ—¥è¿˜æ²¡æœ‰å®Œæˆä»»åŠ¡ï¼Œç»§ç»­åŠ æ²¹ï¼\n\n`;
            }

            // ç»Ÿè®¡ä¿¡æ¯
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            const todayRate = (todayTasks.length + todayCompletedTasks.length) > 0 ?
                Math.round((todayCompletedTasks.length / (todayTasks.length + todayCompletedTasks.length)) * 100) : 0;

            content += `## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯\n\n`;
            content += `- æ€»ä»»åŠ¡ï¼š${totalTasks}é¡¹\n`;
            content += `- å·²å®Œæˆï¼š${completedTasks}é¡¹\n`;
            content += `- æ€»å®Œæˆç‡ï¼š${completionRate}%\n`;
            content += `- ä»Šæ—¥å®Œæˆï¼š${todayCompletedTasks.length}é¡¹\n`;
            content += `- ä»Šæ—¥å®Œæˆç‡ï¼š${todayRate}%\n\n`;

            const motivationalMessage = notifyType === 'morning' ?
                'ğŸŒŸ æ–°çš„ä¸€å¤©ï¼ŒåŠ æ²¹ï¼' :
                'ğŸŒ™ è¾›è‹¦äº†ä¸€å¤©ï¼Œç»§ç»­ä¿æŒï¼';

            content += `---\n${motivationalMessage}\n\nğŸ’¡ æ¥è‡ªæ‚¨çš„æ¯æ—¥å¾…åŠåŠ©æ‰‹`;

            return { title, content };
        }

        // æ·»åŠ æµ‹è¯•å¾®ä¿¡é€šçŸ¥çš„æŒ‰é’®åŠŸèƒ½
        function testWechatNotification() {
            const settings = getDailyTodoSettings();
            if (!settings.serverChanKey) {
                alert('è¯·å…ˆè®¾ç½®Serveré…±çš„SendKey');
                return;
            }
            if (!settings.enableWechatNotify) {
                alert('è¯·å…ˆå¯ç”¨å¾®ä¿¡é€šçŸ¥');
                return;
            }

            const { title, content } = generateNotificationContent('morning');
            sendWechatNotification(title, content);
            alert('æµ‹è¯•æ™¨æ™šæŠ¥å·²å‘é€ï¼Œè¯·æ£€æŸ¥å¾®ä¿¡');
        }

        // æµ‹è¯•è¶…æ—¶æé†’åŠŸèƒ½
        function testDeadlineReminder() {
            const settings = getDailyTodoSettings();
            if (!settings.serverChanKey) {
                alert('è¯·å…ˆè®¾ç½®Serveré…±çš„SendKey');
                return;
            }
            if (!settings.enableWechatNotify) {
                alert('è¯·å…ˆå¯ç”¨å¾®ä¿¡é€šçŸ¥');
                return;
            }

            // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„å³å°†åˆ°æœŸä»»åŠ¡ç”¨äºæµ‹è¯•
            const mockTask = {
                id: 'test_' + Date.now(),
                title: 'æµ‹è¯•ä»»åŠ¡ - å³å°†åˆ°æœŸ',
                priority: 'high',
                category: 'work',
                assignee: 'æµ‹è¯•ç”¨æˆ·',
                deadline: new Date(Date.now() + 3 * 60 * 1000).toISOString(), // 3åˆ†é’Ÿååˆ°æœŸ
                notes: 'è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•è¶…æ—¶æé†’çš„ä»»åŠ¡',
                completed: false
            };

            const { title, content } = generateDeadlineReminderContent([mockTask]);
            sendWechatNotification(title, content);
            alert('æµ‹è¯•è¶…æ—¶æé†’å·²å‘é€ï¼Œè¯·æ£€æŸ¥å¾®ä¿¡');
        }

        // å¯åŠ¨å®šæ—¶æ£€æŸ¥å¾®ä¿¡é€šçŸ¥
        function startNotificationScheduler() {
            // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦å‘é€é€šçŸ¥
            setInterval(() => {
                checkAndSendWechatNotification();
            }, 60000); // 60ç§’æ£€æŸ¥ä¸€æ¬¡
        }

        // ========== å®šæ—¶æ•°æ®åŒæ­¥åŠŸèƒ½ ==========

        let syncTimer = null;
        let syncInterval = 5 * 60 * 1000; // é»˜è®¤5åˆ†é’ŸåŒæ­¥ä¸€æ¬¡

        // å¯åŠ¨å®šæ—¶æ•°æ®åŒæ­¥
        function startDataSyncScheduler() {
            // æ¸…é™¤ç°æœ‰å®šæ—¶å™¨
            if (syncTimer) {
                clearInterval(syncTimer);
            }

            // è®¾ç½®æ–°çš„å®šæ—¶å™¨
            syncTimer = setInterval(async () => {
                if (syncStatus.isOnline && !syncStatus.syncInProgress) {
                    console.log('å®šæ—¶åŒæ­¥æ•°æ®...');
                    try {
                        // ç›´æ¥æ£€æŸ¥æœåŠ¡å™¨æ•°æ®å¹¶è¦†ç›–æœ¬åœ°æ•°æ®
                        await checkForUpdatesFromServer();
                    } catch (error) {
                        console.error('å®šæ—¶åŒæ­¥å¤±è´¥:', error);
                    }
                }
            }, syncInterval);

            console.log(`å®šæ—¶æ•°æ®åŒæ­¥å·²å¯åŠ¨ï¼Œé—´éš”: ${syncInterval / 1000}ç§’`);
        }

        // åœæ­¢å®šæ—¶æ•°æ®åŒæ­¥
        function stopDataSyncScheduler() {
            if (syncTimer) {
                clearInterval(syncTimer);
                syncTimer = null;
                console.log('å®šæ—¶æ•°æ®åŒæ­¥å·²åœæ­¢');
            }
        }

        // è®¾ç½®åŒæ­¥é—´éš”
        function setSyncInterval(intervalInMinutes) {
            syncInterval = intervalInMinutes * 60 * 1000;
            console.log(`åŒæ­¥é—´éš”å·²è®¾ç½®ä¸º: ${intervalInMinutes}åˆ†é’Ÿ`);

            // é‡å¯å®šæ—¶å™¨ä»¥åº”ç”¨æ–°é—´éš”
            if (syncTimer) {
                startDataSyncScheduler();
            }
        }

        // æ£€æŸ¥æœåŠ¡å™¨æ›´æ–°
        async function checkForUpdatesFromServer() {
            if (!DATABASE_CONFIG.binId || !syncStatus.isOnline) {
                return;
            }

            try {
                const response = await fetch(`${DATABASE_CONFIG.baseUrl}/${DATABASE_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': DATABASE_CONFIG.apiKey
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const serverTasks = data.record.tasks || [];
                    const serverLastModified = data.record.lastModified;

                    // æ•°æ®åº“æ•°æ®å§‹ç»ˆè¦†ç›–æœ¬åœ°æ•°æ®
                    console.log('åŒæ­¥æ•°æ®å®Œæˆ...');

                    const oldTasksLength = tasks.length;
                    tasks = serverTasks;

                    // ä¿å­˜åˆ°æœ¬åœ°
                    saveTasksToLocal();

                    // æ›´æ–°ç•Œé¢
                    renderTasks();
                    updateStats();

                    console.log(`æ•°æ®å·²è¦†ç›–: ${oldTasksLength} -> ${tasks.length} ä¸ªä»»åŠ¡`);

                    // æ˜¾ç¤ºåŒæ­¥æç¤º
                    showSyncNotification(`æ•°æ®å·²ä»æ•°æ®åº“åŒæ­¥ (${tasks.length}ä¸ªä»»åŠ¡)`);
                }
            } catch (error) {
                console.error('æ£€æŸ¥æœåŠ¡å™¨æ›´æ–°å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºåŒæ­¥é€šçŸ¥
        function showSyncNotification(message) {
            // åˆ›å»ºä¸€ä¸ªç®€å•çš„é€šçŸ¥æç¤º
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4caf50;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 12000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                animation: slideInRight 0.3s ease-out;
            `;
            notification.textContent = message;

            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.querySelector('#sync-notification-style')) {
                const style = document.createElement('style');
                style.id = 'sync-notification-style';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        function handleVisibilityChange() {
            if (document.hidden) {
                // é¡µé¢ä¸å¯è§æ—¶åœæ­¢å®šæ—¶åŒæ­¥ä»¥èŠ‚çœèµ„æº
                console.log('é¡µé¢ä¸å¯è§ï¼Œæš‚åœå®šæ—¶åŒæ­¥');
                stopDataSyncScheduler();
            } else {
                // é¡µé¢å¯è§æ—¶æ¢å¤å®šæ—¶åŒæ­¥å¹¶ç«‹å³æ£€æŸ¥æ›´æ–°
                console.log('é¡µé¢å¯è§ï¼Œæ¢å¤å®šæ—¶åŒæ­¥');
                startDataSyncScheduler();

                // ç«‹å³æ£€æŸ¥ä¸€æ¬¡æ›´æ–°
                if (syncStatus.isOnline) {
                    setTimeout(() => {
                        checkForUpdatesFromServer();
                    }, 1000);
                }
            }
        }

        // æŠ˜å åŠŸèƒ½
        function toggleFilterSection() {
            const content = document.getElementById('filterContent');
            const icon = document.getElementById('filterCollapseIcon');
            const taskList = document.getElementById('taskList');
            const taskView = document.getElementById('taskView');
            const viewContainer = document.querySelector('.view-container');

            console.log('toggleFilterSection called', {
                content: !!content,
                icon: !!icon,
                taskList: !!taskList,
                taskView: !!taskView,
                viewContainer: !!viewContainer
            });

            if (content && icon) {
                const isCollapsed = content.classList.contains('collapsed');
                console.log('isCollapsed:', isCollapsed);

                const isMobile = window.innerWidth <= 768;
                const isSmallMobile = window.innerWidth <= 480;

                if (isCollapsed) {
                    content.classList.remove('collapsed');
                    icon.classList.remove('collapsed');
                    icon.textContent = 'â–¼';
                    // å±•å¼€æ—¶ï¼Œå‡å°‘å„å®¹å™¨é«˜åº¦ä»¥å……åˆ†åˆ©ç”¨ç©ºé—´
                    if (taskList) {
                        if (isSmallMobile) {
                            taskList.style.maxHeight = 'calc(100vh - 320px)';
                        } else if (isMobile) {
                            taskList.style.maxHeight = 'calc(100vh - 340px)';
                        } else {
                            taskList.style.maxHeight = 'calc(100vh - 400px)';
                        }
                        console.log('å±•å¼€ï¼šè®¾ç½®task-listé«˜åº¦');
                    }
                    // if (taskView) {
                    //     if (isSmallMobile) {
                    //         taskView.style.height = 'auto';
                    //     } else if (isMobile) {
                    //         taskView.style.height = 'auto';
                    //     } else {
                    //         taskView.style.height = 'auto';
                    //     }
                    //     console.log('æŠ˜å ï¼šè®¾ç½®taskViewé«˜åº¦');
                    // }

                    // è°ƒæ•´task-itemé«˜åº¦
                    adjustTaskItemHeight('compact');
                } else {
                    content.classList.add('collapsed');
                    icon.classList.add('collapsed');
                    icon.textContent = 'â–¶';
                    // æŠ˜å æ—¶ï¼Œå¢åŠ å„å®¹å™¨é«˜åº¦ä»¥å……åˆ†åˆ©ç”¨ç©ºé—´
                    if (taskList) {
                        if (isSmallMobile) {
                            taskList.style.maxHeight = 'calc(100vh - 260px)';
                        } else if (isMobile) {
                            taskList.style.maxHeight = 'calc(100vh - 280px)';
                        } else {
                            taskList.style.maxHeight = 'calc(100vh - 350px)';
                        }
                        console.log('æŠ˜å ï¼šè®¾ç½®task-listé«˜åº¦');
                    }
                    // if (taskView) {
                    //     if (isSmallMobile) {
                    //         taskView.style.height = '100vh';
                    //     } else if (isMobile) {
                    //         taskView.style.height = '100vh';
                    //     } else {
                    //         taskView.style.height = '100vh';
                    //     }
                    //     console.log('æŠ˜å ï¼šè®¾ç½®taskViewé«˜åº¦');
                    // }
                    // if (viewContainer) {
                    //     if (isSmallMobile) {
                    //         viewContainer.style.height = '100vh';
                    //     } else if (isMobile) {
                    //         viewContainer.style.height = '100vh';
                    //     } else {
                    //         viewContainer.style.height = '100vh';
                    //     }
                    //     console.log('æŠ˜å ï¼šè®¾ç½®viewContaineré«˜åº¦');
                    // }

                    // è°ƒæ•´task-itemé«˜åº¦
                    adjustTaskItemHeight('normal');
                }

                // ä¿å­˜æŠ˜å çŠ¶æ€ï¼ˆæš‚æ—¶ä¿ç•™ä»¥å…¼å®¹ï¼‰
                localStorage.setItem('filterSectionCollapsed', !isCollapsed);
            }
        }

        // ç®€åŒ–ç‰ˆæœ¬ - ç­›é€‰å¤´éƒ¨å·²ç§»é™¤ï¼Œä½†ä¿ç•™å‡½æ•°ä»¥å…¼å®¹
        function toggleFilterSection() {
            console.log('toggleFilterSection: ç­›é€‰å¤´éƒ¨å·²ç§»é™¤ï¼Œä½¿ç”¨ toggleCollapsibleRows() æ›¿ä»£è¡Œçº§æŠ˜å ');
        }

        // è°ƒæ•´task-itemé«˜åº¦çš„è¾…åŠ©å‡½æ•° - ç§»åŠ¨ç«¯è‡ªé€‚åº”
        function adjustTaskItemHeight(mode) {
            const taskItems = document.querySelectorAll('.task-item');
            const taskList = document.getElementById('taskList');

            taskItems.forEach(item => {
                // æ¸…é™¤ä¹‹å‰çš„å†…è”æ ·å¼ï¼Œè®©CSSåª’ä½“æŸ¥è¯¢ç”Ÿæ•ˆ
                item.style.padding = '';

                // æ ¹æ®å±å¹•å°ºå¯¸å’Œæ¨¡å¼è®¾ç½®padding
                const isMobile = window.innerWidth <= 768;
                const isSmallMobile = window.innerWidth <= 480;

                if (mode === 'compact') {
                    if (isSmallMobile) {
                        item.style.padding = '8px 14px'; /* å°å±å¹•ç´§å‡‘æ¨¡å¼ */
                    } else if (isMobile) {
                        item.style.padding = '10px 16px'; /* ç§»åŠ¨ç«¯ç´§å‡‘æ¨¡å¼ */
                    } else {
                        item.style.padding = '12px 20px';
                    }
                    console.log('è®¾ç½®task-itemä¸ºç´§å‡‘æ¨¡å¼');
                } else {
                    if (isSmallMobile) {
                        item.style.padding = '25px 20px'; /* å°å±å¹•æ­£å¸¸æ¨¡å¼ */
                    } else if (isMobile) {
                        item.style.padding = '25px 20px'; /* ç§»åŠ¨ç«¯æ­£å¸¸æ¨¡å¼ */
                    } else {
                        item.style.padding = '25px 20px';
                    }
                    console.log('è®¾ç½®task-itemä¸ºæ­£å¸¸æ¨¡å¼');
                }
            });

            // åŒæ—¶è°ƒæ•´task-listé«˜åº¦ä»¥é€‚åº”ç§»åŠ¨ç«¯
            if (taskList) {
                const isMobile = window.innerWidth <= 768;
                const isSmallMobile = window.innerWidth <= 480;

                if (mode === 'compact') {
                    if (isSmallMobile) {
                        taskList.style.maxHeight = 'calc(100vh - 260px)'; /* å°å±å¹•ç´§å‡‘æ¨¡å¼ */
                    } else if (isMobile) {
                        taskList.style.maxHeight = 'calc(100vh - 280px)'; /* ç§»åŠ¨ç«¯ç´§å‡‘æ¨¡å¼ */
                    } else {
                        taskList.style.maxHeight = 'calc(100vh - 350px)';
                    }
                } else {
                    if (isSmallMobile) {
                        taskList.style.maxHeight = 'calc(100vh - 240px)'; /* å°å±å¹•æ­£å¸¸æ¨¡å¼ */
                    } else if (isMobile) {
                        taskList.style.maxHeight = 'calc(100vh - 260px)'; /* ç§»åŠ¨ç«¯æ­£å¸¸æ¨¡å¼ */
                    } else {
                        taskList.style.maxHeight = 'calc(100vh - 330px)';
                    }
                }
            }
        }

        function toggleFunctionSection() {
            const content = document.getElementById('functionContent');
            const icon = document.getElementById('functionCollapseIcon');

            if (content && icon) {
                const isCollapsed = content.classList.contains('collapsed');

                if (isCollapsed) {
                    content.classList.remove('collapsed');
                    icon.classList.remove('collapsed');
                    icon.textContent = 'â–¼';
                } else {
                    content.classList.add('collapsed');
                    icon.classList.add('collapsed');
                    icon.textContent = 'â–¶';
                }

                // ä¿å­˜æŠ˜å çŠ¶æ€
                localStorage.setItem('functionSectionCollapsed', !isCollapsed);
            }
        }

        function toggleSettingsSection() {
            const content = document.getElementById('settingsContent');
            const icon = document.getElementById('settingsCollapseIcon');

            if (content && icon) {
                const isCollapsed = content.classList.contains('collapsed');

                if (isCollapsed) {
                    content.classList.remove('collapsed');
                    icon.classList.remove('collapsed');
                    icon.textContent = 'â–¼';
                } else {
                    content.classList.add('collapsed');
                    icon.classList.add('collapsed');
                    icon.textContent = 'â–¶';
                }

                // ä¿å­˜æŠ˜å çŠ¶æ€
                localStorage.setItem('settingsSectionCollapsed', !isCollapsed);
            }
        }

        // æ¢å¤æŠ˜å çŠ¶æ€
        function restoreCollapsedStates() {
            const taskList = document.getElementById('taskList');

            // æ¢å¤ç­›é€‰åŒºåŸŸçŠ¶æ€
            const filterCollapsed = localStorage.getItem('filterSectionCollapsed') === 'true';
            if (filterCollapsed) {
                const filterContent = document.getElementById('filterContent');
                const filterIcon = document.getElementById('filterCollapseIcon');
                if (filterContent && filterIcon) {
                    filterContent.classList.add('collapsed');
                    filterIcon.classList.add('collapsed');
                    filterIcon.textContent = 'â–¶';
                    // æŠ˜å æ—¶ï¼Œå¢åŠ task-listé«˜åº¦
                    if (taskList) {
                        const isMobile = window.innerWidth <= 768;
                        const isSmallMobile = window.innerWidth <= 480;
                        if (isSmallMobile) {
                            taskList.style.maxHeight = 'calc(100vh - 260px)';
                        } else if (isMobile) {
                            taskList.style.maxHeight = 'calc(100vh - 280px)';
                        } else {
                            taskList.style.maxHeight = 'calc(100vh - 350px)';
                        }
                        console.log('é¡µé¢åŠ è½½ï¼šç­›é€‰å™¨æŠ˜å ï¼Œè®¾ç½®task-listé«˜åº¦');
                    }
                    // è®¾ç½®task-itemä¸ºæ­£å¸¸æ¨¡å¼
                    adjustTaskItemHeight('normal');
                }
            } else {
                // å±•å¼€æ—¶ï¼Œä½¿ç”¨é»˜è®¤é«˜åº¦
                if (taskList) {
                    const isMobile = window.innerWidth <= 768;
                    const isSmallMobile = window.innerWidth <= 480;
                    if (isSmallMobile) {
                        taskList.style.maxHeight = 'calc(100vh - 320px)';
                    } else if (isMobile) {
                        taskList.style.maxHeight = 'calc(100vh - 340px)';
                    } else {
                        taskList.style.maxHeight = 'calc(100vh - 400px)';
                    }
                    console.log('é¡µé¢åŠ è½½ï¼šç­›é€‰å™¨å±•å¼€ï¼Œè®¾ç½®task-listé«˜åº¦');
                }
                // è®¾ç½®task-itemä¸ºç´§å‡‘æ¨¡å¼
                adjustTaskItemHeight('compact');
            }

            // æ¢å¤åŠŸèƒ½åŒºåŸŸçŠ¶æ€
            const functionCollapsed = localStorage.getItem('functionSectionCollapsed') === 'true';
            if (functionCollapsed) {
                const functionContent = document.getElementById('functionContent');
                const functionIcon = document.getElementById('functionCollapseIcon');
                if (functionContent && functionIcon) {
                    functionContent.classList.add('collapsed');
                    functionIcon.classList.add('collapsed');
                    functionIcon.textContent = 'â–¶';
                }
            }

            // æ¢å¤è®¾ç½®åŒºåŸŸçŠ¶æ€
            const settingsCollapsed = localStorage.getItem('settingsSectionCollapsed') === 'true';
            if (settingsCollapsed) {
                const settingsContent = document.getElementById('settingsContent');
                const settingsIcon = document.getElementById('settingsCollapseIcon');
                if (settingsContent && settingsIcon) {
                    settingsContent.classList.add('collapsed');
                    settingsIcon.classList.add('collapsed');
                    settingsIcon.textContent = 'â–¶';
                }
            }
        }

        // æ‰¹é‡æ¨¡å¼äº‹ä»¶ç»‘å®šå‡½æ•° - Android 14 å…¼å®¹æ€§ä¼˜åŒ–
        function bindBatchModeEvents() {
            const isAndroid = /Android/i.test(navigator.userAgent);
            const androidVersion = isAndroid ? parseFloat((navigator.userAgent.match(/Android ([\d.]+)/) || [])[1]) : 0;
            const needsAndroidOptimization = isAndroid && androidVersion >= 14;

            console.log('ç»‘å®šæ‰¹é‡æ¨¡å¼äº‹ä»¶ï¼ŒAndroid 14ä¼˜åŒ–:', needsAndroidOptimization);

            // è·å–æ‰€æœ‰æ‰¹é‡æ“ä½œæŒ‰é’®
            const batchButtons = document.querySelectorAll('.batch-btn');

            batchButtons.forEach(button => {
                // ç§»é™¤ç°æœ‰äº‹ä»¶ç›‘å¬å™¨
                const oldClickHandler = button._batchClickHandler;
                const oldTouchHandler = button._batchTouchHandler;

                if (oldClickHandler) {
                    button.removeEventListener('click', oldClickHandler);
                }
                if (oldTouchHandler) {
                    button.removeEventListener('touchend', oldTouchHandler);
                }

                // åˆ›å»ºæ–°çš„äº‹ä»¶å¤„ç†å™¨
                button._batchClickHandler = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();

                    const actionType = this.getAttribute('onclick') || this.className;
                    console.log('æ‰¹é‡æ“ä½œæŒ‰é’®ç‚¹å‡»:', actionType);

                    // æ·»åŠ è§†è§‰åé¦ˆ
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);

                    // æ‰§è¡Œå¯¹åº”çš„æ“ä½œ
                    if (this.classList.contains('delete-selected-btn')) {
                        deleteSelectedTasks();
                    } else if (this.classList.contains('select-all-btn')) {
                        selectAllTasks();
                    } else if (this.classList.contains('deselect-all-btn')) {
                        deselectAllTasks();
                    } else if (this.classList.contains('complete-selected-btn')) {
                        completeSelectedTasks();
                    } else if (this.classList.contains('cancel-batch-btn')) {
                        exitBatchMode();
                    }
                };

                // Android 14 ç‰¹æ®Šè§¦æ‘¸å¤„ç†
                if (needsAndroidOptimization) {
                    button._batchTouchHandler = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();

                        console.log('æ‰¹é‡æ“ä½œæŒ‰é’®touchendäº‹ä»¶');

                        // å»¶è¿Ÿæ‰§è¡Œï¼Œé¿å…ä¸clickäº‹ä»¶å†²çª
                        setTimeout(() => {
                            button._batchClickHandler.call(this, e);
                        }, 50);
                    };

                    // ç»‘å®šè§¦æ‘¸äº‹ä»¶
                    button.addEventListener('touchend', button._batchTouchHandler, { passive: false });

                    // ç¦ç”¨clickäº‹ä»¶é˜²æ­¢é‡å¤è§¦å‘
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        return false;
                    }, { passive: false, capture: true });
                } else {
                    // éAndroid 14è®¾å¤‡ä½¿ç”¨æ ‡å‡†clickäº‹ä»¶
                    button.addEventListener('click', button._batchClickHandler, { passive: false });
                }
            });

            console.log('æ‰¹é‡æ¨¡å¼äº‹ä»¶ç»‘å®šå®Œæˆï¼Œå¤„ç†æŒ‰é’®æ•°:', batchButtons.length);
        }

        // æ–°å¢çš„ç­›é€‰å™¨åŠŸèƒ½å‡½æ•°

        // æŠ˜å /å±•å¼€ç­›é€‰è¡Œ
        function toggleCollapsibleRows() {
            const collapsibleRows = document.querySelectorAll('.collapsible-row');
            const toggleBtn = document.getElementById('collapseToggleBtn');

            let isAnyCollapsed = false;
            collapsibleRows.forEach(row => {
                if (row.classList.contains('collapsed')) {
                    isAnyCollapsed = true;
                }
            });

            if (isAnyCollapsed) {
                // å±•å¼€æ‰€æœ‰è¡Œ
                collapsibleRows.forEach(row => {
                    row.classList.remove('collapsed');
                });
                toggleBtn.textContent = 'ğŸ“‹ æŠ˜å ç­›é€‰';
                toggleBtn.classList.remove('active');
            } else {
                // æŠ˜å æ‰€æœ‰è¡Œ
                collapsibleRows.forEach(row => {
                    row.classList.add('collapsed');
                });
                toggleBtn.textContent = 'ğŸ“‹ å±•å¼€ç­›é€‰';
                toggleBtn.classList.add('active');
            }
        }

        // ç»Ÿä¸€çš„ç­›é€‰åº”ç”¨å‡½æ•°
        function applyFilters() {
            const keyword = document.getElementById('keywordSearch').value.toLowerCase();
            const dateFilter = document.getElementById('dateFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = getCustomSelectValues('statusFilter');
            const assigneeFilter = getCustomSelectValues('assigneeFilter');
            const sortBy = document.getElementById('sortFilter').value;
            const sortOrder = document.getElementById('sortOrderFilter').value;
            const customDate = document.getElementById('customDatePicker').value;

            // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨
            const customDateGroup = document.getElementById('customDateGroup');
            if (dateFilter === 'custom') {
                customDateGroup.style.display = 'block';
            } else {
                customDateGroup.style.display = 'none';
            }

            let filteredTasks = tasks.filter(task => {
                // å…³é”®å­—ç­›é€‰
                if (keyword && !task.title.toLowerCase().includes(keyword) &&
                    !(task.notes && task.notes.toLowerCase().includes(keyword))) {
                    return false;
                }

                // æ—¥æœŸç­›é€‰
                if (!filterByDate(task, dateFilter, customDate)) {
                    return false;
                }

                // ä¼˜å…ˆçº§ç­›é€‰
                if (priorityFilter !== 'all' && task.priority !== priorityFilter) {
                    return false;
                }

                // åˆ†ç±»ç­›é€‰
                if (categoryFilter !== 'all' && task.category !== categoryFilter) {
                    return false;
                }

                // çŠ¶æ€ç­›é€‰
                if (!filterByStatus(task, statusFilter)) {
                    return false;
                }

                // å®Œæˆäººç­›é€‰
                if (!filterByAssignee(task, assigneeFilter)) {
                    return false;
                }

                return true;
            });

            // æ’åº
            filteredTasks = sortTasks(filteredTasks, sortBy, sortOrder);

            // æ¸²æŸ“ç­›é€‰åçš„ä»»åŠ¡
            renderFilteredTasks(filteredTasks);
        }

        // è·å–å¤šé€‰ä¸‹æ‹‰æ¡†çš„å€¼
        function getMultiSelectValues(selectId) {
            const select = document.getElementById(selectId);
            const values = [];
            if (select && select.selectedOptions) {
                for (let option of select.selectedOptions) {
                    values.push(option.value);
                }
            }
            return values;
        }

        // æ—¥æœŸç­›é€‰é€»è¾‘
        function filterByDate(task, dateFilter, customDate) {
            if (dateFilter === 'all') return true;

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const taskDate = task.deadline ? new Date(task.deadline) : null;

            switch (dateFilter) {
                case 'today':
                    return taskDate && taskDate.toDateString() === today.toDateString();
                case 'tomorrow':
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    return taskDate && taskDate.toDateString() === tomorrow.toDateString();
                case 'week':
                    if (!taskDate) return false;
                    const weekEnd = new Date(today);
                    weekEnd.setDate(weekEnd.getDate() + 7);
                    return taskDate >= today && taskDate <= weekEnd;
                case 'overdue':
                    return taskDate && taskDate < today && !task.completed;
                case 'custom':
                    if (!customDate || !taskDate) return !customDate;
                    const selectedDate = new Date(customDate);
                    return taskDate.toDateString() === selectedDate.toDateString();
                default:
                    return true;
            }
        }

        // çŠ¶æ€ç­›é€‰é€»è¾‘
        function filterByStatus(task, statusFilters) {
            if (statusFilters.includes('all')) return true;

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const taskDate = task.deadline ? new Date(task.deadline) : null;
            const isOverdue = taskDate && taskDate < today && !task.completed;

            if (statusFilters.includes('overdue') && isOverdue) return true;
            if (statusFilters.includes('completed') && task.completed) return true;
            if (statusFilters.includes('active') && !task.completed && !isOverdue) return true;

            return false;
        }

        // å®Œæˆäººç­›é€‰é€»è¾‘
        function filterByAssignee(task, assigneeFilters) {
            if (assigneeFilters.includes('all')) return true;

            // æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†"æœªæŒ‡å®š"é€‰é¡¹
            const hasUnassignedFilter = assigneeFilters.includes('unassigned');

            // åˆ¤æ–­ä»»åŠ¡æ˜¯å¦ä¸ºæœªæŒ‡å®šæ‰§è¡Œäºº
            const isTaskUnassigned = (!task.assignees || task.assignees.length === 0) &&
                                     (!task.assignee || task.assignee === '');

            // å¦‚æœé€‰æ‹©äº†"æœªæŒ‡å®š"ä¸”ä»»åŠ¡ç¡®å®æœªæŒ‡å®šæ‰§è¡Œäººï¼Œåˆ™è¿”å›true
            if (hasUnassignedFilter && isTaskUnassigned) {
                return true;
            }

            // å¦‚æœåªé€‰æ‹©äº†"æœªæŒ‡å®š"ä½†ä»»åŠ¡æœ‰æ‰§è¡Œäººï¼Œåˆ™è¿”å›false
            if (assigneeFilters.length === 1 && hasUnassignedFilter && !isTaskUnassigned) {
                return false;
            }

            // æ”¯æŒå¤šå®Œæˆäººç­›é€‰
            if (task.assignees && Array.isArray(task.assignees)) {
                return task.assignees.some(assignee => assigneeFilters.includes(assignee));
            }

            // å‘åå…¼å®¹å•ä¸ªå®Œæˆäºº
            const taskAssignee = task.assignee || '';
            return assigneeFilters.includes(taskAssignee);
        }

        // ä»»åŠ¡æ’åº
        function sortTasks(tasks, sortBy, sortOrder) {
            return tasks.sort((a, b) => {
                let comparison = 0;

                switch (sortBy) {
                    case 'deadline':
                        const dateA = a.deadline ? new Date(a.deadline) : new Date('9999-12-31');
                        const dateB = b.deadline ? new Date(b.deadline) : new Date('9999-12-31');
                        comparison = dateA - dateB;
                        break;
                    case 'priority':
                        const priorityOrder = { high: 3, medium: 2, low: 1 };
                        comparison = (priorityOrder[b.priority] || 0) - (priorityOrder[a.priority] || 0);
                        break;
                    case 'created':
                        comparison = new Date(a.createdAt || 0) - new Date(b.createdAt || 0);
                        break;
                    case 'category':
                        comparison = (a.category || '').localeCompare(b.category || '');
                        break;
                    default:
                        return 0;
                }

                return sortOrder === 'desc' ? -comparison : comparison;
            });
        }

        // æ¸²æŸ“ç­›é€‰åçš„ä»»åŠ¡
        function renderFilteredTasks(filteredTasks, preserveScrollPosition = false) {
            // ç›´æ¥æ¸²æŸ“ä»»åŠ¡ï¼Œé¿å…é€’å½’è°ƒç”¨
            const taskList = document.getElementById('taskList');

            if (!taskList) {
                console.error('æœªæ‰¾åˆ°taskListå…ƒç´ ');
                return;
            }

            // ä¿å­˜å½“å‰æ»šåŠ¨ä½ç½®ï¼ˆåªåœ¨éœ€è¦æ—¶ï¼‰
            const scrollTop = preserveScrollPosition ? (window.pageYOffset || document.documentElement.scrollTop) : 0;

            // æ£€æŸ¥æ˜¯å¦æ²¡æœ‰ä»»åŠ¡
            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”</div>
                        <div>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä»»åŠ¡</div>
                    </div>
                `;
            } else {
                // å¤ç”¨åŸå§‹renderTasksçš„HTMLç”Ÿæˆé€»è¾‘
                const isBatchMode = document.body.classList.contains('batch-mode');

                // ä¸ºä»»åŠ¡åˆ—è¡¨æ·»åŠ æ‰¹é‡æ¨¡å¼ç±»
                const taskListElement = document.getElementById('taskList');
                if (isBatchMode) {
                    taskListElement.classList.add('batch-mode');
                } else {
                    taskListElement.classList.remove('batch-mode');
                }

                taskList.innerHTML = filteredTasks.map(task => {
                    const isOverdue = task.deadline && new Date(task.deadline) < new Date() && !task.completed;
                    const isSelected = selectedTasks.has(task.id);

                    // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ“ä½œæ­¤ä»»åŠ¡ï¼ˆæƒé™æ§åˆ¶ï¼‰
                    let canOperate = true;
                    if (personalInfo.enableRoleRestriction && personalInfo.myAssignee) {
                        if (task.assignees && Array.isArray(task.assignees)) {
                            canOperate = task.assignees.length === 0 || task.assignees.includes(personalInfo.myAssignee);
                        } else {
                            canOperate = !task.assignee || task.assignee === personalInfo.myAssignee;
                        }
                    }

                    const buttonDisabled = !canOperate;
                    const buttonTitle = buttonDisabled ?
                        `æ­¤ä»»åŠ¡åˆ†é…ç»™"${task.assignee}"ï¼Œæ‚¨æ— æ³•æ“ä½œ` :
                        (task.completed ? 'æ ‡è®°ä¸ºæœªå®Œæˆ' : 'æ ‡è®°ä¸ºå®Œæˆ');

                    return `
                        <div class="task-item ${task.completed ? 'completed' : ''} ${isOverdue ? 'overdue' : ''} ${isSelected ? 'selected' : ''} ${buttonDisabled ? 'not-operable' : ''}" data-id="${task.id}">
                            ${isBatchMode ? `<input type="checkbox" class="batch-checkbox" data-task-id="${task.id}" ${isSelected ? 'checked' : ''} ${buttonDisabled ? 'disabled title="æ— æƒé™æ“ä½œæ­¤ä»»åŠ¡"' : ''}>` : ''}
                            <button class="task-complete-btn ${task.completed ? 'completed' : ''} ${buttonDisabled ? 'disabled' : ''}"
                                    data-task-id="${task.id}"
                                    title="${buttonTitle}"
                                    ${buttonDisabled ? 'disabled' : ''}>
                                ${task.completed ? 'âœ…' : 'â­•'}
                            </button>
                            <div class="task-content">
                                <div class="task-title">
                                    ${isOverdue ? '<span class="overdue-badge">è¶…æ—¶</span>' : ''}
                                    ${escapeHtml(task.title || task.text || 'æ— æ ‡é¢˜')}
                                </div>
                                ${task.notes ? `<div class="task-notes">${escapeHtml(task.notes)}</div>` : ''}
                                <div class="task-meta">
                                    <span class="task-category category-${task.category}">${getCategoryName(task.category)}</span>
                                    <span class="task-priority priority-${task.priority}">${getPriorityName(task.priority)}</span>
                                    ${task.deadline ? `<span class="task-deadline ${isOverdue ? 'overdue' : ''}">${formatDeadline(task.deadline)}</span>` : ''}
                                    ${task.assignees && task.assignees.length > 0 ? `<span class="task-assignee">ğŸ‘¤ ${task.assignees.join(', ')}</span>` : task.assignee ? `<span class="task-assignee">ğŸ‘¤ ${task.assignee}</span>` : ''}
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="edit-btn ${buttonDisabled ? 'disabled' : ''}" data-task-id="${task.id}" title="${buttonDisabled ? 'æ— æƒé™æ“ä½œæ­¤ä»»åŠ¡' : 'ç¼–è¾‘ä»»åŠ¡'}" ${buttonDisabled ? 'disabled' : ''}>
                                    <span class="emoji-icon">âœï¸</span>
                                </button>
                                <button class="delete-btn ${buttonDisabled ? 'disabled' : ''}" data-task-id="${task.id}" title="${buttonDisabled ? 'æ— æƒé™æ“ä½œæ­¤ä»»åŠ¡' : 'åˆ é™¤ä»»åŠ¡'}" ${buttonDisabled ? 'disabled' : ''}>
                                    <span class="emoji-icon">ğŸ—‘ï¸</span>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // é‡æ–°ç»‘å®šäº‹ä»¶
            bindTaskEvents();

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateFilterStats(filteredTasks);

            // æ¢å¤æ»šåŠ¨ä½ç½®ï¼ˆåªåœ¨éœ€è¦æ—¶ï¼‰
            if (preserveScrollPosition && scrollTop > 0) {
                setTimeout(() => {
                    window.scrollTo(0, scrollTop);
                }, 10);
            }
        }

        // æ›´æ–°ç­›é€‰ç»Ÿè®¡ä¿¡æ¯
        function updateFilterStats(filteredTasks) {
            const totalElement = document.getElementById('totalTasks');
            const completedElement = document.getElementById('completedTasks');
            const rateElement = document.getElementById('completionRate');

            if (totalElement) totalElement.textContent = filteredTasks.length;

            const completedCount = filteredTasks.filter(t => t.completed).length;
            if (completedElement) completedElement.textContent = completedCount;

            const completionRate = filteredTasks.length > 0 ? Math.round((completedCount / filteredTasks.length) * 100) : 0;
            if (rateElement) rateElement.textContent = completionRate + '%';
        }

        // æ¸…é™¤æ‰€æœ‰ç­›é€‰
        function clearAllFilters() {
            document.getElementById('keywordSearch').value = '';
            document.getElementById('dateFilter').value = 'today';
            document.getElementById('priorityFilter').value = 'all';
            document.getElementById('categoryFilter').value = 'all';

            // é‡ç½®è‡ªå®šä¹‰é€‰æ‹©å™¨
            customSelectValues.statusFilter = ['all'];
            customSelectValues.assigneeFilter = ['all'];
            updateCustomSelectCheckboxes('statusFilter');
            updateCustomSelectCheckboxes('assigneeFilter');
            updateCustomSelectDisplay('statusFilter');
            updateCustomSelectDisplay('assigneeFilter');
            updateCustomSelectTags('statusFilter');
            updateCustomSelectTags('assigneeFilter');

            document.getElementById('sortFilter').value = 'deadline';
            document.getElementById('sortOrderFilter').value = 'asc';

            // éšè—è‡ªå®šä¹‰æ—¥æœŸ
            document.getElementById('customDateGroup').style.display = 'none';

            // é‡æ–°æ¸²æŸ“æ‰€æœ‰ä»»åŠ¡
            renderTasks();
            updateStats();
        }

        // é‡ç½®å¤šé€‰ä¸‹æ‹‰æ¡†
        function resetMultiSelect(selectId, defaultValues) {
            const select = document.getElementById(selectId);
            for (let option of select.options) {
                option.selected = defaultValues.includes(option.value);
            }
        }

        // åŠ¨æ€æ›´æ–°å®Œæˆäººé€‰é¡¹
        function updateAssigneeFilterOptions() {
            const assigneeDropdown = document.getElementById('assigneeFilterDropdown');
            // ä½¿ç”¨é…ç½®çš„å®Œæˆäººåˆ—è¡¨ï¼Œè€Œä¸æ˜¯ä»ä»»åŠ¡ä¸­æå–
            const configuredAssignees = assignees.map(assignee =>
                typeof assignee === 'string' ? assignee : assignee.name
            );

            // ä¿å­˜å½“å‰é€‰ä¸­çš„å€¼
            const selectedValues = customSelectValues.assigneeFilter || ['all'];

            // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆé™¤äº†"æ‰€æœ‰äºº"å’Œ"æœªæŒ‡å®š"ï¼‰
            assigneeDropdown.innerHTML = `
                <div class="custom-select-option" data-value="all">
                    <input type="checkbox" class="custom-select-checkbox" ${selectedValues.includes('all') ? 'checked' : ''}>
                    <span>æ‰€æœ‰äºº</span>
                </div>
                <div class="custom-select-option" data-value="unassigned">
                    <input type="checkbox" class="custom-select-checkbox" ${selectedValues.includes('unassigned') ? 'checked' : ''}>
                    <span>æœªæŒ‡å®š</span>
                </div>
            `;

            // æ·»åŠ é…ç½®çš„å®Œæˆäººé€‰é¡¹
            configuredAssignees.forEach(assignee => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'custom-select-option';
                optionDiv.dataset.value = assignee;
                optionDiv.innerHTML = `
                    <input type="checkbox" class="custom-select-checkbox" ${selectedValues.includes(assignee) ? 'checked' : ''}>
                    <span>${assignee}</span>
                `;
                assigneeDropdown.appendChild(optionDiv);
            });

            // é‡æ–°ç»‘å®šé€‰é¡¹çš„äº‹ä»¶ç›‘å¬å™¨
            assigneeDropdown.querySelectorAll('.custom-select-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    e.stopPropagation();
                    handleCustomSelectOption('assigneeFilter', this);
                });
            });

            // æ›´æ–°é€‰ä¸­çŠ¶æ€å’Œæ˜¾ç¤º
            updateCustomSelectCheckboxes('assigneeFilter');
            updateCustomSelectDisplay('assigneeFilter');
            updateCustomSelectTags('assigneeFilter');
        }

        // åœ¨ä»»åŠ¡åŠ è½½æˆ–æ›´æ–°æ—¶è°ƒç”¨
        function initializeFilters() {
            updateAssigneeFilterOptions();

            // å¦‚æœæ²¡æœ‰é€‰ä¸­ä»»ä½•å®Œæˆäººï¼Œé»˜è®¤é€‰ä¸­"æ‰€æœ‰äºº"
            const assigneeFilter = document.getElementById('assigneeFilter');
            if (assigneeFilter && assigneeFilter.selectedOptions && assigneeFilter.selectedOptions.length === 0) {
                assigneeFilter.options[0].selected = true;
            }
        }

        // ä¿®æ”¹æ‰¹é‡æ¨¡å¼æŒ‰é’®çŠ¶æ€
        function updateBatchModeButton() {
            const batchToggleBtn = document.getElementById('batchToggleBtn');
            if (batchToggleBtn) {
                if (isBatchMode) {
                    batchToggleBtn.textContent = 'âŒ é€€å‡ºæ‰¹é‡';
                    batchToggleBtn.classList.add('active');
                } else {
                    batchToggleBtn.textContent = 'â˜‘ï¸ æ‰¹é‡æ¨¡å¼';
                    batchToggleBtn.classList.remove('active');
                }
            }
        }

        // æ›´æ–°å¤šé€‰ä¸‹æ‹‰æ¡†çš„UIçŠ¶æ€
        function updateMultiSelectUI(selectElement) {
            if (!selectElement || !selectElement.selectedOptions) {
                return;
            }
            const selectedOptions = Array.from(selectElement.selectedOptions);
            const totalOptions = selectElement.options.length;
            const selectId = selectElement.id;
            const countElement = document.getElementById(selectId + 'Count');

            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            selectElement.classList.remove('all-selected', 'partial-selected');

            // è¿‡æ»¤æ‰"å…¨éƒ¨"é€‰é¡¹æ¥è®¡ç®—å®é™…é€‰ä¸­æ•°é‡
            const nonAllOptions = selectedOptions.filter(option => option.value !== 'all');
            const actualSelectedCount = nonAllOptions.length;

            // æ›´æ–°æ•°é‡æ˜¾ç¤º
            if (countElement) {
                if (actualSelectedCount > 1) {
                    countElement.textContent = actualSelectedCount;
                    countElement.classList.add('show');
                } else {
                    countElement.classList.remove('show');
                }
            }

            // æ›´æ–°é€‰æ‹©æ¡†æ ·å¼
            if (selectedOptions.some(option => option.value === 'all')) {
                // é€‰ä¸­äº†"å…¨éƒ¨"
                selectElement.classList.add('all-selected');
            } else if (actualSelectedCount > 0) {
                // éƒ¨åˆ†é€‰ä¸­
                selectElement.classList.add('partial-selected');
            }

            // å¤„ç†"å…¨éƒ¨"é€‰é¡¹çš„é€»è¾‘
            const allOption = selectElement.querySelector('option[value="all"]');
            if (allOption) {
                if (allOption.selected && actualSelectedCount > 0) {
                    // å¦‚æœåŒæ—¶é€‰ä¸­äº†"å…¨éƒ¨"å’Œå…¶ä»–é€‰é¡¹ï¼Œå–æ¶ˆå…¶ä»–é€‰é¡¹
                    Array.from(selectElement.options).forEach(option => {
                        if (option.value !== 'all') {
                            option.selected = false;
                        }
                    });
                } else if (!allOption.selected && actualSelectedCount === 0) {
                    // å¦‚æœæ²¡æœ‰é€‰ä¸­ä»»ä½•é€‰é¡¹ï¼Œè‡ªåŠ¨é€‰ä¸­"å…¨éƒ¨"
                    allOption.selected = true;
                }
            }
        }

        // åˆå§‹åŒ–å¤šé€‰UIçŠ¶æ€
        function initializeMultiSelectUI() {
            const multiSelects = document.querySelectorAll('select[multiple].filter-select');
            multiSelects.forEach(select => {
                updateMultiSelectUI(select);
            });
        }

        // åˆå§‹åŒ–å®Œæˆäººä¸‹æ‹‰æ¡† - ä¿®å¤ç¼ºå¤±çš„å‡½æ•°
        function initializeAssigneeDropdown(type) {
            const optionsContainer = document.getElementById(`${type}TaskAssigneeOptions`);
            const displayElement = document.getElementById(`${type}TaskAssigneeDisplay`);

            if (!optionsContainer || !displayElement) {
                console.warn(`initializeAssigneeDropdown: æ‰¾ä¸åˆ°${type}çš„ä¸‹æ‹‰æ¡†å…ƒç´ `);
                return;
            }

            // ç¡®ä¿selectedAssignees[type]å·²åˆå§‹åŒ–
            if (!selectedAssignees[type]) {
                selectedAssignees[type] = [];
            }

            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            optionsContainer.innerHTML = '';

            // ä½¿ç”¨é…ç½®çš„å®Œæˆäººåˆ—è¡¨
            const allAssignees = assignees.map(assignee =>
                typeof assignee === 'string' ? assignee : assignee.name
            );

            // ä¸ºæ¯ä¸ªå®Œæˆäººåˆ›å»ºé€‰é¡¹
            allAssignees.forEach(assigneeName => {
                // æ£€æŸ¥æ˜¯å¦å·²è¢«é€‰ä¸­
                const isSelected = selectedAssignees[type].includes(assigneeName);

                const optionDiv = document.createElement('div');
                optionDiv.className = 'assignee-option';
                optionDiv.innerHTML = `
                    <input type="checkbox" id="${type}_${assigneeName}" value="${assigneeName}" ${isSelected ? 'checked' : ''} onchange="updateAssigneeSelection('${type}')">
                    <label for="${type}_${assigneeName}">${assigneeName}</label>
                `;

                optionsContainer.appendChild(optionDiv);
            });

            // æ›´æ–°æ˜¾ç¤º
            updateAssigneeDisplay(type);
        }

        // æ›´æ–°å®Œæˆäººé€‰æ‹©çŠ¶æ€
        function updateAssigneeSelection(type) {
            const optionsContainer = document.getElementById(`${type}TaskAssigneeOptions`);
            if (!optionsContainer) return;

            const checkboxes = optionsContainer.querySelectorAll('input[type="checkbox"]:checked');
            selectedAssignees[type] = Array.from(checkboxes).map(cb => cb.value);

            updateAssigneeDisplay(type);
        }

        // ========== è‡ªå®šä¹‰ä¸‹æ‹‰é€‰æ‹©å™¨åŠŸèƒ½ ==========

        // å­˜å‚¨è‡ªå®šä¹‰é€‰æ‹©å™¨çš„é€‰ä¸­å€¼
        let customSelectValues = {
            statusFilter: ['all'],
            assigneeFilter: ['all']
        };

        // åˆ‡æ¢è‡ªå®šä¹‰ä¸‹æ‹‰é€‰æ‹©å™¨
        function toggleCustomSelect(selectId) {
            console.log('toggleCustomSelect è°ƒç”¨:', selectId); // è°ƒè¯•æ—¥å¿—
            const dropdown = document.getElementById(selectId + 'Dropdown');
            console.log('æ‰¾åˆ°ä¸‹æ‹‰æ¡†:', dropdown); // è°ƒè¯•æ—¥å¿—

            if (!dropdown) {
                console.error('æœªæ‰¾åˆ°ä¸‹æ‹‰æ¡†:', selectId + 'Dropdown');
                return;
            }

            const trigger = dropdown.previousElementSibling;
            console.log('æ‰¾åˆ°è§¦å‘å™¨:', trigger); // è°ƒè¯•æ—¥å¿—

            // å…³é—­å…¶ä»–ä¸‹æ‹‰æ¡†
            document.querySelectorAll('.custom-select-dropdown.active').forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('active');
                    d.previousElementSibling.classList.remove('active');
                }
            });

            // åˆ‡æ¢å½“å‰ä¸‹æ‹‰æ¡†
            const wasActive = dropdown.classList.contains('active');
            dropdown.classList.toggle('active');
            trigger.classList.toggle('active');

            console.log('ä¸‹æ‹‰æ¡†çŠ¶æ€ä»', wasActive, 'å˜ä¸º', dropdown.classList.contains('active')); // è°ƒè¯•æ—¥å¿—
        }

        // å¤„ç†è‡ªå®šä¹‰é€‰æ‹©å™¨é€‰é¡¹ç‚¹å‡»
        function handleCustomSelectOption(selectId, optionElement) {
            const checkbox = optionElement.querySelector('.custom-select-checkbox');
            const value = optionElement.dataset.value;

            // åˆ‡æ¢å¤é€‰æ¡†çŠ¶æ€
            checkbox.checked = !checkbox.checked;

            // æ›´æ–°é€‰ä¸­å€¼æ•°ç»„
            if (checkbox.checked) {
                if (value === 'all') {
                    // é€‰ä¸­"å…¨éƒ¨"æ—¶ï¼Œå–æ¶ˆå…¶ä»–æ‰€æœ‰é€‰é¡¹
                    customSelectValues[selectId] = ['all'];
                    updateCustomSelectCheckboxes(selectId);
                } else {
                    // é€‰ä¸­å…·ä½“é€‰é¡¹æ—¶ï¼Œå–æ¶ˆ"å…¨éƒ¨"
                    customSelectValues[selectId] = customSelectValues[selectId].filter(v => v !== 'all');
                    if (!customSelectValues[selectId].includes(value)) {
                        customSelectValues[selectId].push(value);
                    }
                }
            } else {
                // å–æ¶ˆé€‰ä¸­
                customSelectValues[selectId] = customSelectValues[selectId].filter(v => v !== value);

                // å¦‚æœæ²¡æœ‰é€‰ä¸­ä»»ä½•é¡¹ï¼Œè‡ªåŠ¨é€‰ä¸­"å…¨éƒ¨"
                if (customSelectValues[selectId].length === 0) {
                    customSelectValues[selectId] = ['all'];
                    updateCustomSelectCheckboxes(selectId);
                }
            }

            // æ›´æ–°æ˜¾ç¤º
            updateCustomSelectDisplay(selectId);
            updateCustomSelectTags(selectId);

            // åº”ç”¨ç­›é€‰
            applyFilters();
        }

        // æ›´æ–°è‡ªå®šä¹‰é€‰æ‹©å™¨çš„å¤é€‰æ¡†çŠ¶æ€
        function updateCustomSelectCheckboxes(selectId) {
            const dropdown = document.getElementById(selectId + 'Dropdown');
            const options = dropdown.querySelectorAll('.custom-select-option');

            options.forEach(option => {
                const checkbox = option.querySelector('.custom-select-checkbox');
                const value = option.dataset.value;
                checkbox.checked = customSelectValues[selectId].includes(value);

                // æ›´æ–°é€‰é¡¹æ ·å¼
                if (checkbox.checked) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        // æ›´æ–°è‡ªå®šä¹‰é€‰æ‹©å™¨çš„æ˜¾ç¤ºæ–‡æœ¬
        function updateCustomSelectDisplay(selectId) {
            const display = document.getElementById(selectId + 'Display');
            const values = customSelectValues[selectId];

            if (values.includes('all')) {
                if (selectId === 'statusFilter') {
                    display.textContent = 'å…¨éƒ¨';
                } else {
                    display.textContent = 'æ‰€æœ‰äºº';
                }
            } else if (values.length === 1) {
                // å•ä¸ªé€‰æ‹©æ˜¾ç¤ºå…·ä½“æ–‡æœ¬
                const option = document.querySelector(`#${selectId}Dropdown [data-value="${values[0]}"]`);
                if (option) {
                    display.textContent = option.querySelector('span').textContent;
                }
            } else {
                // å¤šä¸ªé€‰æ‹©æ˜¾ç¤ºæ•°é‡
                display.textContent = `å·²é€‰æ‹© ${values.length} é¡¹`;
            }
        }

        // æ›´æ–°è‡ªå®šä¹‰é€‰æ‹©å™¨çš„æ ‡ç­¾æ˜¾ç¤º
        function updateCustomSelectTags(selectId) {
            const tagsContainer = document.getElementById(selectId + 'Tags');
            const values = customSelectValues[selectId];

            tagsContainer.innerHTML = '';

            if (values.includes('all')) {
                // é€‰æ‹©å…¨éƒ¨æ—¶ä¸æ˜¾ç¤ºæ ‡ç­¾
                return;
            }

            if (values.length > 1) {
                values.forEach(value => {
                    const option = document.querySelector(`#${selectId}Dropdown [data-value="${value}"]`);
                    if (option) {
                        const tag = document.createElement('span');
                        tag.className = 'selected-tag';

                        // ä¸ºçŠ¶æ€æ·»åŠ ç‰¹æ®Šé¢œè‰²
                        if (selectId === 'statusFilter') {
                            tag.classList.add(`status-tag-${value}`);
                        } else {
                            tag.classList.add('assignee-tag');
                        }

                        tag.textContent = option.querySelector('span').textContent;
                        tagsContainer.appendChild(tag);
                    }
                });
            }
        }

        // åˆå§‹åŒ–è‡ªå®šä¹‰é€‰æ‹©å™¨
        function initializeCustomSelects() {
            // ä¸ºæ‰€æœ‰è§¦å‘å™¨æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.custom-select-trigger').forEach(trigger => {
                trigger.addEventListener('click', function(e) {
                    // åªåœ¨è‡ªå®šä¹‰é€‰æ‹©å™¨å†…éƒ¨åœæ­¢ä¼ æ’­ï¼Œä¸å½±å“å…¶ä»–å…ƒç´ 
                    e.stopPropagation();
                    const selectId = this.dataset.selectId;
                    console.log('è§¦å‘å™¨ç‚¹å‡»:', selectId); // è°ƒè¯•æ—¥å¿—
                    toggleCustomSelect(selectId);
                });
            });

            // ä¸ºæ‰€æœ‰é€‰é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.custom-select-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    // åªåœ¨è‡ªå®šä¹‰é€‰æ‹©å™¨å†…éƒ¨åœæ­¢ä¼ æ’­ï¼Œä¸å½±å“å…¶ä»–å…ƒç´ 
                    e.stopPropagation();
                    const selectId = this.closest('.custom-select-dropdown').id.replace('Dropdown', '');
                    handleCustomSelectOption(selectId, this);
                });
            });

            // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰æ¡† - ç¡®ä¿ä¸å¹²æ‰°æ¨¡æ€æ¡†äº‹ä»¶
            document.addEventListener('click', function(e) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯æ¨¡æ€æ¡†ç›¸å…³å…ƒç´ ï¼Œä¸å¤„ç†ä¸‹æ‹‰æ¡†å…³é—­
                if (e.target.closest('.modal') ||
                    e.target.closest('.close-btn') ||
                    e.target.classList.contains('close-btn') ||
                    e.target.closest('[id*="cancel"]') ||
                    e.target.closest('[id*="close"]') ||
                    e.target.closest('[id*="Modal"]') ||
                    e.target.closest('.modal-content') ||
                    e.target.closest('.modal-header') ||
                    e.target.closest('.modal-footer') ||
                    e.target.id.includes('cancel') ||
                    e.target.id.includes('close') ||
                    e.target.id.includes('Cancel') ||
                    e.target.id.includes('Close')) {
                    return;
                }

                // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯è‡ªå®šä¹‰ä¸‹æ‹‰é€‰æ‹©å™¨ï¼Œå…³é—­æ‰€æœ‰ä¸‹æ‹‰æ¡†
                if (!e.target.closest('.custom-select')) {
                    document.querySelectorAll('.custom-select-dropdown.active').forEach(dropdown => {
                        dropdown.classList.remove('active');
                        dropdown.previousElementSibling.classList.remove('active');
                    });
                }
            });

            // åˆå§‹åŒ–æ˜¾ç¤º
            updateCustomSelectDisplay('statusFilter');
            updateCustomSelectDisplay('assigneeFilter');
        }

        // è·å–è‡ªå®šä¹‰é€‰æ‹©å™¨çš„å€¼ï¼ˆç”¨äºç­›é€‰é€»è¾‘ï¼‰
        function getCustomSelectValues(selectId) {
            return customSelectValues[selectId] || [];
        }


    </script>

    <!-- æ•°æ®åŒæ­¥Loadingè¦†ç›–å±‚ -->
    <div class="sync-loading-overlay" id="syncLoadingOverlay">
        <div class="sync-loading-content">
            <div class="sync-loading-spinner"></div>
            <div class="sync-loading-text" id="syncLoadingText">æ­£åœ¨åŒæ­¥æ•°æ®...</div>
            <div class="sync-loading-subtitle" id="syncLoadingSubtitle">è¯·ç¨å€™ï¼Œæ­£åœ¨ä¸äº‘ç«¯åŒæ­¥</div>
        </div>
    </div>
</body>
</html>